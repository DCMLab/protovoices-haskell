<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE PartialTypeSignatures #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- {-# LANGUAGE Strict #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NoStarIsType #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# HLINT ignore &quot;Use &lt;$&gt;&quot; #-}</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- {-# OPTIONS_GHC -O0 #-}</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- {-# OPTIONS_GHC -v #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-partial-type-signatures #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wredundant-constraints #-}</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-comment">-- {-# OPTIONS_GHC -fplugin GHC.TypeLits.KnownNat.Solver #-}</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- {-# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise #-}</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="RL.Model.html"><span class="hs-identifier">RL.Model</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Common</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Type.Equality</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:~:)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Refl</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(==)</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.TypeNums</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KnownNat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Nat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TInt</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intVal</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">intVal'</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(*)</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(+)</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(&lt;=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DT</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.ForeignPtr</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ptr</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OrderingI</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cmpNat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sameNat</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GreedyParser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DoubleParent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DoubleParent</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SingleParent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SingleParent</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OnlyCheckWhnf</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">allNoThunks</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="RL.Encoding.html"><span class="hs-identifier">RL.Encoding</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="RL.ModelTypes.html"><span class="hs-identifier">RL.ModelTypes</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="RL.TorchHelpers.html"><span class="hs-identifier">RL.TorchHelpers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.TorchHelpers.html#withBatchDim"><span class="hs-identifier">withBatchDim</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="RL.TorchHelpers.html"><span class="hs-identifier">RL.TorchHelpers</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch.Jit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TJit</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch.Lens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TL</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch.Typed</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TT</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch.Internal.Cast</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cast2</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Torch.Internal.Managed.Type.Tensor</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ATen</span></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-comment">-- Global Settings</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- ===============</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span id="local-6989586621679370643"><span id="local-6989586621679370645"><span class="annot"><a href="RL.Model.html#activation"><span class="hs-identifier hs-type">activation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370643"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370643"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370645"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370643"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370645"><span class="hs-identifier hs-type">shape</span></a></span></span></span><span>
</span><span id="line-53"></span><span id="activation"><span class="annot"><span class="annottext">activation :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var hs-var">activation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType shape -&gt; Tensor dev QDType shape
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
GeluDTypeIsValid device dtype =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.gelu</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- helpers</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- =======</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><a href="RL.Model.html#expandAs"><span class="hs-identifier hs-type">expandAs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Tensor</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Tensor</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Tensor</span></span><span>
</span><span id="line-59"></span><span id="expandAs"><span class="annot"><span class="annottext">expandAs :: Tensor -&gt; Tensor -&gt; Tensor
</span><a href="RL.Model.html#expandAs"><span class="hs-identifier hs-var hs-var">expandAs</span></a></span></span><span> </span><span id="local-6989586621679371574"><span class="annot"><span class="annottext">Tensor
</span><a href="#local-6989586621679371574"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679371575"><span class="annot"><span class="annottext">Tensor
</span><a href="#local-6989586621679371575"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Tensor -&gt; Tensor
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Tensor -&gt; Tensor) -&gt; IO Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ForeignPtr Tensor -&gt; ForeignPtr Tensor -&gt; IO (ForeignPtr Tensor))
-&gt; Tensor -&gt; Tensor -&gt; IO Tensor
forall a ca x1 cx1 y cy.
(Castable a ca, Castable x1 cx1, Castable y cy) =&gt;
(ca -&gt; cx1 -&gt; IO cy) -&gt; a -&gt; x1 -&gt; IO y
</span><span class="hs-identifier hs-var">cast2</span></span><span> </span><span class="annot"><span class="annottext">ForeignPtr Tensor -&gt; ForeignPtr Tensor -&gt; IO (ForeignPtr Tensor)
</span><span class="hs-identifier hs-var">ATen.tensor_expand_as_t</span></span><span> </span><span class="annot"><span class="annottext">Tensor
</span><a href="#local-6989586621679371574"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
</span><a href="#local-6989586621679371575"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span id="local-6989586621679370674"><span id="local-6989586621679370675"><span id="local-6989586621679370676"><span class="annot"><a href="RL.Model.html#traceDyn"><span class="hs-identifier hs-type">traceDyn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679370674"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370675"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370676"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679370674"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370675"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370676"><span class="hs-identifier hs-type">c</span></a></span></span></span></span><span>
</span><span id="line-62"></span><span id="traceDyn"><span class="annot"><span class="annottext">traceDyn :: forall (a :: (DeviceType, Nat)) (b :: DType) (c :: [Nat]).
Tensor a b c -&gt; Tensor a b c
</span><a href="RL.Model.html#traceDyn"><span class="hs-identifier hs-var hs-var">traceDyn</span></a></span></span><span> </span><span id="local-6989586621679371585"><span class="annot"><span class="annottext">Tensor a b c
</span><a href="#local-6989586621679371585"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Tensor a b c -&gt; Tensor a b c
forall a b. Show a =&gt; a -&gt; b -&gt; b
</span><span class="hs-identifier hs-var">DT.traceShow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor -&gt; [Int]
</span><span class="hs-identifier hs-var">T.shape</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; [Int]) -&gt; Tensor -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor a b c -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">Tensor a b c
</span><a href="#local-6989586621679371585"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor a b c
</span><a href="#local-6989586621679371585"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span id="local-6989586621679370688"><span id="local-6989586621679370689"><span id="local-6989586621679370690"><span id="local-6989586621679370691"><span class="annot"><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-type">unsafeReshape</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679370688"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370689"><span class="hs-identifier hs-type">dtype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370690"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679370688"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370689"><span class="hs-identifier hs-type">dtype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370691"><span class="hs-identifier hs-type">shape'</span></a></span></span></span></span></span><span>
</span><span id="line-65"></span><span id="unsafeReshape"><span class="annot"><span class="annottext">unsafeReshape :: forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var hs-var">unsafeReshape</span></a></span></span><span> </span><span id="local-6989586621679371591"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679371591"><span class="hs-identifier hs-var">shape</span></a></span></span><span> </span><span id="local-6989586621679371592"><span class="annot"><span class="annottext">Tensor dev dtype shape
</span><a href="#local-6989586621679371592"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor dev dtype shape'
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor dev dtype shape')
-&gt; Tensor -&gt; Tensor dev dtype shape'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Tensor -&gt; Tensor
</span><span class="hs-identifier hs-var">T.reshape</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679371591"><span class="hs-identifier hs-var">shape</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev dtype shape -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev dtype shape
</span><a href="#local-6989586621679371592"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- Q net</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- =====</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- Learned Constant Embeddings</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- ---------------------------</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">data</span><span> </span><span id="ConstEmbSpec"><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-var">ConstEmbSpec</span></a></span></span><span> </span><span id="local-6989586621679370922"><span class="annot"><a href="#local-6989586621679370922"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679370923"><span class="annot"><a href="#local-6989586621679370923"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Nat</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConstEmbSpec"><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-var">ConstEmbSpec</span></a></span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">newtype</span><span> </span><span id="ConstEmb"><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-var">ConstEmb</span></a></span></span><span> </span><span id="local-6989586621679370760"><span class="annot"><a href="#local-6989586621679370760"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679370761"><span class="annot"><a href="#local-6989586621679370761"><span class="hs-identifier hs-type">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ConstEmb"><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-var">ConstEmb</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Parameter</span></span><span> </span><span class="annot"><a href="#local-6989586621679370760"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370761"><span class="hs-identifier hs-type">shape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679371598"><span id="local-6989586621679371604"><span id="local-6989586621679371608"><span class="annot"><span class="annottext">Int -&gt; ConstEmb dev shape -&gt; ShowS
[ConstEmb dev shape] -&gt; ShowS
ConstEmb dev shape -&gt; String
(Int -&gt; ConstEmb dev shape -&gt; ShowS)
-&gt; (ConstEmb dev shape -&gt; String)
-&gt; ([ConstEmb dev shape] -&gt; ShowS)
-&gt; Show (ConstEmb dev shape)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Int -&gt; ConstEmb dev shape -&gt; ShowS
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
[ConstEmb dev shape] -&gt; ShowS
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Int -&gt; ConstEmb dev shape -&gt; ShowS
showsPrec :: Int -&gt; ConstEmb dev shape -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; String
show :: ConstEmb dev shape -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
[ConstEmb dev shape] -&gt; ShowS
showList :: [ConstEmb dev shape] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371613"><span id="local-6989586621679371615"><span class="annot"><span class="annottext">(forall x. ConstEmb dev shape -&gt; Rep (ConstEmb dev shape) x)
-&gt; (forall x. Rep (ConstEmb dev shape) x -&gt; ConstEmb dev shape)
-&gt; Generic (ConstEmb dev shape)
forall x. Rep (ConstEmb dev shape) x -&gt; ConstEmb dev shape
forall x. ConstEmb dev shape -&gt; Rep (ConstEmb dev shape) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]) x.
Rep (ConstEmb dev shape) x -&gt; ConstEmb dev shape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]) x.
ConstEmb dev shape -&gt; Rep (ConstEmb dev shape) x
$cfrom :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]) x.
ConstEmb dev shape -&gt; Rep (ConstEmb dev shape) x
from :: forall x. ConstEmb dev shape -&gt; Rep (ConstEmb dev shape) x
$cto :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]) x.
Rep (ConstEmb dev shape) x -&gt; ConstEmb dev shape
to :: forall x. Rep (ConstEmb dev shape) x -&gt; ConstEmb dev shape
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679371621"><span id="local-6989586621679371627"><span class="annot"><span class="annottext">ConstEmb dev shape -&gt; HList (Parameters (ConstEmb dev shape))
ConstEmb dev shape
-&gt; HList (Parameters (ConstEmb dev shape)) -&gt; ConstEmb dev shape
(ConstEmb dev shape -&gt; HList (Parameters (ConstEmb dev shape)))
-&gt; (ConstEmb dev shape
    -&gt; HList (Parameters (ConstEmb dev shape)) -&gt; ConstEmb dev shape)
-&gt; Parameterized (ConstEmb dev shape)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; HList (Parameters (ConstEmb dev shape))
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape
-&gt; HList (Parameters (ConstEmb dev shape)) -&gt; ConstEmb dev shape
$cflattenParameters :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; HList (Parameters (ConstEmb dev shape))
flattenParameters :: ConstEmb dev shape -&gt; HList (Parameters (ConstEmb dev shape))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape
-&gt; HList (Parameters (ConstEmb dev shape)) -&gt; ConstEmb dev shape
replaceParameters :: ConstEmb dev shape
-&gt; HList (Parameters (ConstEmb dev shape)) -&gt; ConstEmb dev shape
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371636"><span class="annot"><span class="annottext">ConstEmb dev shape -&gt; ()
(ConstEmb dev shape -&gt; ()) -&gt; NFData (ConstEmb dev shape)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmb dev shape -&gt; ()
rnf :: ConstEmb dev shape -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371644"><span id="local-6989586621679371649"><span id="local-6989586621679371653"><span class="annot"><span class="annottext">Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
Proxy (ConstEmb dev shape) -&gt; String
(Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (ConstEmb dev shape) -&gt; String)
-&gt; NoThunks (ConstEmb dev shape)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Proxy (ConstEmb dev shape) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; ConstEmb dev shape -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Proxy (ConstEmb dev shape) -&gt; String
showTypeOf :: Proxy (ConstEmb dev shape) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-80"></span><span>  </span><span id="local-6989586621679370757"><span id="local-6989586621679370758"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.TensorOptions</span></span><span> </span><span class="annot"><a href="#local-6989586621679370758"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370758"><span class="hs-identifier hs-type">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370758"><span class="hs-identifier hs-type">shape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sample</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370758"><span class="hs-identifier hs-type">shape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370757"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370758"><span class="hs-identifier hs-type">shape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span id="local-6989586621679371674"><span class="annot"><span class="annottext">sample :: ConstEmbSpec dev shape -&gt; IO (ConstEmb dev shape)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">ConstEmbSpec dev shape
</span><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-var">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parameter dev QDType shape -&gt; ConstEmb dev shape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
Parameter dev QDType shape -&gt; ConstEmb dev shape
</span><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-var">ConstEmb</span></a></span><span> </span><span class="annot"><span class="annottext">(Parameter dev QDType shape -&gt; ConstEmb dev shape)
-&gt; IO (Parameter dev QDType shape) -&gt; IO (ConstEmb dev shape)
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor dev QDType shape -&gt; IO (Parameter dev QDType shape)
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Tensor device dtype shape -&gt; IO (Parameter device dtype shape)
</span><span class="hs-identifier hs-var">TT.makeIndependent</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType shape -&gt; IO (Parameter dev QDType shape))
-&gt; IO (Tensor dev QDType shape) -&gt; IO (Parameter dev QDType shape)
forall (m :: Type -&gt; Type) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Tensor dev QDType shape)
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(TensorOptions shape dtype device,
 RandDTypeIsValid device dtype) =&gt;
IO (Tensor device dtype shape)
</span><span class="hs-identifier hs-var">TT.randn</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679370780"><span id="local-6989586621679370781"><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forward</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span id="local-6989586621679371684"><span class="annot"><span class="annottext">forward :: ConstEmb dev size -&gt; () -&gt; QTensor dev size
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span id="local-6989586621679371685"><span class="annot"><span class="annottext">Parameter dev QDType size
</span><a href="#local-6989586621679371685"><span class="hs-identifier hs-var">emb</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parameter dev QDType size -&gt; QTensor dev size
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Parameter device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.toDependent</span></span><span> </span><span class="annot"><span class="annottext">Parameter dev QDType size
</span><a href="#local-6989586621679371685"><span class="hs-identifier hs-var">emb</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forwardStoch</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370780"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370781"><span class="hs-identifier hs-type">size</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679371691"><span class="annot"><span class="annottext">forwardStoch :: ConstEmb dev size -&gt; () -&gt; IO (QTensor dev size)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679371692"><span class="annot"><span class="annottext">ConstEmb dev size
</span><a href="#local-6989586621679371692"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679371693"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679371693"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev size -&gt; IO (QTensor dev size)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev size -&gt; IO (QTensor dev size))
-&gt; QTensor dev size -&gt; IO (QTensor dev size)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev size -&gt; () -&gt; QTensor dev size
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev size
</span><a href="#local-6989586621679371692"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621679371693"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- Slice Encoder</span><span>
</span><span id="line-93"></span><span class="hs-comment">-- -------------</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">data</span><span> </span><span id="SliceSpec"><span class="annot"><a href="RL.Model.html#SliceSpec"><span class="hs-identifier hs-var">SliceSpec</span></a></span></span><span> </span><span id="local-6989586621679371345"><span class="annot"><a href="#local-6989586621679371345"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SliceSpec"><span class="annot"><a href="RL.Model.html#SliceSpec"><span class="hs-identifier hs-var">SliceSpec</span></a></span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">data</span><span> </span><span id="SliceEncoder"><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-var">SliceEncoder</span></a></span></span><span> </span><span id="local-6989586621679370787"><span class="annot"><a href="#local-6989586621679370787"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SliceEncoder"><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-var">SliceEncoder</span></a></span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="_slcL1"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
SliceEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="RL.Model.html#_slcL1"><span class="hs-identifier hs-var hs-var">_slcL1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QSliceHidden"><span class="hs-identifier hs-type">QSliceHidden</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370787"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (PSize spec) hidden QDType QDevice)</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_slcL2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
SliceEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#_slcL2"><span class="hs-identifier hs-var hs-var">_slcL2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QSliceHidden"><span class="hs-identifier hs-type">QSliceHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370787"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear hidden (EmbSize spec) QDType QDevice)</span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_slcStart"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
SliceEncoder dev -&gt; ConstEmb dev EmbShape
</span><a href="RL.Model.html#_slcStart"><span class="hs-identifier hs-var hs-var">_slcStart</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370787"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbShape"><span class="hs-identifier hs-type">EmbShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="_slcStop"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
SliceEncoder dev -&gt; ConstEmb dev EmbShape
</span><a href="RL.Model.html#_slcStop"><span class="hs-identifier hs-var hs-var">_slcStop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370787"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbShape"><span class="hs-identifier hs-type">EmbShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-comment">-- TODO: learn embedding for empty slice</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679371702"><span id="local-6989586621679371710"><span id="local-6989586621679371714"><span class="annot"><span class="annottext">Int -&gt; SliceEncoder dev -&gt; ShowS
[SliceEncoder dev] -&gt; ShowS
SliceEncoder dev -&gt; String
(Int -&gt; SliceEncoder dev -&gt; ShowS)
-&gt; (SliceEncoder dev -&gt; String)
-&gt; ([SliceEncoder dev] -&gt; ShowS)
-&gt; Show (SliceEncoder dev)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)). Int -&gt; SliceEncoder dev -&gt; ShowS
forall (dev :: (DeviceType, Nat)). [SliceEncoder dev] -&gt; ShowS
forall (dev :: (DeviceType, Nat)). SliceEncoder dev -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)). Int -&gt; SliceEncoder dev -&gt; ShowS
showsPrec :: Int -&gt; SliceEncoder dev -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)). SliceEncoder dev -&gt; String
show :: SliceEncoder dev -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)). [SliceEncoder dev] -&gt; ShowS
showList :: [SliceEncoder dev] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371717"><span id="local-6989586621679371719"><span class="annot"><span class="annottext">(forall x. SliceEncoder dev -&gt; Rep (SliceEncoder dev) x)
-&gt; (forall x. Rep (SliceEncoder dev) x -&gt; SliceEncoder dev)
-&gt; Generic (SliceEncoder dev)
forall x. Rep (SliceEncoder dev) x -&gt; SliceEncoder dev
forall x. SliceEncoder dev -&gt; Rep (SliceEncoder dev) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) x.
Rep (SliceEncoder dev) x -&gt; SliceEncoder dev
forall (dev :: (DeviceType, Nat)) x.
SliceEncoder dev -&gt; Rep (SliceEncoder dev) x
$cfrom :: forall (dev :: (DeviceType, Nat)) x.
SliceEncoder dev -&gt; Rep (SliceEncoder dev) x
from :: forall x. SliceEncoder dev -&gt; Rep (SliceEncoder dev) x
$cto :: forall (dev :: (DeviceType, Nat)) x.
Rep (SliceEncoder dev) x -&gt; SliceEncoder dev
to :: forall x. Rep (SliceEncoder dev) x -&gt; SliceEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371722"><span id="local-6989586621679371731"><span class="annot"><span class="annottext">SliceEncoder dev -&gt; HList (Parameters (SliceEncoder dev))
SliceEncoder dev
-&gt; HList (Parameters (SliceEncoder dev)) -&gt; SliceEncoder dev
(SliceEncoder dev -&gt; HList (Parameters (SliceEncoder dev)))
-&gt; (SliceEncoder dev
    -&gt; HList (Parameters (SliceEncoder dev)) -&gt; SliceEncoder dev)
-&gt; Parameterized (SliceEncoder dev)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)).
SliceEncoder dev -&gt; HList (Parameters (SliceEncoder dev))
forall (dev :: (DeviceType, Nat)).
SliceEncoder dev
-&gt; HList (Parameters (SliceEncoder dev)) -&gt; SliceEncoder dev
$cflattenParameters :: forall (dev :: (DeviceType, Nat)).
SliceEncoder dev -&gt; HList (Parameters (SliceEncoder dev))
flattenParameters :: SliceEncoder dev -&gt; HList (Parameters (SliceEncoder dev))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)).
SliceEncoder dev
-&gt; HList (Parameters (SliceEncoder dev)) -&gt; SliceEncoder dev
replaceParameters :: SliceEncoder dev
-&gt; HList (Parameters (SliceEncoder dev)) -&gt; SliceEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371799"><span id="local-6989586621679371803"><span id="local-6989586621679371809"><span class="annot"><span class="annottext">Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
Proxy (SliceEncoder dev) -&gt; String
(Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (SliceEncoder dev) -&gt; String)
-&gt; NoThunks (SliceEncoder dev)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)).
Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)).
Proxy (SliceEncoder dev) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; SliceEncoder dev -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)).
Proxy (SliceEncoder dev) -&gt; String
showTypeOf :: Proxy (SliceEncoder dev) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679371855"><span class="annot"><span class="annottext">SliceEncoder dev -&gt; ()
(SliceEncoder dev -&gt; ()) -&gt; NFData (SliceEncoder dev)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)). SliceEncoder dev -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)). SliceEncoder dev -&gt; ()
rnf :: SliceEncoder dev -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679370897"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceSpec"><span class="hs-identifier hs-type">SliceSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sample</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#SliceSpec"><span class="hs-identifier hs-type">SliceSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span id="local-6989586621679371909"><span class="annot"><span class="annottext">sample :: SliceSpec dev -&gt; IO (SliceEncoder dev)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">SliceSpec dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
-&gt; ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; SliceEncoder dev
Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; ConstEmb dev EmbShape
-&gt; ConstEmb dev EmbShape
-&gt; SliceEncoder dev
forall (dev :: (DeviceType, Nat)).
Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; ConstEmb dev EmbShape
-&gt; ConstEmb dev EmbShape
-&gt; SliceEncoder dev
</span><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-var">SliceEncoder</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="annot"><span class="annottext">(Conv2d 1 QSliceHidden 1 1 QDType dev
 -&gt; Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
 -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
 -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
 -&gt; SliceEncoder dev)
-&gt; IO (Conv2d 1 QSliceHidden 1 1 QDType dev)
-&gt; IO
     (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
      -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
      -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
      -&gt; SliceEncoder dev)
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec 1 QSliceHidden 1 1 QDType dev
-&gt; IO (Conv2d 1 QSliceHidden 1 1 QDType dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec 1 QSliceHidden 1 1 QDType dev
forall (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Conv2dSpec
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><span class="hs-identifier hs-var">TT.Conv2dSpec</span></span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">IO
  (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
   -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
   -&gt; ConstEmb dev '[QSliceHidden, 13, 5]
   -&gt; SliceEncoder dev)
-&gt; IO (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev)
-&gt; IO
     (ConstEmb dev '[QSliceHidden, 13, 5]
      -&gt; ConstEmb dev '[QSliceHidden, 13, 5] -&gt; SliceEncoder dev)
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
-&gt; IO (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
forall (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Conv2dSpec
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><span class="hs-identifier hs-var">TT.Conv2dSpec</span></span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">IO
  (ConstEmb dev '[QSliceHidden, 13, 5]
   -&gt; ConstEmb dev '[QSliceHidden, 13, 5] -&gt; SliceEncoder dev)
-&gt; IO (ConstEmb dev '[QSliceHidden, 13, 5])
-&gt; IO (ConstEmb dev '[QSliceHidden, 13, 5] -&gt; SliceEncoder dev)
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConstEmbSpec dev '[QSliceHidden, 13, 5]
-&gt; IO (ConstEmb dev '[QSliceHidden, 13, 5])
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (dev :: k) (shape :: [Nat]). ConstEmbSpec dev shape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmbSpec dev shape
</span><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-var">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">IO (ConstEmb dev '[QSliceHidden, 13, 5] -&gt; SliceEncoder dev)
-&gt; IO (ConstEmb dev '[QSliceHidden, 13, 5])
-&gt; IO (SliceEncoder dev)
forall a b. IO (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: Type -&gt; Type) a b.
Applicative f =&gt;
f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConstEmbSpec dev '[QSliceHidden, 13, 5]
-&gt; IO (ConstEmb dev '[QSliceHidden, 13, 5])
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (dev :: k) (shape :: [Nat]). ConstEmbSpec dev shape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
ConstEmbSpec dev shape
</span><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-var">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679370897"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><span class="hs-comment">-- | HasFoward for slice (unbatched)</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-117"></span><span>  </span><span id="local-6989586621679370927"><span id="local-6989586621679370928"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679370927"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbShape"><span class="hs-identifier hs-type">EmbShape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#SliceEncoding"><span class="hs-identifier hs-type">SliceEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370927"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-120"></span><span>  </span><span id="local-6989586621679371977"><span class="annot"><span class="annottext">forward :: SliceEncoder dev -&gt; SliceEncoding dev '[] -&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span id="local-6989586621679371978"><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679371978"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621679371979"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679371979"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679371980"><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679371980"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, QSliceHidden, 13, 5]
QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679371982"><span class="hs-identifier hs-var">out2</span></a></span><span>
</span><span id="line-121"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621679371983"><span class="annot"><span class="annottext">input :: Tensor dev QDType '[1, 1, 13, 5]
</span><a href="#local-6989586621679371983"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1, 13, 5] -&gt; Tensor dev QDType '[1, 1, 13, 5])
-&gt; Tensor dev QDType '[1, 13, 5]
-&gt; Tensor dev QDType '[1, 1, 13, 5]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[13, 5] -&gt; Tensor dev QDType '[1, 13, 5])
-&gt; Tensor dev QDType '[13, 5] -&gt; Tensor dev QDType '[1, 13, 5]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[] -&gt; QTensor dev ('[] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679371980"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><a href="#local-6989586621679371986"><span class="hs-identifier hs-type">out1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QSliceHidden"><span class="hs-identifier hs-type">QSliceHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679371986"><span class="annot"><span class="annottext">out1 :: QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679371986"><span class="hs-identifier hs-var hs-var">out1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679371978"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, 1, 13, 5]
</span><a href="#local-6989586621679371983"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="#local-6989586621679371982"><span class="hs-identifier hs-type">out2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370928"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbShape"><span class="hs-identifier hs-type">EmbShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679371982"><span class="annot"><span class="annottext">out2 :: QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679371982"><span class="hs-identifier hs-var hs-var">out2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (1 : EmbShape) -&gt; QTensor dev (1 : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (1 : EmbShape) -&gt; QTensor dev (1 : EmbShape))
-&gt; QTensor dev (1 : EmbShape) -&gt; QTensor dev (1 : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679371979"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, QSliceHidden, 13, 5]
QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679371986"><span class="hs-identifier hs-var">out1</span></a></span><span>
</span><span id="line-127"></span><span>  </span><span id="local-6989586621679371994"><span class="annot"><span class="annottext">forwardStoch :: SliceEncoder dev
-&gt; SliceEncoding dev '[] -&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679371995"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679371995"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; (SliceEncoding dev '[] -&gt; QTensor dev embshape)
-&gt; SliceEncoding dev '[]
-&gt; IO (QTensor dev embshape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev -&gt; SliceEncoding dev '[] -&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679371995"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><span class="hs-comment">-- | HasFoward for slice (batched)</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679370966"><span id="local-6989586621679370967"><span id="local-6989586621679370968"><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679370967"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679370968"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#SliceEncoding"><span class="hs-identifier hs-type">SliceEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679370968"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370967"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679372030"><span class="annot"><span class="annottext">forward :: SliceEncoder dev
-&gt; SliceEncoding dev '[batchSize] -&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span id="local-6989586621679372031"><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372031"><span class="hs-identifier hs-var">l1</span></a></span></span><span> </span><span id="local-6989586621679372032"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372032"><span class="hs-identifier hs-var">l2</span></a></span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679372033"><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372033"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372034"><span class="hs-identifier hs-var">out2</span></a></span><span>
</span><span id="line-137"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679372035"><span class="annot"><span class="annottext">input :: Tensor dev QDType '[batchSize, 1, 13, 5]
</span><a href="#local-6989586621679372035"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, 13, 5]
 -&gt; Tensor dev QDType '[batchSize, 1, 13, 5])
-&gt; Tensor dev QDType '[batchSize, 13, 5]
-&gt; Tensor dev QDType '[batchSize, 1, 13, 5]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
-&gt; QTensor dev ('[batchSize] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372033"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="#local-6989586621679372036"><span class="hs-identifier hs-type">out1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679370968"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QSliceHidden"><span class="hs-identifier hs-type">QSliceHidden</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679372036"><span class="annot"><span class="annottext">out1 :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372036"><span class="hs-identifier hs-var hs-var">out1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372031"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, 1, 13, 5]
</span><a href="#local-6989586621679372035"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="#local-6989586621679372034"><span class="hs-identifier hs-type">out2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370966"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679370968"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621679372034"><span class="annot"><span class="annottext">out2 :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372034"><span class="hs-identifier hs-var hs-var">out2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372032"><span class="hs-identifier hs-var">l2</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372036"><span class="hs-identifier hs-var">out1</span></a></span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621679372043"><span class="annot"><span class="annottext">forwardStoch :: SliceEncoder dev
-&gt; SliceEncoding dev '[batchSize] -&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679372044"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372044"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; (SliceEncoding dev '[batchSize] -&gt; QTensor dev embshape)
-&gt; SliceEncoding dev '[batchSize]
-&gt; IO (QTensor dev embshape)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; SliceEncoding dev '[batchSize] -&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372044"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">-- | HasForward for slice wrappend in QStartStop (unbatched).</span></span><span>
</span><span id="line-146"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-147"></span><span>  </span><span id="local-6989586621679370989"><span id="local-6989586621679370990"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679370989"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbShape"><span class="hs-identifier hs-type">EmbShape</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QStartStop"><span class="hs-identifier hs-type">QStartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#SliceEncoding"><span class="hs-identifier hs-type">SliceEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370989"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679372121"><span class="annot"><span class="annottext">forward :: SliceEncoder dev
-&gt; QStartStop dev '[] (SliceEncoding dev '[])
-&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span id="local-6989586621679372122"><span class="annot"><span class="annottext">model :: SliceEncoder dev
</span><a href="#local-6989586621679372122"><span class="hs-identifier hs-var">model</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679372123"><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><a href="#local-6989586621679372123"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679372124"><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><a href="#local-6989586621679372124"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QStartStop"><span class="hs-identifier hs-type">QStartStop</span></a></span><span> </span><span id="local-6989586621679372126"><span class="annot"><span class="annottext">Tensor dev 'Int64 '[]
</span><a href="#local-6989586621679372126"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621679372127"><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679372127"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, QSliceHidden, 13, 5]
QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679372128"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-151"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- compute the possible outputs for start/stop/inner</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621679372129"><span class="hs-identifier hs-type">outStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679372129"><span class="annot"><span class="annottext">outStart :: QTensor dev EmbShape
</span><a href="#local-6989586621679372129"><span class="hs-identifier hs-var hs-var">outStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; () -&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">TT.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
ConstEmb dev EmbShape
</span><a href="#local-6989586621679372123"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><a href="#local-6989586621679372130"><span class="hs-identifier hs-type">outStop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621679372130"><span class="annot"><span class="annottext">outStop :: QTensor dev EmbShape
</span><a href="#local-6989586621679372130"><span class="hs-identifier hs-var hs-var">outStop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; () -&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">TT.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
ConstEmb dev EmbShape
</span><a href="#local-6989586621679372124"><span class="hs-identifier hs-var">stop</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><a href="#local-6989586621679372131"><span class="hs-identifier hs-type">outInner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679372131"><span class="annot"><span class="annottext">outInner :: QTensor dev EmbShape
</span><a href="#local-6989586621679372131"><span class="hs-identifier hs-var hs-var">outInner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; SliceEncoding dev '[] -&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372122"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679372127"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- combine the outputs into one tensor</span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><a href="#local-6989586621679372132"><span class="hs-identifier hs-type">combined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span id="local-6989586621679372132"><span class="annot"><span class="annottext">combined :: QTensor dev (3 : EmbShape)
</span><a href="#local-6989586621679372132"><span class="hs-identifier hs-var hs-var">combined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [Type]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
forall {k} (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [k]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.stack</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(HList
   '[QTensor dev '[QSliceHidden, 13, 5],
     QTensor dev '[QSliceHidden, 13, 5],
     QTensor dev '[QSliceHidden, 13, 5]]
 -&gt; QTensor dev (3 : EmbShape))
-&gt; HList
     '[QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5]]
-&gt; QTensor dev (3 : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372129"><span class="hs-identifier hs-var">outStart</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
-&gt; HList
     '[QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5]]
-&gt; HList
     '[QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372131"><span class="hs-identifier hs-var">outInner</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
-&gt; HList '[QTensor dev '[QSliceHidden, 13, 5]]
-&gt; HList
     '[QTensor dev '[QSliceHidden, 13, 5],
       QTensor dev '[QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372130"><span class="hs-identifier hs-var">outStop</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
-&gt; HList '[] -&gt; HList '[QTensor dev '[QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">HList '[]
forall k. HList '[]
</span><span class="hs-identifier hs-var">TT.HNil</span></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-comment">-- use gather to select the right output.</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- gather can select different elements from 'dim' for each position,</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- so we expand the tag to the right shape, selecting the *same* 'dim'-index everywhere</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="#local-6989586621679372136"><span class="hs-identifier hs-type">tag'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679372136"><span class="annot"><span class="annottext">tag' :: Tensor dev 'Int64 (1 : EmbShape)
</span><a href="#local-6989586621679372136"><span class="hs-identifier hs-var hs-var">tag'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Tensor dev 'Int64 '[1, 1, 1, 1]
-&gt; Tensor dev 'Int64 (1 : EmbShape)
forall (shape' :: [Nat]) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownShape shape', shape' ~ Broadcast shape shape') =&gt;
Bool -&gt; Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.expand</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev 'Int64 '[1, 1, 1, 1]
 -&gt; Tensor dev 'Int64 (1 : EmbShape))
-&gt; Tensor dev 'Int64 '[1, 1, 1, 1]
-&gt; Tensor dev 'Int64 (1 : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (shape' :: [Nat]) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownShape shape', Numel shape ~ Numel shape') =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.reshape</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[]
</span><a href="#local-6989586621679372126"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621679372128"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679370990"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679372128"><span class="annot"><span class="annottext">out :: QTensor dev (1 : EmbShape)
</span><a href="#local-6989586621679372128"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ GatherDim shape shape' dim) =&gt;
Tensor device 'Int64 shape'
-&gt; Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.gatherDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[1, QSliceHidden, 13, 5]
Tensor dev 'Int64 (1 : EmbShape)
</span><a href="#local-6989586621679372136"><span class="hs-identifier hs-var">tag'</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[3, QSliceHidden, 13, 5]
QTensor dev (3 : EmbShape)
</span><a href="#local-6989586621679372132"><span class="hs-identifier hs-var">combined</span></a></span><span>
</span><span id="line-169"></span><span>  </span><span id="local-6989586621679372145"><span class="annot"><span class="annottext">forwardStoch :: SliceEncoder dev
-&gt; QStartStop dev '[] (SliceEncoding dev '[])
-&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679372146"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372146"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679372147"><span class="annot"><span class="annottext">QStartStop dev '[] (SliceEncoding dev '[])
</span><a href="#local-6989586621679372147"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[] (SliceEncoding dev '[])
-&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372146"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[] (SliceEncoding dev '[])
</span><a href="#local-6989586621679372147"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><span class="hs-comment">-- | HasForward for slice wrapped in QStartStop (batched).</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679371063"><span id="local-6989586621679371064"><span id="local-6989586621679371065"><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371064"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QStartStop"><span class="hs-identifier hs-type">QStartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#SliceEncoding"><span class="hs-identifier hs-type">SliceEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371064"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679372204"><span class="annot"><span class="annottext">forward :: SliceEncoder dev
-&gt; QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
-&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span id="local-6989586621679372205"><span class="annot"><span class="annottext">model :: SliceEncoder dev
</span><a href="#local-6989586621679372205"><span class="hs-identifier hs-var">model</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679372206"><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><a href="#local-6989586621679372206"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679372207"><span class="annot"><span class="annottext">ConstEmb dev EmbShape
</span><a href="#local-6989586621679372207"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QStartStop"><span class="hs-identifier hs-type">QStartStop</span></a></span><span> </span><span id="local-6989586621679372208"><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize]
</span><a href="#local-6989586621679372208"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621679372209"><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372209"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, batchSize, QSliceHidden, 13, 5]
</span><a href="#local-6989586621679372210"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-179"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- compute the possible outputs for start/stop/inner</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><a href="#local-6989586621679372211"><span class="hs-identifier hs-type">outStart</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679372211"><span class="annot"><span class="annottext">outStart :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372211"><span class="hs-identifier hs-var hs-var">outStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; QTensor dev (batchSize : EmbShape)
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; QTensor dev (batchSize : EmbShape))
-&gt; Tensor -&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor -&gt; Tensor
</span><a href="RL.Model.html#expandAs"><span class="hs-identifier hs-var">expandAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor)
-&gt; QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; () -&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">TT.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
ConstEmb dev EmbShape
</span><a href="#local-6989586621679372206"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372212"><span class="hs-identifier hs-var">outInner</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621679372213"><span class="hs-identifier hs-type">outStop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679372213"><span class="annot"><span class="annottext">outStop :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372213"><span class="hs-identifier hs-var hs-var">outStop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; QTensor dev (batchSize : EmbShape)
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; QTensor dev (batchSize : EmbShape))
-&gt; Tensor -&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor -&gt; Tensor
</span><a href="RL.Model.html#expandAs"><span class="hs-identifier hs-var">expandAs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor)
-&gt; QTensor dev '[QSliceHidden, 13, 5] -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
-&gt; () -&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">TT.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden, 13, 5]
ConstEmb dev EmbShape
</span><a href="#local-6989586621679372207"><span class="hs-identifier hs-var">stop</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372212"><span class="hs-identifier hs-var">outInner</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><a href="#local-6989586621679372212"><span class="hs-identifier hs-type">outInner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679372212"><span class="annot"><span class="annottext">outInner :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372212"><span class="hs-identifier hs-var hs-var">outInner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; SliceEncoding dev '[batchSize]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372205"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372209"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- combine the outputs into one tensor</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="#local-6989586621679372214"><span class="hs-identifier hs-type">combined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span id="local-6989586621679372214"><span class="annot"><span class="annottext">combined :: QTensor dev (3 : batchSize : EmbShape)
</span><a href="#local-6989586621679372214"><span class="hs-identifier hs-var hs-var">combined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [Type]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
forall {k} (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [k]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.stack</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(HList
   '[QTensor dev '[batchSize, QSliceHidden, 13, 5],
     QTensor dev '[batchSize, QSliceHidden, 13, 5],
     QTensor dev '[batchSize, QSliceHidden, 13, 5]]
 -&gt; QTensor dev (3 : batchSize : EmbShape))
-&gt; HList
     '[QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5]]
-&gt; QTensor dev (3 : batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372211"><span class="hs-identifier hs-var">outStart</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; HList
     '[QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5]]
-&gt; HList
     '[QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372212"><span class="hs-identifier hs-var">outInner</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; HList '[QTensor dev '[batchSize, QSliceHidden, 13, 5]]
-&gt; HList
     '[QTensor dev '[batchSize, QSliceHidden, 13, 5],
       QTensor dev '[batchSize, QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372213"><span class="hs-identifier hs-var">outStop</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; HList '[]
-&gt; HList '[QTensor dev '[batchSize, QSliceHidden, 13, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">HList '[]
forall k. HList '[]
</span><span class="hs-identifier hs-var">TT.HNil</span></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- use gather to select the right output.</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-comment">-- gather can select different elements from 'dim' for each position,</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- so we expand the tag to the right shape, selecting the *same* 'dim'-index everywhere</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><a href="#local-6989586621679372215"><span class="hs-identifier hs-type">tag'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679371063"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">TT.Int64</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371065"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679372215"><span class="annot"><span class="annottext">tag' :: Tensor dev 'Int64 (1 : batchSize : EmbShape)
</span><a href="#local-6989586621679372215"><span class="hs-identifier hs-var hs-var">tag'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor dev 'Int64 (1 : batchSize : EmbShape)
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor dev 'Int64 (1 : batchSize : EmbShape))
-&gt; Tensor -&gt; Tensor dev 'Int64 (1 : batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Dim -&gt; Tensor -&gt; Tensor
</span><span class="hs-identifier hs-var">T.unsqueeze</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Dim
</span><span class="hs-identifier hs-var">T.Dim</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor -&gt; Tensor
</span><a href="RL.Model.html#expandAs"><span class="hs-identifier hs-var">expandAs</span></a></span><span>
</span><span id="line-198"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int] -&gt; Tensor -&gt; Tensor
</span><span class="hs-identifier hs-var">T.reshape</span></span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize]
</span><a href="#local-6989586621679372208"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor) -&gt; Tensor -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372212"><span class="hs-identifier hs-var">outInner</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679372210"><span class="annot"><span class="annottext">out :: Tensor dev QDType '[1, batchSize, QSliceHidden, 13, 5]
</span><a href="#local-6989586621679372210"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ GatherDim shape shape' dim) =&gt;
Tensor device 'Int64 shape'
-&gt; Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.gatherDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[1, batchSize, QSliceHidden, 13, 5]
Tensor dev 'Int64 (1 : batchSize : EmbShape)
</span><a href="#local-6989586621679372215"><span class="hs-identifier hs-var">tag'</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[3, batchSize, QSliceHidden, 13, 5]
QTensor dev (3 : batchSize : EmbShape)
</span><a href="#local-6989586621679372214"><span class="hs-identifier hs-var">combined</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679372223"><span class="annot"><span class="annottext">forwardStoch :: SliceEncoder dev
-&gt; QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
-&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679372224"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372224"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679372225"><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679372225"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
-&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679372224"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679372225"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- Transition Encoder</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- ------------------</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-keyword">data</span><span> </span><span id="TransitionSpec"><span class="annot"><a href="RL.Model.html#TransitionSpec"><span class="hs-identifier hs-var">TransitionSpec</span></a></span></span><span> </span><span id="local-6989586621679371347"><span class="annot"><a href="#local-6989586621679371347"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransitionSpec"><span class="annot"><a href="RL.Model.html#TransitionSpec"><span class="hs-identifier hs-var">TransitionSpec</span></a></span></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">data</span><span> </span><span id="TransitionEncoder"><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-var">TransitionEncoder</span></a></span></span><span> </span><span id="local-6989586621679371068"><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TransitionEncoder"><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-var">TransitionEncoder</span></a></span></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="trL1Passing"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#trL1Passing"><span class="hs-identifier hs-var hs-var">trL1Passing</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (ESize spec) hidden QDType QDevice)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="trL1Inner"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#trL1Inner"><span class="hs-identifier hs-var hs-var">trL1Inner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (ESize spec) hidden QDType QDevice)</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="trL1Left"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="RL.Model.html#trL1Left"><span class="hs-identifier hs-var hs-var">trL1Left</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (PSize spec) hidden QDType QDevice)</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="trL1Right"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="RL.Model.html#trL1Right"><span class="hs-identifier hs-var hs-var">trL1Right</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (PSize spec) hidden QDType QDevice)</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="trL1Root"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; ConstEmb dev '[QSliceHidden]
</span><a href="RL.Model.html#trL1Root"><span class="hs-identifier hs-var hs-var">trL1Root</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="trL2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#trL2"><span class="hs-identifier hs-var hs-var">trL2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371068"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear hidden (EmbSize) QDType QDevice)</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679372236"><span id="local-6989586621679372245"><span id="local-6989586621679372249"><span class="annot"><span class="annottext">Int -&gt; TransitionEncoder dev -&gt; ShowS
[TransitionEncoder dev] -&gt; ShowS
TransitionEncoder dev -&gt; String
(Int -&gt; TransitionEncoder dev -&gt; ShowS)
-&gt; (TransitionEncoder dev -&gt; String)
-&gt; ([TransitionEncoder dev] -&gt; ShowS)
-&gt; Show (TransitionEncoder dev)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)).
Int -&gt; TransitionEncoder dev -&gt; ShowS
forall (dev :: (DeviceType, Nat)). [TransitionEncoder dev] -&gt; ShowS
forall (dev :: (DeviceType, Nat)). TransitionEncoder dev -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)).
Int -&gt; TransitionEncoder dev -&gt; ShowS
showsPrec :: Int -&gt; TransitionEncoder dev -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)). TransitionEncoder dev -&gt; String
show :: TransitionEncoder dev -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)). [TransitionEncoder dev] -&gt; ShowS
showList :: [TransitionEncoder dev] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372252"><span id="local-6989586621679372254"><span class="annot"><span class="annottext">(forall x. TransitionEncoder dev -&gt; Rep (TransitionEncoder dev) x)
-&gt; (forall x.
    Rep (TransitionEncoder dev) x -&gt; TransitionEncoder dev)
-&gt; Generic (TransitionEncoder dev)
forall x. Rep (TransitionEncoder dev) x -&gt; TransitionEncoder dev
forall x. TransitionEncoder dev -&gt; Rep (TransitionEncoder dev) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) x.
Rep (TransitionEncoder dev) x -&gt; TransitionEncoder dev
forall (dev :: (DeviceType, Nat)) x.
TransitionEncoder dev -&gt; Rep (TransitionEncoder dev) x
$cfrom :: forall (dev :: (DeviceType, Nat)) x.
TransitionEncoder dev -&gt; Rep (TransitionEncoder dev) x
from :: forall x. TransitionEncoder dev -&gt; Rep (TransitionEncoder dev) x
$cto :: forall (dev :: (DeviceType, Nat)) x.
Rep (TransitionEncoder dev) x -&gt; TransitionEncoder dev
to :: forall x. Rep (TransitionEncoder dev) x -&gt; TransitionEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372257"><span id="local-6989586621679372266"><span class="annot"><span class="annottext">TransitionEncoder dev -&gt; HList (Parameters (TransitionEncoder dev))
TransitionEncoder dev
-&gt; HList (Parameters (TransitionEncoder dev))
-&gt; TransitionEncoder dev
(TransitionEncoder dev
 -&gt; HList (Parameters (TransitionEncoder dev)))
-&gt; (TransitionEncoder dev
    -&gt; HList (Parameters (TransitionEncoder dev))
    -&gt; TransitionEncoder dev)
-&gt; Parameterized (TransitionEncoder dev)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; HList (Parameters (TransitionEncoder dev))
forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; HList (Parameters (TransitionEncoder dev))
-&gt; TransitionEncoder dev
$cflattenParameters :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; HList (Parameters (TransitionEncoder dev))
flattenParameters :: TransitionEncoder dev -&gt; HList (Parameters (TransitionEncoder dev))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; HList (Parameters (TransitionEncoder dev))
-&gt; TransitionEncoder dev
replaceParameters :: TransitionEncoder dev
-&gt; HList (Parameters (TransitionEncoder dev))
-&gt; TransitionEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372360"><span id="local-6989586621679372364"><span id="local-6989586621679372370"><span class="annot"><span class="annottext">Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
Proxy (TransitionEncoder dev) -&gt; String
(Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (TransitionEncoder dev) -&gt; String)
-&gt; NoThunks (TransitionEncoder dev)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)).
Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)).
Proxy (TransitionEncoder dev) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; TransitionEncoder dev -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)).
Proxy (TransitionEncoder dev) -&gt; String
showTypeOf :: Proxy (TransitionEncoder dev) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372417"><span class="annot"><span class="annottext">TransitionEncoder dev -&gt; ()
(TransitionEncoder dev -&gt; ()) -&gt; NFData (TransitionEncoder dev)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)). TransitionEncoder dev -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)). TransitionEncoder dev -&gt; ()
rnf :: TransitionEncoder dev -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679371088"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionSpec"><span class="hs-identifier hs-type">TransitionSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sample</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#TransitionSpec"><span class="hs-identifier hs-type">TransitionSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621679372474"><span class="annot"><span class="annottext">sample :: TransitionSpec dev -&gt; IO (TransitionEncoder dev)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">TransitionSpec dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679372475"><span class="annot"><a href="#local-6989586621679372475"><span class="hs-identifier hs-var">trL1Passing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Conv2dSpec 2 QSliceHidden 13 5 QDType dev
-&gt; IO (Conv2d 2 QSliceHidden 13 5 QDType dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec 2 QSliceHidden 13 5 QDType dev
forall (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Conv2dSpec
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><span class="hs-identifier hs-var">TT.Conv2dSpec</span></span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621679372476"><span class="annot"><a href="#local-6989586621679372476"><span class="hs-identifier hs-var">trL1Inner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679372477"><span class="annot"><a href="#local-6989586621679372477"><span class="hs-identifier hs-var">trL1Left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679372478"><span class="annot"><a href="#local-6989586621679372478"><span class="hs-identifier hs-var">trL1Right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679372479"><span class="annot"><a href="#local-6989586621679372479"><span class="hs-identifier hs-var">trL1Root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371088"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679372480"><span class="annot"><a href="#local-6989586621679372480"><span class="hs-identifier hs-var">trL2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span class="hs-special">{</span><span class="annot"><a href="RL.Model.html#trL1Passing"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><span class="hs-comment">-- | HasForward for transitions (unbatched)</span></span><span>
</span><span id="line-230"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371092"><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371093"><span class="annot"><a href="#local-6989586621679371093"><span class="hs-identifier hs-type">embshape</span></a></span></span><span>
</span><span id="line-232"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-233"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371093"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#TransitionEncoding"><span class="hs-identifier hs-type">TransitionEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371093"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621679372575"><span class="annot"><span class="annottext">forward :: TransitionEncoder dev
-&gt; TransitionEncoding dev '[] -&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span class="hs-special">{</span><span id="local-6989586621679372576"><span id="local-6989586621679372577"><span id="local-6989586621679372578"><span id="local-6989586621679372579"><span id="local-6989586621679372580"><span id="local-6989586621679372581"><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
ConstEmb dev '[QSliceHidden]
trL1Passing :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Inner :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Left :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Right :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Root :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; ConstEmb dev '[QSliceHidden]
trL2 :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
trL1Passing :: Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Inner :: Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Left :: Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Right :: Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Root :: ConstEmb dev '[QSliceHidden]
trL2 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#trL1Passing"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="RL.Encoding.html#TransitionEncoding"><span class="hs-identifier hs-type">TransitionEncoding</span></a></span><span class="hs-special">{</span><span id="local-6989586621679372583"><span id="local-6989586621679372584"><span id="local-6989586621679372585"><span id="local-6989586621679372586"><span id="local-6989586621679372587"><span class="annot"><span class="annottext">QTensor dev '[]
SliceEncoding dev '[]
QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
trencPassing :: QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
trencInner :: QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
trencLeft :: SliceEncoding dev '[]
trencRight :: SliceEncoding dev '[]
trencRoot :: QTensor dev '[]
trencRoot :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; QTensor dev batchShape
trencRight :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; SliceEncoding dev batchShape
trencLeft :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; SliceEncoding dev batchShape
trencInner :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape
-&gt; QBoundedList dev QDType QSliceHidden batchShape (2 : PShape)
trencPassing :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape
-&gt; QBoundedList dev QDType QSliceHidden batchShape (2 : PShape)
</span><a href="#local-6989586621679372583"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev
   QDType
   '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
 -&gt; QTensor dev embshape)
-&gt; Tensor
     dev
     QDType
     '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
-&gt; QTensor dev embshape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-239"></span><span>      </span><span class="annot"><span class="annottext">Tensor
  dev
  QDType
  '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
-&gt; Tensor
     dev
     QDType
     '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev
   QDType
   '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
 -&gt; Tensor
      dev
      QDType
      '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1])
-&gt; Tensor
     dev
     QDType
     '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
-&gt; Tensor
     dev
     QDType
     '[1, QSliceHidden, ((13 + 12) - 13) + 1, ((5 + 4) - 5) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372581"><span class="hs-identifier hs-var">trL2</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1, QSliceHidden, 13, 5]
 -&gt; Tensor
      dev
      QDType
      '[1, QSliceHidden,
        Div ((13 + (2 * Fst '(FifthPadding, 2))) - 13) (Fst '(1, 1)) + 1,
        Div ((5 + (2 * Snd '(FifthPadding, 2))) - 5) (Snd '(1, 1)) + 1])
-&gt; Tensor dev QDType '[1, QSliceHidden, 13, 5]
-&gt; Tensor
     dev
     QDType
     '[1, QSliceHidden,
       Div ((13 + (2 * Fst '(FifthPadding, 2))) - 13) (Fst '(1, 1)) + 1,
       Div ((5 + (2 * Snd '(FifthPadding, 2))) - 5) (Snd '(1, 1)) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372593"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-242"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621679371110"><span class="annot"><a href="#local-6989586621679372594"><span class="hs-identifier hs-type">runConv</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371110"><span class="hs-identifier hs-type">nin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371110"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-246"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QBoundedList"><span class="hs-identifier hs-type">QBoundedList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371110"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679372594"><span class="annot"><span class="annottext">runConv :: forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[] (nin : PShape)
-&gt; QTensor dev EmbShape
</span><a href="#local-6989586621679372594"><span class="hs-identifier hs-var hs-var">runConv</span></a></span></span><span> </span><span id="local-6989586621679372637"><span class="annot"><span class="annottext">Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372637"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QBoundedList"><span class="hs-identifier hs-type">QBoundedList</span></a></span><span> </span><span id="local-6989586621679372639"><span class="annot"><span class="annottext">QTensor dev ('[] ++ '[QSliceHidden])
</span><a href="#local-6989586621679372639"><span class="hs-identifier hs-var">mask</span></a></span></span><span> </span><span id="local-6989586621679372640"><span class="annot"><span class="annottext">Tensor dev QDType (('[] ++ '[QSliceHidden]) ++ (nin : PShape))
</span><a href="#local-6989586621679372640"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev
   QDType
   (CheckBroadcast
      '[QSliceHidden, 1, 1, 1]
      '[QSliceHidden, QSliceHidden, 13, 5]
      (ComputeBroadcast
         '[1, 1, 1, QSliceHidden]
         (ReverseImpl '[QSliceHidden, QSliceHidden, 13, 5] '[])))
 -&gt; QTensor dev EmbShape)
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[QSliceHidden, 1, 1, 1]
        '[QSliceHidden, QSliceHidden, 13, 5]
        (ComputeBroadcast
           '[1, 1, 1, QSliceHidden]
           (ReverseImpl '[QSliceHidden, QSliceHidden, 13, 5] '[])))
-&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 1, 1, 1]
-&gt; Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[QSliceHidden, 1, 1, 1]
        '[QSliceHidden, QSliceHidden, 13, 5]
        (ComputeBroadcast
           '[1, 1, 1, QSliceHidden]
           (ReverseImpl '[QSliceHidden, QSliceHidden, 13, 5] '[])))
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 1, 1, 1]
</span><a href="#local-6989586621679372643"><span class="hs-identifier hs-var">mask'</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5]
QTensor dev (QSliceHidden : EmbShape)
</span><a href="#local-6989586621679372644"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-249"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><a href="#local-6989586621679372644"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621679372644"><span class="annot"><span class="annottext">out :: QTensor dev (QSliceHidden : EmbShape)
</span><a href="#local-6989586621679372644"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (QSliceHidden : EmbShape)
-&gt; QTensor dev (QSliceHidden : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (QSliceHidden : EmbShape)
 -&gt; QTensor dev (QSliceHidden : EmbShape))
-&gt; QTensor dev (QSliceHidden : EmbShape)
-&gt; QTensor dev (QSliceHidden : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d nin QSliceHidden 13 5 QDType dev
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372637"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, nin, 13, 5]
Tensor dev QDType (('[] ++ '[QSliceHidden]) ++ (nin : PShape))
</span><a href="#local-6989586621679372640"><span class="hs-identifier hs-var">edges</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><a href="#local-6989586621679372643"><span class="hs-identifier hs-type">mask'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>      </span><span id="local-6989586621679372643"><span class="annot"><span class="annottext">mask' :: Tensor dev QDType '[QSliceHidden, 1, 1, 1]
</span><a href="#local-6989586621679372643"><span class="hs-identifier hs-var hs-var">mask'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden]
-&gt; Tensor dev QDType '[QSliceHidden, 1, 1, 1]
forall (shape' :: [Nat]) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownShape shape', Numel shape ~ Numel shape') =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.reshape</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden]
QTensor dev ('[] ++ '[QSliceHidden])
</span><a href="#local-6989586621679372639"><span class="hs-identifier hs-var">mask</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679372717"><span class="annot"><span class="annottext">runSlice :: Conv2d 1 outputChannelSize kernelSize0 kernelSize1 dtype device
-&gt; Tensor device dtype '[inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     (SqueezeDimCheck
        '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
          (inputSize1 - kernelSize1) + 1]
        0
        (SqueezeDimImpl
           '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
             (inputSize1 - kernelSize1) + 1]
           0))
</span><a href="#local-6989586621679372717"><span class="hs-identifier hs-var hs-var">runSlice</span></a></span></span><span> </span><span id="local-6989586621679372718"><span class="annot"><span class="annottext">Conv2d 1 outputChannelSize kernelSize0 kernelSize1 dtype device
</span><a href="#local-6989586621679372718"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679372719"><span class="annot"><span class="annottext">Tensor device dtype '[inputSize0, inputSize1]
</span><a href="#local-6989586621679372719"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor
   device
   dtype
   '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
     (inputSize1 - kernelSize1) + 1]
 -&gt; Tensor
      device
      dtype
      (SqueezeDimCheck
         '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
           (inputSize1 - kernelSize1) + 1]
         0
         (SqueezeDimImpl
            '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
              (inputSize1 - kernelSize1) + 1]
            0)))
-&gt; Tensor
     device
     dtype
     '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
-&gt; Tensor
     device
     dtype
     (SqueezeDimCheck
        '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
          (inputSize1 - kernelSize1) + 1]
        0
        (SqueezeDimImpl
           '[1, outputChannelSize, (inputSize0 - kernelSize0) + 1,
             (inputSize1 - kernelSize1) + 1]
           0))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 outputChannelSize kernelSize0 kernelSize1 dtype device
</span><a href="#local-6989586621679372718"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor device dtype '[1, 1, inputSize0, inputSize1]
</span><a href="#local-6989586621679372720"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-255"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>      </span><span id="local-6989586621679372720"><span class="annot"><span class="annottext">input :: Tensor device dtype '[1, 1, inputSize0, inputSize1]
</span><a href="#local-6989586621679372720"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor device dtype '[1, inputSize0, inputSize1]
 -&gt; Tensor device dtype '[1, 1, inputSize0, inputSize1])
-&gt; Tensor device dtype '[1, inputSize0, inputSize1]
-&gt; Tensor device dtype '[1, 1, inputSize0, inputSize1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor device dtype '[inputSize0, inputSize1]
</span><a href="#local-6989586621679372719"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="#local-6989586621679372721"><span class="hs-identifier hs-type">pass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679372721"><span class="annot"><span class="annottext">pass :: QTensor dev EmbShape
</span><a href="#local-6989586621679372721"><span class="hs-identifier hs-var hs-var">pass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
-&gt; QTensor dev EmbShape
forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[] (nin : PShape)
-&gt; QTensor dev EmbShape
</span><a href="#local-6989586621679372594"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372576"><span class="hs-identifier hs-var">trL1Passing</span></a></span><span> </span><span class="annot"><span class="annottext">QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
</span><a href="#local-6989586621679372583"><span class="hs-identifier hs-var">trencPassing</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621679372722"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679372722"><span class="annot"><span class="annottext">inner :: QTensor dev EmbShape
</span><a href="#local-6989586621679372722"><span class="hs-identifier hs-var hs-var">inner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
-&gt; QTensor dev EmbShape
forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[] (nin : PShape)
-&gt; QTensor dev EmbShape
</span><a href="#local-6989586621679372594"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372577"><span class="hs-identifier hs-var">trL1Inner</span></a></span><span> </span><span class="annot"><span class="annottext">QBoundedList dev QDType QSliceHidden '[] (2 : PShape)
</span><a href="#local-6989586621679372584"><span class="hs-identifier hs-var">trencInner</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="#local-6989586621679372723"><span class="hs-identifier hs-type">left</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679372723"><span class="annot"><span class="annottext">left :: QTensor dev EmbShape
</span><a href="#local-6989586621679372723"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Tensor dev QDType '[13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall {kernelSize0 :: Nat} {inputSize0 :: Nat}
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {outputChannelSize :: Nat}
       {dtype :: DType} {device :: (DeviceType, Nat)}.
(Assert
   (OrdCond (CmpNat kernelSize0 inputSize0) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat kernelSize1 inputSize1) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize0 - 1) inputSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize1 - 1) inputSize1) 'True 'True 'False)
   (TypeError ...),
 KnownNat outputChannelSize, KnownNat kernelSize0,
 KnownNat kernelSize1, KnownNat inputSize0, KnownNat inputSize1) =&gt;
Conv2d 1 outputChannelSize kernelSize0 kernelSize1 dtype device
-&gt; Tensor device dtype '[inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
</span><a href="#local-6989586621679372717"><span class="hs-identifier hs-var">runSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372578"><span class="hs-identifier hs-var">trL1Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[13, 5]
 -&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1])
-&gt; Tensor dev QDType '[13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[] -&gt; QTensor dev ('[] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679372585"><span class="hs-identifier hs-var">trencLeft</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="#local-6989586621679372724"><span class="hs-identifier hs-type">right</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679372724"><span class="annot"><span class="annottext">right :: QTensor dev EmbShape
</span><a href="#local-6989586621679372724"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Tensor dev QDType '[13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall {kernelSize0 :: Nat} {inputSize0 :: Nat}
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {outputChannelSize :: Nat}
       {dtype :: DType} {device :: (DeviceType, Nat)}.
(Assert
   (OrdCond (CmpNat kernelSize0 inputSize0) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat kernelSize1 inputSize1) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize0 - 1) inputSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize1 - 1) inputSize1) 'True 'True 'False)
   (TypeError ...),
 KnownNat outputChannelSize, KnownNat kernelSize0,
 KnownNat kernelSize1, KnownNat inputSize0, KnownNat inputSize1) =&gt;
Conv2d 1 outputChannelSize kernelSize0 kernelSize1 dtype device
-&gt; Tensor device dtype '[inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
</span><a href="#local-6989586621679372717"><span class="hs-identifier hs-var">runSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372579"><span class="hs-identifier hs-var">trL1Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[13, 5]
 -&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1])
-&gt; Tensor dev QDType '[13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[] -&gt; QTensor dev ('[] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[]
</span><a href="#local-6989586621679372586"><span class="hs-identifier hs-var">trencRight</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621679372725"><span class="hs-identifier hs-type">root</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-266"></span><span>    </span><span id="local-6989586621679372725"><span class="annot"><span class="annottext">root :: QTensor dev '[QSliceHidden, 1, 1]
</span><a href="#local-6989586621679372725"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor
  dev QDType (ReverseImpl (ReverseImpl '[QSliceHidden] '[]) '[])
-&gt; QTensor dev '[QSliceHidden, 1, 1]
forall (shape' :: [Nat]) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownShape shape', Numel shape ~ Numel shape') =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.reshape</span></span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev QDType (ReverseImpl (ReverseImpl '[QSliceHidden] '[]) '[])
 -&gt; QTensor dev '[QSliceHidden, 1, 1])
-&gt; Tensor
     dev QDType (ReverseImpl (ReverseImpl '[QSliceHidden] '[]) '[])
-&gt; QTensor dev '[QSliceHidden, 1, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[]
-&gt; QTensor dev '[QSliceHidden]
-&gt; Tensor
     dev QDType (ReverseImpl (ReverseImpl '[QSliceHidden] '[]) '[])
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[]
</span><a href="#local-6989586621679372587"><span class="hs-identifier hs-var">trencRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden] -&gt; QTensor dev '[QSliceHidden]
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden] -&gt; () -&gt; QTensor dev '[QSliceHidden]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden]
</span><a href="#local-6989586621679372580"><span class="hs-identifier hs-var">trL1Root</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><a href="#local-6989586621679372593"><span class="hs-identifier hs-type">all</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371092"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621679372593"><span class="annot"><span class="annottext">all :: QTensor dev EmbShape
</span><a href="#local-6989586621679372593"><span class="hs-identifier hs-var hs-var">all</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372721"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372722"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372723"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679372724"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 1, 1]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[QSliceHidden, 13, 5]
        '[QSliceHidden, 1, 1]
        (ComputeBroadcast
           (ReverseImpl '[QSliceHidden, 13, 5] '[]) '[1, 1, QSliceHidden]))
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-operator hs-var">`TT.add`</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 1, 1]
</span><a href="#local-6989586621679372725"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621679372733"><span class="annot"><span class="annottext">forwardStoch :: TransitionEncoder dev
-&gt; TransitionEncoding dev '[] -&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679372734"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679372734"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679372735"><span class="annot"><span class="annottext">TransitionEncoding dev '[]
</span><a href="#local-6989586621679372735"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
-&gt; TransitionEncoding dev '[] -&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679372734"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionEncoding dev '[]
</span><a href="#local-6989586621679372735"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><span class="hs-comment">-- | HasForward for transitions (batched)</span></span><span>
</span><span id="line-273"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371144"><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371146"><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span></span><span> </span><span id="local-6989586621679371145"><span class="annot"><a href="#local-6989586621679371145"><span class="hs-identifier hs-type">embshape</span></a></span></span><span>
</span><span id="line-275"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-276"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371145"><span class="hs-identifier hs-type">embshape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#TransitionEncoding"><span class="hs-identifier hs-type">TransitionEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371145"><span class="hs-identifier hs-type">embshape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621679372800"><span class="annot"><span class="annottext">forward :: TransitionEncoder dev
-&gt; TransitionEncoding dev '[batchSize] -&gt; QTensor dev embshape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span class="hs-special">{</span><span id="local-6989586621679372801"><span id="local-6989586621679372802"><span id="local-6989586621679372803"><span id="local-6989586621679372804"><span id="local-6989586621679372805"><span id="local-6989586621679372806"><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
ConstEmb dev '[QSliceHidden]
trL1Passing :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Inner :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Left :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Right :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Root :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev -&gt; ConstEmb dev '[QSliceHidden]
trL2 :: forall (dev :: (DeviceType, Nat)).
TransitionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
trL1Passing :: Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Inner :: Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
trL1Left :: Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Right :: Conv2d 1 QSliceHidden 1 1 QDType dev
trL1Root :: ConstEmb dev '[QSliceHidden]
trL2 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#trL1Passing"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="RL.Encoding.html#TransitionEncoding"><span class="hs-identifier hs-type">TransitionEncoding</span></a></span><span class="hs-special">{</span><span id="local-6989586621679372807"><span id="local-6989586621679372808"><span id="local-6989586621679372809"><span id="local-6989586621679372810"><span id="local-6989586621679372811"><span class="annot"><span class="annottext">QTensor dev '[batchSize]
SliceEncoding dev '[batchSize]
QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
trencRoot :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; QTensor dev batchShape
trencRight :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; SliceEncoding dev batchShape
trencLeft :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape -&gt; SliceEncoding dev batchShape
trencInner :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape
-&gt; QBoundedList dev QDType QSliceHidden batchShape (2 : PShape)
trencPassing :: forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
TransitionEncoding dev batchShape
-&gt; QBoundedList dev QDType QSliceHidden batchShape (2 : PShape)
trencPassing :: QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
trencInner :: QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
trencLeft :: SliceEncoding dev '[batchSize]
trencRight :: SliceEncoding dev '[batchSize]
trencRoot :: QTensor dev '[batchSize]
</span><a href="RL.Encoding.html#trencRoot"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; QTensor dev embshape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; QTensor dev embshape)
-&gt; QTensor dev embshape -&gt; QTensor dev embshape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372806"><span class="hs-identifier hs-var">trL2</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372812"><span class="hs-identifier hs-var">all</span></a></span><span>
</span><span id="line-282"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="#local-6989586621679372813"><span class="hs-identifier hs-type">runConv</span></a></span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371147"><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span></span><span>
</span><span id="line-285"></span><span>       </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QBoundedList"><span class="hs-identifier hs-type">QBoundedList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679372813"><span class="annot"><span class="annottext">runConv :: forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[batchSize] (nin : PShape)
-&gt; QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372813"><span class="hs-identifier hs-var hs-var">runConv</span></a></span></span><span> </span><span id="local-6989586621679372845"><span class="annot"><span class="annottext">Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372845"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QBoundedList"><span class="hs-identifier hs-type">QBoundedList</span></a></span><span> </span><span id="local-6989586621679372846"><span class="annot"><span class="annottext">QTensor dev ('[batchSize] ++ '[QSliceHidden])
</span><a href="#local-6989586621679372846"><span class="hs-identifier hs-var">mask</span></a></span></span><span> </span><span id="local-6989586621679372847"><span class="annot"><span class="annottext">Tensor
  dev QDType (('[batchSize] ++ '[QSliceHidden]) ++ (nin : PShape))
</span><a href="#local-6989586621679372847"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev
   QDType
   (CheckBroadcast
      '[batchSize, QSliceHidden, 1, 1, 1]
      '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
      (ComputeBroadcast
         '[1, 1, 1, QSliceHidden, batchSize]
         (ReverseImpl '[batchSize, QSliceHidden, QSliceHidden, 13, 5] '[])))
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, QSliceHidden, 1, 1, 1]
        '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
        (ComputeBroadcast
           '[1, 1, 1, QSliceHidden, batchSize]
           (ReverseImpl '[batchSize, QSliceHidden, QSliceHidden, 13, 5] '[])))
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 1, 1, 1]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, QSliceHidden, 1, 1, 1]
        '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
        (ComputeBroadcast
           '[1, 1, 1, QSliceHidden, batchSize]
           (ReverseImpl '[batchSize, QSliceHidden, QSliceHidden, 13, 5] '[])))
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 1, 1, 1]
</span><a href="#local-6989586621679372848"><span class="hs-identifier hs-var">mask'</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
QTensor dev (batchSize : QSliceHidden : EmbShape)
</span><a href="#local-6989586621679372849"><span class="hs-identifier hs-var">outReshaped</span></a></span><span>
</span><span id="line-290"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>      </span><span id="local-6989586621679372850"><span class="annot"><span class="annottext">shape :: [Int]
</span><a href="#local-6989586621679372850"><span class="hs-identifier hs-var hs-var">shape</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (shape :: [Nat]). KnownShape shape =&gt; [Int]
</span><span class="hs-identifier hs-var">TT.shapeVal</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>      </span><span id="local-6989586621679372861"><span class="annot"><span class="annottext">shape' :: [Int]
</span><a href="#local-6989586621679372861"><span class="hs-identifier hs-var hs-var">shape'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (shape :: [Nat]). KnownShape shape =&gt; [Int]
</span><span class="hs-identifier hs-var">TT.shapeVal</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>      </span><span class="annot"><a href="#local-6989586621679372862"><span class="hs-identifier hs-type">inputShaped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">*</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371147"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>      </span><span id="local-6989586621679372862"><span class="annot"><span class="annottext">inputShaped :: QTensor dev ((batchSize * QSliceHidden) : nin : PShape)
</span><a href="#local-6989586621679372862"><span class="hs-identifier hs-var hs-var">inputShaped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, nin, 13, 5]
-&gt; Tensor dev QDType '[batchSize * QSliceHidden, nin, 13, 5]
forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var">unsafeReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679372850"><span class="hs-identifier hs-var">shape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, nin, 13, 5]
Tensor
  dev QDType (('[batchSize] ++ '[QSliceHidden]) ++ (nin : PShape))
</span><a href="#local-6989586621679372847"><span class="hs-identifier hs-var">edges</span></a></span><span>
</span><span id="line-295"></span><span>      </span><span class="annot"><a href="#local-6989586621679372863"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">*</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>      </span><span id="local-6989586621679372863"><span class="annot"><span class="annottext">out :: QTensor dev ((batchSize * QSliceHidden) : EmbShape)
</span><a href="#local-6989586621679372863"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev ((batchSize * QSliceHidden) : EmbShape)
-&gt; QTensor dev ((batchSize * QSliceHidden) : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev ((batchSize * QSliceHidden) : EmbShape)
 -&gt; QTensor dev ((batchSize * QSliceHidden) : EmbShape))
-&gt; QTensor dev ((batchSize * QSliceHidden) : EmbShape)
-&gt; QTensor dev ((batchSize * QSliceHidden) : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d nin QSliceHidden 13 5 QDType dev
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372845"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize * QSliceHidden, nin, 13, 5]
QTensor dev ((batchSize * QSliceHidden) : nin : PShape)
</span><a href="#local-6989586621679372862"><span class="hs-identifier hs-var">inputShaped</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><a href="#local-6989586621679372849"><span class="hs-identifier hs-type">outReshaped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>      </span><span id="local-6989586621679372849"><span class="annot"><span class="annottext">outReshaped :: QTensor dev (batchSize : QSliceHidden : EmbShape)
</span><a href="#local-6989586621679372849"><span class="hs-identifier hs-var hs-var">outReshaped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; Tensor
     dev QDType '[batchSize * QSliceHidden, QSliceHidden, 13, 5]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, QSliceHidden, 13, 5]
forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var">unsafeReshape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679372861"><span class="hs-identifier hs-var">shape'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize * QSliceHidden, QSliceHidden, 13, 5]
QTensor dev ((batchSize * QSliceHidden) : EmbShape)
</span><a href="#local-6989586621679372863"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="annot"><a href="#local-6989586621679372848"><span class="hs-identifier hs-type">mask'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-300"></span><span>      </span><span id="local-6989586621679372848"><span class="annot"><span class="annottext">mask' :: Tensor dev QDType '[batchSize, QSliceHidden, 1, 1, 1]
</span><a href="#local-6989586621679372848"><span class="hs-identifier hs-var hs-var">mask'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 1, 1, 1]
forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var">unsafeReshape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat). KnownNat n =&gt; Int
</span><span class="hs-identifier hs-var">TT.natValI</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="RL.ModelTypes.html#MaxEdges"><span class="hs-identifier hs-type">MaxEdges</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden]
QTensor dev ('[batchSize] ++ '[QSliceHidden])
</span><a href="#local-6989586621679372846"><span class="hs-identifier hs-var">mask</span></a></span><span>
</span><span id="line-301"></span><span>    </span><span id="local-6989586621679372894"><span class="annot"><span class="annottext">runSlice :: Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor device dtype shape
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
</span><a href="#local-6989586621679372894"><span class="hs-identifier hs-var hs-var">runSlice</span></a></span></span><span> </span><span id="local-6989586621679372895"><span class="annot"><span class="annottext">Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><a href="#local-6989586621679372895"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679372896"><span class="annot"><span class="annottext">Tensor device dtype shape
</span><a href="#local-6989586621679372896"><span class="hs-identifier hs-var">slice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><a href="#local-6989586621679372895"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
</span><a href="#local-6989586621679372897"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-302"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621679372897"><span class="annot"><span class="annottext">input :: Tensor
  device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
</span><a href="#local-6989586621679372897"><span class="hs-identifier hs-var hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Tensor device dtype shape
</span><a href="#local-6989586621679372896"><span class="hs-identifier hs-var">slice</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><a href="#local-6989586621679372898"><span class="hs-identifier hs-type">pass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679372898"><span class="annot"><span class="annottext">pass :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372898"><span class="hs-identifier hs-var hs-var">pass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[batchSize] (nin : PShape)
-&gt; QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372813"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372801"><span class="hs-identifier hs-var">trL1Passing</span></a></span><span> </span><span class="annot"><span class="annottext">QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
</span><a href="#local-6989586621679372807"><span class="hs-identifier hs-var">trencPassing</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><a href="#local-6989586621679372899"><span class="hs-identifier hs-type">inner</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679372899"><span class="annot"><span class="annottext">inner :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372899"><span class="hs-identifier hs-var hs-var">inner</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat).
KnownNat nin =&gt;
Conv2d nin QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QBoundedList dev QDType QSliceHidden '[batchSize] (nin : PShape)
-&gt; QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372813"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 2 QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679372802"><span class="hs-identifier hs-var">trL1Inner</span></a></span><span> </span><span class="annot"><span class="annottext">QBoundedList dev QDType QSliceHidden '[batchSize] (2 : PShape)
</span><a href="#local-6989586621679372808"><span class="hs-identifier hs-var">trencInner</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="#local-6989586621679372900"><span class="hs-identifier hs-type">left</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679372900"><span class="annot"><span class="annottext">left :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372900"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Tensor dev QDType '[batchSize, 13, 5]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall {shape :: [Nat]} {batchSize :: Nat}
       {inputChannelSize :: Nat} {inputSize0 :: Nat} {inputSize1 :: Nat}
       {kernelSize0 :: Nat} {kernelSize1 :: Nat}
       {outputChannelSize :: Nat} {dtype :: DType}
       {device :: (DeviceType, Nat)}.
(UnsqueezeCheck shape 1 (UnsqueezeImpl shape 1)
 ~ '[batchSize, inputChannelSize, inputSize0, inputSize1],
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize0 - 1) inputSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat 1 ((inputSize0 - kernelSize0) + 1)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize1 - 1) inputSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat 1 ((inputSize1 - kernelSize1) + 1)) 'True 'True 'False)
   (TypeError ...)) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor device dtype shape
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
</span><a href="#local-6989586621679372894"><span class="hs-identifier hs-var">runSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372803"><span class="hs-identifier hs-var">trL1Left</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, 13, 5]
 -&gt; Tensor
      dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1])
-&gt; Tensor dev QDType '[batchSize, 13, 5]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
-&gt; QTensor dev ('[batchSize] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372809"><span class="hs-identifier hs-var">trencLeft</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="annot"><a href="#local-6989586621679372901"><span class="hs-identifier hs-type">right</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>    </span><span id="local-6989586621679372901"><span class="annot"><span class="annottext">right :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372901"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
-&gt; Tensor dev QDType '[batchSize, 13, 5]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall {shape :: [Nat]} {batchSize :: Nat}
       {inputChannelSize :: Nat} {inputSize0 :: Nat} {inputSize1 :: Nat}
       {kernelSize0 :: Nat} {kernelSize1 :: Nat}
       {outputChannelSize :: Nat} {dtype :: DType}
       {device :: (DeviceType, Nat)}.
(UnsqueezeCheck shape 1 (UnsqueezeImpl shape 1)
 ~ '[batchSize, inputChannelSize, inputSize0, inputSize1],
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize0 - 1) inputSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat 1 ((inputSize0 - kernelSize0) + 1)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat (kernelSize1 - 1) inputSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat 1 ((inputSize1 - kernelSize1) + 1)) 'True 'True 'False)
   (TypeError ...)) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor device dtype shape
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, (inputSize0 - kernelSize0) + 1,
       (inputSize1 - kernelSize1) + 1]
</span><a href="#local-6989586621679372894"><span class="hs-identifier hs-var">runSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d 1 QSliceHidden 1 1 QDType dev
</span><a href="#local-6989586621679372804"><span class="hs-identifier hs-var">trL1Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, 13, 5]
 -&gt; Tensor
      dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1])
-&gt; Tensor dev QDType '[batchSize, 13, 5]
-&gt; Tensor
     dev QDType '[batchSize, QSliceHidden, (13 - 1) + 1, (5 - 1) + 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
-&gt; QTensor dev ('[batchSize] ++ PShape)
forall (dev :: (DeviceType, Nat)) (batchShape :: [Nat]).
SliceEncoding dev batchShape -&gt; QTensor dev (batchShape ++ PShape)
</span><a href="RL.Encoding.html#getSlice"><span class="hs-identifier hs-var">getSlice</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679372810"><span class="hs-identifier hs-var">trencRight</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="annot"><a href="#local-6989586621679372902"><span class="hs-identifier hs-type">root</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621679372902"><span class="annot"><span class="annottext">root :: QTensor dev '[batchSize, QSliceHidden, 1, 1]
</span><a href="#local-6989586621679372902"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, 1]
        '[QSliceHidden]
        (ComputeBroadcast
           (ReverseImpl '[batchSize, 1] '[])
           (ReverseImpl '[QSliceHidden] '[])))
-&gt; QTensor dev '[batchSize, QSliceHidden, 1, 1]
forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var">unsafeReshape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat). KnownNat n =&gt; Int
</span><span class="hs-identifier hs-var">TT.natValI</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Tensor
   dev
   QDType
   (CheckBroadcast
      '[batchSize, 1]
      '[QSliceHidden]
      (ComputeBroadcast
         (ReverseImpl '[batchSize, 1] '[])
         (ReverseImpl '[QSliceHidden] '[])))
 -&gt; QTensor dev '[batchSize, QSliceHidden, 1, 1])
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, 1]
        '[QSliceHidden]
        (ComputeBroadcast
           (ReverseImpl '[batchSize, 1] '[])
           (ReverseImpl '[QSliceHidden] '[])))
-&gt; QTensor dev '[batchSize, QSliceHidden, 1, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, 1]
-&gt; QTensor dev '[QSliceHidden]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, 1]
        '[QSliceHidden]
        (ComputeBroadcast
           (ReverseImpl '[batchSize, 1] '[])
           (ReverseImpl '[QSliceHidden] '[])))
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679372811"><span class="hs-identifier hs-var">trencRoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[QSliceHidden]
 -&gt; Tensor
      dev
      QDType
      (CheckBroadcast
         '[batchSize, 1]
         '[QSliceHidden]
         (ComputeBroadcast
            (ReverseImpl '[batchSize, 1] '[])
            (ReverseImpl '[QSliceHidden] '[]))))
-&gt; QTensor dev '[QSliceHidden]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, 1]
        '[QSliceHidden]
        (ComputeBroadcast
           (ReverseImpl '[batchSize, 1] '[])
           (ReverseImpl '[QSliceHidden] '[])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden] -&gt; QTensor dev '[QSliceHidden]
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[QSliceHidden] -&gt; QTensor dev '[QSliceHidden])
-&gt; QTensor dev '[QSliceHidden] -&gt; QTensor dev '[QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden] -&gt; () -&gt; QTensor dev '[QSliceHidden]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[QSliceHidden]
</span><a href="#local-6989586621679372805"><span class="hs-identifier hs-var">trL1Root</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><a href="#local-6989586621679372812"><span class="hs-identifier hs-type">all</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371144"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371146"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTransHidden"><span class="hs-identifier hs-type">QTransHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621679372812"><span class="annot"><span class="annottext">all :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372812"><span class="hs-identifier hs-var hs-var">all</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372898"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372899"><span class="hs-identifier hs-var">inner</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372900"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679372901"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 1, 1]
-&gt; Tensor
     dev
     QDType
     (CheckBroadcast
        '[batchSize, QSliceHidden, 13, 5]
        '[batchSize, QSliceHidden, 1, 1]
        (ComputeBroadcast
           (ReverseImpl '[batchSize, QSliceHidden, 13, 5] '[])
           '[1, 1, QSliceHidden, batchSize]))
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-operator hs-var">`TT.add`</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 1, 1]
</span><a href="#local-6989586621679372902"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621679372908"><span class="annot"><span class="annottext">forwardStoch :: TransitionEncoder dev
-&gt; TransitionEncoding dev '[batchSize] -&gt; IO (QTensor dev embshape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679372909"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679372909"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679372910"><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679372910"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev embshape -&gt; IO (QTensor dev embshape))
-&gt; QTensor dev embshape -&gt; IO (QTensor dev embshape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
-&gt; TransitionEncoding dev '[batchSize] -&gt; QTensor dev embshape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679372909"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679372910"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- ActionEncoder</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- -------------</span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-keyword">data</span><span> </span><span id="ActionSpec"><span class="annot"><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-var">ActionSpec</span></a></span></span><span> </span><span id="local-6989586621679371349"><span class="annot"><a href="#local-6989586621679371349"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActionSpec"><span class="annot"><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-var">ActionSpec</span></a></span></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span class="hs-keyword">data</span><span> </span><span id="ActionEncoder"><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-var">ActionEncoder</span></a></span></span><span> </span><span id="local-6989586621679371162"><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActionEncoder"><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-var">ActionEncoder</span></a></span></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="actTop1sl"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop1sl"><span class="hs-identifier hs-var hs-var">actTop1sl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear (EmbSize) hidden QDType dev</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actTop1sm"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop1sm"><span class="hs-identifier hs-var hs-var">actTop1sm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear (EmbSize) hidden QDType dev</span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actTop1sr"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop1sr"><span class="hs-identifier hs-var hs-var">actTop1sr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear (EmbSize) hidden QDType dev</span><span>
</span><span id="line-328"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actTop1t1"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop1t1"><span class="hs-identifier hs-var hs-var">actTop1t1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear (EmbSize) hidden QDType dev</span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actTop1t2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop1t2"><span class="hs-identifier hs-var hs-var">actTop1t2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear (EmbSize) hidden QDType dev</span><span>
</span><span id="line-330"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actTop2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#actTop2"><span class="hs-identifier hs-var hs-var">actTop2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TT.Linear hidden (EmbSize) QDType dev</span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actSplit"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
</span><a href="RL.Model.html#actSplit"><span class="hs-identifier hs-var hs-var">actSplit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- TODO: fill in with actual module</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actSpread"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
</span><a href="RL.Model.html#actSpread"><span class="hs-identifier hs-var hs-var">actSpread</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- TODO: fill in with actual module</span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="actFreeze"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
</span><a href="RL.Model.html#actFreeze"><span class="hs-identifier hs-var hs-var">actFreeze</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmb"><span class="hs-identifier hs-type">ConstEmb</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371162"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">-</span></span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-335"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679372924"><span id="local-6989586621679372936"><span id="local-6989586621679372940"><span class="annot"><span class="annottext">Int -&gt; ActionEncoder dev -&gt; ShowS
[ActionEncoder dev] -&gt; ShowS
ActionEncoder dev -&gt; String
(Int -&gt; ActionEncoder dev -&gt; ShowS)
-&gt; (ActionEncoder dev -&gt; String)
-&gt; ([ActionEncoder dev] -&gt; ShowS)
-&gt; Show (ActionEncoder dev)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)).
Int -&gt; ActionEncoder dev -&gt; ShowS
forall (dev :: (DeviceType, Nat)). [ActionEncoder dev] -&gt; ShowS
forall (dev :: (DeviceType, Nat)). ActionEncoder dev -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)).
Int -&gt; ActionEncoder dev -&gt; ShowS
showsPrec :: Int -&gt; ActionEncoder dev -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)). ActionEncoder dev -&gt; String
show :: ActionEncoder dev -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)). [ActionEncoder dev] -&gt; ShowS
showList :: [ActionEncoder dev] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372943"><span id="local-6989586621679372945"><span class="annot"><span class="annottext">(forall x. ActionEncoder dev -&gt; Rep (ActionEncoder dev) x)
-&gt; (forall x. Rep (ActionEncoder dev) x -&gt; ActionEncoder dev)
-&gt; Generic (ActionEncoder dev)
forall x. Rep (ActionEncoder dev) x -&gt; ActionEncoder dev
forall x. ActionEncoder dev -&gt; Rep (ActionEncoder dev) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) x.
Rep (ActionEncoder dev) x -&gt; ActionEncoder dev
forall (dev :: (DeviceType, Nat)) x.
ActionEncoder dev -&gt; Rep (ActionEncoder dev) x
$cfrom :: forall (dev :: (DeviceType, Nat)) x.
ActionEncoder dev -&gt; Rep (ActionEncoder dev) x
from :: forall x. ActionEncoder dev -&gt; Rep (ActionEncoder dev) x
$cto :: forall (dev :: (DeviceType, Nat)) x.
Rep (ActionEncoder dev) x -&gt; ActionEncoder dev
to :: forall x. Rep (ActionEncoder dev) x -&gt; ActionEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679372948"><span id="local-6989586621679372957"><span class="annot"><span class="annottext">ActionEncoder dev -&gt; HList (Parameters (ActionEncoder dev))
ActionEncoder dev
-&gt; HList (Parameters (ActionEncoder dev)) -&gt; ActionEncoder dev
(ActionEncoder dev -&gt; HList (Parameters (ActionEncoder dev)))
-&gt; (ActionEncoder dev
    -&gt; HList (Parameters (ActionEncoder dev)) -&gt; ActionEncoder dev)
-&gt; Parameterized (ActionEncoder dev)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; HList (Parameters (ActionEncoder dev))
forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; HList (Parameters (ActionEncoder dev)) -&gt; ActionEncoder dev
$cflattenParameters :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; HList (Parameters (ActionEncoder dev))
flattenParameters :: ActionEncoder dev -&gt; HList (Parameters (ActionEncoder dev))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; HList (Parameters (ActionEncoder dev)) -&gt; ActionEncoder dev
replaceParameters :: ActionEncoder dev
-&gt; HList (Parameters (ActionEncoder dev)) -&gt; ActionEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373077"><span id="local-6989586621679373081"><span id="local-6989586621679373087"><span class="annot"><span class="annottext">Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
Proxy (ActionEncoder dev) -&gt; String
(Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (ActionEncoder dev) -&gt; String)
-&gt; NoThunks (ActionEncoder dev)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)).
Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)).
Proxy (ActionEncoder dev) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; ActionEncoder dev -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)).
Proxy (ActionEncoder dev) -&gt; String
showTypeOf :: Proxy (ActionEncoder dev) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373140"><span class="annot"><span class="annottext">ActionEncoder dev -&gt; ()
(ActionEncoder dev -&gt; ()) -&gt; NFData (ActionEncoder dev)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)). ActionEncoder dev -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)). ActionEncoder dev -&gt; ()
rnf :: ActionEncoder dev -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679371186"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-type">ActionSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sample</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-type">ActionSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679373200"><span class="annot"><span class="annottext">sample :: ActionSpec dev -&gt; IO (ActionEncoder dev)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">ActionSpec dev
</span><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-var">ActionSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679373201"><span class="annot"><a href="#local-6989586621679373201"><span class="hs-identifier hs-var">actTop1sl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
-&gt; IO (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
forall (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Conv2dSpec
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><span class="hs-identifier hs-var">TT.Conv2dSpec</span></span><span>
</span><span id="line-341"></span><span>    </span><span id="local-6989586621679373202"><span class="annot"><a href="#local-6989586621679373202"><span class="hs-identifier hs-var">actTop1sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-342"></span><span>    </span><span id="local-6989586621679373203"><span class="annot"><a href="#local-6989586621679373203"><span class="hs-identifier hs-var">actTop1sr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679373204"><span class="annot"><a href="#local-6989586621679373204"><span class="hs-identifier hs-var">actTop1t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-344"></span><span>    </span><span id="local-6989586621679373205"><span class="annot"><a href="#local-6989586621679373205"><span class="hs-identifier hs-var">actTop1t2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-345"></span><span>    </span><span id="local-6989586621679373206"><span class="annot"><a href="#local-6989586621679373206"><span class="hs-identifier hs-var">actTop2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679373207"><span class="annot"><a href="#local-6989586621679373207"><span class="hs-identifier hs-var">actSplit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621679373208"><span class="annot"><a href="#local-6989586621679373208"><span class="hs-identifier hs-var">actSpread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span id="local-6989586621679373209"><span class="annot"><a href="#local-6989586621679373209"><span class="hs-identifier hs-var">actFreeze</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#ConstEmbSpec"><span class="hs-identifier hs-type">ConstEmbSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371186"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span class="hs-special">{</span><span class="annot"><a href="RL.Model.html#actTop1sl"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="RL.Model.html#opTypes"><span class="hs-identifier hs-type">opTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371187"><span class="annot"><a href="#local-6989586621679371187"><span class="hs-identifier hs-type">dev</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.KnownDevice</span></span><span> </span><span class="annot"><a href="#local-6989586621679371187"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371187"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span class="hs-special">]</span><span>
</span><span id="line-352"></span><span id="opTypes"><span class="annot"><span class="annottext">opTypes :: forall (dev :: (DeviceType, Nat)).
KnownDevice dev =&gt;
QTensor dev '[FifthPadding, 3]
</span><a href="RL.Model.html#opTypes"><span class="hs-identifier hs-var hs-var">opTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor dev QDType '[FifthPadding, 3]
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span>
</span><span id="line-354"></span><span>    </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor dev QDType '[FifthPadding, 3])
-&gt; Tensor -&gt; Tensor dev QDType '[FifthPadding, 3]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">forall a opt.
(TensorLike a, TensorOptionLike opt) =&gt;
a -&gt; opt -&gt; Tensor
</span><span class="hs-identifier hs-var">T.asTensor'</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QType"><span class="hs-identifier hs-type">QType</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-355"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- freeze only</span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- split only</span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- freeze left</span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- spread</span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- freeze left</span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">QType
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- freeze right</span><span>
</span><span id="line-361"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><span class="annottext">(TensorOptions -&gt; Tensor) -&gt; TensorOptions -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)). KnownDevice dev =&gt; TensorOptions
</span><a href="RL.ModelTypes.html#opts"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371187"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="annot"><span class="hs-comment">-- | HasForward for actions (batched)</span></span><span>
</span><span id="line-365"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371208"><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371210"><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span></span><span> </span><span id="local-6989586621679371209"><span class="annot"><a href="#local-6989586621679371209"><span class="hs-identifier hs-type">outShape</span></a></span></span><span>
</span><span id="line-367"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-368"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371209"><span class="hs-identifier hs-type">outShape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span>
</span><span id="line-370"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Encoding.html#ActionEncoding"><span class="hs-identifier hs-type">ActionEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371209"><span class="hs-identifier hs-type">outShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621679373351"><span class="annot"><span class="annottext">forward :: ActionEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev,
    ActionEncoding dev '[batchSize])
-&gt; QTensor dev outShape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span class="hs-special">{</span><span id="local-6989586621679373352"><span id="local-6989586621679373353"><span id="local-6989586621679373354"><span id="local-6989586621679373355"><span id="local-6989586621679373356"><span id="local-6989586621679373357"><span id="local-6989586621679373358"><span id="local-6989586621679373359"><span id="local-6989586621679373360"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
ConstEmb dev '[QSliceHidden - 3]
actTop1sl :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1sm :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1sr :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1t1 :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1t2 :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop2 :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actSplit :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
actSpread :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
actFreeze :: forall (dev :: (DeviceType, Nat)).
ActionEncoder dev -&gt; ConstEmb dev '[QSliceHidden - 3]
actTop1sl :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1sm :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1sr :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1t1 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop1t2 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actTop2 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
actSplit :: ConstEmb dev '[QSliceHidden - 3]
actSpread :: ConstEmb dev '[QSliceHidden - 3]
actFreeze :: ConstEmb dev '[QSliceHidden - 3]
</span><a href="RL.Model.html#actTop1sl"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679373361"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373361"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373362"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679373362"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Encoding.html#ActionEncoding"><span class="hs-identifier hs-type">ActionEncoding</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#ActionTop"><span class="hs-identifier hs-type">ActionTop</span></a></span><span> </span><span id="local-6989586621679373365"><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679373365"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679373366"><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679373366"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QMaybe"><span class="hs-identifier hs-type">QMaybe</span></a></span><span> </span><span id="local-6989586621679373368"><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373368"><span class="hs-identifier hs-var">smMask</span></a></span></span><span> </span><span id="local-6989586621679373369"><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679373369"><span class="hs-identifier hs-var">sm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QMaybe"><span class="hs-identifier hs-type">QMaybe</span></a></span><span> </span><span id="local-6989586621679373370"><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373370"><span class="hs-identifier hs-var">t2Mask</span></a></span></span><span> </span><span id="local-6989586621679373371"><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679373371"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679373372"><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679373372"><span class="hs-identifier hs-var">sr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679373373"><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize]
</span><a href="#local-6989586621679373373"><span class="hs-identifier hs-var">opIndex</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373374"><span class="hs-identifier hs-var">topEmb</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 1, 1]
-&gt; QTensor dev outShape
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-operator hs-var">`TT.add`</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, QSliceHidden, 1, 1]
</span><a href="#local-6989586621679373375"><span class="hs-identifier hs-var">opEmbReshaped</span></a></span><span>
</span><span id="line-377"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621679371221"><span id="local-6989586621679371222"><span class="annot"><a href="#local-6989586621679373376"><span class="hs-identifier hs-type">runConv</span></a></span><span>
</span><span id="line-379"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371221"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371222"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371221"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371222"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-382"></span><span>    </span><span id="local-6989586621679373376"><span class="annot"><span class="annottext">runConv :: forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var hs-var">runConv</span></a></span></span><span> </span><span id="local-6989586621679373391"><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373391"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679373392"><span class="annot"><span class="annottext">QTensor dev (batchSize : nin : PShape)
</span><a href="#local-6989586621679373392"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="annottext">QTensor dev (batchSize : nout : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : nout : PShape)
 -&gt; QTensor dev (batchSize : nout : PShape))
-&gt; QTensor dev (batchSize : nout : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout 13 5 QDType dev
Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373391"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, nin, 13, 5]
QTensor dev (batchSize : nin : PShape)
</span><a href="#local-6989586621679373392"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621679371225"><span id="local-6989586621679371226"><span class="annot"><a href="#local-6989586621679373393"><span class="hs-identifier hs-type">runConvMasked</span></a></span><span>
</span><span id="line-385"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-386"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371225"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371226"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-387"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371225"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371226"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-389"></span><span>    </span><span id="local-6989586621679373393"><span class="annot"><span class="annottext">runConvMasked :: forall (nin :: Nat) (nout :: Nat).
QTensor dev '[batchSize]
-&gt; Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373393"><span class="hs-identifier hs-var hs-var">runConvMasked</span></a></span></span><span> </span><span id="local-6989586621679373403"><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373403"><span class="hs-identifier hs-var">mask</span></a></span></span><span> </span><span id="local-6989586621679373404"><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373404"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679373405"><span class="annot"><span class="annottext">QTensor dev (batchSize : nin : PShape)
</span><a href="#local-6989586621679373405"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, 1, 1, 1]
-&gt; Tensor dev QDType '[batchSize, nout, 13, 5]
-&gt; Tensor dev QDType (batchSize : nout : PShape)
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Int]
-&gt; QTensor dev '[batchSize]
-&gt; Tensor dev QDType '[batchSize, 1, 1, 1]
forall (dev :: (DeviceType, Nat)) (dtype :: DType) (shape :: [Nat])
       (shape' :: [Nat]).
[Int] -&gt; Tensor dev dtype shape -&gt; Tensor dev dtype shape'
</span><a href="RL.Model.html#unsafeReshape"><span class="hs-identifier hs-var">unsafeReshape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373403"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, nout, 13, 5]
 -&gt; Tensor dev QDType (batchSize : nout : PShape))
-&gt; Tensor dev QDType '[batchSize, nout, 13, 5]
-&gt; Tensor dev QDType (batchSize : nout : PShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; Tensor dev QDType (batchSize : nout : PShape)
forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373404"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev (batchSize : nin : PShape)
</span><a href="#local-6989586621679373405"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- top embedding</span><span>
</span><span id="line-392"></span><span>    </span><span class="annot"><a href="#local-6989586621679373406"><span class="hs-identifier hs-type">embl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621679373406"><span class="annot"><span class="annottext">embl :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373406"><span class="hs-identifier hs-var hs-var">embl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373352"><span class="hs-identifier hs-var">actTop1sl</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373361"><span class="hs-identifier hs-var">slc</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679373365"><span class="hs-identifier hs-var">sl</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679373407"><span class="annot"><span class="annottext">embm :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373407"><span class="hs-identifier hs-var hs-var">embm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373353"><span class="hs-identifier hs-var">actTop1sm</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; SliceEncoding dev '[batchSize]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373361"><span class="hs-identifier hs-var">slc</span></a></span><span> </span><span class="annot"><span class="annottext">SliceEncoding dev '[batchSize]
</span><a href="#local-6989586621679373369"><span class="hs-identifier hs-var">sm</span></a></span><span>
</span><span id="line-395"></span><span>    </span><span id="local-6989586621679373408"><span class="annot"><span class="annottext">embr :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373408"><span class="hs-identifier hs-var hs-var">embr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
QTensor dev '[batchSize]
-&gt; Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373393"><span class="hs-identifier hs-var">runConvMasked</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373368"><span class="hs-identifier hs-var">smMask</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373354"><span class="hs-identifier hs-var">actTop1sr</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373361"><span class="hs-identifier hs-var">slc</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[batchSize] (SliceEncoding dev '[batchSize])
</span><a href="#local-6989586621679373372"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621679373409"><span class="annot"><span class="annottext">embt1 :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373409"><span class="hs-identifier hs-var hs-var">embt1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373355"><span class="hs-identifier hs-var">actTop1t1</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
-&gt; TransitionEncoding dev '[batchSize]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679373362"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679373366"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679373410"><span class="annot"><span class="annottext">embt2 :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373410"><span class="hs-identifier hs-var hs-var">embt2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
QTensor dev '[batchSize]
-&gt; Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373393"><span class="hs-identifier hs-var">runConvMasked</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize]
</span><a href="#local-6989586621679373370"><span class="hs-identifier hs-var">t2Mask</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373356"><span class="hs-identifier hs-var">actTop1t2</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (batchSize : EmbShape)
 -&gt; QTensor dev (batchSize : EmbShape))
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
-&gt; TransitionEncoding dev '[batchSize]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679373362"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionEncoding dev '[batchSize]
</span><a href="#local-6989586621679373371"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-398"></span><span>    </span><span class="annot"><a href="#local-6989586621679373411"><span class="hs-identifier hs-type">topCombined</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QActionHidden"><span class="hs-identifier hs-type">QActionHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621679373411"><span class="annot"><span class="annottext">topCombined :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373411"><span class="hs-identifier hs-var hs-var">topCombined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373406"><span class="hs-identifier hs-var">embl</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373407"><span class="hs-identifier hs-var">embm</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373408"><span class="hs-identifier hs-var">embr</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373409"><span class="hs-identifier hs-var">embt1</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373410"><span class="hs-identifier hs-var">embt2</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><a href="#local-6989586621679373374"><span class="hs-identifier hs-type">topEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621679373374"><span class="annot"><span class="annottext">topEmb :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373374"><span class="hs-identifier hs-var hs-var">topEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : EmbShape)
-&gt; QTensor dev (batchSize : EmbShape)
forall (nin :: Nat) (nout :: Nat).
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batchSize : nin : PShape)
-&gt; QTensor dev (batchSize : nout : PShape)
</span><a href="#local-6989586621679373376"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373357"><span class="hs-identifier hs-var">actTop2</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679373411"><span class="hs-identifier hs-var">topCombined</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-comment">-- operation embedding</span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679373412"><span class="annot"><span class="annottext">opFreeze :: QTensor dev '[5]
</span><a href="#local-6989586621679373412"><span class="hs-identifier hs-var hs-var">opFreeze</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5] -&gt; () -&gt; QTensor dev '[5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5]
ConstEmb dev '[QSliceHidden - 3]
</span><a href="#local-6989586621679373360"><span class="hs-identifier hs-var">actFreeze</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>    </span><span id="local-6989586621679373413"><span class="annot"><span class="annottext">opSplit :: QTensor dev '[5]
</span><a href="#local-6989586621679373413"><span class="hs-identifier hs-var hs-var">opSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5] -&gt; () -&gt; QTensor dev '[5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5]
ConstEmb dev '[QSliceHidden - 3]
</span><a href="#local-6989586621679373358"><span class="hs-identifier hs-var">actSplit</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621679373414"><span class="annot"><span class="annottext">opSpread :: QTensor dev '[5]
</span><a href="#local-6989586621679373414"><span class="hs-identifier hs-var hs-var">opSpread</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5] -&gt; () -&gt; QTensor dev '[5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ConstEmb dev '[5]
ConstEmb dev '[QSliceHidden - 3]
</span><a href="#local-6989586621679373359"><span class="hs-identifier hs-var">actSpread</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621679373415"><span class="annot"><span class="annottext">opCombined :: Tensor dev QDType '[FifthPadding, 5]
</span><a href="#local-6989586621679373415"><span class="hs-identifier hs-var hs-var">opCombined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [Type]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
forall {k} (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [k]).
(KnownNat dim, '(shape, dtype, device) ~ Stack dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.stack</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(HList
   '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
     QTensor dev '[5], QTensor dev '[5], QTensor dev '[5]]
 -&gt; Tensor dev QDType '[FifthPadding, 5])
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5], QTensor dev '[5], QTensor dev '[5]]
-&gt; Tensor dev QDType '[FifthPadding, 5]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373412"><span class="hs-identifier hs-var">opFreeze</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5], QTensor dev '[5]]
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5], QTensor dev '[5], QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373413"><span class="hs-identifier hs-var">opSplit</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5]]
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5], QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373412"><span class="hs-identifier hs-var">opFreeze</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
-&gt; HList '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5]]
-&gt; HList
     '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5],
       QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373414"><span class="hs-identifier hs-var">opSpread</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
-&gt; HList '[QTensor dev '[5], QTensor dev '[5]]
-&gt; HList '[QTensor dev '[5], QTensor dev '[5], QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373413"><span class="hs-identifier hs-var">opSplit</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
-&gt; HList '[QTensor dev '[5]]
-&gt; HList '[QTensor dev '[5], QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5]
</span><a href="#local-6989586621679373413"><span class="hs-identifier hs-var">opSplit</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[5] -&gt; HList '[] -&gt; HList '[QTensor dev '[5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">HList '[]
forall k. HList '[]
</span><span class="hs-identifier hs-var">TT.HNil</span></span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><a href="#local-6989586621679373416"><span class="hs-identifier hs-type">opEmbeddings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-408"></span><span>    </span><span id="local-6989586621679373416"><span class="annot"><span class="annottext">opEmbeddings :: QTensor dev '[FifthPadding, QSliceHidden]
</span><a href="#local-6989586621679373416"><span class="hs-identifier hs-var hs-var">opEmbeddings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [Type]).
(KnownNat dim, '(shape, dtype, device) ~ Cat dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
forall {k} (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)) (tensors :: [k]).
(KnownNat dim, '(shape, dtype, device) ~ Cat dim tensors,
 Castable (HList tensors) [ForeignPtr Tensor]) =&gt;
HList tensors -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.cat</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(HList
   '[QTensor dev '[FifthPadding, 3],
     Tensor dev QDType '[FifthPadding, 5]]
 -&gt; QTensor dev '[FifthPadding, QSliceHidden])
-&gt; HList
     '[QTensor dev '[FifthPadding, 3],
       Tensor dev QDType '[FifthPadding, 5]]
-&gt; QTensor dev '[FifthPadding, QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
KnownDevice dev =&gt;
QTensor dev '[FifthPadding, 3]
</span><a href="RL.Model.html#opTypes"><span class="hs-identifier hs-var">opTypes</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[FifthPadding, 3]
-&gt; HList '[Tensor dev QDType '[FifthPadding, 5]]
-&gt; HList
     '[QTensor dev '[FifthPadding, 3],
       Tensor dev QDType '[FifthPadding, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[FifthPadding, 5]
</span><a href="#local-6989586621679373415"><span class="hs-identifier hs-var">opCombined</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[FifthPadding, 5]
-&gt; HList '[] -&gt; HList '[Tensor dev QDType '[FifthPadding, 5]]
forall x (xs :: [Type]). x -&gt; HList xs -&gt; HList (x : xs)
</span><span class="hs-operator hs-var">TT.:.</span></span><span> </span><span class="annot"><span class="annottext">HList '[]
forall k. HList '[]
</span><span class="hs-identifier hs-var">TT.HNil</span></span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="#local-6989586621679373418"><span class="hs-identifier hs-type">opIndex'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Tensor</span></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Int64</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679373418"><span class="annot"><span class="annottext">opIndex' :: Tensor dev 'Int64 '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679373418"><span class="hs-identifier hs-var hs-var">opIndex'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Tensor dev 'Int64 '[batchSize, QSliceHidden]
forall (device :: (DeviceType, Nat)) (dtype :: DType)
       (shape :: [Nat]).
Tensor -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.UnsafeMkTensor</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; Tensor dev 'Int64 '[batchSize, QSliceHidden])
-&gt; Tensor -&gt; Tensor dev 'Int64 '[batchSize, QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; Bool -&gt; [Int] -&gt; Tensor
</span><span class="hs-identifier hs-var">T.expand</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize, 1] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev 'Int64 '[batchSize, 1] -&gt; Tensor)
-&gt; Tensor dev 'Int64 '[batchSize, 1] -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize]
</span><a href="#local-6989586621679373373"><span class="hs-identifier hs-var">opIndex</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">[</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (n :: Nat). KnownNat n =&gt; Int
</span><span class="hs-identifier hs-var">TT.natValI</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>    </span><span class="annot"><a href="#local-6989586621679373420"><span class="hs-identifier hs-type">opEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621679373420"><span class="annot"><span class="annottext">opEmb :: QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679373420"><span class="hs-identifier hs-var hs-var">opEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ GatherDim shape shape' dim) =&gt;
Tensor device 'Int64 shape'
-&gt; Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.gatherDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev 'Int64 '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679373418"><span class="hs-identifier hs-var">opIndex'</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[FifthPadding, QSliceHidden]
</span><a href="#local-6989586621679373416"><span class="hs-identifier hs-var">opEmbeddings</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="#local-6989586621679373375"><span class="hs-identifier hs-type">opEmbReshaped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371208"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371210"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span>    </span><span id="local-6989586621679373375"><span class="annot"><span class="annottext">opEmbReshaped :: Tensor dev QDType '[batchSize, QSliceHidden, 1, 1]
</span><a href="#local-6989586621679373375"><span class="hs-identifier hs-var hs-var">opEmbReshaped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, QSliceHidden, 1]
 -&gt; Tensor dev QDType '[batchSize, QSliceHidden, 1, 1])
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 1]
-&gt; Tensor dev QDType '[batchSize, QSliceHidden, 1, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679373420"><span class="hs-identifier hs-var">opEmb</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span id="local-6989586621679373428"><span class="annot"><span class="annottext">forwardStoch :: ActionEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev,
    ActionEncoding dev '[batchSize])
-&gt; IO (QTensor dev outShape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679373429"><span class="annot"><span class="annottext">ActionEncoder dev
</span><a href="#local-6989586621679373429"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679373430"><span class="annot"><span class="annottext">(SliceEncoder dev, TransitionEncoder dev,
 ActionEncoding dev '[batchSize])
</span><a href="#local-6989586621679373430"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev outShape -&gt; IO (QTensor dev outShape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev outShape -&gt; IO (QTensor dev outShape))
-&gt; QTensor dev outShape -&gt; IO (QTensor dev outShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ActionEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev,
    ActionEncoding dev '[batchSize])
-&gt; QTensor dev outShape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ActionEncoder dev
</span><a href="#local-6989586621679373429"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(SliceEncoder dev, TransitionEncoder dev,
 ActionEncoding dev '[batchSize])
</span><a href="#local-6989586621679373430"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="hs-comment">-- State Encoder</span><span>
</span><span id="line-418"></span><span class="hs-comment">-- -------------</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="hs-keyword">data</span><span> </span><span id="StateSpec"><span class="annot"><a href="RL.Model.html#StateSpec"><span class="hs-identifier hs-var">StateSpec</span></a></span></span><span> </span><span id="local-6989586621679371351"><span class="annot"><a href="#local-6989586621679371351"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StateSpec"><span class="annot"><a href="RL.Model.html#StateSpec"><span class="hs-identifier hs-var">StateSpec</span></a></span></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span class="hs-keyword">data</span><span> </span><span id="StateEncoder"><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-var">StateEncoder</span></a></span></span><span> </span><span id="local-6989586621679371235"><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="StateEncoder"><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-var">StateEncoder</span></a></span></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="stL1mid"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1mid"><span class="hs-identifier hs-var hs-var">stL1mid</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL1frozenSlc"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1frozenSlc"><span class="hs-identifier hs-var hs-var">stL1frozenSlc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL1frozenTr"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1frozenTr"><span class="hs-identifier hs-var hs-var">stL1frozenTr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL1openSlc"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1openSlc"><span class="hs-identifier hs-var hs-var">stL1openSlc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL1openTr"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1openTr"><span class="hs-identifier hs-var hs-var">stL1openTr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL2"><span class="hs-identifier hs-var hs-var">stL2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="stL3"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL3"><span class="hs-identifier hs-var hs-var">stL3</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371235"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679373442"><span id="local-6989586621679373452"><span id="local-6989586621679373456"><span class="annot"><span class="annottext">Int -&gt; StateEncoder dev -&gt; ShowS
[StateEncoder dev] -&gt; ShowS
StateEncoder dev -&gt; String
(Int -&gt; StateEncoder dev -&gt; ShowS)
-&gt; (StateEncoder dev -&gt; String)
-&gt; ([StateEncoder dev] -&gt; ShowS)
-&gt; Show (StateEncoder dev)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)). Int -&gt; StateEncoder dev -&gt; ShowS
forall (dev :: (DeviceType, Nat)). [StateEncoder dev] -&gt; ShowS
forall (dev :: (DeviceType, Nat)). StateEncoder dev -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)). Int -&gt; StateEncoder dev -&gt; ShowS
showsPrec :: Int -&gt; StateEncoder dev -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)). StateEncoder dev -&gt; String
show :: StateEncoder dev -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)). [StateEncoder dev] -&gt; ShowS
showList :: [StateEncoder dev] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373459"><span id="local-6989586621679373461"><span class="annot"><span class="annottext">(forall x. StateEncoder dev -&gt; Rep (StateEncoder dev) x)
-&gt; (forall x. Rep (StateEncoder dev) x -&gt; StateEncoder dev)
-&gt; Generic (StateEncoder dev)
forall x. Rep (StateEncoder dev) x -&gt; StateEncoder dev
forall x. StateEncoder dev -&gt; Rep (StateEncoder dev) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) x.
Rep (StateEncoder dev) x -&gt; StateEncoder dev
forall (dev :: (DeviceType, Nat)) x.
StateEncoder dev -&gt; Rep (StateEncoder dev) x
$cfrom :: forall (dev :: (DeviceType, Nat)) x.
StateEncoder dev -&gt; Rep (StateEncoder dev) x
from :: forall x. StateEncoder dev -&gt; Rep (StateEncoder dev) x
$cto :: forall (dev :: (DeviceType, Nat)) x.
Rep (StateEncoder dev) x -&gt; StateEncoder dev
to :: forall x. Rep (StateEncoder dev) x -&gt; StateEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373464"><span id="local-6989586621679373473"><span class="annot"><span class="annottext">StateEncoder dev -&gt; HList (Parameters (StateEncoder dev))
StateEncoder dev
-&gt; HList (Parameters (StateEncoder dev)) -&gt; StateEncoder dev
(StateEncoder dev -&gt; HList (Parameters (StateEncoder dev)))
-&gt; (StateEncoder dev
    -&gt; HList (Parameters (StateEncoder dev)) -&gt; StateEncoder dev)
-&gt; Parameterized (StateEncoder dev)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)).
StateEncoder dev -&gt; HList (Parameters (StateEncoder dev))
forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; HList (Parameters (StateEncoder dev)) -&gt; StateEncoder dev
$cflattenParameters :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev -&gt; HList (Parameters (StateEncoder dev))
flattenParameters :: StateEncoder dev -&gt; HList (Parameters (StateEncoder dev))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; HList (Parameters (StateEncoder dev)) -&gt; StateEncoder dev
replaceParameters :: StateEncoder dev
-&gt; HList (Parameters (StateEncoder dev)) -&gt; StateEncoder dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373555"><span id="local-6989586621679373559"><span id="local-6989586621679373565"><span class="annot"><span class="annottext">Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
Proxy (StateEncoder dev) -&gt; String
(Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (StateEncoder dev) -&gt; String)
-&gt; NoThunks (StateEncoder dev)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)).
Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)).
Proxy (StateEncoder dev) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; StateEncoder dev -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)).
Proxy (StateEncoder dev) -&gt; String
showTypeOf :: Proxy (StateEncoder dev) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373607"><span class="annot"><span class="annottext">StateEncoder dev -&gt; ()
(StateEncoder dev -&gt; ()) -&gt; NFData (StateEncoder dev)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)). StateEncoder dev -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)). StateEncoder dev -&gt; ()
rnf :: StateEncoder dev -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679371256"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371256"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#StateSpec"><span class="hs-identifier hs-type">StateSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371256"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-type">StateEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371256"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-434"></span><span>  </span><span id="local-6989586621679373655"><span class="annot"><span class="annottext">sample :: StateSpec dev -&gt; IO (StateEncoder dev)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">StateSpec dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621679373656"><span class="annot"><a href="#local-6989586621679373656"><span class="hs-identifier hs-var">stL1mid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
-&gt; IO (Conv2d QSliceHidden QSliceHidden 13 5 QDType dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">TT.sample</span></span><span> </span><span class="annot"><span class="annottext">Conv2dSpec QSliceHidden QSliceHidden 13 5 QDType dev
forall (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Conv2dSpec
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
</span><span class="hs-identifier hs-var">TT.Conv2dSpec</span></span><span>
</span><span id="line-436"></span><span>    </span><span id="local-6989586621679373657"><span class="annot"><a href="#local-6989586621679373657"><span class="hs-identifier hs-var">stL1frozenSlc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-437"></span><span>    </span><span id="local-6989586621679373658"><span class="annot"><a href="#local-6989586621679373658"><span class="hs-identifier hs-var">stL1frozenTr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-438"></span><span>    </span><span id="local-6989586621679373659"><span class="annot"><a href="#local-6989586621679373659"><span class="hs-identifier hs-var">stL1openSlc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-439"></span><span>    </span><span id="local-6989586621679373660"><span class="annot"><a href="#local-6989586621679373660"><span class="hs-identifier hs-var">stL1openTr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-440"></span><span>    </span><span id="local-6989586621679373661"><span class="annot"><a href="#local-6989586621679373661"><span class="hs-identifier hs-var">stL2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-441"></span><span>    </span><span id="local-6989586621679373662"><span class="annot"><a href="#local-6989586621679373662"><span class="hs-identifier hs-var">stL3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-type">StateEncoder</span></a></span><span class="hs-special">{</span><span class="annot"><a href="RL.Model.html#stL1mid"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><span class="hs-comment">-- | HasForward for the parsing state (doesn't need batching)</span></span><span>
</span><span id="line-445"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371260"><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371261"><span class="annot"><a href="#local-6989586621679371261"><span class="hs-identifier hs-type">outShape</span></a></span></span><span>
</span><span id="line-447"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-448"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371261"><span class="hs-identifier hs-type">outShape</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span>
</span><span id="line-451"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-type">StateEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Encoding.html#StateEncoding"><span class="hs-identifier hs-type">StateEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371261"><span class="hs-identifier hs-type">outShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-455"></span><span>  </span><span id="local-6989586621679373728"><span class="annot"><span class="annottext">forward :: StateEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
-&gt; QTensor dev outShape
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-type">StateEncoder</span></a></span><span class="hs-special">{</span><span id="local-6989586621679373729"><span id="local-6989586621679373730"><span id="local-6989586621679373731"><span id="local-6989586621679373732"><span id="local-6989586621679373733"><span id="local-6989586621679373734"><span id="local-6989586621679373735"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1mid :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1frozenSlc :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1frozenTr :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1openSlc :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1openTr :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL2 :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL3 :: forall (dev :: (DeviceType, Nat)).
StateEncoder dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1mid :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1frozenSlc :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1frozenTr :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1openSlc :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL1openTr :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL2 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
stL3 :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#stL1mid"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679373736"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373736"><span class="hs-identifier hs-var">slc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373737"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679373737"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Encoding.html#StateEncoding"><span class="hs-identifier hs-type">StateEncoding</span></a></span><span> </span><span id="local-6989586621679373739"><span class="annot"><span class="annottext">QStartStop dev '[] (SliceEncoding dev '[])
</span><a href="#local-6989586621679373739"><span class="hs-identifier hs-var">mid</span></a></span></span><span> </span><span id="local-6989586621679373740"><span class="annot"><span class="annottext">QMaybe
  dev
  '[]
  (TransitionEncoding dev '[FakeSize],
   QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
</span><a href="#local-6989586621679373740"><span class="hs-identifier hs-var">frozen</span></a></span></span><span> </span><span id="local-6989586621679373741"><span class="annot"><span class="annottext">QMaybe
  dev
  '[]
  (TransitionEncoding dev '[FakeSize],
   QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
</span><a href="#local-6989586621679373741"><span class="hs-identifier hs-var">open</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev outShape
QTensor dev EmbShape
</span><a href="#local-6989586621679373742"><span class="hs-identifier hs-var">out3</span></a></span><span>
</span><span id="line-456"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-comment">-- helpers: running convolutions (batched and unbatched)</span><span>
</span><span id="line-458"></span><span>    </span><span id="local-6989586621679371265"><span id="local-6989586621679371266"><span id="local-6989586621679371267"><span class="annot"><a href="#local-6989586621679373743"><span class="hs-identifier hs-type">runConv'</span></a></span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371265"><span class="hs-identifier hs-type">nin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371266"><span class="hs-identifier hs-type">nout</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371267"><span class="hs-identifier hs-type">batch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371265"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371266"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371267"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371265"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371267"><span class="hs-identifier hs-type">batch</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679371266"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621679373743"><span class="annot"><span class="annottext">runConv' :: forall (nin :: Nat) (nout :: Nat) (batch :: Nat).
(KnownNat nin, KnownNat nout, KnownNat batch) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batch : nin : PShape)
-&gt; QTensor dev (batch : nout : PShape)
</span><a href="#local-6989586621679373743"><span class="hs-identifier hs-var hs-var">runConv'</span></a></span></span><span> </span><span id="local-6989586621679373772"><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373772"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679373773"><span class="annot"><span class="annottext">QTensor dev (batch : nin : PShape)
</span><a href="#local-6989586621679373773"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       {kernelSize1 :: Nat} {inputSize1 :: Nat} {kernelSize0 :: Nat}
       {inputSize0 :: Nat} {inputChannelSize :: Nat}
       {outputChannelSize :: Nat} {batchSize :: Nat} {w1 :: DType}
       {w2 :: (DeviceType, Nat)}.
(Assert
   (OrdCond
      (CmpNat kernelSize1 (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond
      (CmpNat kernelSize0 (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Snd stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 (Fst stride)) 'True 'True 'False)
   (TypeError ...)
 ~ (() :: Constraint),
 Assert
   (OrdCond (CmpNat 1 kernelSize0) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize0 - 1) (inputSize0 + (2 * Fst padding)))
      'True
      'True
      'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 1 kernelSize1) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (kernelSize1 - 1) (inputSize1 + (2 * Snd padding)))
      'True
      'True
      'False)
   (TypeError ...),
 KnownNat inputChannelSize, KnownNat outputChannelSize,
 KnownNat kernelSize0, KnownNat kernelSize1, KnownNat inputSize0,
 KnownNat inputSize1, KnownNat batchSize, KnownNat (Fst stride),
 KnownNat (Fst padding), KnownNat (Snd stride),
 KnownNat (Snd padding)) =&gt;
Conv2d
  inputChannelSize outputChannelSize kernelSize0 kernelSize1 w1 w2
-&gt; Tensor
     w2 w1 '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     w2
     w1
     '[batchSize, outputChannelSize,
       Div ((inputSize0 + (2 * Fst padding)) - kernelSize0) (Fst stride)
       + 1,
       Div ((inputSize1 + (2 * Snd padding)) - kernelSize1) (Snd stride)
       + 1]
</span><span class="hs-identifier hs-var">TT.conv2dForward</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout 13 5 QDType dev
Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373772"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batch, nin, 13, 5]
QTensor dev (batch : nin : PShape)
</span><a href="#local-6989586621679373773"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621679371271"><span id="local-6989586621679371272"><span class="annot"><a href="#local-6989586621679373774"><span class="hs-identifier hs-type">runConv</span></a></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371271"><span class="hs-identifier hs-type">nin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371272"><span class="hs-identifier hs-type">nout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="#local-6989586621679371271"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371272"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-467"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371271"><span class="hs-identifier hs-type">nin</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371272"><span class="hs-identifier hs-type">nout</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-469"></span><span>    </span><span id="local-6989586621679373774"><span class="annot"><span class="annottext">runConv :: forall (nin :: Nat) (nout :: Nat).
(KnownNat nin, KnownNat nout) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (nin : PShape) -&gt; QTensor dev (nout : PShape)
</span><a href="#local-6989586621679373774"><span class="hs-identifier hs-var hs-var">runConv</span></a></span></span><span> </span><span id="local-6989586621679373786"><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373786"><span class="hs-identifier hs-var">conv</span></a></span></span><span> </span><span id="local-6989586621679373787"><span class="annot"><span class="annottext">QTensor dev (nin : PShape)
</span><a href="#local-6989586621679373787"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1, nout, 13, 5]
 -&gt; Tensor dev QDType (nout : PShape))
-&gt; Tensor dev QDType '[1, nout, 13, 5]
-&gt; Tensor dev QDType (nout : PShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (1 : nin : PShape)
-&gt; QTensor dev (1 : nout : PShape)
forall (nin :: Nat) (nout :: Nat) (batch :: Nat).
(KnownNat nin, KnownNat nout, KnownNat batch) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batch : nin : PShape)
-&gt; QTensor dev (batch : nout : PShape)
</span><a href="#local-6989586621679373743"><span class="hs-identifier hs-var">runConv'</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d nin nout FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373786"><span class="hs-identifier hs-var">conv</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (1 : nin : PShape) -&gt; QTensor dev (1 : nout : PShape))
-&gt; QTensor dev (1 : nin : PShape)
-&gt; QTensor dev (1 : nout : PShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ Unsqueeze shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.unsqueeze</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[nin, 13, 5]
QTensor dev (nin : PShape)
</span><a href="#local-6989586621679373787"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-comment">-- embedding segments (open and frozen)</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="#local-6989586621679373788"><span class="hs-identifier hs-type">embedSegments</span></a></span><span>
</span><span id="line-473"></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QMaybe"><span class="hs-identifier hs-type">QMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#TransitionEncoding"><span class="hs-identifier hs-type">TransitionEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.Encoding.html#QStartStop"><span class="hs-identifier hs-type">QStartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#SliceEncoding"><span class="hs-identifier hs-type">SliceEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-477"></span><span>    </span><span id="local-6989586621679373788"><span class="annot"><span class="annottext">embedSegments :: Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QMaybe
     dev
     '[]
     (TransitionEncoding dev '[FakeSize],
      QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
-&gt; QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373788"><span class="hs-identifier hs-var hs-var">embedSegments</span></a></span></span><span> </span><span id="local-6989586621679373789"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373789"><span class="hs-identifier hs-var">trEnc</span></a></span></span><span> </span><span id="local-6989586621679373790"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373790"><span class="hs-identifier hs-var">slcEnc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QMaybe"><span class="hs-identifier hs-type">QMaybe</span></a></span><span> </span><span id="local-6989586621679373791"><span class="annot"><span class="annottext">QTensor dev '[]
</span><a href="#local-6989586621679373791"><span class="hs-identifier hs-var">mask</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679373792"><span class="annot"><span class="annottext">TransitionEncoding dev '[FakeSize]
</span><a href="#local-6989586621679373792"><span class="hs-identifier hs-var">ft</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373793"><span class="annot"><span class="annottext">QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize])
</span><a href="#local-6989586621679373793"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-478"></span><span>      </span><span class="annot"><span class="annottext">Tensor dev QDType '[1, 1, 1, 1]
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
-&gt; QTensor dev (FakeSize : EmbShape)
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-identifier hs-var">TT.mul</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (shape' :: [Nat]) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownShape shape', Numel shape ~ Numel shape') =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.reshape</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[]
</span><a href="#local-6989586621679373791"><span class="hs-identifier hs-var">mask</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[FakeSize, QSliceHidden, 13, 5]
 -&gt; QTensor dev (FakeSize : EmbShape))
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
-&gt; QTensor dev (FakeSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[FakeSize, QSliceHidden, 13, 5]
QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373794"><span class="hs-identifier hs-var">ftEmb</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[FakeSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[FakeSize, QSliceHidden, 13, 5]
QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373795"><span class="hs-identifier hs-var">fsEmb</span></a></span><span>
</span><span id="line-479"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-480"></span><span>      </span><span class="annot"><a href="#local-6989586621679373794"><span class="hs-identifier hs-type">ftEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>      </span><span id="local-6989586621679373794"><span class="annot"><span class="annottext">ftEmb :: QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373794"><span class="hs-identifier hs-var hs-var">ftEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape)
 -&gt; QTensor dev (FakeSize : EmbShape))
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall (nin :: Nat) (nout :: Nat) (batch :: Nat).
(KnownNat nin, KnownNat nout, KnownNat batch) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batch : nin : PShape)
-&gt; QTensor dev (batch : nout : PShape)
</span><a href="#local-6989586621679373743"><span class="hs-identifier hs-var">runConv'</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373789"><span class="hs-identifier hs-var">trEnc</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape)
 -&gt; QTensor dev (FakeSize : EmbShape))
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
-&gt; TransitionEncoding dev '[FakeSize]
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679373737"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionEncoding dev '[FakeSize]
</span><a href="#local-6989586621679373792"><span class="hs-identifier hs-var">ft</span></a></span><span>
</span><span id="line-482"></span><span>      </span><span class="annot"><a href="#local-6989586621679373795"><span class="hs-identifier hs-type">fsEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FakeSize"><span class="hs-identifier hs-type">FakeSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>      </span><span id="local-6989586621679373795"><span class="annot"><span class="annottext">fsEmb :: QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373795"><span class="hs-identifier hs-var hs-var">fsEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape)
 -&gt; QTensor dev (FakeSize : EmbShape))
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall (nin :: Nat) (nout :: Nat) (batch :: Nat).
(KnownNat nin, KnownNat nout, KnownNat batch) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (batch : nin : PShape)
-&gt; QTensor dev (batch : nout : PShape)
</span><a href="#local-6989586621679373743"><span class="hs-identifier hs-var">runConv'</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373790"><span class="hs-identifier hs-var">slcEnc</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape)
 -&gt; QTensor dev (FakeSize : EmbShape))
-&gt; QTensor dev (FakeSize : EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize])
-&gt; QTensor dev '[FakeSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373736"><span class="hs-identifier hs-var">slc</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize])
</span><a href="#local-6989586621679373793"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-comment">-- embed frozen segments</span><span>
</span><span id="line-486"></span><span>    </span><span class="annot"><a href="#local-6989586621679373796"><span class="hs-identifier hs-type">frozenEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621679373796"><span class="annot"><span class="annottext">frozenEmb :: QTensor dev EmbShape
</span><a href="#local-6989586621679373796"><span class="hs-identifier hs-var hs-var">frozenEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape' :: [Nat]) (shape :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ DropValue shape dim,
 MeanDTypeValidation device dtype, AllDimsPositive shape) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.meanDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape) -&gt; QTensor dev EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape) -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QMaybe
     dev
     '[]
     (TransitionEncoding dev '[FakeSize],
      QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
-&gt; QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373788"><span class="hs-identifier hs-var">embedSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373731"><span class="hs-identifier hs-var">stL1frozenTr</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373730"><span class="hs-identifier hs-var">stL1frozenSlc</span></a></span><span> </span><span class="annot"><span class="annottext">QMaybe
  dev
  '[]
  (TransitionEncoding dev '[FakeSize],
   QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
</span><a href="#local-6989586621679373740"><span class="hs-identifier hs-var">frozen</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-comment">-- embed open segments</span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="#local-6989586621679373798"><span class="hs-identifier hs-type">openEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>    </span><span id="local-6989586621679373798"><span class="annot"><span class="annottext">openEmb :: QTensor dev EmbShape
</span><a href="#local-6989586621679373798"><span class="hs-identifier hs-var hs-var">openEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape' :: [Nat]) (shape :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ DropValue shape dim,
 MeanDTypeValidation device dtype, AllDimsPositive shape) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.meanDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev (FakeSize : EmbShape) -&gt; QTensor dev EmbShape)
-&gt; QTensor dev (FakeSize : EmbShape) -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QMaybe
     dev
     '[]
     (TransitionEncoding dev '[FakeSize],
      QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
-&gt; QTensor dev (FakeSize : EmbShape)
</span><a href="#local-6989586621679373788"><span class="hs-identifier hs-var">embedSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373733"><span class="hs-identifier hs-var">stL1openTr</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373732"><span class="hs-identifier hs-var">stL1openSlc</span></a></span><span> </span><span class="annot"><span class="annottext">QMaybe
  dev
  '[]
  (TransitionEncoding dev '[FakeSize],
   QStartStop dev '[FakeSize] (SliceEncoding dev '[FakeSize]))
</span><a href="#local-6989586621679373741"><span class="hs-identifier hs-var">open</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-comment">-- embed the mid slice</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621679373799"><span class="hs-identifier hs-type">midEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>    </span><span id="local-6989586621679373799"><span class="annot"><span class="annottext">midEmb :: QTensor dev EmbShape
</span><a href="#local-6989586621679373799"><span class="hs-identifier hs-var hs-var">midEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev EmbShape -&gt; QTensor dev EmbShape)
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (nin :: Nat) (nout :: Nat).
(KnownNat nin, KnownNat nout) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (nin : PShape) -&gt; QTensor dev (nout : PShape)
</span><a href="#local-6989586621679373774"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373729"><span class="hs-identifier hs-var">stL1mid</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev EmbShape -&gt; QTensor dev EmbShape)
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
-&gt; QStartStop dev '[] (SliceEncoding dev '[])
-&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679373736"><span class="hs-identifier hs-var">slc</span></a></span><span> </span><span class="annot"><span class="annottext">QStartStop dev '[] (SliceEncoding dev '[])
</span><a href="#local-6989586621679373739"><span class="hs-identifier hs-var">mid</span></a></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-comment">-- combined embeddings and compute output</span><span>
</span><span id="line-496"></span><span>    </span><span class="annot"><a href="#local-6989586621679373800"><span class="hs-identifier hs-type">fullEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>    </span><span id="local-6989586621679373800"><span class="annot"><span class="annottext">fullEmb :: QTensor dev EmbShape
</span><a href="#local-6989586621679373800"><span class="hs-identifier hs-var hs-var">fullEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679373799"><span class="hs-identifier hs-var">midEmb</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679373796"><span class="hs-identifier hs-var">frozenEmb</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 13, 5]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679373798"><span class="hs-identifier hs-var">openEmb</span></a></span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><a href="#local-6989586621679373801"><span class="hs-identifier hs-type">out2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QStateHidden"><span class="hs-identifier hs-type">QStateHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>    </span><span id="local-6989586621679373801"><span class="annot"><span class="annottext">out2 :: QTensor dev EmbShape
</span><a href="#local-6989586621679373801"><span class="hs-identifier hs-var hs-var">out2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev EmbShape -&gt; QTensor dev EmbShape)
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (nin :: Nat) (nout :: Nat).
(KnownNat nin, KnownNat nout) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (nin : PShape) -&gt; QTensor dev (nout : PShape)
</span><a href="#local-6989586621679373774"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373734"><span class="hs-identifier hs-var">stL2</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev EmbShape
</span><a href="#local-6989586621679373800"><span class="hs-identifier hs-var">fullEmb</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><a href="#local-6989586621679373742"><span class="hs-identifier hs-type">out3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371260"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>    </span><span id="local-6989586621679373742"><span class="annot"><span class="annottext">out3 :: QTensor dev EmbShape
</span><a href="#local-6989586621679373742"><span class="hs-identifier hs-var hs-var">out3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev EmbShape -&gt; QTensor dev EmbShape)
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
-&gt; QTensor dev EmbShape -&gt; QTensor dev EmbShape
forall (nin :: Nat) (nout :: Nat).
(KnownNat nin, KnownNat nout) =&gt;
Conv2d nin nout FifthSize OctaveSize QDType dev
-&gt; QTensor dev (nin : PShape) -&gt; QTensor dev (nout : PShape)
</span><a href="#local-6989586621679373774"><span class="hs-identifier hs-var">runConv</span></a></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679373735"><span class="hs-identifier hs-var">stL3</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev EmbShape
</span><a href="#local-6989586621679373801"><span class="hs-identifier hs-var">out2</span></a></span><span>
</span><span id="line-502"></span><span>  </span><span id="local-6989586621679373807"><span class="annot"><span class="annottext">forwardStoch :: StateEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
-&gt; IO (QTensor dev outShape)
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679373808"><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679373808"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679373809"><span class="annot"><span class="annottext">(SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
</span><a href="#local-6989586621679373809"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev outShape -&gt; IO (QTensor dev outShape)
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev outShape -&gt; IO (QTensor dev outShape))
-&gt; QTensor dev outShape -&gt; IO (QTensor dev outShape)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
-&gt; QTensor dev outShape
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679373808"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
</span><a href="#local-6989586621679373809"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-comment">-- Full Q Model</span><span>
</span><span id="line-505"></span><span class="hs-comment">-- ------------</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-keyword">data</span><span> </span><span id="QSpec"><span class="annot"><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-var">QSpec</span></a></span></span><span> </span><span id="local-6989586621679371459"><span class="annot"><a href="#local-6989586621679371459"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="QSpec"><span class="annot"><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-var">QSpec</span></a></span></span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span class="hs-keyword">data</span><span> </span><span id="QModel"><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-var">QModel</span></a></span></span><span> </span><span id="local-6989586621679371280"><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="QModel"><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-var">QModel</span></a></span></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="qModelSlc"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)). QModel dev -&gt; SliceEncoder dev
</span><a href="RL.Model.html#qModelSlc"><span class="hs-identifier hs-var hs-var">qModelSlc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#SliceEncoder"><span class="hs-identifier hs-type">SliceEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelTr"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; TransitionEncoder dev
</span><a href="RL.Model.html#qModelTr"><span class="hs-identifier hs-var hs-var">qModelTr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#TransitionEncoder"><span class="hs-identifier hs-type">TransitionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelAct"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)). QModel dev -&gt; ActionEncoder dev
</span><a href="RL.Model.html#qModelAct"><span class="hs-identifier hs-var hs-var">qModelAct</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#ActionEncoder"><span class="hs-identifier hs-type">ActionEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelSt"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)). QModel dev -&gt; StateEncoder dev
</span><a href="RL.Model.html#qModelSt"><span class="hs-identifier hs-var hs-var">qModelSt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#StateEncoder"><span class="hs-identifier hs-type">StateEncoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelFinal1"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev
-&gt; Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="RL.Model.html#qModelFinal1"><span class="hs-identifier hs-var hs-var">qModelFinal1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2d</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#FifthSize"><span class="hs-identifier hs-type">FifthSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctaveSize"><span class="hs-identifier hs-type">OctaveSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- !(TT.Linear (EmbSize (QSpecGeneral DefaultQSpec)) QOutHidden QDType dev)</span><span>
</span><span id="line-515"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelNorm1"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; LayerNorm '[QSliceHidden] QDType dev
</span><a href="RL.Model.html#qModelNorm1"><span class="hs-identifier hs-var hs-var">qModelNorm1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.LayerNorm</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelFinal2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; Linear QSliceHidden 1 QDType dev
</span><a href="RL.Model.html#qModelFinal2"><span class="hs-identifier hs-var hs-var">qModelFinal2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Linear</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelValue1"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; Linear QSliceHidden QSliceHidden QDType dev
</span><a href="RL.Model.html#qModelValue1"><span class="hs-identifier hs-var hs-var">qModelValue1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Linear</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelValueNorm"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; LayerNorm '[QSliceHidden] QDType dev
</span><a href="RL.Model.html#qModelValueNorm"><span class="hs-identifier hs-var hs-var">qModelValueNorm</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.LayerNorm</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="qModelValue2"><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; Linear QSliceHidden 1 QDType dev
</span><a href="RL.Model.html#qModelValue2"><span class="hs-identifier hs-var hs-var">qModelValue2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.Linear</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QDType"><span class="hs-identifier hs-type">QDType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371280"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-521"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679373824"><span id="local-6989586621679373839"><span id="local-6989586621679373843"><span class="annot"><span class="annottext">Int -&gt; QModel dev -&gt; ShowS
[QModel dev] -&gt; ShowS
QModel dev -&gt; String
(Int -&gt; QModel dev -&gt; ShowS)
-&gt; (QModel dev -&gt; String)
-&gt; ([QModel dev] -&gt; ShowS)
-&gt; Show (QModel dev)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall (dev :: (DeviceType, Nat)). Int -&gt; QModel dev -&gt; ShowS
forall (dev :: (DeviceType, Nat)). [QModel dev] -&gt; ShowS
forall (dev :: (DeviceType, Nat)). QModel dev -&gt; String
$cshowsPrec :: forall (dev :: (DeviceType, Nat)). Int -&gt; QModel dev -&gt; ShowS
showsPrec :: Int -&gt; QModel dev -&gt; ShowS
$cshow :: forall (dev :: (DeviceType, Nat)). QModel dev -&gt; String
show :: QModel dev -&gt; String
$cshowList :: forall (dev :: (DeviceType, Nat)). [QModel dev] -&gt; ShowS
showList :: [QModel dev] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373846"><span id="local-6989586621679373848"><span class="annot"><span class="annottext">(forall x. QModel dev -&gt; Rep (QModel dev) x)
-&gt; (forall x. Rep (QModel dev) x -&gt; QModel dev)
-&gt; Generic (QModel dev)
forall x. Rep (QModel dev) x -&gt; QModel dev
forall x. QModel dev -&gt; Rep (QModel dev) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall (dev :: (DeviceType, Nat)) x.
Rep (QModel dev) x -&gt; QModel dev
forall (dev :: (DeviceType, Nat)) x.
QModel dev -&gt; Rep (QModel dev) x
$cfrom :: forall (dev :: (DeviceType, Nat)) x.
QModel dev -&gt; Rep (QModel dev) x
from :: forall x. QModel dev -&gt; Rep (QModel dev) x
$cto :: forall (dev :: (DeviceType, Nat)) x.
Rep (QModel dev) x -&gt; QModel dev
to :: forall x. Rep (QModel dev) x -&gt; QModel dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679373851"><span id="local-6989586621679373860"><span class="annot"><span class="annottext">QModel dev -&gt; HList (Parameters (QModel dev))
QModel dev -&gt; HList (Parameters (QModel dev)) -&gt; QModel dev
(QModel dev -&gt; HList (Parameters (QModel dev)))
-&gt; (QModel dev -&gt; HList (Parameters (QModel dev)) -&gt; QModel dev)
-&gt; Parameterized (QModel dev)
forall f.
(f -&gt; HList (Parameters f))
-&gt; (f -&gt; HList (Parameters f) -&gt; f) -&gt; Parameterized f
forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; HList (Parameters (QModel dev))
forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; HList (Parameters (QModel dev)) -&gt; QModel dev
$cflattenParameters :: forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; HList (Parameters (QModel dev))
flattenParameters :: QModel dev -&gt; HList (Parameters (QModel dev))
$creplaceParameters :: forall (dev :: (DeviceType, Nat)).
QModel dev -&gt; HList (Parameters (QModel dev)) -&gt; QModel dev
replaceParameters :: QModel dev -&gt; HList (Parameters (QModel dev)) -&gt; QModel dev
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">TT.Parameterized</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679374192"><span id="local-6989586621679374196"><span id="local-6989586621679374202"><span class="annot"><span class="annottext">Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
Proxy (QModel dev) -&gt; String
(Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (QModel dev) -&gt; String)
-&gt; NoThunks (QModel dev)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
forall (dev :: (DeviceType, Nat)).
Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
forall (dev :: (DeviceType, Nat)). Proxy (QModel dev) -&gt; String
$cnoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall (dev :: (DeviceType, Nat)).
Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; QModel dev -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall (dev :: (DeviceType, Nat)). Proxy (QModel dev) -&gt; String
showTypeOf :: Proxy (QModel dev) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679374279"><span class="annot"><span class="annottext">QModel dev -&gt; ()
(QModel dev -&gt; ()) -&gt; NFData (QModel dev)
forall a. (a -&gt; ()) -&gt; NFData a
forall (dev :: (DeviceType, Nat)). QModel dev -&gt; ()
$crnf :: forall (dev :: (DeviceType, Nat)). QModel dev -&gt; ()
rnf :: QModel dev -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679371334"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Randomizable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-type">QSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-524"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">sample</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-type">QSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>  </span><span id="local-6989586621679374363"><span class="annot"><span class="annottext">sample :: QSpec dev -&gt; IO (QModel dev)
</span><span class="hs-identifier hs-var hs-var hs-var">sample</span></span></span><span> </span><span class="annot"><span class="annottext">QSpec dev
</span><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-var">QSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>    </span><span id="local-6989586621679374364"><span class="annot"><a href="#local-6989586621679374364"><span class="hs-identifier hs-var">qModelSlc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SliceSpec dev -&gt; IO (SliceEncoder dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">(SliceSpec dev -&gt; IO (SliceEncoder dev))
-&gt; SliceSpec dev -&gt; IO (SliceEncoder dev)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (dev :: k). SliceSpec dev
forall (dev :: (DeviceType, Nat)). SliceSpec dev
</span><a href="RL.Model.html#SliceSpec"><span class="hs-identifier hs-var">SliceSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-527"></span><span>    </span><span id="local-6989586621679374365"><span class="annot"><a href="#local-6989586621679374365"><span class="hs-identifier hs-var">qModelTr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#TransitionSpec"><span class="hs-identifier hs-type">TransitionSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-528"></span><span>    </span><span id="local-6989586621679374366"><span class="annot"><a href="#local-6989586621679374366"><span class="hs-identifier hs-var">qModelAct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#ActionSpec"><span class="hs-identifier hs-type">ActionSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-529"></span><span>    </span><span id="local-6989586621679374367"><span class="annot"><a href="#local-6989586621679374367"><span class="hs-identifier hs-var">qModelSt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="RL.Model.html#StateSpec"><span class="hs-identifier hs-type">StateSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371334"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-530"></span><span>    </span><span id="local-6989586621679374368"><span class="annot"><a href="#local-6989586621679374368"><span class="hs-identifier hs-var">qModelFinal1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Conv2dSpec</span></span><span>
</span><span id="line-531"></span><span>    </span><span id="local-6989586621679374369"><span class="annot"><a href="#local-6989586621679374369"><span class="hs-identifier hs-var">qModelNorm1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.LayerNormSpec</span></span><span> </span><span class="annot"><span class="hs-number">1e-05</span></span><span>
</span><span id="line-532"></span><span>    </span><span id="local-6989586621679374371"><span class="annot"><a href="#local-6989586621679374371"><span class="hs-identifier hs-var">qModelFinal2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.LinearSpec</span></span><span>
</span><span id="line-533"></span><span>    </span><span id="local-6989586621679374373"><span class="annot"><a href="#local-6989586621679374373"><span class="hs-identifier hs-var">qModelValue1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.LinearSpec</span></span><span>
</span><span id="line-534"></span><span>    </span><span id="local-6989586621679374374"><span class="annot"><a href="#local-6989586621679374374"><span class="hs-identifier hs-var">qModelValueNorm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.LayerNormSpec</span></span><span> </span><span class="annot"><span class="hs-number">1e-05</span></span><span>
</span><span id="line-535"></span><span>    </span><span id="local-6989586621679374375"><span class="annot"><a href="#local-6989586621679374375"><span class="hs-identifier hs-var">qModelValue2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.sample</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.LinearSpec</span></span><span>
</span><span id="line-536"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span class="hs-special">{</span><span class="annot"><a href="RL.Model.html#qModelSlc"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span class="annot"><span class="hs-comment">-- | HasForward for model (unbatched)</span></span><span>
</span><span id="line-539"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-540"></span><span>  </span><span id="local-6989586621679371363"><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.CheckIsSuffixOf</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-542"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forward</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621679374385"><span class="annot"><span class="annottext">forward :: QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span id="local-6989586621679374386"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374386"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679374387"><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374387"><span class="hs-identifier hs-var">encoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[1] -&gt; QTensor dev '[1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.log</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[1] -&gt; QTensor dev '[1])
-&gt; QTensor dev '[1] -&gt; QTensor dev '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[1] -&gt; QTensor dev '[1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
StandardFloatingPointDTypeValidation device dtype =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.sigmoid</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[1] -&gt; QTensor dev '[1])
-&gt; QTensor dev '[1] -&gt; QTensor dev '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#forwardQModel"><span class="hs-identifier hs-var">forwardQModel</span></a></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374386"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374387"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forwardStoch</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371363"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>  </span><span id="local-6989586621679374394"><span class="annot"><span class="annottext">forwardStoch :: QModel dev -&gt; QEncoding dev '[] -&gt; IO (QTensor dev '[1])
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679374395"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374395"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679374396"><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374396"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[1] -&gt; IO (QTensor dev '[1])
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[1] -&gt; IO (QTensor dev '[1]))
-&gt; QTensor dev '[1] -&gt; IO (QTensor dev '[1])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374395"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374396"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><span class="hs-comment">-- | HasForward for model (batched)</span></span><span>
</span><span id="line-550"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621679371374"><span id="local-6989586621679371375"><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.CheckIsSuffixOf</span></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.HasForward</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-557"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-558"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">forward</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371374"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371375"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-559"></span><span>  </span><span id="local-6989586621679374412"><span class="annot"><span class="annottext">forward :: QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><span class="hs-identifier hs-var hs-var hs-var">forward</span></span></span><span> </span><span id="local-6989586621679374413"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374413"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679374414"><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679374414"><span class="hs-identifier hs-var">encoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.log</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1])
-&gt; QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
StandardFloatingPointDTypeValidation device dtype =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.sigmoid</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1])
-&gt; QTensor dev '[batchSize, 1] -&gt; QTensor dev '[batchSize, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(IsValidDevice dev, 1 &lt;= batchSize) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardQModelBatched"><span class="hs-identifier hs-var">forwardQModelBatched</span></a></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374413"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679374414"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>  </span><span id="local-6989586621679374421"><span class="annot"><span class="annottext">forwardStoch :: QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; IO (QTensor dev '[batchSize, 1])
</span><span class="hs-identifier hs-var hs-var hs-var">forwardStoch</span></span></span><span> </span><span id="local-6989586621679374422"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374422"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679374423"><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679374423"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, 1] -&gt; IO (QTensor dev '[batchSize, 1])
forall a. a -&gt; IO a
forall (f :: Type -&gt; Type) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[batchSize, 1] -&gt; IO (QTensor dev '[batchSize, 1]))
-&gt; QTensor dev '[batchSize, 1] -&gt; IO (QTensor dev '[batchSize, 1])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374422"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679374423"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span id="local-6989586621679371371"><span class="annot"><a href="RL.Model.html#forwardQModel"><span class="hs-identifier hs-type">forwardQModel</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371371"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371371"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371371"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371371"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-569"></span><span id="forwardQModel"><span class="annot"><span class="annottext">forwardQModel :: forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#forwardQModel"><span class="hs-identifier hs-var hs-var">forwardQModel</span></a></span></span><span> </span><span id="local-6989586621679374432"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374432"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679374433"><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374433"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (device :: (DeviceType, Nat)).
(KnownNat dim, shape' ~ SqueezeDim shape dim) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape'
</span><span class="hs-identifier hs-var">TT.squeezeDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1, 1] -&gt; Tensor dev QDType '[1])
-&gt; Tensor dev QDType '[1, 1] -&gt; Tensor dev QDType '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[1] -&gt; Tensor dev QDType '[1, 1]
forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(IsValidDevice dev, 1 &lt;= batchSize) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardQModelBatched"><span class="hs-identifier hs-var">forwardQModelBatched</span></a></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679374432"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">(QEncoding dev '[1] -&gt; Tensor dev QDType '[1, 1])
-&gt; QEncoding dev '[1] -&gt; Tensor dev QDType '[1, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[] -&gt; Batched (QEncoding dev '[])
forall a. Batchable a =&gt; a -&gt; Batched a
</span><a href="RL.Encoding.html#addBatchDim"><span class="hs-identifier hs-var">addBatchDim</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[]
</span><a href="#local-6989586621679374433"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><a href="RL.Model.html#forwardQModelBatched"><span class="hs-identifier hs-type">forwardQModelBatched</span></a></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371376"><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371377"><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span></span><span>
</span><span id="line-573"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-574"></span><span>     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span>
</span><span id="line-575"></span><span>     </span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-579"></span><span id="forwardQModelBatched"><span class="annot"><span class="annottext">forwardQModelBatched :: forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(IsValidDevice dev, 1 &lt;= batchSize) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardQModelBatched"><span class="hs-identifier hs-var hs-var">forwardQModelBatched</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span id="local-6989586621679374492"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679374492"><span class="hs-identifier hs-var">slc</span></a></span></span><span> </span><span id="local-6989586621679374493"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679374493"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span id="local-6989586621679374494"><span class="annot"><span class="annottext">ActionEncoder dev
</span><a href="#local-6989586621679374494"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span id="local-6989586621679374495"><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679374495"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679374496"><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679374496"><span class="hs-identifier hs-var">final1</span></a></span></span><span> </span><span id="local-6989586621679374497"><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><a href="#local-6989586621679374497"><span class="hs-identifier hs-var">norm1</span></a></span></span><span> </span><span id="local-6989586621679374498"><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><a href="#local-6989586621679374498"><span class="hs-identifier hs-var">final2</span></a></span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden QSliceHidden QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span id="local-6989586621679374500"><span class="annot"><span class="annottext">ActionEncoding dev '[batchSize]
</span><a href="#local-6989586621679374500"><span class="hs-identifier hs-var">actEncs</span></a></span></span><span> </span><span id="local-6989586621679374501"><span class="annot"><span class="annottext">StateEncoding dev
</span><a href="#local-6989586621679374501"><span class="hs-identifier hs-var">stEnc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, 1]
</span><a href="#local-6989586621679374502"><span class="hs-identifier hs-var">out2</span></a></span><span>
</span><span id="line-580"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-581"></span><span>  </span><span class="annot"><a href="#local-6989586621679374503"><span class="hs-identifier hs-type">actEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>  </span><span id="local-6989586621679374503"><span class="annot"><span class="annottext">actEmb :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679374503"><span class="hs-identifier hs-var hs-var">actEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev,
    ActionEncoding dev '[batchSize])
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">ActionEncoder dev
</span><a href="#local-6989586621679374494"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679374492"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679374493"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ActionEncoding dev '[batchSize]
</span><a href="#local-6989586621679374500"><span class="hs-identifier hs-var">actEncs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><a href="#local-6989586621679374504"><span class="hs-identifier hs-type">stEmb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#EmbSize"><span class="hs-identifier hs-type">EmbSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>  </span><span id="local-6989586621679374504"><span class="annot"><span class="annottext">stEmb :: QTensor dev EmbShape
</span><a href="#local-6989586621679374504"><span class="hs-identifier hs-var hs-var">stEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
-&gt; QTensor dev '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679374495"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679374492"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679374493"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StateEncoding dev
</span><a href="#local-6989586621679374501"><span class="hs-identifier hs-var">stEnc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>  </span><span id="local-6989586621679374505"><span class="annot"><span class="annottext">inputEmb :: QTensor dev '[batchSize, QSliceHidden, 13, 5]
</span><a href="#local-6989586621679374505"><span class="hs-identifier hs-var hs-var">inputEmb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679374503"><span class="hs-identifier hs-var">actEmb</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
-&gt; QTensor dev '[QSliceHidden, 13, 5]
-&gt; QTensor dev '[batchSize, QSliceHidden, 13, 5]
forall (shape'' :: [Nat]) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (dtype'' :: DType)
       (device :: (DeviceType, Nat)).
(dtype'' ~ DTypePromotion dtype dtype',
 shape'' ~ Broadcast shape shape',
 BasicArithmeticDTypeIsValid device dtype,
 BasicArithmeticDTypeIsValid device dtype',
 BasicArithmeticDTypeIsValid device dtype'') =&gt;
Tensor device dtype shape
-&gt; Tensor device dtype' shape' -&gt; Tensor device dtype'' shape''
</span><span class="hs-operator hs-var">`TT.add`</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[QSliceHidden, 13, 5]
QTensor dev EmbShape
</span><a href="#local-6989586621679374504"><span class="hs-identifier hs-var">stEmb</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><a href="#local-6989586621679374506"><span class="hs-identifier hs-type">out1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="RL.ModelTypes.html#PShape"><span class="hs-identifier hs-type">PShape</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>  </span><span id="local-6989586621679374506"><span class="annot"><span class="annottext">out1 :: QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679374506"><span class="hs-identifier hs-var hs-var">out1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (stride :: (Nat, Nat)) (padding :: (Nat, Nat))
       (inputChannelSize :: Nat) (outputChannelSize :: Nat)
       (kernelSize0 :: Nat) (kernelSize1 :: Nat) (inputSize0 :: Nat)
       (inputSize1 :: Nat) (batchSize :: Nat) (outputSize0 :: Nat)
       (outputSize1 :: Nat) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(All KnownNat '[Fst stride, Snd stride, Fst padding, Snd padding],
 ConvSideCheck
   inputSize0 kernelSize0 (Fst stride) (Fst padding) outputSize0,
 ConvSideCheck
   inputSize1 kernelSize1 (Snd stride) (Snd padding) outputSize1) =&gt;
Conv2d
  inputChannelSize
  outputChannelSize
  kernelSize0
  kernelSize1
  dtype
  device
-&gt; Tensor
     device dtype '[batchSize, inputChannelSize, inputSize0, inputSize1]
-&gt; Tensor
     device
     dtype
     '[batchSize, outputChannelSize, outputSize0, outputSize1]
</span><a href="RL.TorchHelpers.html#conv2dForwardRelaxed"><span class="hs-identifier hs-var">TH.conv2dForwardRelaxed</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#FifthPadding"><span class="hs-identifier hs-type">FifthPadding</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#OctavePadding"><span class="hs-identifier hs-type">OctavePadding</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden 13 5 QDType dev
Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><a href="#local-6989586621679374496"><span class="hs-identifier hs-var">final1</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
</span><a href="#local-6989586621679374505"><span class="hs-identifier hs-var">inputEmb</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span class="annot"><a href="#local-6989586621679374507"><span class="hs-identifier hs-type">sum1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-589"></span><span>  </span><span id="local-6989586621679374507"><span class="annot"><span class="annottext">sum1 :: QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679374507"><span class="hs-identifier hs-var hs-var">sum1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType (DropValue '[batchSize, QSliceHidden, 13, 5] 2)
 -&gt; QTensor dev '[batchSize, QSliceHidden])
-&gt; Tensor
     dev QDType (DropValue '[batchSize, QSliceHidden, 13, 5] 2)
-&gt; QTensor dev '[batchSize, QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden, 13, 5]
QTensor dev (batchSize : EmbShape)
</span><a href="#local-6989586621679374506"><span class="hs-identifier hs-var">out1</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><a href="#local-6989586621679374508"><span class="hs-identifier hs-type">out1norm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QOutHidden"><span class="hs-identifier hs-type">QOutHidden</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-591"></span><span>  </span><span id="local-6989586621679374508"><span class="annot"><span class="annottext">out1norm :: QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679374508"><span class="hs-identifier hs-var hs-var">out1norm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden]
-&gt; QTensor dev '[batchSize, QSliceHidden]
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[batchSize, QSliceHidden]
 -&gt; QTensor dev '[batchSize, QSliceHidden])
-&gt; QTensor dev '[batchSize, QSliceHidden]
-&gt; QTensor dev '[batchSize, QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
-&gt; QTensor dev '[batchSize, QSliceHidden]
-&gt; QTensor dev '[batchSize, QSliceHidden]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><a href="#local-6989586621679374497"><span class="hs-identifier hs-var">norm1</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679374507"><span class="hs-identifier hs-var">sum1</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="annot"><a href="#local-6989586621679374502"><span class="hs-identifier hs-type">out2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371376"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371377"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-593"></span><span>  </span><span id="local-6989586621679374502"><span class="annot"><span class="annottext">out2 :: QTensor dev '[batchSize, 1]
</span><a href="#local-6989586621679374502"><span class="hs-identifier hs-var hs-var">out2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
-&gt; QTensor dev '[batchSize, QSliceHidden]
-&gt; QTensor dev '[batchSize, 1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><a href="#local-6989586621679374498"><span class="hs-identifier hs-var">final2</span></a></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[batchSize, QSliceHidden]
</span><a href="#local-6989586621679374508"><span class="hs-identifier hs-var">out1norm</span></a></span><span>
</span><span id="line-594"></span><span>
</span><span id="line-595"></span><span id="local-6989586621679374509"><span class="annot"><a href="RL.Model.html#forwardPolicy"><span class="hs-identifier hs-type">forwardPolicy</span></a></span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374509"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374509"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374509"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-600"></span><span id="forwardPolicy"><span class="annot"><span class="annottext">forwardPolicy :: QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#forwardPolicy"><span class="hs-identifier hs-var hs-var">forwardPolicy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#forwardQModel"><span class="hs-identifier hs-var">forwardQModel</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><a href="RL.Model.html#forwardPolicyBatched"><span class="hs-identifier hs-type">forwardPolicyBatched</span></a></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679374527"><span class="annot"><a href="#local-6989586621679374527"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679374528"><span class="annot"><a href="#local-6989586621679374528"><span class="hs-identifier hs-type">batchSize</span></a></span></span><span>
</span><span id="line-604"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374527"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679374528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679374527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679374528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-608"></span><span id="forwardPolicyBatched"><span class="annot"><span class="annottext">forwardPolicyBatched :: QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardPolicyBatched"><span class="hs-identifier hs-var hs-var">forwardPolicyBatched</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(IsValidDevice dev, 1 &lt;= batchSize) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardQModelBatched"><span class="hs-identifier hs-var">forwardQModelBatched</span></a></span><span>
</span><span id="line-609"></span><span>
</span><span id="line-610"></span><span id="local-6989586621679371402"><span class="annot"><a href="RL.Model.html#forwardValue"><span class="hs-identifier hs-type">forwardValue</span></a></span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371402"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371402"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#StateEncoding"><span class="hs-identifier hs-type">StateEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371402"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371402"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-615"></span><span id="forwardValue"><span class="annot"><span class="annottext">forwardValue :: forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
QModel dev -&gt; StateEncoding dev -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#forwardValue"><span class="hs-identifier hs-var hs-var">forwardValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span id="local-6989586621679374595"><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679374595"><span class="hs-identifier hs-var">slc</span></a></span></span><span> </span><span id="local-6989586621679374596"><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679374596"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="annot"><span class="annottext">ActionEncoder dev
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679374597"><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679374597"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="annot"><span class="annottext">Conv2d QSliceHidden QSliceHidden FifthSize OctaveSize QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679374598"><span class="annot"><span class="annottext">Linear QSliceHidden QSliceHidden QDType dev
</span><a href="#local-6989586621679374598"><span class="hs-identifier hs-var">value1</span></a></span></span><span> </span><span id="local-6989586621679374599"><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><a href="#local-6989586621679374599"><span class="hs-identifier hs-var">norm</span></a></span></span><span> </span><span id="local-6989586621679374600"><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><a href="#local-6989586621679374600"><span class="hs-identifier hs-var">value2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679374601"><span class="annot"><span class="annottext">StateEncoding dev
</span><a href="#local-6989586621679374601"><span class="hs-identifier hs-var">stateEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1]
</span><a href="#local-6989586621679374602"><span class="hs-identifier hs-var">out2</span></a></span><span>
</span><span id="line-616"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621679374603"><span class="annot"><span class="annottext">outSlc :: Tensor
  dev
  (SumDType (SumDType QDType))
  (DropValue (DropValue '[QSliceHidden, 13, 5] 1) 1)
</span><a href="#local-6989586621679374603"><span class="hs-identifier hs-var hs-var">outSlc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev (SumDType QDType) (DropValue '[QSliceHidden, 13, 5] 1)
 -&gt; Tensor
      dev
      (SumDType (SumDType QDType))
      (DropValue (DropValue '[QSliceHidden, 13, 5] 1) 1))
-&gt; Tensor
     dev (SumDType QDType) (DropValue '[QSliceHidden, 13, 5] 1)
-&gt; Tensor
     dev
     (SumDType (SumDType QDType))
     (DropValue (DropValue '[QSliceHidden, 13, 5] 1) 1)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (d :: Nat) (shape :: [Nat]) (shape' :: [Nat])
       (dtype :: DType) (dtype' :: DType) (device :: (DeviceType, Nat)).
(KnownNat d, shape' ~ DropValue shape d,
 SumDTypeIsValid device dtype, dtype' ~ SumDType dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype' shape'
</span><span class="hs-identifier hs-var">TT.sumDim</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[QSliceHidden, 13, 5]
 -&gt; Tensor
      dev (SumDType QDType) (DropValue '[QSliceHidden, 13, 5] 1))
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
-&gt; Tensor
     dev (SumDType QDType) (DropValue '[QSliceHidden, 13, 5] 1)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
-&gt; (SliceEncoder dev, TransitionEncoder dev, StateEncoding dev)
-&gt; Tensor dev QDType '[QSliceHidden, 13, 5]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">StateEncoder dev
</span><a href="#local-6989586621679374597"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SliceEncoder dev
</span><a href="#local-6989586621679374595"><span class="hs-identifier hs-var">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TransitionEncoder dev
</span><a href="#local-6989586621679374596"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StateEncoding dev
</span><a href="#local-6989586621679374601"><span class="hs-identifier hs-var">stateEncoding</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span id="local-6989586621679374604"><span class="annot"><span class="annottext">out1 :: Tensor dev QDType '[QSliceHidden]
</span><a href="#local-6989586621679374604"><span class="hs-identifier hs-var hs-var">out1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden]
-&gt; Tensor dev QDType '[QSliceHidden]
forall (dev :: (DeviceType, Nat)) (shape :: [Nat]).
IsValidDevice dev =&gt;
QTensor dev shape -&gt; QTensor dev shape
</span><a href="RL.Model.html#activation"><span class="hs-identifier hs-var">activation</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[QSliceHidden]
 -&gt; Tensor dev QDType '[QSliceHidden])
-&gt; Tensor dev QDType '[QSliceHidden]
-&gt; Tensor dev QDType '[QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
-&gt; Tensor dev QDType '[QSliceHidden]
-&gt; Tensor dev QDType '[QSliceHidden]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">LayerNorm '[QSliceHidden] QDType dev
</span><a href="#local-6989586621679374599"><span class="hs-identifier hs-var">norm</span></a></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[QSliceHidden]
 -&gt; Tensor dev QDType '[QSliceHidden])
-&gt; Tensor dev QDType '[QSliceHidden]
-&gt; Tensor dev QDType '[QSliceHidden]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden QSliceHidden QDType dev
-&gt; Tensor
     dev
     (SumDType (SumDType QDType))
     (DropValue (DropValue '[QSliceHidden, 13, 5] 1) 1)
-&gt; Tensor dev QDType '[QSliceHidden]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden QSliceHidden QDType dev
</span><a href="#local-6989586621679374598"><span class="hs-identifier hs-var">value1</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor
  dev
  (SumDType (SumDType QDType))
  (DropValue (DropValue '[QSliceHidden, 13, 5] 1) 1)
</span><a href="#local-6989586621679374603"><span class="hs-identifier hs-var">outSlc</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span id="local-6989586621679374602"><span class="annot"><span class="annottext">out2 :: Tensor dev QDType '[1]
</span><a href="#local-6989586621679374602"><span class="hs-identifier hs-var hs-var">out2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.log</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1])
-&gt; Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
StandardFloatingPointDTypeValidation device dtype =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.sigmoid</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1])
-&gt; Tensor dev QDType '[1] -&gt; Tensor dev QDType '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
-&gt; Tensor dev QDType '[QSliceHidden] -&gt; Tensor dev QDType '[1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">Linear QSliceHidden 1 QDType dev
</span><a href="#local-6989586621679374600"><span class="hs-identifier hs-var">value2</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[QSliceHidden]
</span><a href="#local-6989586621679374604"><span class="hs-identifier hs-var">out1</span></a></span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="annot"><span class="hs-comment">{- | A loss for any model with 0 gradients everywhere.
Can be used to ensure that all parameters have a gradient,
if not all parameters are used in the real loss.
-}</span></span><span>
</span><span id="line-625"></span><span class="annot"><a href="RL.Model.html#fakeLoss"><span class="hs-identifier hs-type">fakeLoss</span></a></span><span>
</span><span id="line-626"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371404"><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371405"><span class="annot"><a href="#local-6989586621679371405"><span class="hs-identifier hs-type">ps</span></a></span></span><span>
</span><span id="line-627"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679371405"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.Parameters</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span id="fakeLoss"><span class="annot"><span class="annottext">fakeLoss :: forall (dev :: (DeviceType, Nat)) (ps :: [Type]).
(IsValidDevice dev, ps ~ Parameters (QModel dev)) =&gt;
QModel dev -&gt; QTensor dev '[]
</span><a href="RL.Model.html#fakeLoss"><span class="hs-identifier hs-var hs-var">fakeLoss</span></a></span></span><span> </span><span id="local-6989586621679375325"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679375325"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[]
</span><a href="#local-6989586621679375326"><span class="hs-identifier hs-var">tzero</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[]
-&gt; Tensor dev QDType '[] -&gt; Tensor dev QDType '[]
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[]
</span><a href="#local-6989586621679375328"><span class="hs-identifier hs-var">total</span></a></span><span>
</span><span id="line-631"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><a href="#local-6989586621679375326"><span class="hs-identifier hs-type">tzero</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371404"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-633"></span><span>  </span><span id="local-6989586621679375326"><span class="annot"><span class="annottext">tzero :: Tensor dev QDType '[]
</span><a href="#local-6989586621679375326"><span class="hs-identifier hs-var hs-var">tzero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[]
forall (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
TensorOptions shape dtype device =&gt;
Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.zeros</span></span><span>
</span><span id="line-634"></span><span>  </span><span id="local-6989586621679375330"><span class="annot"><span class="annottext">params :: HList (Parameters (QModel dev))
</span><a href="#local-6989586621679375330"><span class="hs-identifier hs-var hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; HList (Parameters (QModel dev))
forall f. Parameterized f =&gt; f -&gt; HList (Parameters f)
</span><span class="hs-identifier hs-var">TT.flattenParameters</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679375325"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-635"></span><span>  </span><span id="local-6989586621679371445"><span class="annot"><a href="#local-6989586621679375331"><span class="hs-identifier hs-type">deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.HMap'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.ToDependent</span></span><span> </span><span class="annot"><a href="#local-6989586621679371405"><span class="hs-identifier hs-type">ps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371445"><span class="hs-identifier hs-type">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.HList</span></span><span> </span><span class="annot"><a href="#local-6989586621679371445"><span class="hs-identifier hs-type">ys</span></a></span></span><span>
</span><span id="line-636"></span><span>  </span><span id="local-6989586621679375331"><span class="annot"><span class="annottext">deps :: forall (ys :: [Type]). HMap' ToDependent ps ys =&gt; HList ys
</span><a href="#local-6989586621679375331"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ToDependent
-&gt; HList
     '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
       Parameter dev QDType '[5], Parameter dev QDType '[5],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
       Parameter dev QDType '[QSliceHidden, QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
-&gt; HList ys
forall k f (xs :: [k]) (ys :: [k]).
HMap' f xs ys =&gt;
f -&gt; HList xs -&gt; HList ys
</span><span class="hs-identifier hs-var">TT.hmap'</span></span><span> </span><span class="annot"><span class="annottext">ToDependent
</span><span class="hs-identifier hs-var">TT.ToDependent</span></span><span> </span><span class="annot"><span class="annottext">HList
  '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden, 2, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, 2, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, 1, 1, 1],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, 1, 1, 1],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
    Parameter dev QDType '[5], Parameter dev QDType '[5],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
    Parameter dev QDType '[QSliceHidden, QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[QSliceHidden],
    Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
HList (Parameters (QModel dev))
</span><a href="#local-6989586621679375330"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-637"></span><span>  </span><span id="local-6989586621679375337"><span class="annot"><span class="annottext">sums :: HList
  '[Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[]]
</span><a href="#local-6989586621679375337"><span class="hs-identifier hs-var hs-var">sums</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SumAll
-&gt; HList
     '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
       Tensor dev QDType '[5], Tensor dev QDType '[5],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
       Tensor dev QDType '[QSliceHidden, QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
-&gt; HList
     '[Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[]]
forall k f (xs :: [k]) (ys :: [k]).
HMap' f xs ys =&gt;
f -&gt; HList xs -&gt; HList ys
</span><span class="hs-identifier hs-var">TT.hmap'</span></span><span> </span><span class="annot"><span class="annottext">SumAll
</span><a href="RL.TorchHelpers.html#SumAll"><span class="hs-identifier hs-var">TH.SumAll</span></a></span><span> </span><span class="annot"><span class="annottext">HList
  '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
    Tensor dev QDType '[5], Tensor dev QDType '[5],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
    Tensor dev QDType '[QSliceHidden, QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
forall (ys :: [Type]). HMap' ToDependent ps ys =&gt; HList ys
</span><a href="#local-6989586621679375331"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-comment">-- total</span><span>
</span><span id="line-639"></span><span>  </span><span id="local-6989586621679375328"><span class="annot"><span class="annottext">total :: Tensor dev QDType '[]
</span><a href="#local-6989586621679375328"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Add
-&gt; Tensor dev QDType '[]
-&gt; HList
     '[Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[],
       Tensor dev QDType '[], Tensor dev QDType '[]]
-&gt; Tensor dev QDType '[]
forall {k} f acc (xs :: [k]) res.
HFoldr f acc xs res =&gt;
f -&gt; acc -&gt; HList xs -&gt; res
</span><span class="hs-identifier hs-var">TT.hfoldr</span></span><span> </span><span class="annot"><span class="annottext">Add
</span><a href="RL.TorchHelpers.html#Add"><span class="hs-identifier hs-var">TH.Add</span></a></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[]
</span><a href="#local-6989586621679375326"><span class="hs-identifier hs-var">tzero</span></a></span><span> </span><span class="annot"><span class="annottext">HList
  '[Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[],
    Tensor dev QDType '[], Tensor dev QDType '[]]
</span><a href="#local-6989586621679375337"><span class="hs-identifier hs-var">sums</span></a></span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="annot"><a href="RL.Model.html#mkQModel"><span class="hs-identifier hs-type">mkQModel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371456"><span class="annot"><a href="#local-6989586621679371456"><span class="hs-identifier hs-type">dev</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371456"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371456"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span id="mkQModel"><span class="annot"><span class="annottext">mkQModel :: forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
IO (QModel dev)
</span><a href="RL.Model.html#mkQModel"><span class="hs-identifier hs-var hs-var">mkQModel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QSpec dev -&gt; IO (QModel dev)
forall spec f. Randomizable spec f =&gt; spec -&gt; IO f
</span><span class="hs-identifier hs-var">T.sample</span></span><span> </span><span class="annot"><span class="annottext">(QSpec dev -&gt; IO (QModel dev)) -&gt; QSpec dev -&gt; IO (QModel dev)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall {k} (dev :: k). QSpec dev
forall (dev :: (DeviceType, Nat)). QSpec dev
</span><a href="RL.Model.html#QSpec"><span class="hs-identifier hs-var">QSpec</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371456"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span class="annot"><a href="RL.Model.html#loadModel"><span class="hs-identifier hs-type">loadModel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371460"><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span id="loadModel"><span class="annot"><span class="annottext">loadModel :: forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
String -&gt; IO (QModel dev)
</span><a href="RL.Model.html#loadModel"><span class="hs-identifier hs-var hs-var">loadModel</span></a></span></span><span> </span><span id="local-6989586621679376148"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679376148"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-646"></span><span>  </span><span id="local-6989586621679376149"><span class="annot"><a href="#local-6989586621679376149"><span class="hs-identifier hs-var">modelPlaceholder</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)).
IsValidDevice dev =&gt;
IO (QModel dev)
</span><a href="RL.Model.html#mkQModel"><span class="hs-identifier hs-var">mkQModel</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span id="local-6989586621679376152"><span class="annot"><a href="#local-6989586621679376152"><span class="hs-identifier hs-var">tensors</span></a></span></span><span>
</span><span id="line-648"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TT.HMap'</span></span><span> </span><span class="annot"><span class="hs-identifier">TT.ToDependent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TT.Parameters</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">QModel</span></span><span> </span><span class="annot"><span class="hs-identifier">dev</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier">ts</span></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier">TT.HList</span></span><span> </span><span class="annot"><span class="hs-identifier">ts</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-650"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TT.load</span></span><span> </span><span class="annot"><a href="#local-6989586621679376148"><span class="hs-identifier hs-type">path</span></a></span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-comment">-- TT.load doesn't move the parameters to the correct device, so we move them manually</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679376154"><span class="annot"><a href="#local-6989586621679376154"><span class="hs-identifier hs-var hs-var">tensorsCPU</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (device' :: (DeviceType, Nat)) (device :: (DeviceType, Nat))
       f g.
HasToDevice device' device f g =&gt;
f -&gt; g
</span><span class="hs-identifier hs-var">TT.toDevice</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.CPU</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="annot"><span class="annottext">HList
  '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
    Tensor dev QDType '[5], Tensor dev QDType '[5],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
    Tensor dev QDType '[QSliceHidden, QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
HMap'
  ToDependent
  (Parameters (QModel dev))
  '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
    Tensor dev QDType '[5], Tensor dev QDType '[5],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
    Tensor dev QDType '[QSliceHidden, QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]] =&gt;
HList
  '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
    Tensor dev QDType '[5], Tensor dev QDType '[5],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
    Tensor dev QDType '[QSliceHidden, QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
</span><a href="#local-6989586621679376152"><span class="hs-identifier hs-var">tensors</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679376156"><span class="annot"><a href="#local-6989586621679376156"><span class="hs-identifier hs-var hs-var">tensorsDevice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (device' :: (DeviceType, Nat)) (device :: (DeviceType, Nat))
       f g.
HasToDevice device' device f g =&gt;
f -&gt; g
</span><span class="hs-identifier hs-var">TT.toDevice</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371460"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TT.CPU</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HList
  '[Tensor '( 'CPU, 0) QDType '[QSliceHidden, 1, 1, 1],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 2, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 2, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 1, 1, 1],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, 1, 1, 1],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[5], Tensor '( 'CPU, 0) QDType '[5],
    Tensor '( 'CPU, 0) QDType '[5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[1, QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[1],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden, QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[1, QSliceHidden],
    Tensor '( 'CPU, 0) QDType '[1]]
</span><a href="#local-6989586621679376154"><span class="hs-identifier hs-var">tensorsCPU</span></a></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621679376157"><span class="annot"><a href="#local-6989586621679376157"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.hmapM'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.MakeIndependent</span></span><span> </span><span class="annot"><a href="#local-6989586621679376156"><span class="hs-identifier hs-type">tensorsDevice</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TT.replaceParameters</span></span><span> </span><span class="annot"><a href="#local-6989586621679376149"><span class="hs-identifier hs-type">modelPlaceholder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679376157"><span class="hs-identifier hs-type">params</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span id="local-6989586621679371501"><span class="annot"><a href="RL.Model.html#saveModel"><span class="hs-identifier hs-type">saveModel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371501"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-658"></span><span id="saveModel"><span class="annot"><span class="annottext">saveModel :: forall (dev :: (DeviceType, Nat)). String -&gt; QModel dev -&gt; IO ()
</span><a href="RL.Model.html#saveModel"><span class="hs-identifier hs-var hs-var">saveModel</span></a></span></span><span> </span><span id="local-6989586621679376645"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679376645"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679376646"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376646"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HList
  '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 2, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, 1, 1, 1],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
    Tensor dev QDType '[5], Tensor dev QDType '[5],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
    Tensor dev QDType '[QSliceHidden, QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[QSliceHidden],
    Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
-&gt; String -&gt; IO ()
forall (tensors :: [Type]).
Castable (HList tensors) [ForeignPtr Tensor] =&gt;
HList tensors -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">TT.save</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ToDependent
-&gt; HList
     '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
       Parameter dev QDType '[5], Parameter dev QDType '[5],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
       Parameter dev QDType '[QSliceHidden, QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
-&gt; HList
     '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
       Tensor dev QDType '[5], Tensor dev QDType '[5],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
       Tensor dev QDType '[QSliceHidden, QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
forall k f (xs :: [k]) (ys :: [k]).
HMap' f xs ys =&gt;
f -&gt; HList xs -&gt; HList ys
</span><span class="hs-identifier hs-var">TT.hmap'</span></span><span> </span><span class="annot"><span class="annottext">ToDependent
</span><span class="hs-identifier hs-var">TT.ToDependent</span></span><span> </span><span class="annot"><span class="annottext">(HList
   '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden, 2, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 2, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
     Parameter dev QDType '[5], Parameter dev QDType '[5],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
     Parameter dev QDType '[QSliceHidden, QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
 -&gt; HList
      '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden, 2, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, 2, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, 1, 1, 1],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, 1, 1, 1],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
        Tensor dev QDType '[5], Tensor dev QDType '[5],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
        Tensor dev QDType '[QSliceHidden, QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[QSliceHidden],
        Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]])
-&gt; HList
     '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
       Parameter dev QDType '[5], Parameter dev QDType '[5],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
       Parameter dev QDType '[QSliceHidden, QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
-&gt; HList
     '[Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 2, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, 1, 1, 1],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden], Tensor dev QDType '[5],
       Tensor dev QDType '[5], Tensor dev QDType '[5],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1],
       Tensor dev QDType '[QSliceHidden, QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[QSliceHidden],
       Tensor dev QDType '[1, QSliceHidden], Tensor dev QDType '[1]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; HList (Parameters (QModel dev))
forall f. Parameterized f =&gt; f -&gt; HList (Parameters f)
</span><span class="hs-identifier hs-var">TT.flattenParameters</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376646"><span class="hs-identifier hs-var">model</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679376645"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span id="local-6989586621679371504"><span class="annot"><a href="RL.Model.html#modelSize"><span class="hs-identifier hs-type">modelSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371504"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-661"></span><span id="modelSize"><span class="annot"><span class="annottext">modelSize :: forall (dev :: (DeviceType, Nat)). QModel dev -&gt; Int
</span><a href="RL.Model.html#modelSize"><span class="hs-identifier hs-var hs-var">modelSize</span></a></span></span><span> </span><span id="local-6989586621679376913"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376913"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: Type -&gt; Type) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: Type -&gt; Type) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">product</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [[Int]] -&gt; [Int]
forall (f :: Type -&gt; Type) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[[Int]]
</span><a href="#local-6989586621679376916"><span class="hs-identifier hs-var">sizes</span></a></span><span>
</span><span id="line-662"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-663"></span><span>  </span><span id="local-6989586621679376916"><span class="annot"><span class="annottext">sizes :: [[Int]]
</span><a href="#local-6989586621679376916"><span class="hs-identifier hs-var hs-var">sizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ToList
-&gt; [[Int]]
-&gt; HList
     '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int]]
-&gt; [[Int]]
forall {k} f acc (xs :: [k]) res.
HFoldr f acc xs res =&gt;
f -&gt; acc -&gt; HList xs -&gt; res
</span><span class="hs-identifier hs-var">TT.hfoldr</span></span><span> </span><span class="annot"><span class="annottext">ToList
</span><a href="RL.TorchHelpers.html#ToList"><span class="hs-identifier hs-var">TH.ToList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HList
   '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
     [Int], [Int], [Int], [Int]]
 -&gt; [[Int]])
-&gt; HList
     '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int]]
-&gt; [[Int]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShapeVal
-&gt; HList
     '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
       Parameter dev QDType '[5], Parameter dev QDType '[5],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
       Parameter dev QDType '[QSliceHidden, QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
-&gt; HList
     '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int]]
forall k f (xs :: [k]) (ys :: [k]).
HMap' f xs ys =&gt;
f -&gt; HList xs -&gt; HList ys
</span><span class="hs-identifier hs-var">TT.hmap'</span></span><span> </span><span class="annot"><span class="annottext">ShapeVal
</span><a href="RL.TorchHelpers.html#ShapeVal"><span class="hs-identifier hs-var">TH.ShapeVal</span></a></span><span> </span><span class="annot"><span class="annottext">(HList
   '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden, 2, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 2, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, 1, 1, 1],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
     Parameter dev QDType '[5], Parameter dev QDType '[5],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
     Parameter dev QDType '[QSliceHidden, QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[QSliceHidden],
     Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
 -&gt; HList
      '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
        [Int], [Int], [Int], [Int]])
-&gt; HList
     '[Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 2, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, 1, 1, 1],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden], Parameter dev QDType '[5],
       Parameter dev QDType '[5], Parameter dev QDType '[5],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden, QSliceHidden, 13, 5],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1],
       Parameter dev QDType '[QSliceHidden, QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[QSliceHidden],
       Parameter dev QDType '[1, QSliceHidden], Parameter dev QDType '[1]]
-&gt; HList
     '[[Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int], [Int],
       [Int], [Int], [Int], [Int]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; HList (Parameters (QModel dev))
forall f. Parameterized f =&gt; f -&gt; HList (Parameters f)
</span><span class="hs-identifier hs-var">TT.flattenParameters</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376913"><span class="hs-identifier hs-var">model</span></a></span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span id="local-6989586621679371514"><span id="local-6989586621679371515"><span id="local-6989586621679371516"><span class="annot"><a href="RL.Model.html#runQ"><span class="hs-identifier hs-type">runQ</span></a></span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371514"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371515"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371516"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371514"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371514"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371515"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371516"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QType"><span class="hs-identifier hs-type">QType</span></a></span></span></span></span><span>
</span><span id="line-672"></span><span id="runQ"><span class="annot"><span class="annottext">runQ :: forall (dev :: (DeviceType, Nat)) s a.
IsValidDevice dev =&gt;
(s -&gt; a -&gt; QEncoding dev '[]) -&gt; QModel dev -&gt; s -&gt; a -&gt; QType
</span><a href="RL.Model.html#runQ"><span class="hs-identifier hs-var hs-var">runQ</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679376928"><span class="annot"><span class="annottext">s -&gt; a -&gt; QEncoding dev '[]
</span><a href="#local-6989586621679376928"><span class="hs-identifier hs-var">encode</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679376929"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376929"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679376930"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679376930"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679376931"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679376931"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor -&gt; QType
forall a. TensorLike a =&gt; Tensor -&gt; a
</span><span class="hs-identifier hs-var">T.asValue</span></span><span> </span><span class="annot"><span class="annottext">(Tensor -&gt; QType) -&gt; Tensor -&gt; QType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QTensor dev '[1] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">(QTensor dev '[1] -&gt; Tensor) -&gt; QTensor dev '[1] -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376929"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">(QEncoding dev '[] -&gt; QTensor dev '[1])
-&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; a -&gt; QEncoding dev '[]
</span><a href="#local-6989586621679376928"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679376930"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679376931"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span id="local-6989586621679371521"><span id="local-6989586621679371522"><span id="local-6989586621679371523"><span class="annot"><a href="RL.Model.html#runQ%27"><span class="hs-identifier hs-type">runQ'</span></a></span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371521"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679371522"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371521"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371521"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371522"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679371523"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-680"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371521"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-681"></span><span id="runQ%27"><span class="annot"><span class="annottext">runQ' :: forall (dev :: (DeviceType, Nat)) s a.
IsValidDevice dev =&gt;
(s -&gt; a -&gt; QEncoding dev '[])
-&gt; QModel dev -&gt; s -&gt; a -&gt; QTensor dev '[1]
</span><a href="RL.Model.html#runQ%27"><span class="hs-identifier hs-var hs-var">runQ'</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679376938"><span class="annot"><span class="annottext">s -&gt; a -&gt; QEncoding dev '[]
</span><a href="#local-6989586621679376938"><span class="hs-identifier hs-var">encode</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679376939"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376939"><span class="hs-identifier hs-var">model</span></a></span></span><span> </span><span id="local-6989586621679376940"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679376940"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679376941"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679376941"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QModel dev -&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall f a b. HasForward f a b =&gt; f -&gt; a -&gt; b
</span><span class="hs-identifier hs-var">T.forward</span></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376939"><span class="hs-identifier hs-var">model</span></a></span><span> </span><span class="annot"><span class="annottext">(QEncoding dev '[] -&gt; QTensor dev '[1])
-&gt; QEncoding dev '[] -&gt; QTensor dev '[1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; a -&gt; QEncoding dev '[]
</span><a href="#local-6989586621679376938"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679376940"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679376941"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="annot"><a href="RL.Model.html#runBatchedPolicy"><span class="hs-identifier hs-type">runBatchedPolicy</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679371527"><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span></span><span> </span><span id="local-6989586621679371528"><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span></span><span>
</span><span id="line-685"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="RL.ModelTypes.html#IsValidDevice"><span class="hs-identifier hs-type">IsValidDevice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="RL.Model.html#QModel"><span class="hs-identifier hs-type">QModel</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="RL.Encoding.html#QEncoding"><span class="hs-identifier hs-type">QEncoding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Tensor</span></span><span>
</span><span id="line-689"></span><span id="runBatchedPolicy"><span class="annot"><span class="annottext">runBatchedPolicy :: forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(IsValidDevice dev, KnownNat batchSize) =&gt;
QModel dev -&gt; QEncoding dev '[batchSize] -&gt; Tensor
</span><a href="RL.Model.html#runBatchedPolicy"><span class="hs-identifier hs-var hs-var">runBatchedPolicy</span></a></span></span><span> </span><span id="local-6989586621679376960"><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376960"><span class="hs-identifier hs-var">actor</span></a></span></span><span> </span><span id="local-6989586621679376961"><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679376961"><span class="hs-identifier hs-var">encoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, 1] -&gt; Tensor
forall t. Unnamed t =&gt; t -&gt; Tensor
</span><span class="hs-identifier hs-var">TT.toDynamic</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, 1] -&gt; Tensor)
-&gt; Tensor dev QDType '[batchSize, 1] -&gt; Tensor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (dim :: Nat) (shape :: [Nat]) (dtype :: DType)
       (device :: (DeviceType, Nat)).
(KnownNat dim, DimOutOfBoundCheck shape dim, KnownDType dtype,
 StandardFloatingPointDTypeValidation device dtype) =&gt;
Tensor device dtype shape -&gt; Tensor device dtype shape
</span><span class="hs-identifier hs-var">TT.softmax</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tensor dev QDType '[batchSize, 1]
 -&gt; Tensor dev QDType '[batchSize, 1])
-&gt; Tensor dev QDType '[batchSize, 1]
-&gt; Tensor dev QDType '[batchSize, 1]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tensor dev QDType '[batchSize, 1]
</span><a href="#local-6989586621679376963"><span class="hs-identifier hs-var">policy</span></a></span><span>
</span><span id="line-690"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="#local-6989586621679376963"><span class="hs-identifier hs-type">policy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="RL.ModelTypes.html#QTensor"><span class="hs-identifier hs-type">QTensor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-692"></span><span>  </span><span id="local-6989586621679376963"><span class="annot"><span class="annottext">policy :: Tensor dev QDType '[batchSize, 1]
</span><a href="#local-6989586621679376963"><span class="hs-identifier hs-var hs-var">policy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proxy 1 -&gt; Proxy batchSize -&gt; OrderingI 1 batchSize
forall (a :: Nat) (b :: Nat) (proxy1 :: Nat -&gt; Type)
       (proxy2 :: Nat -&gt; Type).
(KnownNat a, KnownNat b) =&gt;
proxy1 a -&gt; proxy2 b -&gt; OrderingI a b
</span><span class="hs-identifier hs-var">cmpNat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: Nat). Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: Nat). Proxy t
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><span class="annottext">OrderingI 1 batchSize
</span><span class="hs-identifier hs-var">EQI</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(OrdCond (CmpNat 1 batchSize) 'True 'True 'False ~ 'True,
 GeluDTypeIsValid dev QDType, RandDTypeIsValid dev QDType,
 BasicArithmeticDTypeIsValid dev QDType, SumDTypeIsValid dev QDType,
 MeanDTypeValidation dev QDType,
 StandardFloatingPointDTypeValidation dev QDType,
 KnownDevice dev) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardPolicyBatched"><span class="hs-identifier hs-var">forwardPolicyBatched</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376960"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679376961"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-694"></span><span>    </span><span class="annot"><span class="annottext">OrderingI 1 batchSize
</span><span class="hs-identifier hs-var">LTI</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (dev :: (DeviceType, Nat)) (batchSize :: Nat).
(OrdCond (CmpNat 1 batchSize) 'True 'True 'False ~ 'True,
 GeluDTypeIsValid dev QDType, RandDTypeIsValid dev QDType,
 BasicArithmeticDTypeIsValid dev QDType, SumDTypeIsValid dev QDType,
 MeanDTypeValidation dev QDType,
 StandardFloatingPointDTypeValidation dev QDType,
 KnownDevice dev) =&gt;
QModel dev
-&gt; QEncoding dev '[batchSize] -&gt; QTensor dev '[batchSize, 1]
</span><a href="RL.Model.html#forwardPolicyBatched"><span class="hs-identifier hs-var">forwardPolicyBatched</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371527"><span class="hs-identifier hs-type">dev</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679371528"><span class="hs-identifier hs-type">batchSize</span></a></span><span> </span><span class="annot"><span class="annottext">QModel dev
</span><a href="#local-6989586621679376960"><span class="hs-identifier hs-var">actor</span></a></span><span> </span><span class="annot"><span class="annottext">QEncoding dev '[batchSize]
</span><a href="#local-6989586621679376961"><span class="hs-identifier hs-var">encoding</span></a></span><span>
</span><span id="line-695"></span><span>    </span><span class="annot"><span class="annottext">OrderingI 1 batchSize
</span><span class="hs-identifier hs-var">GTI</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Tensor dev QDType '[batchSize, 1]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;batched policy: no actions&quot;</span></span><span>
</span><span id="line-696"></span></pre></body></html>