<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{-|
Copyright  :  (C) 2015-2016, University of Twente,
                  2017     , QBayLogic B.V.
License    :  BSD2 (see the file LICENSE)
Maintainer :  Christiaan Baaij &lt;christiaan.baaij@gmail.com&gt;

A type checker plugin for GHC that can solve /equalities/ of types of kind
'GHC.TypeLits.Nat', where these types are either:

* Type-level naturals
* Type variables
* Applications of the arithmetic expressions @(+,-,*,^)@.

It solves these equalities by normalising them to /sort-of/
'GHC.TypeLits.Normalise.SOP.SOP' (Sum-of-Products) form, and then perform a
simple syntactic equality.

For example, this solver can prove the equality between:

@
(x + 2)^(y + 2)
@

and

@
4*x*(2 + x)^y + 4*(2 + x)^y + (2 + x)^y*x^2
@

Because the latter is actually the 'GHC.TypeLits.Normalise.SOP.SOP' normal form
of the former.

To use the plugin, add

@
{\-\# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise \#-\}
@

To the header of your file.

== Treating subtraction as addition with a negated number

If you are absolutely sure that your subtractions can /never/ lead to (a locally)
negative number, you can ask the plugin to treat subtraction as addition with
a negated operand by additionally adding:

@
{\-\# OPTIONS_GHC -fplugin-opt GHC.TypeLits.Normalise:allow-negated-numbers \#-\}
@

to the header of your file, thereby allowing to use associativity and
commutativity rules when proving constraints involving subtractions. Note that
this option can lead to unsound behaviour and should be handled with extreme
care.

=== When it leads to unsound behaviour

For example, enabling the /allow-negated-numbers/ feature would allow
you to prove:

@
(n - 1) + 1 ~ n
@

/without/ a @(1 &lt;= n)@ constraint, even though when /n/ is set to /0/ the
subtraction @n-1@ would be locally negative and hence not be a natural number.

This would allow the following erroneous definition:

@
data Fin (n :: Nat) where
  FZ :: Fin (n + 1)
  FS :: Fin n -&gt; Fin (n + 1)

f :: forall n . Natural -&gt; Fin n
f n = case of
  0 -&gt; FZ
  x -&gt; FS (f \@(n-1) (x - 1))

fs :: [Fin 0]
fs = f \&lt;$\&gt; [0..]
@

=== When it might be Okay

This example is taken from the &lt;http://hackage.haskell.org/package/mezzo mezzo&gt;
library.

When you have:

@
-- | Singleton type for the number of repetitions of an element.
data Times (n :: Nat) where
    T :: Times n

-- | An element of a &quot;run-length encoded&quot; vector, containing the value and
-- the number of repetitions
data Elem :: Type -&gt; Nat -&gt; Type where
    (:*) :: t -&gt; Times n -&gt; Elem t n

-- | A length-indexed vector, optimised for repetitions.
data OptVector :: Type -&gt; Nat -&gt; Type where
    End  :: OptVector t 0
    (:-) :: Elem t l -&gt; OptVector t (n - l) -&gt; OptVector t n
@

And you want to define:

@
-- | Append two optimised vectors.
type family (x :: OptVector t n) ++ (y :: OptVector t m) :: OptVector t (n + m) where
    ys        ++ End = ys
    End       ++ ys = ys
    (x :- xs) ++ ys = x :- (xs ++ ys)
@

then the last line will give rise to the constraint:

@
(n-l)+m ~ (n+m)-l
@

because:

@
x  :: Elem t l
xs :: OptVector t (n-l)
ys :: OptVector t m
@

In this case it's okay to add

@
{\-\# OPTIONS_GHC -fplugin-opt GHC.TypeLits.Normalise:allow-negated-numbers \#-\}
@

if you can convince yourself you will never be able to construct a:

@
xs :: OptVector t (n-l)
@

where /n-l/ is a negative number.
-}</span></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# LANGUAGE CPP             #-}</span><span>
</span><span id="line-147"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase      #-}</span><span>
</span><span id="line-148"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns  #-}</span><span>
</span><span id="line-149"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-150"></span><span class="hs-pragma">{-# LANGUAGE TupleSections   #-}</span><span>
</span><span id="line-151"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns    #-}</span><span>
</span><span id="line-152"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskellQuotes #-}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK show-extensions #-}</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html"><span class="hs-identifier">GHC.TypeLits.Normalise</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier">plugin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">where</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- external</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;=&lt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer.Strict</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rights</span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stripPrefix</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">notMember</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">union</span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Type.Ord</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeError</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TcPluginM.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tracePlugin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newGiven</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newWanted</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- GHC API</span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Builtin.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">knownNatClassName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eqTyConKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">heqTyConKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hasKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Builtin.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">promotedFalseDataCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">promotedTrueDataCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Builtin.Types.Literals</span></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeNatAddTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeNatExpTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeNatMulTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeNatSubTyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Builtin.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">naturalTy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cTupleDataCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cTupleTyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Builtin.Types.Literals</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeNatCmpTyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Expr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">className</span></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Coercion</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Role</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkUnivCo</span></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.DataCon</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">dataConWrapId</span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Predicate</span></span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EqRel</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NomEq</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pred</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EqPred</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">IrredPred</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">classifyPredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkClassPred</span></span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>   </span><span class="annot"><span class="hs-identifier">mkPrimEqPred</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isEqPred</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isEqPrimPred</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getClassPredTys_maybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UnivCoProvenance</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCon</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TyCon</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_ghc(9,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.Type</span></span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Kind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkTyVarTy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tyConAppTyCon_maybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeKind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkTyConApp</span></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Core.TyCo.Compare</span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">eqType</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Core.Type</span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">Kind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PredType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eqType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkTyVarTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConAppTyCon_maybe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">typeKind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkTyConApp</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Data.IOEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Driver.Plugins</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Plugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultPlugin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">purePlugin</span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Plugins</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">thNameToGhcNameIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HscEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hsc_NC</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Plugin</span></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcLookupClass</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcPluginTrace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcPluginIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newEvVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Plugin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tcLookupTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeTcPluginTcM</span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TcPlugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginSolveResult</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">env_top</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ct</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtEvidence</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcEvDest</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvidence</span></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>   </span><span class="annot"><span class="hs-identifier">ctLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctLocSpan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isGiven</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isWanted</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkNonCanonical</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setCtLocSpan</span></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>   </span><span class="annot"><span class="hs-identifier">isWantedCt</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvPred</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvExpr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">emptyRewriterSet</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setCtEvLoc</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EvBindsVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">EvTerm</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evCast</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evId</span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Types.Unique.FM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">emptyUFM</span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Utils.Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">($$)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">text</span></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- template-haskell</span><span>
</span><span id="line-217"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- internal</span><span>
</span><span id="line-220"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html"><span class="hs-identifier">GHC.TypeLits.Normalise.SOP</span></a></span><span>
</span><span id="line-221"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html"><span class="hs-identifier">GHC.TypeLits.Normalise.Unify</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#subtractionToPred"><span class="hs-identifier">subtractionToPred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-type">isEqPredClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-224"></span><span id="isEqPredClass"><span class="annot"><span class="annottext">isEqPredClass :: Type -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-var hs-var">isEqPredClass</span></a></span></span><span> </span><span id="local-6989586621679238769"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238769"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyCon
</span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238769"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-225"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679238770"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238770"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238770"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><span class="hs-operator hs-var">`hasKey`</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><span class="hs-identifier hs-var">eqTyConKey</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238770"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><span class="hs-operator hs-var">`hasKey`</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><span class="hs-identifier hs-var">heqTyConKey</span></span><span>
</span><span id="line-226"></span><span>  </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | To use the plugin, add</span><span>
</span><span id="line-229"></span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- {\-\# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise \#-\}</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-233"></span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- To the header of your file.</span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier hs-type">plugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plugin</span></span><span>
</span><span id="line-236"></span><span id="plugin"><span class="annot"><span class="annottext">plugin :: Plugin
</span><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier hs-var hs-var">plugin</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
</span><span class="hs-identifier hs-var">defaultPlugin</span></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">tcPlugin</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-type">normalisePlugin</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">id</span></span><span> </span><span class="annot"><a href="#local-6989586621679238777"><span class="hs-identifier hs-type">defaultOpts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="#local-6989586621679238779"><span class="hs-identifier hs-type">parseArgument</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">pluginRecompile</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">purePlugin</span></span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621679238779"><span class="annot"><span class="annottext">parseArgument :: CommandLineOption -&gt; Maybe (Opts -&gt; Opts)
</span><a href="#local-6989586621679238779"><span class="hs-identifier hs-var hs-var">parseArgument</span></a></span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;allow-negated-numbers&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; Opts) -&gt; Maybe (Opts -&gt; Opts)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679238786"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238786"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238786"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="#local-6989586621679238779"><span class="hs-identifier hs-var">parseArgument</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; Maybe Word
forall a. Read a =&gt; CommandLineOption -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">(CommandLineOption -&gt; Maybe Word)
-&gt; (CommandLineOption -&gt; Maybe CommandLineOption)
-&gt; CommandLineOption
-&gt; Maybe Word
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; Maybe CommandLineOption
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;depth=&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679238788"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679238788"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; Opts) -&gt; Maybe (Opts -&gt; Opts)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679238789"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238789"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238789"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="#local-6989586621679238788"><span class="hs-identifier hs-type hs-var">depth</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="#local-6989586621679238779"><span class="hs-identifier hs-var">parseArgument</span></a></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Opts -&gt; Opts)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-245"></span><span>  </span><span id="local-6989586621679238777"><span class="annot"><span class="annottext">defaultOpts :: Opts
</span><a href="#local-6989586621679238777"><span class="hs-identifier hs-var hs-var">defaultOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">negNumbers :: Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">depth :: Word
</span><a href="GHC.TypeLits.Normalise.html#depth"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-keyword">data</span><span> </span><span id="Opts"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-var">Opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Opts"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-var">Opts</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="negNumbers"><span class="annot"><span class="annottext">Opts -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var hs-var">negNumbers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span id="depth"><span class="annot"><span class="annottext">Opts -&gt; Word
</span><a href="GHC.TypeLits.Normalise.html#depth"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-type">normalisePlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPlugin</span></span><span>
</span><span id="line-250"></span><span id="normalisePlugin"><span class="annot"><span class="annottext">normalisePlugin :: Opts -&gt; TcPlugin
</span><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-var hs-var">normalisePlugin</span></a></span></span><span> </span><span id="local-6989586621679238792"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238792"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; TcPlugin -&gt; TcPlugin
</span><span class="hs-identifier hs-var">tracePlugin</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TcPlugin</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcPluginInit :: TcPluginM ExtraDefs
</span><span class="hs-identifier hs-var">tcPluginInit</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginM ExtraDefs
</span><a href="GHC.TypeLits.Normalise.html#lookupExtraDefs"><span class="hs-identifier hs-var">lookupExtraDefs</span></a></span><span>
</span><span id="line-252"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginSolve :: ExtraDefs -&gt; TcPluginSolver
</span><span class="hs-identifier hs-var">tcPluginSolve</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Opts -&gt; ExtraDefs -&gt; TcPluginSolver
</span><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var">decideEqualSOP</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238792"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-253"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginRewrite :: ExtraDefs -&gt; UniqFM TyCon TcPluginRewriter
</span><span class="hs-identifier hs-var">tcPluginRewrite</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqFM TyCon TcPluginRewriter
-&gt; ExtraDefs -&gt; UniqFM TyCon TcPluginRewriter
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">UniqFM TyCon TcPluginRewriter
forall {k} (key :: k) elt. UniqFM key elt
</span><span class="hs-identifier hs-var">emptyUFM</span></span><span>
</span><span id="line-254"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginStop :: ExtraDefs -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginStop</span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginM () -&gt; ExtraDefs -&gt; TcPluginM ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcPluginM ()
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-keyword">type</span><span> </span><span id="ExtraDefs"><span class="annot"><a href="GHC.TypeLits.Normalise.html#ExtraDefs"><span class="hs-identifier hs-var">ExtraDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#lookupExtraDefs"><span class="hs-identifier hs-type">lookupExtraDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#ExtraDefs"><span class="hs-identifier hs-type">ExtraDefs</span></a></span><span>
</span><span id="line-260"></span><span id="lookupExtraDefs"><span class="annot"><span class="annottext">lookupExtraDefs :: TcPluginM ExtraDefs
</span><a href="GHC.TypeLits.Normalise.html#lookupExtraDefs"><span class="hs-identifier hs-var hs-var">lookupExtraDefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679238801"><span class="annot"><a href="#local-6989586621679238801"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (Set CType)) -&gt; TcPluginM (IORef (Set CType))
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CType -&gt; IO (IORef (Set CType))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679238803"><span class="annot"><a href="#local-6989586621679238803"><span class="hs-identifier hs-var">ordCond</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#lookupTHName"><span class="hs-identifier hs-type">lookupTHName</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Data.Type.Ord.OrdCond</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">tcLookupTyCon</span></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679238805"><span class="annot"><a href="#local-6989586621679238805"><span class="hs-identifier hs-var">leqT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#lookupTHName"><span class="hs-identifier hs-type">lookupTHName</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-special">(</span><span class="hs-operator">Data.Type.Ord.&lt;=</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">tcLookupTyCon</span></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621679238806"><span class="annot"><a href="#local-6989586621679238806"><span class="hs-identifier hs-var">assertT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#lookupTHName"><span class="hs-identifier hs-type">lookupTHName</span></a></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">GHC.TypeError.Assert</span><span> </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">tcLookupTyCon</span></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238801"><span class="hs-identifier hs-type">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238805"><span class="hs-identifier hs-type">leqT</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679238806"><span class="hs-identifier hs-type">assertT</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621679238803"><span class="hs-identifier hs-type">ordCond</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#lookupTHName"><span class="hs-identifier hs-type">lookupTHName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-268"></span><span id="lookupTHName"><span class="annot"><span class="annottext">lookupTHName :: Name -&gt; TcPluginM Name
</span><a href="GHC.TypeLits.Normalise.html#lookupTHName"><span class="hs-identifier hs-var hs-var">lookupTHName</span></a></span></span><span> </span><span id="local-6989586621679238807"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679238807"><span class="hs-identifier hs-var">th</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679238808"><span class="annot"><a href="#local-6989586621679238808"><span class="hs-identifier hs-var">nc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM NameCache -&gt; TcPluginM NameCache
forall a. TcM a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">unsafeTcPluginTcM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; NameCache
</span><span class="hs-identifier hs-var">hsc_NC</span></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; NameCache)
-&gt; (Env TcGblEnv TcLclEnv -&gt; HscEnv)
-&gt; Env TcGblEnv TcLclEnv
-&gt; NameCache
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Env TcGblEnv TcLclEnv -&gt; HscEnv
forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><span class="hs-identifier hs-var">env_top</span></span><span> </span><span class="annot"><span class="annottext">(Env TcGblEnv TcLclEnv -&gt; NameCache)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Env TcGblEnv TcLclEnv)
-&gt; TcM NameCache
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (Env TcGblEnv TcLclEnv)
forall env. IOEnv env env
</span><span class="hs-identifier hs-var">getEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621679238810"><span class="annot"><a href="#local-6989586621679238810"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">tcPluginIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">thNameToGhcNameIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679238808"><span class="hs-identifier hs-type">nc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238807"><span class="hs-identifier hs-type">th</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fail</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Failed to lookup &quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="annot"><a href="#local-6989586621679238807"><span class="hs-identifier hs-type">th</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679238810"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-type">decideEqualSOP</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#ExtraDefs"><span class="hs-identifier hs-type">ExtraDefs</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span class="hs-comment">-- ^ 1. Givens that is already generated.</span><span>
</span><span id="line-277"></span><span>      </span><span class="hs-comment">--   We have to generate new givens at most once;</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-comment">--   otherwise GHC will loop indefinitely.</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span>      </span><span class="hs-comment">--   2. For GHc 9.2: TyCon of Data.Type.Ord.OrdCond</span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-comment">--      For older: TyCon of GHC.TypeLits.&lt;=?</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvBindsVar</span></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginSolveResult</span></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span class="hs-comment">-- Simplification phase: Derives /simplified/ givens;</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- we can reduce given constraints like @Show (Foo (n + 2))@</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- to its normal form @Show (Foo (2 + n))@, which is eventually</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- useful in solving phase.</span><span>
</span><span id="line-292"></span><span class="hs-comment">--</span><span>
</span><span id="line-293"></span><span class="hs-comment">-- This helps us to solve /indirect/ constraints;</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- without this phase, we cannot derive, e.g.,</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- @IsVector UVector (Fin (n + 1))@ from</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- @Unbox (1 + n)@!</span><span>
</span><span id="line-297"></span><span id="decideEqualSOP"><span class="annot"><span class="annottext">decideEqualSOP :: Opts -&gt; ExtraDefs -&gt; TcPluginSolver
</span><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var hs-var">decideEqualSOP</span></a></span></span><span> </span><span id="local-6989586621679238813"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238813"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238814"><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679238814"><span class="hs-identifier hs-var">gen'd</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679238815"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238815"><span class="hs-identifier hs-var">leqT</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679238816"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621679238816"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621679238817"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238817"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679238818"><span class="annot"><a href="#local-6989586621679238818"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set CType) -&gt; TcPluginM (Set CType)
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set CType) -&gt; TcPluginM (Set CType))
-&gt; IO (Set CType) -&gt; TcPluginM (Set CType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; IO (Set CType)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679238814"><span class="hs-identifier hs-var">gen'd</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238821"><span class="annot"><a href="#local-6989586621679238821"><span class="hs-identifier hs-var hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-300"></span><span>          </span><span class="annot"><span class="annottext">((Ct, (Type, EvTerm, [Type])) -&gt; Bool)
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679238822"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679238822"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679238822"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238813"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))])
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-301"></span><span>          </span><span class="annot"><span class="annottext">Opts
-&gt; TyCon -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (Type, EvTerm, [Type]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var">reduceGivens</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238813"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238815"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679238818"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238817"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-302"></span><span>        </span><span id="local-6989586621679238825"><span class="annot"><a href="#local-6989586621679238825"><span class="hs-identifier hs-var hs-var">newlyDone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ct, (Type, EvTerm, [Type])) -&gt; CType)
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [CType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679238826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238826"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238826"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Ct, (Type, EvTerm, [Type]))]
</span><a href="#local-6989586621679238821"><span class="hs-identifier hs-var">reds</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">tcPluginIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef'</span></span><span> </span><span class="annot"><a href="#local-6989586621679238814"><span class="hs-identifier hs-type">gen'd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromList</span></span><span> </span><span class="annot"><a href="#local-6989586621679238825"><span class="hs-identifier hs-type">newlyDone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span id="local-6989586621679238829"><span class="annot"><a href="#local-6989586621679238829"><span class="hs-identifier hs-var">newGivens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679238821"><span class="hs-identifier hs-type">reds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679238830"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238830"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238831"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238831"><span class="hs-identifier hs-var">pred'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238832"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238832"><span class="hs-identifier hs-var">evTerm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238830"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; CtLoc -&gt; Type -&gt; EvTerm -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newGiven</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621679238816"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238830"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238831"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238832"><span class="hs-identifier hs-var">evTerm</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TcPluginOk</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679238829"><span class="hs-identifier hs-type">newGivens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- Solving phase.</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- Solves in/equalities on Nats and simplifiable constraints</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- containing naturals.</span><span>
</span><span id="line-312"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var">decideEqualSOP</span></a></span><span> </span><span id="local-6989586621679238835"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238835"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238836"><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679238836"><span class="hs-identifier hs-var">gen'd</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679238837"><span class="annot"><span class="annottext">tcs :: (TyCon, TyCon, TyCon)
</span><a href="#local-6989586621679238837"><span class="hs-identifier hs-var">tcs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679238838"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238838"><span class="hs-identifier hs-var">leqT</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679238839"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621679238839"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span id="local-6989586621679238840"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238840"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621679238841"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238841"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238842"><span class="annot"><span class="annottext">unit_wanteds :: [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238842"><span class="hs-identifier hs-var hs-var hs-var">unit_wanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct
 -&gt; Maybe
      (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)]))
-&gt; [Ct]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon, TyCon, TyCon)
-&gt; Ct
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var">toNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, TyCon, TyCon)
</span><a href="#local-6989586621679238837"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238841"><span class="hs-identifier hs-var">wanteds</span></a></span><span>
</span><span id="line-314"></span><span>        </span><span id="local-6989586621679238844"><span class="annot"><span class="annottext">nonEqs :: [Ct]
</span><a href="#local-6989586621679238844"><span class="hs-identifier hs-var hs-var hs-var">nonEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; [Ct]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span>
</span><span id="line-315"></span><span>                        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Ct -&gt; Bool) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679238846"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238846"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238846"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPrimPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238846"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                        </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Ct -&gt; Type) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span>
</span><span id="line-317"></span><span>                        </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>                 </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238841"><span class="hs-identifier hs-var">wanteds</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679238847"><span class="annot"><a href="#local-6989586621679238847"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set CType) -&gt; TcPluginM (Set CType)
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set CType) -&gt; TcPluginM (Set CType))
-&gt; IO (Set CType) -&gt; TcPluginM (Set CType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; IO (Set CType)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679238836"><span class="hs-identifier hs-var">gen'd</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238848"><span class="annot"><a href="#local-6989586621679238848"><span class="hs-identifier hs-var hs-var">redGs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Opts
-&gt; TyCon -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (Type, EvTerm, [Type]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var">reduceGivens</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238835"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238838"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679238847"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238840"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621679238849"><span class="annot"><a href="#local-6989586621679238849"><span class="hs-identifier hs-var hs-var">newlyDone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ct, (Type, EvTerm, [Type])) -&gt; CType)
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [CType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679238850"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238850"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238850"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Ct, (Type, EvTerm, [Type]))]
</span><a href="#local-6989586621679238848"><span class="hs-identifier hs-var">redGs</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span id="local-6989586621679238851"><span class="annot"><a href="#local-6989586621679238851"><span class="hs-identifier hs-var">redGivens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679238848"><span class="hs-identifier hs-type">redGs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679238852"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238852"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238853"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238853"><span class="hs-identifier hs-var">pred'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238854"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238854"><span class="hs-identifier hs-var">evTerm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-323"></span><span>      </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238852"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; CtLoc -&gt; Type -&gt; EvTerm -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newGiven</span></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621679238839"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238852"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238853"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238854"><span class="hs-identifier hs-var">evTerm</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679238855"><span class="annot"><a href="#local-6989586621679238855"><span class="hs-identifier hs-var">reducible_wanteds</span></a></span></span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">catMaybes</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679238857"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238857"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((EvTerm, [(Type, Type)], [Ct])
 -&gt; (Ct, (EvTerm, [(Type, Type)], [Ct])))
-&gt; Maybe (EvTerm, [(Type, Type)], [Ct])
-&gt; Maybe (Ct, (EvTerm, [(Type, Type)], [Ct]))
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238857"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvTerm, [(Type, Type)], [Ct])
 -&gt; Maybe (Ct, (EvTerm, [(Type, Type)], [Ct])))
-&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
-&gt; TcPluginM (Maybe (Ct, (EvTerm, [(Type, Type)], [Ct])))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-326"></span><span>                                    </span><span class="annot"><span class="annottext">[Ct] -&gt; Ct -&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-var">reduceNatConstr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238840"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238851"><span class="hs-identifier hs-var">redGivens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238857"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>                            </span><span class="annot"><a href="#local-6989586621679238844"><span class="hs-identifier hs-type">nonEqs</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621679238842"><span class="hs-identifier hs-type">unit_wanteds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&amp;&amp;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621679238855"><span class="hs-identifier hs-type">reducible_wanteds</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginOk</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>        </span><span class="hs-comment">-- Since reducible wanteds also can have some negation/subtraction</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- subterms, we have to make sure appropriate inequalities to hold.</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-comment">-- Here, we generate such additional inequalities for reduction</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- that is to be added to new [W]anteds.</span><span>
</span><span id="line-335"></span><span>        </span><span id="local-6989586621679238860"><span class="annot"><a href="#local-6989586621679238860"><span class="hs-identifier hs-var">ineqForRedWants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">concat</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679238848"><span class="hs-identifier hs-type">redGs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679238862"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238862"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238863"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679238863"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; (Type -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679238863"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">((Type -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct])
-&gt; (Type -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-336"></span><span>          </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall a b. (a -&gt; b) -&gt; TcPluginM a -&gt; TcPluginM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238862"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcPluginM CtEvidence -&gt; TcPluginM Ct)
-&gt; (Type -&gt; TcPluginM CtEvidence) -&gt; Type -&gt; TcPluginM Ct
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newWanted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238862"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">tcPluginIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-338"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">modifyIORef'</span></span><span> </span><span class="annot"><a href="#local-6989586621679238836"><span class="hs-identifier hs-type">gen'd</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fromList</span></span><span> </span><span class="annot"><a href="#local-6989586621679238849"><span class="hs-identifier hs-type">newlyDone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238864"><span class="annot"><a href="#local-6989586621679238864"><span class="hs-identifier hs-var hs-var">unit_givens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct
 -&gt; Maybe
      (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)]))
-&gt; [Ct]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-340"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon, TyCon, TyCon)
-&gt; Ct
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var">toNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, TyCon, TyCon)
</span><a href="#local-6989586621679238837"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>                            </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238840"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621679238865"><span class="annot"><a href="#local-6989586621679238865"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-type">simplifyNats</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238835"><span class="hs-identifier hs-type">opts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238838"><span class="hs-identifier hs-type">leqT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238864"><span class="hs-identifier hs-type">unit_givens</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238842"><span class="hs-identifier hs-type">unit_wanteds</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">tcPluginTrace</span></span><span> </span><span class="annot"><span class="hs-string">&quot;normalised&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ppr</span></span><span> </span><span class="annot"><a href="#local-6989586621679238865"><span class="hs-identifier hs-type">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>        </span><span id="local-6989586621679238868"><span class="annot"><a href="#local-6989586621679238868"><span class="hs-identifier hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679238855"><span class="hs-identifier hs-type">reducible_wanteds</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679238869"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238869"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679238870"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238870"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238871"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238871"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238872"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238872"><span class="hs-identifier hs-var">wDicts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>          </span><span id="local-6989586621679238873"><span class="annot"><a href="#local-6989586621679238873"><span class="hs-identifier hs-var">wants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; [Type] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var">evSubtPreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238869"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; TcPluginM [Ct]) -&gt; [Type] -&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238835"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238838"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238871"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-346"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238870"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679238869"><span class="hs-identifier hs-type">origCt</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679238872"><span class="hs-identifier hs-type">wDicts</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621679238873"><span class="hs-identifier hs-type">wants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679238865"><span class="hs-identifier hs-type">sr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>          </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679238877"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238877"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-349"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238878"><span class="annot"><span class="annottext">simpld :: [((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238878"><span class="hs-identifier hs-var hs-var">simpld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((EvTerm, Ct), [Ct]) -&gt; Bool)
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Bool) -&gt; ((EvTerm, Ct), [Ct]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; CtEvidence)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; CtEvidence)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Ct)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; CtEvidence
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679238879"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238879"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238879"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238877"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-350"></span><span>                </span><span class="hs-comment">-- Only solve derived when we solved a wanted</span><span>
</span><span id="line-351"></span><span>                </span><span id="local-6989586621679238880"><span class="annot"><span class="annottext">simpld1 :: [((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238880"><span class="hs-identifier hs-var hs-var">simpld1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(((EvTerm, Ct), [Ct]) -&gt; Bool)
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isWanted</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; CtEvidence)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; CtEvidence)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Ct)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; CtEvidence
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679238881"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238881"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238881"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238877"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238868"><span class="hs-identifier hs-var">reds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-352"></span><span>                            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-353"></span><span>                            </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238878"><span class="hs-identifier hs-var">simpld</span></a></span><span>
</span><span id="line-354"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679238885"><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621679238885"><span class="hs-identifier hs-var">solved'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679238886"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238886"><span class="hs-identifier hs-var">newWanteds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[Ct]] -&gt; [Ct])
-&gt; ([(EvTerm, Ct)], [[Ct]]) -&gt; ([(EvTerm, Ct)], [Ct])
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">[[Ct]] -&gt; [Ct]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]]))
-&gt; [((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238880"><span class="hs-identifier hs-var">simpld1</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238868"><span class="hs-identifier hs-var">reds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>            </span><span class="annot"><span class="annottext">TcPluginSolveResult -&gt; TcPluginM TcPluginSolveResult
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EvTerm, Ct)] -&gt; [Ct] -&gt; TcPluginSolveResult
</span><span class="hs-identifier hs-var">TcPluginOk</span></span><span> </span><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621679238885"><span class="hs-identifier hs-var">solved'</span></a></span><span> </span><span class="annot"><span class="annottext">([Ct] -&gt; TcPluginSolveResult) -&gt; [Ct] -&gt; TcPluginSolveResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238886"><span class="hs-identifier hs-var">newWanteds</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238860"><span class="hs-identifier hs-var">ineqForRedWants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>          </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679238889"><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679238889"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcPluginSolveResult -&gt; TcPluginM TcPluginSolveResult
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; TcPluginSolveResult
</span><span class="hs-identifier hs-var">TcPluginContradiction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var">fromNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679238889"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="hs-keyword">type</span><span> </span><span id="NatEquality"><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-var">NatEquality</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span class="hs-keyword">type</span><span> </span><span id="NatInEquality"><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-var">NatInEquality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-type">reduceGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-362"></span><span id="reduceGivens"><span class="annot"><span class="annottext">reduceGivens :: Opts
-&gt; TyCon -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (Type, EvTerm, [Type]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var hs-var">reduceGivens</span></a></span></span><span> </span><span id="local-6989586621679238893"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238893"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679238894"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238894"><span class="hs-identifier hs-var">leqT</span></a></span></span><span> </span><span id="local-6989586621679238895"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679238895"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621679238896"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238896"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238897"><span class="annot"><span class="annottext">nonEqs :: [Ct]
</span><a href="#local-6989586621679238897"><span class="hs-identifier hs-var hs-var">nonEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-364"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238898"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-365"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679238898"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238898"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238896"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-366"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238899"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621679238899"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238898"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-367"></span><span>              </span><span id="local-6989586621679238900"><span class="annot"><span class="annottext">prd :: Type
</span><a href="#local-6989586621679238900"><span class="hs-identifier hs-var hs-var">prd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679238899"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-368"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679238899"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679238901"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238901"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238901"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPrimPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238901"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-var">isEqPredClass</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238901"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238900"><span class="hs-identifier hs-var">prd</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((Ct, (Type, EvTerm, [Type])) -&gt; Bool)
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238902"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238902"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><span class="annottext">CType -&gt; Set CType -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">notMember</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238902"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679238895"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-374"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="annottext">([(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))])
-&gt; [(Ct, (Type, EvTerm, [Type]))] -&gt; [(Ct, (Type, EvTerm, [Type]))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Maybe (Ct, (Type, EvTerm, [Type])))
-&gt; [Ct] -&gt; [(Ct, (Type, EvTerm, [Type]))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-376"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679238903"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238903"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238903"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Type, EvTerm, [Type]) -&gt; (Ct, (Type, EvTerm, [Type])))
-&gt; Maybe (Type, EvTerm, [Type])
-&gt; Maybe (Ct, (Type, EvTerm, [Type]))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [Ct] -&gt; Ct -&gt; Maybe (Type, EvTerm, [Type])
</span><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-var">tryReduceGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238893"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238894"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238896"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238903"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>      </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238897"><span class="hs-identifier hs-var">nonEqs</span></a></span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-type">tryReduceGiven</span></a></span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span id="tryReduceGiven"><span class="annot"><span class="annottext">tryReduceGiven :: Opts -&gt; TyCon -&gt; [Ct] -&gt; Ct -&gt; Maybe (Type, EvTerm, [Type])
</span><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-var hs-var">tryReduceGiven</span></a></span></span><span> </span><span id="local-6989586621679238905"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238905"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679238906"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238906"><span class="hs-identifier hs-var">leqT</span></a></span></span><span> </span><span id="local-6989586621679238907"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238907"><span class="hs-identifier hs-var">simplGivens</span></a></span></span><span> </span><span id="local-6989586621679238908"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238908"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238909"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679238909"><span class="hs-identifier hs-var hs-var">mans</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238910"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238910"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><span class="annottext">Writer [(Type, Type)] (Maybe Type) -&gt; (Maybe Type, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer [(Type, Type)] (Maybe Type)
 -&gt; (Maybe Type, [(Type, Type)]))
-&gt; Writer [(Type, Type)] (Maybe Type)
-&gt; (Maybe Type, [(Type, Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] (Maybe Type)
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNatEverywhere"><span class="hs-identifier hs-var">normaliseNatEverywhere</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Writer [(Type, Type)] (Maybe Type))
-&gt; Type -&gt; Writer [(Type, Type)] (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-385"></span><span>          </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; CtEvidence -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238908"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-386"></span><span>        </span><span id="local-6989586621679238914"><span class="annot"><span class="annottext">ws' :: [Type]
</span><a href="#local-6989586621679238914"><span class="hs-identifier hs-var hs-var hs-var">ws'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238915"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-387"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679238915"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238915"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238905"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238906"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238910"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-388"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Ct -&gt; Bool) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238915"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Ct -&gt; Type) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238907"><span class="hs-identifier hs-var">simplGivens</span></a></span><span>
</span><span id="line-389"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>    </span><span id="local-6989586621679238917"><span class="annot"><a href="#local-6989586621679238917"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679238909"><span class="hs-identifier hs-var">mans</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238917"><span class="hs-identifier hs-type">pred'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-type">toReducedDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ctEvidence</span></span><span> </span><span class="annot"><a href="#local-6989586621679238908"><span class="hs-identifier hs-type">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679238917"><span class="hs-identifier hs-type">pred'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679238914"><span class="hs-identifier hs-type">ws'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-type">fromNatEquality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-394"></span><span id="fromNatEquality"><span class="annot"><span class="annottext">fromNatEquality :: Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var hs-var">fromNatEquality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679238919"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238919"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238919"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-395"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var">fromNatEquality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238920"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238920"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238920"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-396"></span><span>
</span><span id="line-397"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-type">reduceNatConstr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span id="reduceNatConstr"><span class="annot"><span class="annottext">reduceNatConstr :: [Ct] -&gt; Ct -&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-var hs-var">reduceNatConstr</span></a></span></span><span> </span><span id="local-6989586621679238921"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238921"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621679238922"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238922"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238923"><span class="annot"><span class="annottext">pred0 :: Type
</span><a href="#local-6989586621679238923"><span class="hs-identifier hs-var hs-var">pred0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; CtEvidence -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238922"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679238924"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679238924"><span class="hs-identifier hs-var">mans</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679238925"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238925"><span class="hs-identifier hs-var">tests</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] (Maybe Type) -&gt; (Maybe Type, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer [(Type, Type)] (Maybe Type)
 -&gt; (Maybe Type, [(Type, Type)]))
-&gt; Writer [(Type, Type)] (Maybe Type)
-&gt; (Maybe Type, [(Type, Type)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] (Maybe Type)
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNatEverywhere"><span class="hs-identifier hs-var">normaliseNatEverywhere</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238923"><span class="hs-identifier hs-var">pred0</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621679238924"><span class="hs-identifier hs-var">mans</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(Type, Type)], [Ct])
-&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(Type, Type)], [Ct])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-403"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679238926"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; Maybe Ct
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Ct -&gt; Type) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679238921"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-comment">-- No existing evidence found</span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ct
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe (Class, [Type])
</span><span class="hs-identifier hs-var">getClassPredTys_maybe</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-407"></span><span>          </span><span class="hs-comment">-- Are we trying to solve a class instance?</span><span>
</span><span id="line-408"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238927"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679238927"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Name
</span><span class="hs-identifier hs-var">className</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679238927"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier hs-var">knownNatClassName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>            </span><span class="hs-comment">-- Create new evidence binding for normalized class constraint</span><span>
</span><span id="line-410"></span><span>            </span><span id="local-6989586621679238929"><span class="annot"><a href="#local-6989586621679238929"><span class="hs-identifier hs-var">evVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcPluginM TyVar
</span><span class="hs-identifier hs-var">newEvVar</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-comment">-- Bind the evidence to a new wanted normalized class constraint</span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238930"><span class="annot"><a href="#local-6989586621679238930"><span class="hs-identifier hs-var hs-var">wDict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">mkNonCanonical</span></span><span>
</span><span id="line-413"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcEvDest -&gt; CtLoc -&gt; RewriterSet -&gt; CtEvidence
</span><span class="hs-identifier hs-var">CtWanted</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TcEvDest
</span><span class="hs-identifier hs-var">EvVarDest</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679238929"><span class="hs-identifier hs-var">evVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238922"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RewriterSet
</span><span class="hs-identifier hs-var">emptyRewriterSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>            </span><span class="hs-comment">-- Evidence for current wanted is simply the coerced binding for</span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-comment">-- the new binding</span><span>
</span><span id="line-416"></span><span>                </span><span id="local-6989586621679238933"><span class="annot"><a href="#local-6989586621679238933"><span class="hs-identifier hs-var hs-var">evCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>                         </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Representational</span></span><span>
</span><span id="line-418"></span><span>                         </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238926"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238923"><span class="hs-identifier hs-var">pred0</span></a></span><span>
</span><span id="line-419"></span><span>                </span><span id="local-6989586621679238936"><span class="annot"><a href="#local-6989586621679238936"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; EvExpr
</span><span class="hs-identifier hs-var">evId</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679238929"><span class="hs-identifier hs-var">evVar</span></a></span><span> </span><span class="annot"><span class="annottext">EvExpr -&gt; Coercion -&gt; EvTerm
</span><span class="hs-operator hs-var">`evCast`</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679238933"><span class="hs-identifier hs-var">evCo</span></a></span><span>
</span><span id="line-420"></span><span>            </span><span class="hs-comment">-- Use newly created coerced wanted as evidence, and emit the</span><span>
</span><span id="line-421"></span><span>            </span><span class="hs-comment">-- normalized wanted as a new constraint to solve.</span><span>
</span><span id="line-422"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238936"><span class="hs-identifier hs-type">ev</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679238925"><span class="hs-identifier hs-type">tests</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679238930"><span class="hs-identifier hs-type">wDict</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Class, [Type])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(Type, Type)], [Ct])
-&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(Type, Type)], [Ct])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-comment">-- Use existing evidence</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679238937"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238937"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(Type, Type)], [Ct])
-&gt; TcPluginM (Maybe (EvTerm, [(Type, Type)], [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EvTerm, [(Type, Type)], [Ct])
-&gt; Maybe (EvTerm, [(Type, Type)], [Ct])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Type -&gt; EvTerm
</span><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-var">toReducedDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238937"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238923"><span class="hs-identifier hs-var">pred0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238925"><span class="hs-identifier hs-var">tests</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-type">toReducedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtEvidence</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span>
</span><span id="line-428"></span><span id="toReducedDict"><span class="annot"><span class="annottext">toReducedDict :: CtEvidence -&gt; Type -&gt; EvTerm
</span><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-var hs-var">toReducedDict</span></a></span></span><span> </span><span id="local-6989586621679238938"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679238938"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621679238939"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238939"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238940"><span class="annot"><span class="annottext">pred0 :: Type
</span><a href="#local-6989586621679238940"><span class="hs-identifier hs-var hs-var">pred0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679238938"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-430"></span><span>      </span><span id="local-6989586621679238941"><span class="annot"><span class="annottext">evCo :: Coercion
</span><a href="#local-6989586621679238941"><span class="hs-identifier hs-var hs-var">evCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>              </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Representational</span></span><span>
</span><span id="line-432"></span><span>              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238940"><span class="hs-identifier hs-var">pred0</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679238939"><span class="hs-identifier hs-var">pred'</span></a></span><span>
</span><span id="line-433"></span><span>      </span><span id="local-6989586621679238943"><span class="annot"><span class="annottext">ev :: EvTerm
</span><a href="#local-6989586621679238943"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; CtEvidence -&gt; EvExpr
CtEvidence -&gt; EvExpr
</span><span class="hs-identifier hs-var">ctEvExpr</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679238938"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-434"></span><span>             </span><span class="annot"><span class="annottext">EvExpr -&gt; Coercion -&gt; EvTerm
</span><span class="hs-operator hs-var">`evCast`</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679238941"><span class="hs-identifier hs-var">evCo</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679238943"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-keyword">data</span><span> </span><span id="SimplifyResult"><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-var">SimplifyResult</span></a></span></span><span>
</span><span id="line-438"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Simplified"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Impossible"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-442"></span><span>  </span><span id="local-6989586621679238959"><span class="annot"><span class="annottext">ppr :: SimplifyResult -&gt; SDoc
</span><span class="hs-identifier hs-var hs-var hs-var">ppr</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679238960"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238960"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Simplified&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsDoc doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">$$</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238960"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679238961"><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679238961"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc
forall doc. IsLine doc =&gt; CommandLineOption -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679238961"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-type">simplifyNats</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- ^ Allow negated numbers (potentially unsound!)</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- * TyCon of Data.Type.Ord.&lt;=</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-comment">-- ^ Given constraints</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-comment">-- ^ Wanted constraints</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span><span>
</span><span id="line-455"></span><span id="simplifyNats"><span class="annot"><span class="annottext">simplifyNats :: Opts
-&gt; TyCon
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-var hs-var">simplifyNats</span></a></span></span><span> </span><span id="local-6989586621679238962"><span class="annot"><span class="annottext">opts :: Opts
</span><a href="#local-6989586621679238962"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679238963"><span id="local-6989586621679238964"><span class="annot"><span class="annottext">Bool
Word
negNumbers :: Opts -&gt; Bool
depth :: Opts -&gt; Word
negNumbers :: Bool
depth :: Word
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679238965"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238965"><span class="hs-identifier hs-var">leqT</span></a></span></span><span> </span><span id="local-6989586621679238966"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238966"><span class="hs-identifier hs-var">eqsG</span></a></span></span><span> </span><span id="local-6989586621679238967"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238967"><span class="hs-identifier hs-var">eqsW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238969"><span class="annot"><span class="annottext">eqsG1 :: [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238969"><span class="hs-identifier hs-var hs-var">eqsG1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
 -&gt; (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)]))
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(Type, Type)] -&gt; [(Type, Type)])
-&gt; (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall b c d. (b -&gt; c) -&gt; (d, b) -&gt; (d, c)
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238966"><span class="hs-identifier hs-var">eqsG</span></a></span><span>
</span><span id="line-457"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679238970"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238970"><span class="hs-identifier hs-var">varEqs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679238971"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238971"><span class="hs-identifier hs-var">otherEqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
 -&gt; Bool)
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; ([(Either (Ct, CoreSOP, CoreSOP) NatInEquality,
      [(Type, Type)])],
    [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Bool
forall {a} {v} {c} {v} {c} {b} {b}.
(Either (a, SOP v c, SOP v c) b, b) -&gt; Bool
</span><a href="#local-6989586621679238972"><span class="hs-identifier hs-var">isVarEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238969"><span class="hs-identifier hs-var">eqsG1</span></a></span><span>
</span><span id="line-458"></span><span>        </span><span id="local-6989586621679238976"><span class="annot"><span class="annottext">fancyGivens :: [[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]]
</span><a href="#local-6989586621679238976"><span class="hs-identifier hs-var hs-var">fancyGivens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
 -&gt; [[(Either (Ct, CoreSOP, CoreSOP) NatInEquality,
       [(Type, Type)])]])
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [[(Either (Ct, CoreSOP, CoreSOP) NatInEquality,
      [(Type, Type)])]]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; [[(Either (Ct, CoreSOP, CoreSOP) NatInEquality,
      [(Type, Type)])]]
forall {v} {a} {c} {c} {a} {c} {c} {c} {b}.
Eq v =&gt;
[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679238978"><span class="hs-identifier hs-var">makeGivensSet</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238971"><span class="hs-identifier hs-var">otherEqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238970"><span class="hs-identifier hs-var">varEqs</span></a></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238970"><span class="hs-identifier hs-var">varEqs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238979"><span class="annot"><span class="annottext">eqs :: [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238979"><span class="hs-identifier hs-var hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238971"><span class="hs-identifier hs-var">otherEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238967"><span class="hs-identifier hs-var">eqsW</span></a></span><span>
</span><span id="line-462"></span><span>        </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;simplifyNats&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238979"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>        </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238979"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-464"></span><span>      </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-465"></span><span>        </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;simplifyNats(backtrack: &quot;</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CommandLineOption
forall a. Show a =&gt; a -&gt; CommandLineOption
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]]
-&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]]
</span><a href="#local-6989586621679238976"><span class="hs-identifier hs-var">fancyGivens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; CommandLineOption -&gt; CommandLineOption
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238970"><span class="hs-identifier hs-var">varEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span id="local-6989586621679238982"><span class="annot"><a href="#local-6989586621679238982"><span class="hs-identifier hs-var">allSimplified</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]]
-&gt; ([(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
    -&gt; TcPluginM SimplifyResult)
-&gt; TcPluginM [SimplifyResult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]]
</span><a href="#local-6989586621679238976"><span class="hs-identifier hs-var">fancyGivens</span></a></span><span> </span><span class="annot"><span class="annottext">(([(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
  -&gt; TcPluginM SimplifyResult)
 -&gt; TcPluginM [SimplifyResult])
-&gt; ([(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
    -&gt; TcPluginM SimplifyResult)
-&gt; TcPluginM [SimplifyResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679238983"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238983"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-469"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679238984"><span class="annot"><span class="annottext">eqs :: [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238984"><span class="hs-identifier hs-var hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238983"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238967"><span class="hs-identifier hs-var">eqsW</span></a></span><span>
</span><span id="line-470"></span><span>          </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;simplifyNats&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238984"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238984"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">foldr</span></span><span> </span><span class="annot"><a href="#local-6989586621679238985"><span class="hs-identifier hs-type">findFirstSimpliedWanted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679238982"><span class="hs-identifier hs-type">allSimplified</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-475"></span><span>    </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreUnify"><span class="hs-identifier hs-type">CoreUnify</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-477"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-478"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-479"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-480"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span id="local-6989586621679238980"><span class="annot"><span class="annottext">simples :: [CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var hs-var">simples</span></a></span></span><span> </span><span id="local-6989586621679238986"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238986"><span class="hs-identifier hs-var">_subst</span></a></span></span><span> </span><span id="local-6989586621679238987"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238987"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679238988"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679238988"><span class="hs-identifier hs-var">_leqsG</span></a></span></span><span> </span><span id="local-6989586621679238989"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238989"><span class="hs-identifier hs-var">_xs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238987"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>    </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span id="local-6989586621679238990"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679238991"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679238992"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679238992"><span class="hs-identifier hs-var">leqsG</span></a></span></span><span> </span><span id="local-6989586621679238993"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238993"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238994"><span class="annot"><span class="annottext">eq :: (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679238994"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679238995"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238995"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679238996"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679238996"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679238997"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679238997"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679238998"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238998"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679238999"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-483"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239002"><span class="annot"><span class="annottext">u' :: CoreSOP
</span><a href="#local-6989586621679239002"><span class="hs-identifier hs-var hs-var hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679238996"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-484"></span><span>          </span><span id="local-6989586621679239006"><span class="annot"><span class="annottext">v' :: CoreSOP
</span><a href="#local-6989586621679239006"><span class="hs-identifier hs-var hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679238997"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-485"></span><span>      </span><span id="local-6989586621679239007"><span class="annot"><a href="#local-6989586621679239007"><span class="hs-identifier hs-var">ur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CoreSOP -&gt; CoreSOP -&gt; TcPluginM UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#unifyNats"><span class="hs-identifier hs-var">unifyNats</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238995"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239002"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239006"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-486"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">tcPluginTrace</span></span><span> </span><span class="annot"><span class="hs-string">&quot;unifyNats result&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ppr</span></span><span> </span><span class="annot"><a href="#local-6989586621679239007"><span class="hs-identifier hs-type">ur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679239007"><span class="hs-identifier hs-type">ur</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-488"></span><span>        </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-489"></span><span>          </span><span id="local-6989586621679239010"><span class="annot"><a href="#local-6989586621679239010"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Set CType -&gt; [Type] -&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238995"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238962"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238965"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238998"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-490"></span><span>          </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238990"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239010"><span class="hs-identifier hs-type">evs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679238992"><span class="hs-identifier hs-type">leqsG</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679238993"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621679238999"><span class="hs-identifier hs-type">eqs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-492"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679238994"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-493"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679238992"><span class="hs-identifier hs-var">leqsG</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238993"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-494"></span><span>        </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#Draw"><span class="hs-identifier hs-type">Draw</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679238994"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238993"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#Draw"><span class="hs-identifier hs-type">Draw</span></a></span><span> </span><span id="local-6989586621679239015"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239015"><span class="hs-identifier hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>          </span><span id="local-6989586621679239016"><span class="annot"><a href="#local-6989586621679239016"><span class="hs-identifier hs-var">evM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Set CType -&gt; [Type] -&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238995"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreUnify -&gt; Type) -&gt; [CoreUnify] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CoreUnify -&gt; Type
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-var">unifyItemToPredType</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239015"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-497"></span><span>                                   </span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238962"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238965"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679238998"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239018"><span class="annot"><a href="#local-6989586621679239018"><span class="hs-identifier hs-var hs-var">leqsG'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679238995"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; CoreSOP -&gt; [(CoreSOP, CoreSOP, Bool)]
forall {a}. a -&gt; a -&gt; [(a, a, Bool)]
</span><a href="#local-6989586621679239019"><span class="hs-identifier hs-var">eqToLeq</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239002"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239006"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679238992"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-499"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679238992"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-500"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679239016"><span class="hs-identifier hs-type">evM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>            </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239018"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238993"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-502"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679239020"><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679239020"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>              </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreUnify] -&gt; [CoreUnify] -&gt; [CoreUnify]
forall v c.
(Ord v, Ord c) =&gt;
[UnifyItem v c] -&gt; [UnifyItem v c] -&gt; [UnifyItem v c]
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSubst"><span class="hs-identifier hs-var">substsSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239015"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679238990"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; [CoreUnify] -&gt; [CoreUnify]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239015"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679239020"><span class="hs-identifier hs-var">ev</span></a></span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679238991"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239018"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238993"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238999"><span class="hs-identifier hs-var">eqs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span id="local-6989586621679239022"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679239023"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679239024"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span></span><span> </span><span id="local-6989586621679239025"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679239025"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239026"><span class="annot"><span class="annottext">eq :: (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239026"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239027"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239027"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239028"><span class="annot"><span class="annottext">u :: (CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239028"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679239029"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239029"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239030"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239030"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239031"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679239031"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679239032"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239032"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679239033"><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679239033"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-506"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239036"><span class="annot"><span class="annottext">u' :: CoreSOP
</span><a href="#local-6989586621679239036"><span class="hs-identifier hs-var hs-var hs-var">u'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool) -&gt; CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#subtractIneq"><span class="hs-identifier hs-var">subtractIneq</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239028"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-507"></span><span>          </span><span id="local-6989586621679239040"><span class="annot"><span class="annottext">x' :: CoreSOP
</span><a href="#local-6989586621679239040"><span class="hs-identifier hs-var hs-var hs-var">x'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239029"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-508"></span><span>          </span><span id="local-6989586621679239043"><span class="annot"><span class="annottext">y' :: CoreSOP
</span><a href="#local-6989586621679239043"><span class="hs-identifier hs-var hs-var hs-var">y'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239030"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-509"></span><span>          </span><span id="local-6989586621679239044"><span class="annot"><span class="annottext">uS :: (CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239044"><span class="hs-identifier hs-var hs-var hs-var">uS</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239040"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239043"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679239031"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>          </span><span id="local-6989586621679239045"><span class="annot"><span class="annottext">leqsG' :: [(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239045"><span class="hs-identifier hs-var hs-var hs-var">leqsG'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239027"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239040"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239043"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679239031"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-511"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-512"></span><span>          </span><span id="local-6989586621679239049"><span class="annot"><span class="annottext">ineqs :: [(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239049"><span class="hs-identifier hs-var hs-var hs-var">ineqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CoreSOP, CoreSOP, Bool)]] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-513"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; (CoreSOP, CoreSOP, Bool))
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreUnify] -&gt; (CoreSOP, CoreSOP, Bool) -&gt; (CoreSOP, CoreSOP, Bool)
forall {v} {c} {c}.
(Ord v, Ord c) =&gt;
[UnifyItem v c] -&gt; (SOP v c, SOP v c, c) -&gt; (SOP v c, SOP v c, c)
</span><a href="#local-6989586621679239050"><span class="hs-identifier hs-var">substLeq</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-514"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(NatInEquality -&gt; (CoreSOP, CoreSOP, Bool))
-&gt; [NatInEquality] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NatInEquality -&gt; (CoreSOP, CoreSOP, Bool)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either (Ct, CoreSOP, CoreSOP) NatInEquality] -&gt; [NatInEquality]
forall a b. [Either a b] -&gt; [b]
</span><span class="hs-identifier hs-var">rights</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
 -&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality)
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [Either (Ct, CoreSOP, CoreSOP) NatInEquality]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679238966"><span class="hs-identifier hs-var">eqsG</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-516"></span><span>      </span><span class="annot"><span class="annottext">CommandLineOption -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;unifyNats(ineq) results&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct, (CoreSOP, CoreSOP, Bool), CoreSOP, [(CoreSOP, CoreSOP, Bool)])
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239027"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239028"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239036"><span class="hs-identifier hs-var">u'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239049"><span class="hs-identifier hs-var">ineqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP -&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#isNatural"><span class="hs-identifier hs-var">isNatural</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239036"><span class="hs-identifier hs-var">u'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-518"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span id="local-6989586621679239054"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679239054"><span class="hs-identifier hs-var">knW</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>          </span><span id="local-6989586621679239055"><span class="annot"><a href="#local-6989586621679239055"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Set CType -&gt; [Type] -&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239027"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679239054"><span class="hs-identifier hs-var">knW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238962"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238965"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239032"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>          </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239022"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239055"><span class="hs-identifier hs-type">evs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239045"><span class="hs-identifier hs-type">leqsG'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239025"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239033"><span class="hs-identifier hs-type">eqs'</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Set CType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239032"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239026"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Bool, Set CType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-524"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239056"><span class="annot"><span class="annottext">solvedIneq :: [(Bool, Set CType)]
</span><a href="#local-6989586621679239056"><span class="hs-identifier hs-var hs-var">solvedIneq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType))
-&gt; [WriterT (Set CType) Maybe Bool] -&gt; [(Bool, Set CType)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">runWriterT</span></span><span>
</span><span id="line-525"></span><span>                 </span><span class="hs-comment">-- it is an inequality that can be instantly solved, such as</span><span>
</span><span id="line-526"></span><span>                 </span><span class="hs-comment">-- `1 &lt;= x^y`</span><span>
</span><span id="line-527"></span><span>                 </span><span class="hs-comment">-- OR</span><span>
</span><span id="line-528"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; (CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#instantSolveIneq"><span class="hs-identifier hs-var">instantSolveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679238964"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239028"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool
-&gt; [WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-529"></span><span>                </span><span class="annot"><span class="annottext">Word -&gt; (CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#instantSolveIneq"><span class="hs-identifier hs-var">instantSolveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679238964"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239044"><span class="hs-identifier hs-var">uS</span></a></span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool
-&gt; [WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-530"></span><span>                </span><span class="hs-comment">-- This inequality is either a given constraint, or it is a wanted</span><span>
</span><span id="line-531"></span><span>                </span><span class="hs-comment">-- constraint, which in normal form is equal to another given</span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-comment">-- constraint, hence it can be solved.</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-comment">-- OR</span><span>
</span><span id="line-534"></span><span>                </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [WriterT (Set CType) Maybe Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#solveIneq"><span class="hs-identifier hs-var">solveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679238964"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239028"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239049"><span class="hs-identifier hs-var">ineqs</span></a></span><span> </span><span class="annot"><span class="annottext">[WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-535"></span><span>                </span><span class="hs-comment">-- The above, but with valid substitutions applied to the wanted.</span><span>
</span><span id="line-536"></span><span>                </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [WriterT (Set CType) Maybe Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#solveIneq"><span class="hs-identifier hs-var">solveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679238964"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679239044"><span class="hs-identifier hs-var">uS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239049"><span class="hs-identifier hs-var">ineqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>              </span><span id="local-6989586621679239059"><span class="annot"><span class="annottext">smallest :: (Bool, Set CType)
</span><a href="#local-6989586621679239059"><span class="hs-identifier hs-var hs-var">smallest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Bool, Set CType)] -&gt; (Bool, Set CType)
forall a. [(Bool, Set a)] -&gt; (Bool, Set a)
</span><a href="GHC.TypeLits.Normalise.Unify.html#solvedInEqSmallestConstraint"><span class="hs-identifier hs-var">solvedInEqSmallestConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Set CType)]
</span><a href="#local-6989586621679239056"><span class="hs-identifier hs-var">solvedIneq</span></a></span><span>
</span><span id="line-538"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Bool, Set CType)
</span><a href="#local-6989586621679239059"><span class="hs-identifier hs-var">smallest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-539"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span id="local-6989586621679239061"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679239061"><span class="hs-identifier hs-var">kW</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-540"></span><span>              </span><span id="local-6989586621679239062"><span class="annot"><a href="#local-6989586621679239062"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Set CType -&gt; [Type] -&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239027"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679239061"><span class="hs-identifier hs-var">kW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679238962"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679238965"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239032"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>              </span><span class="annot"><a href="#local-6989586621679238980"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239022"><span class="hs-identifier hs-type">subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239062"><span class="hs-identifier hs-type">evs'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239045"><span class="hs-identifier hs-type">leqsG'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239025"><span class="hs-identifier hs-type">xs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239033"><span class="hs-identifier hs-type">eqs'</span></a></span><span>
</span><span id="line-542"></span><span>            </span><span class="annot"><span class="annottext">(Bool, Set CType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679238980"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679239022"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239023"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679239024"><span class="hs-identifier hs-var">leqsG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239026"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
-&gt; [(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679239025"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])]
</span><a href="#local-6989586621679239033"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-543"></span><span>
</span><span id="line-544"></span><span>    </span><span id="local-6989586621679239019"><span class="annot"><span class="annottext">eqToLeq :: a -&gt; a -&gt; [(a, a, Bool)]
</span><a href="#local-6989586621679239019"><span class="hs-identifier hs-var hs-var">eqToLeq</span></a></span></span><span> </span><span id="local-6989586621679239063"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239063"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679239064"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239064"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239063"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239064"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239064"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239063"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-545"></span><span>    </span><span id="local-6989586621679239050"><span class="annot"><span class="annottext">substLeq :: [UnifyItem v c] -&gt; (SOP v c, SOP v c, c) -&gt; (SOP v c, SOP v c, c)
</span><a href="#local-6989586621679239050"><span class="hs-identifier hs-var hs-var">substLeq</span></a></span></span><span> </span><span id="local-6989586621679239076"><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679239076"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239077"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679239077"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239078"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679239078"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239079"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679239079"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679239076"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679239077"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679239076"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679239078"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679239079"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621679238972"><span class="annot"><span class="annottext">isVarEqs :: (Either (a, SOP v c, SOP v c) b, b) -&gt; Bool
</span><a href="#local-6989586621679238972"><span class="hs-identifier hs-var hs-var">isVarEqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-548"></span><span>    </span><span class="annot"><a href="#local-6989586621679238972"><span class="hs-identifier hs-var">isVarEqs</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621679238978"><span class="annot"><span class="annottext">makeGivensSet :: [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679238978"><span class="hs-identifier hs-var hs-var">makeGivensSet</span></a></span></span><span> </span><span id="local-6989586621679239084"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239084"><span class="hs-identifier hs-var">otherEqs</span></a></span></span><span> </span><span id="local-6989586621679239085"><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679239085"><span class="hs-identifier hs-var">varEq</span></a></span></span><span>
</span><span id="line-551"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239087"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239087"><span class="hs-identifier hs-var">noMentionsV</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239088"><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239088"><span class="hs-identifier hs-var">mentionsV</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))]
-&gt; ([(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)],
    [Either
       (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
       (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-552"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
 -&gt; Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)))
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; Either
     (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
     (Either
        (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
        (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))
forall {a} {a} {c} {c} {b} {b} {a} {c} {c} {a} {c} {c} {c} {b}.
Eq a =&gt;
(Either (a, SOP a c, SOP a c) b, b)
-&gt; (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
</span><a href="#local-6989586621679239089"><span class="hs-identifier hs-var">matchesVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679239085"><span class="hs-identifier hs-var">varEq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239084"><span class="hs-identifier hs-var">otherEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679239090"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239090"><span class="hs-identifier hs-var">mentionsLHS</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239091"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239091"><span class="hs-identifier hs-var">mentionsRHS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; ([(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)],
    [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239088"><span class="hs-identifier hs-var">mentionsV</span></a></span><span>
</span><span id="line-554"></span><span>            </span><span id="local-6989586621679239092"><span class="annot"><span class="annottext">vS :: (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679239092"><span class="hs-identifier hs-var hs-var">vS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
forall {a} {v} {c} {v} {c} {b} {b} {c} {c} {b}.
(Either (a, SOP v c, SOP v c) b, b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679239093"><span class="hs-identifier hs-var">swapVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679239085"><span class="hs-identifier hs-var">varEq</span></a></span><span>
</span><span id="line-555"></span><span>            </span><span id="local-6989586621679239094"><span class="annot"><span class="annottext">givensLHS :: [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679239094"><span class="hs-identifier hs-var hs-var">givensLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239090"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span>              </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239090"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679239085"><span class="hs-identifier hs-var">varEq</span></a></span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239091"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239087"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-558"></span><span>            </span><span id="local-6989586621679239095"><span class="annot"><span class="annottext">givensRHS :: [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679239095"><span class="hs-identifier hs-var hs-var">givensRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239091"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-559"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>              </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239091"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
forall {c} {c} {b}. (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679239092"><span class="hs-identifier hs-var">vS</span></a></span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239090"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239087"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239088"><span class="hs-identifier hs-var">mentionsV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-562"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679239087"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-563"></span><span>              </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679239094"><span class="hs-identifier hs-var">givensLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679239095"><span class="hs-identifier hs-var">givensRHS</span></a></span><span>
</span><span id="line-564"></span><span>
</span><span id="line-565"></span><span>    </span><span id="local-6989586621679239089"><span class="annot"><span class="annottext">matchesVarEq :: (Either (a, SOP a c, SOP a c) b, b)
-&gt; (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
</span><a href="#local-6989586621679239089"><span class="hs-identifier hs-var hs-var">matchesVarEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239107"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239107"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239108"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239108"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679239109"><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239110"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239110"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239107"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239110"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239108"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239110"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239111"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239111"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239107"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239111"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239108"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239111"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239112"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239112"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239107"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239112"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239108"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239112"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239113"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239113"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239107"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239113"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239108"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239113"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>      </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679239109"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><a href="#local-6989586621679239089"><span class="hs-identifier hs-var">matchesVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a. HasCallStack =&gt; CommandLineOption -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621679239093"><span class="annot"><span class="annottext">swapVar :: (Either (a, SOP v c, SOP v c) b, b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679239093"><span class="hs-identifier hs-var hs-var">swapVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239117"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239117"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239118"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679239118"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679239119"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679239119"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679239120"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679239120"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, SOP v c, SOP v c) -&gt; Either (a, SOP v c, SOP v c) b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679239117"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v -&gt; Symbol v c
forall v c. v -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-var">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679239119"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v -&gt; Symbol v c
forall v c. v -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-var">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679239118"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679239120"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>    </span><span class="annot"><a href="#local-6989586621679239093"><span class="hs-identifier hs-var">swapVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CommandLineOption -&gt; (Either (a, SOP v c, SOP v c) b, b)
forall a. HasCallStack =&gt; CommandLineOption -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621679238985"><span class="annot"><span class="annottext">findFirstSimpliedWanted :: SimplifyResult -&gt; SimplifyResult -&gt; SimplifyResult
</span><a href="#local-6989586621679238985"><span class="hs-identifier hs-var hs-var">findFirstSimpliedWanted</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679239122"><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679239122"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">SimplifyResult
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Ct, CoreSOP, CoreSOP) NatInEquality
</span><a href="#local-6989586621679239122"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-586"></span><span>    </span><span class="annot"><a href="#local-6989586621679238985"><span class="hs-identifier hs-var">findFirstSimpliedWanted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679239123"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239123"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679239124"><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679239124"><span class="hs-identifier hs-var">s2</span></a></span></span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(((EvTerm, Ct), [Ct]) -&gt; Bool) -&gt; [((EvTerm, Ct), [Ct])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><span class="hs-identifier hs-var">isWantedCt</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Ct) -&gt; ((EvTerm, Ct), [Ct]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EvTerm, Ct) -&gt; Ct
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((EvTerm, Ct) -&gt; Ct)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; (EvTerm, Ct))
-&gt; ((EvTerm, Ct), [Ct])
-&gt; Ct
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; (EvTerm, Ct)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239123"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-588"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679239123"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-589"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-590"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679239124"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">-- If we allow negated numbers we simply do not emit the inequalities</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- derived from the subtractions that are converted to additions with a</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- negated operand</span><span>
</span><span id="line-595"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-type">subToPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span>
</span><span id="line-596"></span><span id="subToPred"><span class="annot"><span class="annottext">subToPred :: Opts -&gt; TyCon -&gt; [(Type, Type)] -&gt; [Type]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var hs-var">subToPred</span></a></span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span class="hs-special">{</span><span id="local-6989586621679239126"><span id="local-6989586621679239127"><span class="annot"><span class="annottext">Bool
Word
negNumbers :: Opts -&gt; Bool
depth :: Opts -&gt; Word
negNumbers :: Bool
depth :: Word
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679239128"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239128"><span class="hs-identifier hs-var">leqT</span></a></span></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679239126"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [(Type, Type)] -&gt; [Type]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Type, Type) -&gt; Type) -&gt; [(Type, Type)] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; Type
</span><a href="#local-6989586621679239129"><span class="hs-identifier hs-var">leq</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-600"></span><span>    </span><span id="local-6989586621679239129"><span class="annot"><span class="annottext">leq :: (Type, Type) -&gt; Type
</span><a href="#local-6989586621679239129"><span class="hs-identifier hs-var hs-var">leq</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239130"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239130"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239131"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239131"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239132"><span class="annot"><span class="annottext">lhs :: Type
</span><a href="#local-6989586621679239132"><span class="hs-identifier hs-var hs-var">lhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">TyConApp</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239128"><span class="hs-identifier hs-var">leqT</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">naturalTy</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239131"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239130"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-602"></span><span>          </span><span id="local-6989586621679239134"><span class="annot"><span class="annottext">rhs :: Type
</span><a href="#local-6989586621679239134"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">TyConApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><span class="hs-identifier hs-var">cTupleTyCon</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">mkPrimEqPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239132"><span class="hs-identifier hs-var">lhs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239134"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="hs-comment">-- Extract the Nat equality constraints</span><span>
</span><span id="line-606"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-type">toNatEquality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">TyCon</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span id="toNatEquality"><span class="annot"><span class="annottext">toNatEquality :: (TyCon, TyCon, TyCon)
-&gt; Ct
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var hs-var">toNatEquality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679239135"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239135"><span class="hs-identifier hs-var">assertT</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239136"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239136"><span class="hs-identifier hs-var">ordCond</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679239137"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Pred
</span><span class="hs-identifier hs-var">classifyPredType</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Pred) -&gt; Type -&gt; Pred
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Type
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Type) -&gt; CtEvidence -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-608"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">EqPred</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><span class="hs-identifier hs-var">NomEq</span></span><span> </span><span id="local-6989586621679239138"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239138"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679239139"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239139"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-609"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Type
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239140"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239138"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239139"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IrredPred</span></span><span> </span><span id="local-6989586621679239141"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239141"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-611"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall {a}. Type -&gt; Maybe (Either a NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239142"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239141"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-614"></span><span>    </span><span id="local-6989586621679239140"><span class="annot"><span class="annottext">go :: Type
-&gt; Type
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239140"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239165"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239165"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679239166"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239166"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239167"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span></span><span> </span><span id="local-6989586621679239168"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239168"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-615"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239165"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span>
</span><span id="line-616"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239165"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; [TyCon] -&gt; [TyCon]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatAddTyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatSubTyCon</span></span><span>
</span><span id="line-617"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatMulTyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatExpTyCon</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((Type, Type) -&gt; Bool) -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ((Type, Type) -&gt; Bool) -&gt; (Type, Type) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Bool) -&gt; (Type, Type) -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-identifier hs-var">eqType</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [(Type, Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239166"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239168"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-619"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679239170"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239170"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239171"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239171"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-620"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621679239172"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239170"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621679239172"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239171"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239173"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239173"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239174"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239174"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239170"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239176"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239176"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239177"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239177"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239171"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct, CoreSOP, CoreSOP)
-&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239173"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239176"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239174"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239177"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-625"></span><span>          </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-626"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239165"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239136"><span class="hs-identifier hs-var">ordCond</span></a></span><span>
</span><span id="line-627"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679239178"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239178"><span class="hs-identifier hs-var">cmp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239179"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239179"><span class="hs-identifier hs-var">lt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239180"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239180"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239181"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239181"><span class="hs-identifier hs-var">gt</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239166"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-628"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239182"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239182"><span class="hs-identifier hs-var">tcCmpNat</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679239183"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239183"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239184"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239184"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239178"><span class="hs-identifier hs-var">cmp</span></a></span><span>
</span><span id="line-629"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239182"><span class="hs-identifier hs-var">tcCmpNat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatCmpTyCon</span></span><span>
</span><span id="line-630"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239185"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239185"><span class="hs-identifier hs-var">ltTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239179"><span class="hs-identifier hs-var">lt</span></a></span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239185"><span class="hs-identifier hs-var">ltTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-632"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239186"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239186"><span class="hs-identifier hs-var">eqTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239180"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239186"><span class="hs-identifier hs-var">eqTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239187"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239187"><span class="hs-identifier hs-var">gtTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239181"><span class="hs-identifier hs-var">gt</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239187"><span class="hs-identifier hs-var">gtTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedFalseDataCon</span></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239188"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239188"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239189"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239189"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239183"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239190"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239190"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239191"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239191"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239184"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239192"><span class="annot"><span class="annottext">ks :: [(Type, Type)]
</span><a href="#local-6989586621679239192"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239189"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239191"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-640"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-641"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239188"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239190"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239192"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-642"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedFalseDataCon</span></span><span>
</span><span id="line-643"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239188"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239190"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239192"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239165"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239135"><span class="hs-identifier hs-var">assertT</span></a></span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239167"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><span class="hs-identifier hs-var">cTupleTyCon</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239168"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239193"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239193"><span class="hs-identifier hs-var">ordCondTc</span></a></span></span><span> </span><span id="local-6989586621679239194"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239194"><span class="hs-identifier hs-var">zs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239166"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239193"><span class="hs-identifier hs-var">ordCondTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239136"><span class="hs-identifier hs-var">ordCond</span></a></span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679239195"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239195"><span class="hs-identifier hs-var">cmp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239196"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239196"><span class="hs-identifier hs-var">lt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239197"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239197"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239198"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239198"><span class="hs-identifier hs-var">gt</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239194"><span class="hs-identifier hs-var">zs</span></a></span><span>
</span><span id="line-651"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239199"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239199"><span class="hs-identifier hs-var">tcCmpNat</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679239200"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239200"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239201"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239201"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239195"><span class="hs-identifier hs-var">cmp</span></a></span><span>
</span><span id="line-652"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239199"><span class="hs-identifier hs-var">tcCmpNat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatCmpTyCon</span></span><span>
</span><span id="line-653"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239202"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239202"><span class="hs-identifier hs-var">ltTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239196"><span class="hs-identifier hs-var">lt</span></a></span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239202"><span class="hs-identifier hs-var">ltTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-655"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239203"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239203"><span class="hs-identifier hs-var">eqTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239197"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-656"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239203"><span class="hs-identifier hs-var">eqTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-657"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239204"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239204"><span class="hs-identifier hs-var">gtTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239198"><span class="hs-identifier hs-var">gt</span></a></span><span>
</span><span id="line-658"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239204"><span class="hs-identifier hs-var">gtTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedFalseDataCon</span></span><span>
</span><span id="line-659"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239205"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239205"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239206"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239206"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239200"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239207"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239207"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239208"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239208"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239201"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239209"><span class="annot"><span class="annottext">ks :: [(Type, Type)]
</span><a href="#local-6989586621679239209"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239206"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239208"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239205"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239207"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239209"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span>    </span><span class="annot"><a href="#local-6989586621679239140"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679239210"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239210"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679239211"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239211"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621679239172"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239210"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621679239172"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239211"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239212"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239212"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239213"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239213"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239210"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239214"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239214"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239215"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239215"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239211"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
-&gt; Maybe
     (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct, CoreSOP, CoreSOP)
-&gt; Either (Ct, CoreSOP, CoreSOP) NatInEquality
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239212"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239214"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239213"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239215"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Either (Ct, CoreSOP, CoreSOP) NatInEquality, [(Type, Type)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>    </span><span id="local-6989586621679239142"><span class="annot"><span class="annottext">go2 :: Type -&gt; Maybe (Either a NatInEquality, [(Type, Type)])
</span><a href="#local-6989586621679239142"><span class="hs-identifier hs-var hs-var">go2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239222"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239222"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679239223"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239223"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239222"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239135"><span class="hs-identifier hs-var">assertT</span></a></span><span>
</span><span id="line-675"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239224"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239224"><span class="hs-identifier hs-var">ordCondTc</span></a></span></span><span> </span><span id="local-6989586621679239225"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239225"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239223"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-676"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239224"><span class="hs-identifier hs-var">ordCondTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239136"><span class="hs-identifier hs-var">ordCond</span></a></span><span>
</span><span id="line-677"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679239226"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239226"><span class="hs-identifier hs-var">cmp</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239227"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239227"><span class="hs-identifier hs-var">lt</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239228"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239228"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239229"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239229"><span class="hs-identifier hs-var">gt</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239225"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-678"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239230"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239230"><span class="hs-identifier hs-var">tcCmpNat</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679239231"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239231"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239232"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239232"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239226"><span class="hs-identifier hs-var">cmp</span></a></span><span>
</span><span id="line-679"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239230"><span class="hs-identifier hs-var">tcCmpNat</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatCmpTyCon</span></span><span>
</span><span id="line-680"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239233"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239233"><span class="hs-identifier hs-var">ltTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239227"><span class="hs-identifier hs-var">lt</span></a></span><span>
</span><span id="line-681"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239233"><span class="hs-identifier hs-var">ltTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239234"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239234"><span class="hs-identifier hs-var">eqTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239228"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239234"><span class="hs-identifier hs-var">eqTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679239235"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239235"><span class="hs-identifier hs-var">gtTc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239229"><span class="hs-identifier hs-var">gt</span></a></span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679239235"><span class="hs-identifier hs-var">gtTc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedFalseDataCon</span></span><span>
</span><span id="line-686"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239236"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239236"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239237"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239237"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239231"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679239238"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239238"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679239239"><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239239"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(Type, Type)] CoreSOP -&gt; (CoreSOP, [(Type, Type)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Writer [(Type, Type)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239232"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239240"><span class="annot"><span class="annottext">ks :: [(Type, Type)]
</span><a href="#local-6989586621679239240"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239237"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; [(Type, Type)] -&gt; [(Type, Type)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239239"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-689"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either a NatInEquality, [(Type, Type)])
-&gt; Maybe (Either a NatInEquality, [(Type, Type)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either a NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239137"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239236"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239238"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621679239240"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>    </span><span class="annot"><a href="#local-6989586621679239142"><span class="hs-identifier hs-var">go2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Either a NatInEquality, [(Type, Type)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>    </span><span class="annot"><a href="#local-6989586621679239172"><span class="hs-identifier hs-type">isNatKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679239172"><span class="annot"><span class="annottext">isNatKind :: Type -&gt; Bool
</span><a href="#local-6989586621679239172"><span class="hs-identifier hs-var hs-var">isNatKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier hs-var">naturalTy</span></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-type">unifyItemToPredType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreUnify"><span class="hs-identifier hs-type">CoreUnify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span>
</span><span id="line-697"></span><span id="unifyItemToPredType"><span class="annot"><span class="annottext">unifyItemToPredType :: CoreUnify -&gt; Type
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-var hs-var">unifyItemToPredType</span></a></span></span><span> </span><span id="local-6989586621679239241"><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679239241"><span class="hs-identifier hs-var">ui</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">mkPrimEqPred</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239242"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239243"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-699"></span><span>    </span><span id="local-6989586621679239242"><span class="annot"><span class="annottext">ty1 :: Type
</span><a href="#local-6989586621679239242"><span class="hs-identifier hs-var hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679239241"><span class="hs-identifier hs-var">ui</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-700"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#SubstItem"><span class="hs-identifier hs-type">SubstItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679239245"><span id="local-6989586621679239246"><span class="annot"><span class="annottext">TyVar
CoreSOP
siVar :: TyVar
siSOP :: CoreSOP
siSOP :: forall v c. UnifyItem v c -&gt; SOP v c
siVar :: forall v c. UnifyItem v c -&gt; v
</span><a href="#local-6989586621679239245"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><span class="hs-identifier hs-var">mkTyVarTy</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621679239245"><span class="hs-identifier hs-var">siVar</span></a></span><span>
</span><span id="line-701"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#UnifyItem"><span class="hs-identifier hs-type">UnifyItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679239250"><span id="local-6989586621679239251"><span class="annot"><span class="annottext">CoreSOP
siLHS :: CoreSOP
siRHS :: CoreSOP
siRHS :: forall v c. UnifyItem v c -&gt; SOP v c
siLHS :: forall v c. UnifyItem v c -&gt; SOP v c
</span><a href="#local-6989586621679239250"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; Type
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239250"><span class="hs-identifier hs-var">siLHS</span></a></span><span>
</span><span id="line-702"></span><span>    </span><span id="local-6989586621679239243"><span class="annot"><span class="annottext">ty2 :: Type
</span><a href="#local-6989586621679239243"><span class="hs-identifier hs-var hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679239241"><span class="hs-identifier hs-var">ui</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-703"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#SubstItem"><span class="hs-identifier hs-type">SubstItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679239255"><span id="local-6989586621679239256"><span class="annot"><span class="annottext">TyVar
CoreSOP
siSOP :: forall v c. UnifyItem v c -&gt; SOP v c
siVar :: forall v c. UnifyItem v c -&gt; v
siVar :: TyVar
siSOP :: CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#siSOP"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; Type
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239256"><span class="hs-identifier hs-var">siSOP</span></a></span><span>
</span><span id="line-704"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#UnifyItem"><span class="hs-identifier hs-type">UnifyItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679239257"><span id="local-6989586621679239258"><span class="annot"><span class="annottext">CoreSOP
siRHS :: forall v c. UnifyItem v c -&gt; SOP v c
siLHS :: forall v c. UnifyItem v c -&gt; SOP v c
siLHS :: CoreSOP
siRHS :: CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#siRHS"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; Type
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679239258"><span class="hs-identifier hs-var">siRHS</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-type">evSubtPreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-707"></span><span id="evSubtPreds"><span class="annot"><span class="annottext">evSubtPreds :: CtLoc -&gt; [Type] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var hs-var">evSubtPreds</span></a></span></span><span> </span><span id="local-6989586621679239259"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239259"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcPluginM Ct) -&gt; [Type] -&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall a b. (a -&gt; b) -&gt; TcPluginM a -&gt; TcPluginM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">mkNonCanonical</span></span><span> </span><span class="annot"><span class="annottext">(TcPluginM CtEvidence -&gt; TcPluginM Ct)
-&gt; (Type -&gt; TcPluginM CtEvidence) -&gt; Type -&gt; TcPluginM Ct
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; Type -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newWanted</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239259"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-type">evMagic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span id="evMagic"><span class="annot"><span class="annottext">evMagic :: Ct -&gt; Set CType -&gt; [Type] -&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var hs-var">evMagic</span></a></span></span><span> </span><span id="local-6989586621679239260"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239260"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621679239261"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679239261"><span class="hs-identifier hs-var">knW</span></a></span></span><span> </span><span id="local-6989586621679239262"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239262"><span class="hs-identifier hs-var">preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>  </span><span id="local-6989586621679239263"><span class="annot"><a href="#local-6989586621679239263"><span class="hs-identifier hs-var">holeWanteds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; [Type] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var">evSubtPreds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239260"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679239262"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-712"></span><span>  </span><span id="local-6989586621679239264"><span class="annot"><a href="#local-6989586621679239264"><span class="hs-identifier hs-var">knWanted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-type">mkKnWanted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ctLoc</span></span><span> </span><span class="annot"><a href="#local-6989586621679239260"><span class="hs-identifier hs-type">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">toList</span></span><span> </span><span class="annot"><a href="#local-6989586621679239261"><span class="hs-identifier hs-type">knW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239266"><span class="annot"><a href="#local-6989586621679239266"><span class="hs-identifier hs-var hs-var">newWant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679239264"><span class="hs-identifier hs-var">knWanted</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679239263"><span class="hs-identifier hs-var">holeWanteds</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="hs-identifier hs-type">classifyPredType</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ctEvPred</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ctEvidence</span></span><span> </span><span class="annot"><a href="#local-6989586621679239260"><span class="hs-identifier hs-type">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-715"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">EqPred</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><span class="hs-identifier hs-var">NomEq</span></span><span> </span><span id="local-6989586621679239267"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239267"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679239268"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239268"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-716"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239269"><span class="annot"><span class="annottext">ctEv :: Coercion
</span><a href="#local-6989586621679239269"><span class="hs-identifier hs-var hs-var">ctEv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Nominal</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239267"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239268"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; Maybe ((EvTerm, Ct), [Ct])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><span class="hs-identifier hs-var">EvExpr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; EvExpr
forall b. Coercion -&gt; Expr b
</span><span class="hs-identifier hs-var">Coercion</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679239269"><span class="hs-identifier hs-var">ctEv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239260"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679239266"><span class="hs-identifier hs-var">newWant</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">IrredPred</span></span><span> </span><span id="local-6989586621679239273"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239273"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-719"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239274"><span class="annot"><span class="annottext">t1 :: Type
</span><a href="#local-6989586621679239274"><span class="hs-identifier hs-var hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">mkTyConApp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TyCon
</span><span class="hs-identifier hs-var">cTupleTyCon</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-720"></span><span>          </span><span id="local-6989586621679239275"><span class="annot"><span class="annottext">co :: Coercion
</span><a href="#local-6989586621679239275"><span class="hs-identifier hs-var hs-var">co</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; Type -&gt; Type -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommandLineOption -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">CommandLineOption
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Representational</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239274"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239273"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-721"></span><span>          </span><span id="local-6989586621679239276"><span class="annot"><span class="annottext">dcApp :: EvExpr
</span><a href="#local-6989586621679239276"><span class="hs-identifier hs-var hs-var">dcApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; EvExpr
</span><span class="hs-identifier hs-var">evId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyVar
</span><span class="hs-identifier hs-var">dataConWrapId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; DataCon
</span><span class="hs-identifier hs-var">cTupleDataCon</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; Maybe ((EvTerm, Ct), [Ct])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; Coercion -&gt; EvTerm
</span><span class="hs-identifier hs-var">evCast</span></span><span> </span><span class="annot"><span class="annottext">EvExpr
</span><a href="#local-6989586621679239276"><span class="hs-identifier hs-var">dcApp</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679239275"><span class="hs-identifier hs-var">co</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679239260"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679239266"><span class="hs-identifier hs-var">newWant</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
forall a. a -&gt; TcPluginM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-724"></span><span>
</span><span id="line-725"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-type">mkNonCanonical'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtEvidence</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-726"></span><span id="mkNonCanonical%27"><span class="annot"><span class="annottext">mkNonCanonical' :: CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var hs-var">mkNonCanonical'</span></a></span></span><span> </span><span id="local-6989586621679239277"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239277"><span class="hs-identifier hs-var">origCtl</span></a></span></span><span> </span><span id="local-6989586621679239278"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679239278"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-727"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239279"><span class="annot"><span class="annottext">ct_ls :: RealSrcSpan
</span><a href="#local-6989586621679239279"><span class="hs-identifier hs-var hs-var">ct_ls</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan
</span><span class="hs-identifier hs-var">ctLocSpan</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239277"><span class="hs-identifier hs-var">origCtl</span></a></span><span>
</span><span id="line-728"></span><span>      </span><span id="local-6989586621679239280"><span class="annot"><span class="annottext">ctl :: CtLoc
</span><a href="#local-6989586621679239280"><span class="hs-identifier hs-var hs-var">ctl</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctEvLoc</span></span><span>  </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679239278"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">mkNonCanonical</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc -&gt; CtEvidence
</span><span class="hs-identifier hs-var">setCtEvLoc</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679239278"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan -&gt; CtLoc
</span><span class="hs-identifier hs-var">setCtLocSpan</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239280"><span class="hs-identifier hs-var">ctl</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621679239279"><span class="hs-identifier hs-var">ct_ls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-type">mkKnWanted</span></a></span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span>
</span><span id="line-734"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-735"></span><span id="mkKnWanted"><span class="annot"><span class="annottext">mkKnWanted :: CtLoc -&gt; CType -&gt; TcPluginM Ct
</span><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-var hs-var">mkKnWanted</span></a></span></span><span> </span><span id="local-6989586621679239281"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239281"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span id="local-6989586621679239282"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239282"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-736"></span><span>  </span><span id="local-6989586621679239283"><span class="annot"><a href="#local-6989586621679239283"><span class="hs-identifier hs-var">kc_clas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcPluginM Class
</span><span class="hs-identifier hs-var">tcLookupClass</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier hs-var">knownNatClassName</span></span><span>
</span><span id="line-737"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239284"><span class="annot"><a href="#local-6989586621679239284"><span class="hs-identifier hs-var hs-var">kn_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><span class="hs-identifier hs-var">mkClassPred</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679239283"><span class="hs-identifier hs-var">kc_clas</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679239282"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-738"></span><span>  </span><span id="local-6989586621679239285"><span class="annot"><a href="#local-6989586621679239285"><span class="hs-identifier hs-var">wantedCtEv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newWanted</span></span><span> </span><span class="annot"><a href="#local-6989586621679239281"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679239284"><span class="hs-identifier hs-type">kn_pred</span></a></span><span>
</span><span id="line-739"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679239286"><span class="annot"><a href="#local-6989586621679239286"><span class="hs-identifier hs-var hs-var">wanted'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679239281"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679239285"><span class="hs-identifier hs-var">wantedCtEv</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679239286"><span class="hs-identifier hs-type">wanted'</span></a></span><span>
</span><span id="line-741"></span></pre></body></html>