<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{-|
Copyright  :  (C) 2015-2016, University of Twente,
                  2017     , QBayLogic B.V.
License    :  BSD2 (see the file LICENSE)
Maintainer :  Christiaan Baaij &lt;christiaan.baaij@gmail.com&gt;

= SOP: Sum-of-Products, sorta

The arithmetic operation for 'GHC.TypeLits.Nat' are, addition
(@'GHC.TypeLits.+'@), subtraction (@'GHC.TypeLits.-'@), multiplication
(@'GHC.TypeLits.*'@), and exponentiation (@'GHC.TypeLits.^'@). This means we
cannot write expressions in a canonical SOP normal form. We can get rid of
subtraction by working with integers, and translating @a - b@ to @a + (-1)*b@.
Exponentation cannot be getten rid of that way. So we define the following
grammar for our canonical SOP-like normal form of arithmetic expressions:

@
SOP      ::= Product \'+\' SOP | Product
Product  ::= Symbol \'*\' Product | Symbol
Symbol   ::= Integer
          |  Var
          |  Var \'^\' Product
          |  SOP \'^\' ProductE

ProductE ::= SymbolE \'*\' ProductE | SymbolE
SymbolE  ::= Var
          |  Var \'^\' Product
          |  SOP \'^\' ProductE
@

So a valid SOP terms are:

@
x*y + y^2
(x+y)^(k*z)
@

, but,

@
(x*y)^2
@

is not, and should be:

@
x^2 * y^2
@

Exponents are thus not allowed to have products, so for example, the expression:

@
(x + 2)^(y + 2)
@

in valid SOP form is:

@
4*x*(2 + x)^y + 4*(2 + x)^y + (2 + x)^y*x^2
@

Also, exponents can only be integer values when the base is a variable. Although
not enforced by the grammar, the exponentials are flatted as far as possible in
SOP form. So:

@
(x^y)^z
@

is flattened to:

@
x^(y*z)
@
-}</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html"><span class="hs-identifier">GHC.TypeLits.Normalise.SOP</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * SOP types</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier">Symbol</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier">Product</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier">SOP</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-comment">-- * Simplification</span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier">reduceExp</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier">mergeS</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier">mergeP</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPAdd"><span class="hs-identifier">mergeSOPAdd</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-identifier">mergeSOPMul</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier">normaliseExp</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-identifier">simplifySOP</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-comment">-- External</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sort</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-comment">-- GHC API</span><span class="hs-cpp">
#if MIN_VERSION_ghc(9,0,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Utils.Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hcat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">punctuate</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;+&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hcat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">punctuate</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="Symbol"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-var">Symbol</span></a></span></span><span> </span><span id="local-6989586621679236446"><span class="annot"><a href="#local-6989586621679236446"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679236447"><span class="annot"><a href="#local-6989586621679236447"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="I"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>                 </span><span class="hs-comment">-- ^ Integer constant</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="C"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#C"><span class="hs-identifier hs-var">C</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679236447"><span class="hs-identifier hs-type">c</span></a></span><span>                       </span><span class="hs-comment">-- ^ Non-integer constant</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="E"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236446"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236447"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236446"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236447"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Exponentiation</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="V"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-var">V</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679236446"><span class="hs-identifier hs-type">v</span></a></span><span>                       </span><span class="hs-comment">-- ^ Variable</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679236512"><span id="local-6989586621679236525"><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Bool
(Symbol v c -&gt; Symbol v c -&gt; Bool)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Bool) -&gt; Eq (Symbol v c)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v c. (Eq c, Eq v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
$c== :: forall v c. (Eq c, Eq v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
== :: Symbol v c -&gt; Symbol v c -&gt; Bool
$c/= :: forall v c. (Eq c, Eq v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
/= :: Symbol v c -&gt; Symbol v c -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span id="local-6989586621679236536"><span id="local-6989586621679236546"><span id="local-6989586621679236550"><span id="local-6989586621679236553"><span id="local-6989586621679236556"><span id="local-6989586621679236559"><span id="local-6989586621679236562"><span class="annot"><span class="annottext">Eq (Symbol v c)
Eq (Symbol v c) =&gt;
(Symbol v c -&gt; Symbol v c -&gt; Ordering)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Bool)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Bool)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Bool)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Bool)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Symbol v c)
-&gt; (Symbol v c -&gt; Symbol v c -&gt; Symbol v c)
-&gt; Ord (Symbol v c)
Symbol v c -&gt; Symbol v c -&gt; Bool
Symbol v c -&gt; Symbol v c -&gt; Ordering
Symbol v c -&gt; Symbol v c -&gt; Symbol v c
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v c. (Ord c, Ord v) =&gt; Eq (Symbol v c)
forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Ordering
forall v c.
(Ord c, Ord v) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Symbol v c
$ccompare :: forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Ordering
compare :: Symbol v c -&gt; Symbol v c -&gt; Ordering
$c&lt; :: forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
&lt; :: Symbol v c -&gt; Symbol v c -&gt; Bool
$c&lt;= :: forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
&lt;= :: Symbol v c -&gt; Symbol v c -&gt; Bool
$c&gt; :: forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
&gt; :: Symbol v c -&gt; Symbol v c -&gt; Bool
$c&gt;= :: forall v c. (Ord c, Ord v) =&gt; Symbol v c -&gt; Symbol v c -&gt; Bool
&gt;= :: Symbol v c -&gt; Symbol v c -&gt; Bool
$cmax :: forall v c.
(Ord c, Ord v) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Symbol v c
max :: Symbol v c -&gt; Symbol v c -&gt; Symbol v c
$cmin :: forall v c.
(Ord c, Ord v) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Symbol v c
min :: Symbol v c -&gt; Symbol v c -&gt; Symbol v c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">newtype</span><span> </span><span id="Product"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-var">Product</span></a></span></span><span> </span><span id="local-6989586621679236385"><span class="annot"><a href="#local-6989586621679236385"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679236386"><span class="annot"><a href="#local-6989586621679236386"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="P"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unP"><span class="annot"><span class="annottext">forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var hs-var">unP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236385"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236386"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679236572"><span id="local-6989586621679236578"><span class="annot"><span class="annottext">Product v c -&gt; Product v c -&gt; Bool
(Product v c -&gt; Product v c -&gt; Bool)
-&gt; (Product v c -&gt; Product v c -&gt; Bool) -&gt; Eq (Product v c)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall v c. (Eq c, Eq v) =&gt; Product v c -&gt; Product v c -&gt; Bool
$c== :: forall v c. (Eq c, Eq v) =&gt; Product v c -&gt; Product v c -&gt; Bool
== :: Product v c -&gt; Product v c -&gt; Bool
$c/= :: forall v c. (Eq c, Eq v) =&gt; Product v c -&gt; Product v c -&gt; Bool
/= :: Product v c -&gt; Product v c -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679236379"><span id="local-6989586621679236380"><span id="local-6989586621679236591"><span id="local-6989586621679236594"><span id="local-6989586621679236597"><span id="local-6989586621679236600"><span id="local-6989586621679236603"><span id="local-6989586621679236606"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236379"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236380"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236379"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236380"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-117"></span><span>  </span><span id="local-6989586621679236611"><span class="annot"><span class="annottext">compare :: Product v c -&gt; Product v c -&gt; Ordering
</span><span class="hs-identifier hs-var hs-var hs-var">compare</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236612"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236612"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236613"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236613"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236612"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236613"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Symbol v c]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Symbol v c]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236614"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236614"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236615"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236615"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236614"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236615"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">newtype</span><span> </span><span id="SOP"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-var">SOP</span></a></span></span><span> </span><span id="local-6989586621679236398"><span class="annot"><a href="#local-6989586621679236398"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679236399"><span class="annot"><a href="#local-6989586621679236399"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="S"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unS"><span class="annot"><span class="annottext">forall v c. SOP v c -&gt; [Product v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unS"><span class="hs-identifier hs-var hs-var">unS</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236398"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236399"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679236625"><span id="local-6989586621679236630"><span id="local-6989586621679236635"><span id="local-6989586621679236640"><span id="local-6989586621679236645"><span id="local-6989586621679236650"><span id="local-6989586621679236655"><span class="annot"><span class="annottext">Eq (SOP v c)
Eq (SOP v c) =&gt;
(SOP v c -&gt; SOP v c -&gt; Ordering)
-&gt; (SOP v c -&gt; SOP v c -&gt; Bool)
-&gt; (SOP v c -&gt; SOP v c -&gt; Bool)
-&gt; (SOP v c -&gt; SOP v c -&gt; Bool)
-&gt; (SOP v c -&gt; SOP v c -&gt; Bool)
-&gt; (SOP v c -&gt; SOP v c -&gt; SOP v c)
-&gt; (SOP v c -&gt; SOP v c -&gt; SOP v c)
-&gt; Ord (SOP v c)
SOP v c -&gt; SOP v c -&gt; Bool
SOP v c -&gt; SOP v c -&gt; Ordering
SOP v c -&gt; SOP v c -&gt; SOP v c
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall v c. (Ord v, Ord c) =&gt; Eq (SOP v c)
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Bool
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Ordering
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
$ccompare :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Ordering
compare :: SOP v c -&gt; SOP v c -&gt; Ordering
$c&lt; :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Bool
&lt; :: SOP v c -&gt; SOP v c -&gt; Bool
$c&lt;= :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Bool
&lt;= :: SOP v c -&gt; SOP v c -&gt; Bool
$c&gt; :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Bool
&gt; :: SOP v c -&gt; SOP v c -&gt; Bool
$c&gt;= :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; Bool
&gt;= :: SOP v c -&gt; SOP v c -&gt; Bool
$cmax :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
max :: SOP v c -&gt; SOP v c -&gt; SOP v c
$cmin :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
min :: SOP v c -&gt; SOP v c -&gt; SOP v c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679236368"><span id="local-6989586621679236369"><span id="local-6989586621679236668"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679236368"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679236369"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236368"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236369"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236677"><span class="annot"><span class="annottext">== :: SOP v c -&gt; SOP v c -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var">==</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236678"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236678"><span class="hs-identifier hs-var">ps1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236679"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236679"><span class="hs-identifier hs-var">ps2</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236678"><span class="hs-identifier hs-var">ps1</span></a></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; [Product v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236679"><span class="hs-identifier hs-var">ps2</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679236412"><span id="local-6989586621679236413"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236412"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236413"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236412"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236413"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679236691"><span class="annot"><span class="annottext">ppr :: SOP v c -&gt; SDoc
</span><a href="#local-6989586621679236691"><span class="hs-identifier hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><span class="hs-identifier hs-var">hcat</span></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; (SOP v c -&gt; [SDoc]) -&gt; SOP v c -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; + &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; (SOP v c -&gt; [SDoc]) -&gt; SOP v c -&gt; [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; SDoc) -&gt; [Product v c] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">([Product v c] -&gt; [SDoc])
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; [Product v c]
forall v c. SOP v c -&gt; [Product v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unS"><span class="hs-identifier hs-var">unS</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679236415"><span id="local-6989586621679236416"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236415"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236416"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236415"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236416"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621679236702"><span class="annot"><span class="annottext">ppr :: Product v c -&gt; SDoc
</span><span class="hs-identifier hs-var hs-var hs-var">ppr</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
forall doc. IsLine doc =&gt; [doc] -&gt; doc
</span><span class="hs-identifier hs-var">hcat</span></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; (Product v c -&gt; [SDoc]) -&gt; Product v c -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall doc. IsLine doc =&gt; doc -&gt; [doc] -&gt; [doc]
</span><span class="hs-identifier hs-var">punctuate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; * &quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc])
-&gt; (Product v c -&gt; [SDoc]) -&gt; Product v c -&gt; [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Symbol v c -&gt; SDoc) -&gt; [Symbol v c] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; [SDoc])
-&gt; (Product v c -&gt; [Symbol v c]) -&gt; Product v c -&gt; [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679236426"><span id="local-6989586621679236427"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236426"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="#local-6989586621679236427"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236426"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236427"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679236716"><span class="annot"><span class="annottext">ppr :: Symbol v c -&gt; SDoc
</span><span class="hs-identifier hs-var hs-var hs-var">ppr</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236717"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236717"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SDoc
forall doc. IsLine doc =&gt; Integer -&gt; doc
</span><span class="hs-identifier hs-var">integer</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236717"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#C"><span class="hs-identifier hs-type">C</span></a></span><span> </span><span id="local-6989586621679236718"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679236718"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679236718"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679236719"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679236719"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679236719"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236720"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236720"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679236721"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236721"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; SDoc
forall v c. (Outputable v, Outputable c) =&gt; SOP v c -&gt; SDoc
</span><a href="#local-6989586621679236722"><span class="hs-identifier hs-var">pprSimple</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236720"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SDoc
forall v c. (Outputable v, Outputable c) =&gt; SOP v c -&gt; SDoc
</span><a href="#local-6989586621679236722"><span class="hs-identifier hs-var">pprSimple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236721"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-141"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679236723"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621679236723"><span class="hs-identifier hs-var">bS</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679236724"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621679236724"><span class="hs-identifier hs-var">eS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621679236723"><span class="hs-identifier hs-var">bS</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;^&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621679236724"><span class="hs-identifier hs-var">eS</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-143"></span><span>      </span><span id="local-6989586621679236722"><span class="annot"><span class="annottext">pprSimple :: SOP a c -&gt; SDoc
</span><a href="#local-6989586621679236722"><span class="hs-identifier hs-var hs-var">pprSimple</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236735"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236735"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SDoc
forall doc. IsLine doc =&gt; Integer -&gt; doc
</span><span class="hs-identifier hs-var">integer</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236735"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><a href="#local-6989586621679236722"><span class="hs-identifier hs-var">pprSimple</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679236736"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679236736"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679236736"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><a href="#local-6989586621679236722"><span class="hs-identifier hs-var">pprSimple</span></a></span><span> </span><span id="local-6989586621679236737"><span class="annot"><span class="annottext">SOP a c
</span><a href="#local-6989586621679236737"><span class="hs-identifier hs-var">sop</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">SOP a c -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">SOP a c
</span><a href="#local-6989586621679236737"><span class="hs-identifier hs-var">sop</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
forall doc. IsLine doc =&gt; doc -&gt; doc -&gt; doc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall doc. IsLine doc =&gt; String -&gt; doc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="local-6989586621679236433"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-type">mergeWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679236433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-148"></span><span id="mergeWith"><span class="annot"><span class="annottext">mergeWith :: forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var hs-var">mergeWith</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Either a a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span id="local-6989586621679236739"><span class="annot"><span class="annottext">a -&gt; a -&gt; Either a a
</span><a href="#local-6989586621679236739"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679236740"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679236740"><span class="hs-identifier hs-var">f</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236741"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236741"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either a a] -&gt; ([a], [a])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either a a] -&gt; ([a], [a])) -&gt; [Either a a] -&gt; ([a], [a])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either a a) -&gt; [a] -&gt; [Either a a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a -&gt; Either a a
</span><a href="#local-6989586621679236739"><span class="hs-operator hs-var">`op`</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679236740"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236741"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-150"></span><span>                        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679236740"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Either a a
</span><a href="#local-6989586621679236739"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236741"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-151"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679236742"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236742"><span class="hs-identifier hs-var">updated</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679236743"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236743"><span class="hs-identifier hs-var">untouched</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Either a a
</span><a href="#local-6989586621679236739"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236742"><span class="hs-identifier hs-var">updated</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679236743"><span class="hs-identifier hs-var">untouched</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-comment">-- | reduce exponentials</span><span>
</span><span id="line-154"></span><span class="hs-comment">--</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- Performs the following rewrites:</span><span>
</span><span id="line-156"></span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- x^0          ==&gt;  1</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- 0^x          ==&gt;  0</span><span>
</span><span id="line-160"></span><span class="hs-comment">-- 2^3          ==&gt;  8</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- (k ^ i) ^ j  ==&gt;  k ^ (i * j)</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-163"></span><span id="local-6989586621679236442"><span id="local-6989586621679236443"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-type">reduceExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236442"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236443"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236442"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236443"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236442"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236443"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-164"></span><span id="reduceExp"><span class="annot"><span class="annottext">reduceExp :: forall v c. (Ord v, Ord c) =&gt; Symbol v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var hs-var">reduceExp</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>        </span><span class="hs-comment">-- x^0 ==&gt; 1</span><span>
</span><span id="line-165"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><span class="annot"><span class="annottext">Product v c
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>        </span><span class="hs-comment">-- 0^x ==&gt; 0</span><span>
</span><span id="line-166"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236759"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236759"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236760"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236760"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236760"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>                                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236759"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span><span class="hs-operator hs-var">^</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236760"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- 2^3 ==&gt; 8</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-comment">-- (k ^ i) ^ j ==&gt; k ^ (i * j)</span><span>
</span><span id="line-170"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236762"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236762"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679236763"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236763"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236764"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236764"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236762"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236765"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236766"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236766"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236766"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">SOP v c
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236762"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236765"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>    </span><span id="local-6989586621679236765"><span class="annot"><span class="annottext">e :: Product v c
</span><a href="#local-6989586621679236765"><span class="hs-identifier hs-var hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Product v c)
-&gt; ([Symbol v c] -&gt; [Symbol v c]) -&gt; [Symbol v c] -&gt; Product v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; [Symbol v c])
-&gt; ([Symbol v c] -&gt; [Symbol v c]) -&gt; [Symbol v c] -&gt; [Symbol v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Symbol v c -&gt; Symbol v c) -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c
forall v c. (Ord v, Ord c) =&gt; Symbol v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Product v c) -&gt; [Symbol v c] -&gt; Product v c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c))
-&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall v c.
(Ord v, Ord c) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236763"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236764"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span id="local-6989586621679236776"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236776"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236776"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="hs-comment">-- | Merge two symbols of a Product term</span><span>
</span><span id="line-179"></span><span class="hs-comment">--</span><span>
</span><span id="line-180"></span><span class="hs-comment">-- Performs the following rewrites:</span><span>
</span><span id="line-181"></span><span class="hs-comment">--</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-183"></span><span class="hs-comment">-- 8 * 7    ==&gt;  56</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- 1 * x    ==&gt;  x</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- x * 1    ==&gt;  x</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- 0 * x    ==&gt;  0</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- x * 0    ==&gt;  0</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- x * x^4  ==&gt;  x^5</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- x^4 * x  ==&gt;  x^5</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- y*y      ==&gt;  y^2</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-192"></span><span id="local-6989586621679236451"><span id="local-6989586621679236452"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-type">mergeS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236451"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236452"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236451"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236452"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236451"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236452"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-193"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236451"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236452"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Symbol"><span class="hs-identifier hs-type">Symbol</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236451"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236452"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-194"></span><span id="mergeS"><span class="annot"><span class="annottext">mergeS :: forall v c.
(Ord v, Ord c) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var hs-var">mergeS</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236811"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236811"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236812"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236812"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236811"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236812"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- 8 * 7 ==&gt; 56</span><span>
</span><span id="line-195"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236814"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236814"><span class="hs-identifier hs-var">r</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236814"><span class="hs-identifier hs-var">r</span></a></span><span>           </span><span class="hs-comment">-- 1 * x ==&gt; x</span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span id="local-6989586621679236815"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236815"><span class="hs-identifier hs-var">l</span></a></span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236815"><span class="hs-identifier hs-var">l</span></a></span><span>           </span><span class="hs-comment">-- x * 1 ==&gt; x</span><span>
</span><span id="line-197"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- 0 * x ==&gt; 0</span><span>
</span><span id="line-198"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- x * 0 ==&gt; 0</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- x * x^4 ==&gt; x^5</span><span>
</span><span id="line-201"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span id="local-6989586621679236816"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236816"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236817"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236817"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236818"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236818"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236816"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236817"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236817"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236818"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span class="hs-comment">-- x^4 * x ==&gt; x^5</span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236820"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236820"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236821"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236821"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236822"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236822"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236822"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236820"><span class="hs-identifier hs-var">s'</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236820"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236821"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- 4^x * 2^x ==&gt; 8^x</span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236823"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236823"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236824"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236824"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236825"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236825"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679236826"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236826"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236824"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Product v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236826"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236823"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236825"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236824"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span class="hs-comment">-- y*y ==&gt; y^2</span><span>
</span><span id="line-216"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span id="local-6989586621679236827"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236827"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679236828"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236828"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236827"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236828"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236827"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-219"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236829"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236829"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>  </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236829"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="annot"><span class="annottext">SOP v c
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236827"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-221"></span><span>
</span><span id="line-222"></span><span class="hs-comment">-- x^y * x^(-y) ==&gt; 1</span><span>
</span><span id="line-223"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236830"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236830"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236831"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236831"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236832"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236832"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236833"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236833"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236834"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236834"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236833"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236830"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236832"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236831"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236834"><span class="hs-identifier hs-var">p2</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- x^(-y) * x^y ==&gt; 1</span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236835"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236835"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236836"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236836"><span class="hs-identifier hs-var">i</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236837"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236837"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-type">E</span></a></span><span> </span><span id="local-6989586621679236838"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236838"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236839"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236839"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236836"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236835"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236838"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236837"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236839"><span class="hs-identifier hs-var">p2</span></a></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span id="local-6989586621679236840"><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236840"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236840"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">-- | Merge two products of a SOP term</span><span>
</span><span id="line-239"></span><span class="hs-comment">--</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- Performs the following rewrites:</span><span>
</span><span id="line-241"></span><span class="hs-comment">--</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- 2xy + 3xy  ==&gt;  5xy</span><span>
</span><span id="line-244"></span><span class="hs-comment">-- 2xy + xy   ==&gt;  3xy</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- xy + 2xy   ==&gt;  3xy</span><span>
</span><span id="line-246"></span><span class="hs-comment">-- xy + xy    ==&gt;  2xy</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-248"></span><span id="local-6989586621679236457"><span id="local-6989586621679236458"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-type">mergeP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679236457"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679236458"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236457"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236458"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236457"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236458"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236457"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236458"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236457"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236458"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- 2xy + 3xy ==&gt; 5xy</span><span>
</span><span id="line-251"></span><span id="mergeP"><span class="annot"><span class="annottext">mergeP :: forall v c.
(Eq v, Eq c) =&gt;
Product v c -&gt; Product v c -&gt; Either (Product v c) (Product v c)
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-var hs-var">mergeP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236853"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236853"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236854"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236854"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236855"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236855"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236856"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236856"><span class="hs-identifier hs-var">js</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236854"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236856"><span class="hs-identifier hs-var">js</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Either (Product v c) (Product v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Either (Product v c) (Product v c))
-&gt; ([Symbol v c] -&gt; Product v c)
-&gt; [Symbol v c]
-&gt; Either (Product v c) (Product v c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Either (Product v c) (Product v c))
-&gt; [Symbol v c] -&gt; Either (Product v c) (Product v c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236853"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236855"><span class="hs-identifier hs-var">j</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236854"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- 2xy + xy  ==&gt; 3xy</span><span>
</span><span id="line-254"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-var">mergeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236857"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236857"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236858"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236858"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236859"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236859"><span class="hs-identifier hs-var">js</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236858"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236859"><span class="hs-identifier hs-var">js</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Either (Product v c) (Product v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Either (Product v c) (Product v c))
-&gt; ([Symbol v c] -&gt; Product v c)
-&gt; [Symbol v c]
-&gt; Either (Product v c) (Product v c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Either (Product v c) (Product v c))
-&gt; [Symbol v c] -&gt; Either (Product v c) (Product v c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236857"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236858"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-256"></span><span class="hs-comment">-- xy + 2xy  ==&gt; 3xy</span><span>
</span><span id="line-257"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-var">mergeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236860"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236860"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236861"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236861"><span class="hs-identifier hs-var">j</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236862"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236862"><span class="hs-identifier hs-var">js</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236860"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236862"><span class="hs-identifier hs-var">js</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Either (Product v c) (Product v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Either (Product v c) (Product v c))
-&gt; ([Symbol v c] -&gt; Product v c)
-&gt; [Symbol v c]
-&gt; Either (Product v c) (Product v c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Either (Product v c) (Product v c))
-&gt; [Symbol v c] -&gt; Either (Product v c) (Product v c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236861"><span class="hs-identifier hs-var">j</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236860"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- xy + xy ==&gt; 2xy</span><span>
</span><span id="line-260"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-var">mergeP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236863"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236863"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span id="local-6989586621679236864"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236864"><span class="hs-identifier hs-var">js</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236863"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236864"><span class="hs-identifier hs-var">js</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Either (Product v c) (Product v c)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Either (Product v c) (Product v c))
-&gt; ([Symbol v c] -&gt; Product v c)
-&gt; [Symbol v c]
-&gt; Either (Product v c) (Product v c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Either (Product v c) (Product v c))
-&gt; [Symbol v c] -&gt; Either (Product v c) (Product v c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236863"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Either (Product v c) (Product v c)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Either (Product v c) (Product v c))
-&gt; Product v c -&gt; Either (Product v c) (Product v c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236863"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Expand or Simplify 'complex' exponentials</span><span>
</span><span id="line-265"></span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- Performs the following rewrites:</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- b^1              ==&gt;  b</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- 2^(y^2)          ==&gt;  4^y</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- (x + 2)^2        ==&gt;  x^2 + 4xy + 4</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- (x + 2)^(2x)     ==&gt;  (x^2 + 4xy + 4)^x</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- (x + 2)^(y + 2)  ==&gt;  4x(2 + x)^y + 4(2 + x)^y + (2 + x)^yx^2</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-275"></span><span id="local-6989586621679236865"><span id="local-6989586621679236866"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-type">normaliseExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236865"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236866"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236865"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236866"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236865"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236866"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236865"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236866"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- b^1 ==&gt; b</span><span>
</span><span id="line-277"></span><span id="normaliseExp"><span class="annot"><span class="annottext">normaliseExp :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var hs-var">normaliseExp</span></a></span></span><span> </span><span id="local-6989586621679236894"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236894"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236894"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- x^(2xy) ==&gt; x^(2xy)</span><span>
</span><span id="line-280"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236895"><span class="annot"><span class="annottext">b :: SOP v c
</span><a href="#local-6989586621679236895"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236896"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236896"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236895"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236896"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span class="hs-comment">-- 2^(y^2) ==&gt; 4^y</span><span>
</span><span id="line-283"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236897"><span class="annot"><span class="annottext">b :: SOP v c
</span><a href="#local-6989586621679236897"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236898"><span class="annot"><span class="annottext">e :: Product v c
</span><a href="#local-6989586621679236898"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c
forall v c. (Ord v, Ord c) =&gt; Symbol v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236897"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236898"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span class="hs-comment">-- (x + 2)^2 ==&gt; x^2 + 4xy + 4</span><span>
</span><span id="line-286"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236899"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236899"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236900"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236900"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236900"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c -&gt; SOP v c) -&gt; [SOP v c] -&gt; SOP v c
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-identifier hs-var">mergeSOPMul</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SOP v c -&gt; [SOP v c]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236900"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236899"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-comment">-- (x + 2)^(2x) ==&gt; (x^2 + 4xy + 4)^x</span><span>
</span><span id="line-290"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236903"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236903"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679236904"><span class="annot"><span class="annottext">e :: Symbol v c
</span><a href="#local-6989586621679236904"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span id="local-6989586621679236905"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236905"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679236906"><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236906"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679236905"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- Without the &quot;| i &gt;= 0&quot; guard, normaliseExp can loop with itself</span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-comment">-- for exponentials such as: 2^(n-k)</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236903"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c
</span><a href="#local-6989586621679236904"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c]
</span><a href="#local-6989586621679236906"><span class="hs-identifier hs-var">es</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- (x + 2)^(xy) ==&gt; (x+2)^(xy)</span><span>
</span><span id="line-296"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236907"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236907"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679236908"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236908"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c
forall v c. (Ord v, Ord c) =&gt; Symbol v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; Product v c -&gt; Symbol v c
forall v c. SOP v c -&gt; Product v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#E"><span class="hs-identifier hs-var">E</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236907"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236908"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-comment">-- (x + 2)^(y + 2) ==&gt; 4x(2 + x)^y + 4(2 + x)^y + (2 + x)^yx^2</span><span>
</span><span id="line-299"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span id="local-6989586621679236909"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236909"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236910"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236910"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c -&gt; SOP v c) -&gt; [SOP v c] -&gt; SOP v c
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">foldr1</span></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-identifier hs-var">mergeSOPMul</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Product v c -&gt; SOP v c) -&gt; [Product v c] -&gt; [SOP v c]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#normaliseExp"><span class="hs-identifier hs-var">normaliseExp</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236909"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c)
-&gt; (Product v c -&gt; SOP v c) -&gt; Product v c -&gt; SOP v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="annot"><span class="annottext">([Product v c] -&gt; SOP v c)
-&gt; (Product v c -&gt; [Product v c]) -&gt; Product v c -&gt; SOP v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Product v c -&gt; [Product v c] -&gt; [Product v c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236910"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621679236466"><span id="local-6989586621679236467"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#zeroP"><span class="hs-identifier hs-type">zeroP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#Product"><span class="hs-identifier hs-type">Product</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236466"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236467"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-302"></span><span id="zeroP"><span class="annot"><span class="annottext">zeroP :: forall v c. Product v c -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.SOP.html#zeroP"><span class="hs-identifier hs-var hs-var">zeroP</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-type">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Symbol v c]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#zeroP"><span class="hs-identifier hs-var">zeroP</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span id="local-6989586621679236470"><span id="local-6989586621679236471"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mkNonEmpty"><span class="hs-identifier hs-type">mkNonEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236470"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236471"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236470"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236471"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-306"></span><span id="mkNonEmpty"><span class="annot"><span class="annottext">mkNonEmpty :: forall v c. SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mkNonEmpty"><span class="hs-identifier hs-var hs-var">mkNonEmpty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Symbol v c
forall v c. Integer -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#I"><span class="hs-identifier hs-var">I</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mkNonEmpty"><span class="hs-identifier hs-var">mkNonEmpty</span></a></span><span> </span><span id="local-6989586621679236915"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236915"><span class="hs-identifier hs-var">s</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679236915"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | Simplifies SOP terms using</span><span>
</span><span id="line-310"></span><span class="hs-comment">--</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- * 'mergeS'</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- * 'mergeP'</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- * 'reduceExp'</span><span>
</span><span id="line-314"></span><span id="local-6989586621679236474"><span id="local-6989586621679236475"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-identifier hs-type">simplifySOP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236474"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236475"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236474"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236475"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236474"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236475"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-315"></span><span id="simplifySOP"><span class="annot"><span class="annottext">simplifySOP :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-identifier hs-var hs-var">simplifySOP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c) -&gt; SOP v c -&gt; SOP v c
forall {t}. Eq t =&gt; (t -&gt; t) -&gt; t -&gt; t
</span><a href="#local-6989586621679236921"><span class="hs-identifier hs-var">repeatF</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c
</span><a href="#local-6989586621679236922"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679236922"><span class="annot"><span class="annottext">go :: SOP v c -&gt; SOP v c
</span><a href="#local-6989586621679236922"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c
forall v c. SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mkNonEmpty"><span class="hs-identifier hs-var">mkNonEmpty</span></a></span><span>
</span><span id="line-318"></span><span>       </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c) -&gt; (SOP v c -&gt; SOP v c) -&gt; SOP v c -&gt; SOP v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span>
</span><span id="line-319"></span><span>       </span><span class="annot"><span class="annottext">([Product v c] -&gt; SOP v c)
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; SOP v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; [Product v c]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Product v c] -&gt; [Product v c])
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; [Product v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Bool) -&gt; [Product v c] -&gt; [Product v c]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Product v c -&gt; Bool) -&gt; Product v c -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Bool
forall v c. Product v c -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.SOP.html#zeroP"><span class="hs-identifier hs-var">zeroP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>       </span><span class="annot"><span class="annottext">([Product v c] -&gt; [Product v c])
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; [Product v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Product v c -&gt; Either (Product v c) (Product v c))
-&gt; [Product v c] -&gt; [Product v c]
forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; Product v c -&gt; Either (Product v c) (Product v c)
forall v c.
(Eq v, Eq c) =&gt;
Product v c -&gt; Product v c -&gt; Either (Product v c) (Product v c)
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeP"><span class="hs-identifier hs-var">mergeP</span></a></span><span>
</span><span id="line-321"></span><span>       </span><span class="annot"><span class="annottext">([Product v c] -&gt; [Product v c])
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; [Product v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; Product v c) -&gt; [Product v c] -&gt; [Product v c]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; Product v c)
-&gt; (Product v c -&gt; [Symbol v c]) -&gt; Product v c -&gt; Product v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sort</span></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; [Symbol v c])
-&gt; (Product v c -&gt; [Symbol v c]) -&gt; Product v c -&gt; [Symbol v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Symbol v c -&gt; Symbol v c) -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c
forall v c. (Ord v, Ord c) =&gt; Symbol v c -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#reduceExp"><span class="hs-identifier hs-var">reduceExp</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; [Symbol v c])
-&gt; (Product v c -&gt; [Symbol v c]) -&gt; Product v c -&gt; [Symbol v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c))
-&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. (a -&gt; a -&gt; Either a a) -&gt; [a] -&gt; [a]
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeWith"><span class="hs-identifier hs-var">mergeWith</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
forall v c.
(Ord v, Ord c) =&gt;
Symbol v c -&gt; Symbol v c -&gt; Either (Symbol v c) (Symbol v c)
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeS"><span class="hs-identifier hs-var">mergeS</span></a></span><span> </span><span class="annot"><span class="annottext">([Symbol v c] -&gt; [Symbol v c])
-&gt; (Product v c -&gt; [Symbol v c]) -&gt; Product v c -&gt; [Symbol v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>       </span><span class="annot"><span class="annottext">([Product v c] -&gt; [Product v c])
-&gt; (SOP v c -&gt; [Product v c]) -&gt; SOP v c -&gt; [Product v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; [Product v c]
forall v c. SOP v c -&gt; [Product v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unS"><span class="hs-identifier hs-var">unS</span></a></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>    </span><span id="local-6989586621679236921"><span class="annot"><span class="annottext">repeatF :: (t -&gt; t) -&gt; t -&gt; t
</span><a href="#local-6989586621679236921"><span class="hs-identifier hs-var hs-var">repeatF</span></a></span></span><span> </span><span id="local-6989586621679236938"><span class="annot"><span class="annottext">t -&gt; t
</span><a href="#local-6989586621679236938"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679236939"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236939"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679236940"><span class="annot"><span class="annottext">x' :: t
</span><a href="#local-6989586621679236940"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; t
</span><a href="#local-6989586621679236938"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236939"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236940"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236939"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-327"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236939"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-328"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(t -&gt; t) -&gt; t -&gt; t
</span><a href="#local-6989586621679236921"><span class="hs-identifier hs-var">repeatF</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t
</span><a href="#local-6989586621679236938"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679236940"><span class="hs-identifier hs-var">x'</span></a></span><span>
</span><span id="line-329"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-pragma hs-type">simplifySOP</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | Merge two SOP terms by additions</span><span>
</span><span id="line-332"></span><span id="local-6989586621679236941"><span id="local-6989586621679236942"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPAdd"><span class="hs-identifier hs-type">mergeSOPAdd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236941"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236942"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236941"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236942"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236941"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236942"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236941"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236942"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-333"></span><span id="mergeSOPAdd"><span class="annot"><span class="annottext">mergeSOPAdd :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPAdd"><span class="hs-identifier hs-var hs-var">mergeSOPAdd</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236947"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236947"><span class="hs-identifier hs-var">sop1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236948"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236948"><span class="hs-identifier hs-var">sop2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-identifier hs-var">simplifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c) -&gt; SOP v c -&gt; SOP v c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236947"><span class="hs-identifier hs-var">sop1</span></a></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; [Product v c] -&gt; [Product v c]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236948"><span class="hs-identifier hs-var">sop2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPAdd"><span class="hs-pragma hs-type">mergeSOPAdd</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">-- | Merge two SOP terms by multiplication</span><span>
</span><span id="line-337"></span><span id="local-6989586621679236949"><span id="local-6989586621679236950"><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-identifier hs-type">mergeSOPMul</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236949"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679236950"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236949"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236950"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236949"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236950"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#SOP"><span class="hs-identifier hs-type">SOP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236949"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679236950"><span class="hs-identifier hs-type">c</span></a></span></span></span><span>
</span><span id="line-338"></span><span id="mergeSOPMul"><span class="annot"><span class="annottext">mergeSOPMul :: forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-identifier hs-var hs-var">mergeSOPMul</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236956"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236956"><span class="hs-identifier hs-var">sop1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span id="local-6989586621679236957"><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236957"><span class="hs-identifier hs-var">sop2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#simplifySOP"><span class="hs-identifier hs-var">simplifySOP</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="annottext">(SOP v c -&gt; SOP v c)
-&gt; ([Product v c] -&gt; SOP v c) -&gt; [Product v c] -&gt; SOP v c
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><span class="annottext">([Product v c] -&gt; SOP v c) -&gt; [Product v c] -&gt; SOP v c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Product v c -&gt; [Product v c]) -&gt; [Product v c] -&gt; [Product v c]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Product v c -&gt; Product v c -&gt; Product v c)
-&gt; [Product v c] -&gt; [Product v c] -&gt; [Product v c]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679236960"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236960"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621679236961"><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236961"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236960"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">[Symbol v c] -&gt; [Symbol v c] -&gt; [Symbol v c]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; [Symbol v c]
forall v c. Product v c -&gt; [Symbol v c]
</span><a href="GHC.TypeLits.Normalise.SOP.html#unP"><span class="hs-identifier hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">Product v c
</span><a href="#local-6989586621679236961"><span class="hs-identifier hs-var">p2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236956"><span class="hs-identifier hs-var">sop1</span></a></span><span> </span><span class="annot"><span class="annottext">([Product v c] -&gt; [Product v c])
-&gt; (Product v c -&gt; [Product v c]) -&gt; Product v c -&gt; [Product v c]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Product v c -&gt; [Product v c]
forall a. a -&gt; [a]
</span><span class="hs-identifier hs-var">repeat</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Product v c]
</span><a href="#local-6989586621679236957"><span class="hs-identifier hs-var">sop2</span></a></span><span>
</span><span id="line-342"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#mergeSOPMul"><span class="hs-pragma hs-type">mergeSOPMul</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-343"></span></pre></body></html>