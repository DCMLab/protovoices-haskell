<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | A module that contains exception-safe equivalents of @inline-c@ QuasiQuoters.</span></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html"><span class="hs-identifier">Language.C.Inline.Cpp.Exception</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier">CppException</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppExceptionPtr"><span class="hs-identifier">CppExceptionPtr</span></a></span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#toSomeException"><span class="hs-identifier">toSomeException</span></a></span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#throwBlock"><span class="hs-identifier">throwBlock</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#tryBlock"><span class="hs-identifier">tryBlock</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#catchBlock"><span class="hs-identifier">catchBlock</span></a></span><span>
</span><span id="line-15"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#tryBlockQuoteExp"><span class="hs-identifier">tryBlockQuoteExp</span></a></span><span>
</span><span id="line-16"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Exception.Safe</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Unsafe</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePackMallocCString</span></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding.Error</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Inline</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.C.Inline.Internal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.html"><span class="hs-identifier">Language.C.Inline.Cpp</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cpp</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Language.C.Inline.Cpp.html"><span class="hs-identifier">Language.C.Inline.Cpp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.html#AbstractCppExceptionPtr"><span class="hs-identifier">AbstractCppExceptionPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Quote</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.C</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">System.IO.Unsafe</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unsafePerformIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-identifier">C.context</span><span> </span><span class="hs-identifier">Cpp.cppCtx</span><span>
</span><span id="line-35"></span><span class="hs-identifier">C.include</span><span> </span><span class="hs-string">&quot;HaskellException.hxx&quot;</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><span class="hs-comment">-- | An exception thrown in C++ code.</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">data</span><span> </span><span id="CppException"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-var">CppException</span></a></span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CppStdException"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppStdException"><span class="hs-identifier hs-var">CppStdException</span></a></span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppExceptionPtr"><span class="hs-identifier hs-type">CppExceptionPtr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CppHaskellException"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppHaskellException"><span class="hs-identifier hs-var">CppHaskellException</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CppNonStdException"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppNonStdException"><span class="hs-identifier hs-var">CppNonStdException</span></a></span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppExceptionPtr"><span class="hs-identifier hs-type">CppExceptionPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080188"><span id="local-6989586621679080192"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-type">CppException</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621679080210"><span class="annot"><span class="annottext">showsPrec :: Int -&gt; CppException -&gt; ShowS
</span><a href="#local-6989586621679080210"><span class="hs-identifier hs-var hs-var hs-var">showsPrec</span></a></span></span><span> </span><span id="local-6989586621679080212"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppStdException"><span class="hs-identifier hs-type">CppStdException</span></a></span><span> </span><span class="annot"><span class="annottext">CppExceptionPtr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080213"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679080214"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679080214"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080212"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CppStdException e &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ByteString -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080213"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe ByteString -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679080214"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span id="local-6989586621679080218"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080218"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppHaskellException"><span class="hs-identifier hs-type">CppHaskellException</span></a></span><span> </span><span id="local-6989586621679080219"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080219"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080218"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CppHaskellException &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SomeException -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080219"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span id="local-6989586621679080220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppNonStdException"><span class="hs-identifier hs-type">CppNonStdException</span></a></span><span> </span><span class="annot"><span class="annottext">CppExceptionPtr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080221"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ShowS -&gt; ShowS
</span><span class="hs-identifier hs-var">showParen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080220"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ShowS
</span><span class="hs-identifier hs-var">showString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CppOtherException e &quot;</span></span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; ShowS -&gt; ShowS
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe ByteString -&gt; ShowS
forall a. Show a =&gt; Int -&gt; a -&gt; ShowS
</span><span class="hs-identifier hs-var">showsPrec</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679080221"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679080227"><span id="local-6989586621679080230"><span id="local-6989586621679080234"><span class="annot"><span class="hs-identifier hs-type">Exception</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-type">CppException</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>  </span><span id="local-6989586621679080241"><span class="annot"><span class="annottext">displayException :: CppException -&gt; String
</span><a href="#local-6989586621679080241"><span class="hs-identifier hs-var hs-var hs-var">displayException</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppStdException"><span class="hs-identifier hs-type">CppStdException</span></a></span><span> </span><span class="annot"><span class="annottext">CppExceptionPtr
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679080243"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080243"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679080244"><span class="annot"><span class="annottext">Maybe ByteString
</span><a href="#local-6989586621679080244"><span class="hs-identifier hs-var">_typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Language.C.Inline.Cpp.Exception.html#bsToChars"><span class="hs-identifier hs-var">bsToChars</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080243"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppHaskellException"><span class="hs-identifier hs-type">CppHaskellException</span></a></span><span> </span><span id="local-6989586621679080246"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080246"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080246"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppNonStdException"><span class="hs-identifier hs-type">CppNonStdException</span></a></span><span> </span><span class="annot"><span class="annottext">CppExceptionPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679080247"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080247"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exception: Exception of type &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Language.C.Inline.Cpp.Exception.html#bsToChars"><span class="hs-identifier hs-var">bsToChars</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679080247"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">displayException</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppNonStdException"><span class="hs-identifier hs-type">CppNonStdException</span></a></span><span> </span><span class="annot"><span class="annottext">CppExceptionPtr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exception: Non-std exception of unknown type&quot;</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">type</span><span> </span><span id="CppExceptionPtr"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppExceptionPtr"><span class="hs-identifier hs-var">CppExceptionPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ForeignPtr</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.html#AbstractCppExceptionPtr"><span class="hs-identifier hs-type">AbstractCppExceptionPtr</span></a></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">-- | This converts a plain pointer to a managed object.</span><span>
</span><span id="line-57"></span><span class="hs-comment">--</span><span>
</span><span id="line-58"></span><span class="hs-comment">-- The pointer must have been created with @new@. The returned 'CppExceptionPtr'</span><span>
</span><span id="line-59"></span><span class="hs-comment">-- will @delete@ it when it is garbage collected, so you must not @delete@ it</span><span>
</span><span id="line-60"></span><span class="hs-comment">-- on your own. This function is called &quot;unsafe&quot; because it is not memory safe</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- by itself, but safe when used correctly; similar to for example</span><span>
</span><span id="line-62"></span><span class="hs-comment">-- 'BS.unsafePackMallocCString'.</span><span>
</span><span id="line-63"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#unsafeFromNewCppExceptionPtr"><span class="hs-identifier hs-type">unsafeFromNewCppExceptionPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.html#AbstractCppExceptionPtr"><span class="hs-identifier hs-type">AbstractCppExceptionPtr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppExceptionPtr"><span class="hs-identifier hs-type">CppExceptionPtr</span></a></span><span>
</span><span id="line-64"></span><span id="unsafeFromNewCppExceptionPtr"><span class="annot"><span class="annottext">unsafeFromNewCppExceptionPtr :: Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr
</span><a href="Language.C.Inline.Cpp.Exception.html#unsafeFromNewCppExceptionPtr"><span class="hs-identifier hs-var hs-var">unsafeFromNewCppExceptionPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FinalizerPtr AbstractCppExceptionPtr
-&gt; Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr
forall a. FinalizerPtr a -&gt; Ptr a -&gt; IO (ForeignPtr a)
</span><span class="hs-identifier hs-var">newForeignPtr</span></span><span> </span><span class="annot"><span class="annottext">FinalizerPtr AbstractCppExceptionPtr
</span><a href="Language.C.Inline.Cpp.Exception.html#finalizeAbstractCppExceptionPtr"><span class="hs-identifier hs-var">finalizeAbstractCppExceptionPtr</span></a></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#finalizeAbstractCppExceptionPtr"><span class="hs-identifier hs-type">finalizeAbstractCppExceptionPtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FinalizerPtr</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.html#AbstractCppExceptionPtr"><span class="hs-identifier hs-type">AbstractCppExceptionPtr</span></a></span><span>
</span><span id="line-67"></span><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#finalizeAbstractCppExceptionPtr"><span class="hs-pragma hs-type">finalizeAbstractCppExceptionPtr</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-68"></span><span id="finalizeAbstractCppExceptionPtr"><span class="annot"><span class="annottext">finalizeAbstractCppExceptionPtr :: FinalizerPtr AbstractCppExceptionPtr
</span><a href="Language.C.Inline.Cpp.Exception.html#finalizeAbstractCppExceptionPtr"><span class="hs-identifier hs-var hs-var">finalizeAbstractCppExceptionPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="annottext">IO (FinalizerPtr AbstractCppExceptionPtr)
-&gt; FinalizerPtr AbstractCppExceptionPtr
forall a. IO a -&gt; a
</span><span class="hs-identifier hs-var">unsafePerformIO</span></span><span>
</span><span id="line-70"></span><span>    </span><span class="annot"><span class="annottext">IO (FinalizerPtr AbstractCppExceptionPtr)
</span><span class="">[C.exp|
      void (*)(std::exception_ptr *) {
        [](std::exception_ptr *v){ delete v; }
      }|]</span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | Like 'toException' but unwrap 'CppHaskellException'</span></span><span>
</span><span id="line-76"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#toSomeException"><span class="hs-identifier hs-type">toSomeException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-type">CppException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span>
</span><span id="line-77"></span><span id="toSomeException"><span class="annot"><span class="annottext">toSomeException :: CppException -&gt; SomeException
</span><a href="Language.C.Inline.Cpp.Exception.html#toSomeException"><span class="hs-identifier hs-var hs-var">toSomeException</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppHaskellException"><span class="hs-identifier hs-type">CppHaskellException</span></a></span><span> </span><span id="local-6989586621679080253"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080253"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679080253"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-78"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#toSomeException"><span class="hs-identifier hs-var">toSomeException</span></a></span><span> </span><span id="local-6989586621679080254"><span class="annot"><span class="annottext">CppException
</span><a href="#local-6989586621679080254"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CppException -&gt; SomeException
forall e. Exception e =&gt; e -&gt; SomeException
</span><span class="hs-identifier hs-var">toException</span></span><span> </span><span class="annot"><span class="annottext">CppException
</span><a href="#local-6989586621679080254"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="hs-comment">-- NOTE: Other C++ exception types (std::runtime_error etc) could be distinguished like this in the future.</span><span>
</span><span id="line-81"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#ExTypeNoException"><span class="hs-identifier hs-type">ExTypeNoException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">pattern</span><span> </span><span id="ExTypeNoException"><span id="%24mExTypeNoException"><span id="%24bExTypeNoException"><span class="annot"><span class="annottext">$mExTypeNoException :: forall {r}. CInt -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bExTypeNoException :: CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeNoException"><span class="hs-identifier hs-var hs-var hs-var">ExTypeNoException</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#ExTypeStdException"><span class="hs-identifier hs-type">ExTypeStdException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">pattern</span><span> </span><span id="ExTypeStdException"><span id="%24mExTypeStdException"><span id="%24bExTypeStdException"><span class="annot"><span class="annottext">$mExTypeStdException :: forall {r}. CInt -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bExTypeStdException :: CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeStdException"><span class="hs-identifier hs-var hs-var hs-var">ExTypeStdException</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#ExTypeHaskellException"><span class="hs-identifier hs-type">ExTypeHaskellException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">pattern</span><span> </span><span id="ExTypeHaskellException"><span id="%24mExTypeHaskellException"><span id="%24bExTypeHaskellException"><span class="annot"><span class="annottext">$mExTypeHaskellException :: forall {r}. CInt -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bExTypeHaskellException :: CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeHaskellException"><span class="hs-identifier hs-var hs-var hs-var">ExTypeHaskellException</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">2</span></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#ExTypeOtherException"><span class="hs-identifier hs-type">ExTypeOtherException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">pattern</span><span> </span><span id="ExTypeOtherException"><span id="%24mExTypeOtherException"><span id="%24bExTypeOtherException"><span class="annot"><span class="annottext">$mExTypeOtherException :: forall {r}. CInt -&gt; ((# #) -&gt; r) -&gt; ((# #) -&gt; r) -&gt; r
$bExTypeOtherException :: CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeOtherException"><span class="hs-identifier hs-var hs-var hs-var">ExTypeOtherException</span></a></span></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">3</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span id="local-6989586621679080094"><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#handleForeignCatch"><span class="hs-identifier hs-type">handleForeignCatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679080094"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-type">CppException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080094"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-95"></span><span id="handleForeignCatch"><span class="annot"><span class="annottext">handleForeignCatch :: forall a. (Ptr (Ptr ()) -&gt; IO a) -&gt; IO (Either CppException a)
</span><a href="Language.C.Inline.Cpp.Exception.html#handleForeignCatch"><span class="hs-identifier hs-var hs-var">handleForeignCatch</span></a></span></span><span> </span><span id="local-6989586621679080320"><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; IO a
</span><a href="#local-6989586621679080320"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; Int
-&gt; (Ptr (Ptr ()) -&gt; IO (Either CppException a))
-&gt; IO (Either CppException a)
forall a b. Int -&gt; Int -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">allocaBytesAligned</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr () -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr () -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">alignment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Ptr (Ptr ()) -&gt; IO (Either CppException a))
 -&gt; IO (Either CppException a))
-&gt; (Ptr (Ptr ()) -&gt; IO (Either CppException a))
-&gt; IO (Either CppException a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679080326"><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080330"><span class="annot"><span class="annottext">ptrSize :: Int
</span><a href="#local-6989586621679080330"><span class="hs-identifier hs-var hs-var">ptrSize</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr () -&gt; Int
forall a. Storable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">sizeOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr ()
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>        </span><span id="local-6989586621679080331"><span class="annot"><span class="annottext">exTypePtr :: Ptr CInt
</span><a href="#local-6989586621679080331"><span class="hs-identifier hs-var hs-var">exTypePtr</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Ptr CInt
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-99"></span><span>        </span><span id="local-6989586621679080333"><span class="annot"><span class="annottext">msgCStringPtr :: Ptr CString
</span><a href="#local-6989586621679080333"><span class="hs-identifier hs-var hs-var">msgCStringPtr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 0) -&gt; Ptr CString
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr (ZonkAny 0)
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080330"><span class="hs-identifier hs-var">ptrSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span>
</span><span id="line-100"></span><span>        </span><span id="local-6989586621679080337"><span class="annot"><span class="annottext">typCStringPtr :: Ptr CString
</span><a href="#local-6989586621679080337"><span class="hs-identifier hs-var hs-var">typCStringPtr</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 1) -&gt; Ptr CString
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr (ZonkAny 1)
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080330"><span class="hs-identifier hs-var">ptrSize</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CString</span></span><span>
</span><span id="line-101"></span><span>        </span><span id="local-6989586621679080340"><span class="annot"><span class="annottext">exPtr :: Ptr (Ptr AbstractCppExceptionPtr)
</span><a href="#local-6989586621679080340"><span class="hs-identifier hs-var hs-var">exPtr</span></a></span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 2) -&gt; Ptr (Ptr AbstractCppExceptionPtr)
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr (ZonkAny 2)
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080330"><span class="hs-identifier hs-var">ptrSize</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.html#AbstractCppExceptionPtr"><span class="hs-identifier hs-type">AbstractCppExceptionPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621679080343"><span class="annot"><span class="annottext">haskellExPtrPtr :: Ptr (Ptr ())
</span><a href="#local-6989586621679080343"><span class="hs-identifier hs-var hs-var">haskellExPtrPtr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ptr (ZonkAny 3) -&gt; Ptr (Ptr ())
forall a b. Ptr a -&gt; Ptr b
</span><span class="hs-identifier hs-var">castPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; Int -&gt; Ptr (ZonkAny 3)
forall a b. Ptr a -&gt; Int -&gt; Ptr b
</span><span class="hs-operator hs-var">`plusPtr`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080330"><span class="hs-identifier hs-var">ptrSize</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">-- we need to mask this entire block because the C++ allocates the</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-comment">-- string for the exception message and we need to make sure that</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-comment">-- we free it (see the @free@ below). The foreign code would not be</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-comment">-- preemptable anyway, so I do not think this loses us anything.</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">IO (Either CppException a) -&gt; IO (Either CppException a)
forall (m :: * -&gt; *) a. (HasCallStack, MonadMask m) =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">mask_</span></span><span> </span><span class="annot"><span class="annottext">(IO (Either CppException a) -&gt; IO (Either CppException a))
-&gt; IO (Either CppException a) -&gt; IO (Either CppException a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-108"></span><span>      </span><span id="local-6989586621679080345"><span class="annot"><a href="#local-6989586621679080345"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; IO a
</span><a href="#local-6989586621679080320"><span class="hs-identifier hs-var">cont</span></a></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080326"><span class="hs-identifier hs-var">basePtr</span></a></span><span>
</span><span id="line-109"></span><span>      </span><span id="local-6989586621679080346"><span class="annot"><a href="#local-6989586621679080346"><span class="hs-identifier hs-var">exType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679080331"><span class="hs-identifier hs-type">exTypePtr</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679080346"><span class="hs-identifier hs-type">exType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeNoException"><span class="hs-identifier hs-var">ExTypeNoException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either CppException a -&gt; IO (Either CppException a)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either CppException a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679080345"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeStdException"><span class="hs-identifier hs-var">ExTypeStdException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>          </span><span id="local-6989586621679080348"><span class="annot"><a href="#local-6989586621679080348"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr
</span><a href="Language.C.Inline.Cpp.Exception.html#unsafeFromNewCppExceptionPtr"><span class="hs-identifier hs-var">unsafeFromNewCppExceptionPtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr)
-&gt; IO (Ptr AbstractCppExceptionPtr) -&gt; IO CppExceptionPtr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr AbstractCppExceptionPtr)
-&gt; IO (Ptr AbstractCppExceptionPtr)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr AbstractCppExceptionPtr)
</span><a href="#local-6989586621679080340"><span class="hs-identifier hs-var">exPtr</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>          </span><span class="hs-comment">-- BS.unsafePackMallocCString: safe because setMessageOfStdException</span><span>
</span><span id="line-116"></span><span>          </span><span class="hs-comment">-- (invoked via tryBlockQuoteExp) sets msgCStringPtr to a newly</span><span>
</span><span id="line-117"></span><span>          </span><span class="hs-comment">-- malloced string.</span><span>
</span><span id="line-118"></span><span>          </span><span id="local-6989586621679080350"><span class="annot"><a href="#local-6989586621679080350"><span class="hs-identifier hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.unsafePackMallocCString</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679080333"><span class="hs-identifier hs-type">msgCStringPtr</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>          </span><span class="hs-comment">-- BS.unsafePackMallocCString: safe because currentExceptionTypeName</span><span>
</span><span id="line-121"></span><span>          </span><span class="hs-comment">-- returns a newly malloced string</span><span>
</span><span id="line-122"></span><span>          </span><span id="local-6989586621679080351"><span class="annot"><a href="#local-6989586621679080351"><span class="hs-identifier hs-var">mbExcType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybePeek</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.unsafePackMallocCString</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">typCStringPtr</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppStdException"><span class="hs-identifier hs-type">CppStdException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080348"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080350"><span class="hs-identifier hs-type">errMsg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080351"><span class="hs-identifier hs-type">mbExcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeHaskellException"><span class="hs-identifier hs-var">ExTypeHaskellException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>          </span><span id="local-6989586621679080353"><span class="annot"><a href="#local-6989586621679080353"><span class="hs-identifier hs-var">haskellExPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ()) -&gt; IO (Ptr ())
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr ())
</span><a href="#local-6989586621679080343"><span class="hs-identifier hs-var">haskellExPtrPtr</span></a></span><span>
</span><span id="line-127"></span><span>          </span><span id="local-6989586621679080354"><span class="annot"><a href="#local-6989586621679080354"><span class="hs-identifier hs-var">stablePtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="">[C.block| void * {
              return (static_cast&lt;HaskellException *&gt;($(void *haskellExPtr)))-&gt;haskellExceptionStablePtr-&gt;stablePtr;
            } |]</span></span><span>
</span><span id="line-130"></span><span>          </span><span id="local-6989586621679080358"><span class="annot"><a href="#local-6989586621679080358"><span class="hs-identifier hs-var">someExc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">deRefStablePtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">castPtrToStablePtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679080354"><span class="hs-identifier hs-type">stablePtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><span class="">[C.block| void{
              delete static_cast&lt;HaskellException *&gt;($(void *haskellExPtr));
            } |]</span></span><span>
</span><span id="line-134"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppHaskellException"><span class="hs-identifier hs-type">CppHaskellException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080358"><span class="hs-identifier hs-type">someExc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeOtherException"><span class="hs-identifier hs-var">ExTypeOtherException</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>          </span><span id="local-6989586621679080364"><span class="annot"><a href="#local-6989586621679080364"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr
</span><a href="Language.C.Inline.Cpp.Exception.html#unsafeFromNewCppExceptionPtr"><span class="hs-identifier hs-var">unsafeFromNewCppExceptionPtr</span></a></span><span> </span><span class="annot"><span class="annottext">(Ptr AbstractCppExceptionPtr -&gt; IO CppExceptionPtr)
-&gt; IO (Ptr AbstractCppExceptionPtr) -&gt; IO CppExceptionPtr
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr AbstractCppExceptionPtr)
-&gt; IO (Ptr AbstractCppExceptionPtr)
forall a. Storable a =&gt; Ptr a -&gt; IO a
</span><span class="hs-identifier hs-var">peek</span></span><span> </span><span class="annot"><span class="annottext">Ptr (Ptr AbstractCppExceptionPtr)
</span><a href="#local-6989586621679080340"><span class="hs-identifier hs-var">exPtr</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>          </span><span class="hs-comment">-- BS.unsafePackMallocCString: safe because currentExceptionTypeName</span><span>
</span><span id="line-139"></span><span>          </span><span class="hs-comment">-- returns a newly malloced string</span><span>
</span><span id="line-140"></span><span>          </span><span id="local-6989586621679080365"><span class="annot"><a href="#local-6989586621679080365"><span class="hs-identifier hs-var">mbExcType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybePeek</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.unsafePackMallocCString</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">peek</span></span><span> </span><span class="annot"><a href="#local-6989586621679080337"><span class="hs-identifier hs-type">typCStringPtr</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span>          </span><span id="local-6989586621679080366"><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppNonStdException"><span class="hs-identifier hs-type">CppNonStdException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080364"><span class="hs-identifier hs-type">ex</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080365"><span class="hs-identifier hs-type">mbExcType</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#CppException"><span class="hs-identifier hs-type">CppException</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080366"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">CInt
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO (Either CppException a)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected C++ exception type.&quot;</span></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- | Like 'tryBlock', but will throw unwrapped 'CppHaskellException's or other 'CppException's rather than returning</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- them in an 'Either'</span><span>
</span><span id="line-147"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#throwBlock"><span class="hs-identifier hs-type">throwBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-148"></span><span id="throwBlock"><span class="annot"><span class="annottext">throwBlock :: QuasiQuoter
</span><a href="Language.C.Inline.Cpp.Exception.html#throwBlock"><span class="hs-identifier hs-var hs-var">throwBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">quoteExp :: String -&gt; Q Exp
</span><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679080370"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080370"><span class="hs-identifier hs-var">blockStr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">[e|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">throwIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#toSomeException"><span class="hs-identifier hs-type">toSomeException</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">=&lt;&lt;</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuasiQuoter -&gt; String -&gt; Q Exp
</span><a href="Language.C.Inline.Cpp.Exception.html#tryBlockQuoteExp"><span class="hs-identifier hs-var">tryBlockQuoteExp</span></a></span><span> </span><span class="annot"><span class="annottext">QuasiQuoter
</span><span class="hs-identifier hs-var">C.block</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080370"><span class="hs-identifier hs-var">blockStr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quotePat :: String -&gt; Q Pat
</span><span class="hs-identifier hs-var">quotePat</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Pat
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080374"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteType :: String -&gt; Q Type
</span><span class="hs-identifier hs-var">quoteType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Type
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080374"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteDec :: String -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">quoteDec</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q [Dec]
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080374"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-155"></span><span>      </span><span id="local-6989586621679080374"><span class="annot"><span class="annottext">unsupported :: p -&gt; m a
</span><a href="#local-6989586621679080374"><span class="hs-identifier hs-var hs-var">unsupported</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported quasiquotation.&quot;</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><span class="hs-comment">-- | Variant of 'throwBlock' for blocks which return 'void'.</span></span><span>
</span><span id="line-158"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#catchBlock"><span class="hs-identifier hs-type">catchBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-159"></span><span id="catchBlock"><span class="annot"><span class="annottext">catchBlock :: QuasiQuoter
</span><a href="Language.C.Inline.Cpp.Exception.html#catchBlock"><span class="hs-identifier hs-var hs-var">catchBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">quoteExp :: String -&gt; Q Exp
</span><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679080387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080387"><span class="hs-identifier hs-var">blockStr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QuasiQuoter -&gt; String -&gt; Q Exp
</span><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="annot"><span class="annottext">QuasiQuoter
</span><a href="Language.C.Inline.Cpp.Exception.html#throwBlock"><span class="hs-identifier hs-var">throwBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void {&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080387"><span class="hs-identifier hs-var">blockStr</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quotePat :: String -&gt; Q Pat
</span><span class="hs-identifier hs-var">quotePat</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Pat
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteType :: String -&gt; Q Type
</span><span class="hs-identifier hs-var">quoteType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Type
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteDec :: String -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">quoteDec</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q [Dec]
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>      </span><span id="local-6989586621679080388"><span class="annot"><span class="annottext">unsupported :: p -&gt; m a
</span><a href="#local-6989586621679080388"><span class="hs-identifier hs-var hs-var">unsupported</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported quasiquotation.&quot;</span></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#exceptionalValue"><span class="hs-identifier hs-type">exceptionalValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-168"></span><span id="exceptionalValue"><span class="annot"><span class="annottext">exceptionalValue :: ShowS
</span><a href="Language.C.Inline.Cpp.Exception.html#exceptionalValue"><span class="hs-identifier hs-var hs-var">exceptionalValue</span></a></span></span><span> </span><span id="local-6989586621679080398"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080398"><span class="hs-identifier hs-var">typeStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080398"><span class="hs-identifier hs-var">typeStr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;void&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;char&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;short&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;long&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int8_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int16_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-177"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int32_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int64_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uint8_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uint16_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uint32_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uint64_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;float&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;double&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bool&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;signed char&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;signed short&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;signed int&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;signed long&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsigned char&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsigned short&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsigned int&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsigned long&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;size_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wchar_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ptrdiff_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sig_atomic_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;intptr_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uintptr_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;intmax_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uintmax_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-202"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;clock_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;time_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;useconds_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;suseconds_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;FILE&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fpos_t&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;jmp_buf&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;0&quot;</span></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;{}&quot;</span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#tryBlockQuoteExp"><span class="hs-identifier hs-type">tryBlockQuoteExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Exp</span></span><span>
</span><span id="line-212"></span><span id="tryBlockQuoteExp"><span class="annot"><span class="annottext">tryBlockQuoteExp :: QuasiQuoter -&gt; String -&gt; Q Exp
</span><a href="Language.C.Inline.Cpp.Exception.html#tryBlockQuoteExp"><span class="hs-identifier hs-var hs-var">tryBlockQuoteExp</span></a></span></span><span> </span><span id="local-6989586621679080399"><span class="annot"><span class="annottext">QuasiQuoter
</span><a href="#local-6989586621679080399"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span id="local-6989586621679080400"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080400"><span class="hs-identifier hs-var">blockStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679080401"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080401"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679080402"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080402"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679080403"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080403"><span class="hs-identifier hs-var hs-var">bodyLineShift</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String, Int)
</span><span class="hs-identifier hs-var">C.splitTypedC</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080400"><span class="hs-identifier hs-var">blockStr</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">C.include</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HaskellException.hxx&quot;</span></span><span>
</span><span id="line-215"></span><span>  </span><span id="local-6989586621679080406"><span class="annot"><a href="#local-6989586621679080406"><span class="hs-identifier hs-var">basePtrVarName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newName</span></span><span> </span><span class="annot"><span class="hs-string">&quot;basePtr&quot;</span></span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621679080407"><span class="annot"><a href="#local-6989586621679080407"><span class="hs-identifier hs-var">there</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">location</span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679080415"><span class="annot"><a href="#local-6989586621679080415"><span class="hs-identifier hs-var hs-var">inlineCStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-218"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080401"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; {&quot;</span></span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  void** __inline_c_cpp_base_ptr__ = $(void** &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">nameBase</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679080406"><span class="hs-identifier hs-var">basePtrVarName</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;);&quot;</span></span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  int* __inline_c_cpp_exception_type__ = (int*)__inline_c_cpp_base_ptr__;&quot;</span></span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  const char** __inline_c_cpp_error_message__ = (const char**)(__inline_c_cpp_base_ptr__ + 1);&quot;</span></span><span>
</span><span id="line-222"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  const char** __inline_c_cpp_error_typ__ = (const char**)(__inline_c_cpp_base_ptr__ + 2);&quot;</span></span><span>
</span><span id="line-223"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  std::exception_ptr** __inline_c_cpp_exception_ptr__ = (std::exception_ptr**)(__inline_c_cpp_base_ptr__ + 3);&quot;</span></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  HaskellException** __inline_c_cpp_haskellexception__ = (HaskellException**)(__inline_c_cpp_base_ptr__ + 4);&quot;</span></span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  *__inline_c_cpp_exception_type__ = 0;&quot;</span></span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  try {&quot;</span></span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Loc -&gt; String
</span><span class="hs-identifier hs-var">C.lineDirective</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Loc -&gt; Loc
</span><span class="hs-identifier hs-var">C.shiftLines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679080403"><span class="hs-identifier hs-var">bodyLineShift</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621679080407"><span class="hs-identifier hs-var">there</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080402"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Loc -&gt; String
</span><span class="hs-identifier hs-var">C.lineDirective</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.here</span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  } catch (const HaskellException &amp;e) {&quot;</span></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_exception_type__ = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeHaskellException"><span class="hs-identifier hs-var">ExTypeHaskellException</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_haskellexception__ = new HaskellException(e);&quot;</span></span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    return &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Language.C.Inline.Cpp.Exception.html#exceptionalValue"><span class="hs-identifier hs-var">exceptionalValue</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080401"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  } catch (const std::exception &amp;e) {&quot;</span></span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_exception_ptr__ = new std::exception_ptr(std::current_exception());&quot;</span></span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_exception_type__ = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeStdException"><span class="hs-identifier hs-var">ExTypeStdException</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-237"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    setMessageOfStdException(e, __inline_c_cpp_error_message__, __inline_c_cpp_error_typ__);&quot;</span></span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    return &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Language.C.Inline.Cpp.Exception.html#exceptionalValue"><span class="hs-identifier hs-var">exceptionalValue</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080401"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-239"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  } catch (...) {&quot;</span></span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_exception_ptr__ = new std::exception_ptr(std::current_exception());&quot;</span></span><span>
</span><span id="line-241"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    *__inline_c_cpp_exception_type__ = &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">CInt -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CInt
</span><a href="Language.C.Inline.Cpp.Exception.html#ExTypeOtherException"><span class="hs-identifier hs-var">ExTypeOtherException</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-242"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    setCppExceptionType(__inline_c_cpp_error_typ__);&quot;</span></span><span>
</span><span id="line-243"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    return &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><a href="Language.C.Inline.Cpp.Exception.html#exceptionalValue"><span class="hs-identifier hs-var">exceptionalValue</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679080401"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  }&quot;</span></span><span>
</span><span id="line-245"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;}&quot;</span></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">[e|</span><span> </span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#handleForeignCatch"><span class="hs-identifier hs-type">handleForeignCatch</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">varP</span></span><span> </span><span class="annot"><a href="#local-6989586621679080406"><span class="hs-identifier hs-type">basePtrVarName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="annot"><a href="#local-6989586621679080399"><span class="hs-identifier hs-type">block</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679080415"><span class="hs-identifier hs-type">inlineCStr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | Similar to `C.block`, but C++ exceptions will be caught and the result is (Either CppException value). The return type must be void or constructible with @{}@.</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- Using this will automatically include @exception@, @cstring@ and @cstdlib@.</span><span>
</span><span id="line-251"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#tryBlock"><span class="hs-identifier hs-type">tryBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-252"></span><span id="tryBlock"><span class="annot"><span class="annottext">tryBlock :: QuasiQuoter
</span><a href="Language.C.Inline.Cpp.Exception.html#tryBlock"><span class="hs-identifier hs-var hs-var">tryBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">QuasiQuoter</span></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">quoteExp :: String -&gt; Q Exp
</span><span class="hs-identifier hs-var">quoteExp</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QuasiQuoter -&gt; String -&gt; Q Exp
</span><a href="Language.C.Inline.Cpp.Exception.html#tryBlockQuoteExp"><span class="hs-identifier hs-var">tryBlockQuoteExp</span></a></span><span> </span><span class="annot"><span class="annottext">QuasiQuoter
</span><span class="hs-identifier hs-var">C.block</span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quotePat :: String -&gt; Q Pat
</span><span class="hs-identifier hs-var">quotePat</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Pat
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080423"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteType :: String -&gt; Q Type
</span><span class="hs-identifier hs-var">quoteType</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q Type
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080423"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">quoteDec :: String -&gt; Q [Dec]
</span><span class="hs-identifier hs-var">quoteDec</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Q [Dec]
forall {m :: * -&gt; *} {p} {a}. MonadFail m =&gt; p -&gt; m a
</span><a href="#local-6989586621679080423"><span class="hs-identifier hs-var">unsupported</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-258"></span><span>      </span><span id="local-6989586621679080423"><span class="annot"><span class="annottext">unsupported :: p -&gt; m a
</span><a href="#local-6989586621679080423"><span class="hs-identifier hs-var hs-var">unsupported</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unsupported quasiquotation.&quot;</span></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="Language.C.Inline.Cpp.Exception.html#bsToChars"><span class="hs-identifier hs-type">bsToChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-261"></span><span id="bsToChars"><span class="annot"><span class="annottext">bsToChars :: ByteString -&gt; String
</span><a href="Language.C.Inline.Cpp.Exception.html#bsToChars"><span class="hs-identifier hs-var hs-var">bsToChars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; String) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OnDecodeError -&gt; ByteString -&gt; Text
</span><span class="hs-identifier hs-var">T.decodeUtf8With</span></span><span> </span><span class="annot"><span class="annottext">OnDecodeError
</span><span class="hs-identifier hs-var">T.lenientDecode</span></span><span>
</span><span id="line-262"></span></pre></body></html>