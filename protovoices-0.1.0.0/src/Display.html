<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="annot"><span class="hs-comment">{- | This module contains functions for visualizing derivations using LaTeX and TikZ.
 These functions are generic over slice and transition contents and are thus somewhat limited.
 For protovoice derivations,
 an alternative to plotting a derivation would be to export an 'Analysis' to JSON
 and view it interactively in the
 [protovoice annotation tool](https://dcmlab.github.io/protovoice-annotation-tool/)
 (not implemented yet).

 Plotting happens in two steps.
 First, a the derivation is &quot;replayed&quot; using a (generic or grammar-specific) &quot;player&quot;
 to construct a 'DerivationGraph',
 which contains all graphical objects and their positions explicitly.
 The 'DerivationGraph' can then be plotted using different backends
 (currently only TikZ, but a diagrams/SVG backed would be useful too).
-}</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Display.html"><span class="hs-identifier">Display</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier">DerivationGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier">DerivSlice</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier">DerivTrans</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Replaying Derivations</span></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivation"><span class="hs-identifier">replayDerivation</span></a></span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivation%27"><span class="hs-identifier">replayDerivation'</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#replayDerivationFull"><span class="hs-identifier">replayDerivationFull</span></a></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#unfoldDerivation"><span class="hs-identifier">unfoldDerivation</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier">unfoldDerivation'</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Derivation Players</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier">DerivationPlayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier">derivationPlayerUnit</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier">derivationPlayerEmpty</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier">Empty</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Plotting Derivation Graphs with TikZ</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier">tikzDerivationGraph</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzPic"><span class="hs-identifier">tikzPic</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#tikzStandalone"><span class="hs-identifier">tikzStandalone</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#writeGraph"><span class="hs-identifier">writeGraph</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#writeGraphs"><span class="hs-identifier">writeGraphs</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#viewGraph"><span class="hs-identifier">viewGraph</span></a></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#viewGraphs"><span class="hs-identifier">viewGraphs</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.IO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Process</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">callCommand</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bimap</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsString</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.FilePath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FP</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- derivation graphs</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- =================</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">-- | A slice together with a depth and an ID</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">data</span><span> </span><span id="DerivSlice"><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span></span><span> </span><span id="local-6989586621679462210"><span class="annot"><a href="#local-6989586621679462210"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivSlice"><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dslDepth"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var hs-var">dslDepth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dslId"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var hs-var">dslId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dslContent"><span class="annot"><span class="annottext">forall slc. DerivSlice slc -&gt; StartStop slc
</span><a href="Display.html#dslContent"><span class="hs-identifier hs-var hs-var">dslContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462210"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679462611"><span id="local-6989586621679462618"><span class="annot"><span class="annottext">DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
(DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; Eq (DerivSlice slc)
forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
== :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c/= :: forall slc. Eq slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
/= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462627"><span id="local-6989586621679462634"><span id="local-6989586621679462639"><span id="local-6989586621679462643"><span id="local-6989586621679462646"><span id="local-6989586621679462649"><span id="local-6989586621679462652"><span class="annot"><span class="annottext">Eq (DerivSlice slc)
Eq (DerivSlice slc) =&gt;
(DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; Bool)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc)
-&gt; (DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc)
-&gt; Ord (DerivSlice slc)
DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall slc. Ord slc =&gt; Eq (DerivSlice slc)
forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
$ccompare :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
compare :: DerivSlice slc -&gt; DerivSlice slc -&gt; Ordering
$c&lt; :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&lt; :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&lt;= :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&lt;= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&gt; :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&gt; :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$c&gt;= :: forall slc. Ord slc =&gt; DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
&gt;= :: DerivSlice slc -&gt; DerivSlice slc -&gt; Bool
$cmax :: forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
max :: DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
$cmin :: forall slc.
Ord slc =&gt;
DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
min :: DerivSlice slc -&gt; DerivSlice slc -&gt; DerivSlice slc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462662"><span id="local-6989586621679462670"><span id="local-6989586621679462674"><span class="annot"><span class="annottext">Int -&gt; DerivSlice slc -&gt; ShowS
[DerivSlice slc] -&gt; ShowS
DerivSlice slc -&gt; String
(Int -&gt; DerivSlice slc -&gt; ShowS)
-&gt; (DerivSlice slc -&gt; String)
-&gt; ([DerivSlice slc] -&gt; ShowS)
-&gt; Show (DerivSlice slc)
forall slc. Show slc =&gt; Int -&gt; DerivSlice slc -&gt; ShowS
forall slc. Show slc =&gt; [DerivSlice slc] -&gt; ShowS
forall slc. Show slc =&gt; DerivSlice slc -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall slc. Show slc =&gt; Int -&gt; DerivSlice slc -&gt; ShowS
showsPrec :: Int -&gt; DerivSlice slc -&gt; ShowS
$cshow :: forall slc. Show slc =&gt; DerivSlice slc -&gt; String
show :: DerivSlice slc -&gt; String
$cshowList :: forall slc. Show slc =&gt; [DerivSlice slc] -&gt; ShowS
showList :: [DerivSlice slc] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">-- | A transition between two 'DerivSlice's.</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">type</span><span> </span><span id="DerivTrans"><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-var">DerivTrans</span></a></span></span><span> </span><span id="local-6989586621679462678"><span class="annot"><a href="#local-6989586621679462678"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679462679"><span class="annot"><a href="#local-6989586621679462679"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462678"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462679"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462678"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="annot"><span class="hs-comment">{- | A derivation graph.
 Contains the graphical objects of a derivation plot
 as well as intermediate information that is used during a replay.
-}</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">data</span><span> </span><span id="DerivationGraph"><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-var">DerivationGraph</span></a></span></span><span> </span><span id="local-6989586621679462229"><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679462230"><span class="annot"><a href="#local-6989586621679462230"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DGraph"><span class="annot"><a href="Display.html#DGraph"><span class="hs-identifier hs-var">DGraph</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dgNextId"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Int
</span><a href="Display.html#dgNextId"><span class="hs-identifier hs-var hs-var">dgNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a counter for generating new IDs (used during replay)</span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgSlices"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivSlice slc)
</span><a href="Display.html#dgSlices"><span class="hs-identifier hs-var hs-var">dgSlices</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the positioned slices of the derivation graph</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgTransitions"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var hs-var">dgTransitions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462230"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the positioned transitionn in the derivation graph</span></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgHoriEdges"><span class="annot"><span class="annottext">forall slc tr.
DerivationGraph slc tr -&gt; Set (DerivSlice slc, DerivSlice slc)
</span><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var hs-var">dgHoriEdges</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- ^ the &quot;horizontalization&quot; edges</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-comment">-- (connecting the parent slice of a spread to its children)</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgOpen"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var hs-var">dgOpen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462230"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the open transitions of the current surface</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgFrozen"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var hs-var">dgFrozen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462230"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the frozen transitions of the current surface in reverse order</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dgRoot"><span class="annot"><span class="annottext">forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgRoot"><span class="hs-identifier hs-var hs-var">dgRoot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462229"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462230"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the root transitions</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679462691"><span id="local-6989586621679462705"><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
(DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; (DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; Eq (DerivationGraph slc tr)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c== :: forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
== :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c/= :: forall slc tr.
(Eq slc, Eq tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
/= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462717"><span id="local-6989586621679462731"><span id="local-6989586621679462743"><span id="local-6989586621679462747"><span id="local-6989586621679462750"><span id="local-6989586621679462753"><span id="local-6989586621679462756"><span class="annot"><span class="annottext">Eq (DerivationGraph slc tr)
Eq (DerivationGraph slc tr) =&gt;
(DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering)
-&gt; (DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; (DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; (DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; (DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool)
-&gt; (DerivationGraph slc tr
    -&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr)
-&gt; (DerivationGraph slc tr
    -&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr)
-&gt; Ord (DerivationGraph slc tr)
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall slc tr. (Ord slc, Ord tr) =&gt; Eq (DerivationGraph slc tr)
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
$ccompare :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
compare :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Ordering
$c&lt; :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&lt; :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&lt;= :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&lt;= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&gt; :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&gt; :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$c&gt;= :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
&gt;= :: DerivationGraph slc tr -&gt; DerivationGraph slc tr -&gt; Bool
$cmax :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
max :: DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
$cmin :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
min :: DerivationGraph slc tr
-&gt; DerivationGraph slc tr -&gt; DerivationGraph slc tr
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462763"><span id="local-6989586621679462778"><span id="local-6989586621679462782"><span class="annot"><span class="annottext">Int -&gt; DerivationGraph slc tr -&gt; ShowS
[DerivationGraph slc tr] -&gt; ShowS
DerivationGraph slc tr -&gt; String
(Int -&gt; DerivationGraph slc tr -&gt; ShowS)
-&gt; (DerivationGraph slc tr -&gt; String)
-&gt; ([DerivationGraph slc tr] -&gt; ShowS)
-&gt; Show (DerivationGraph slc tr)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall slc tr.
(Show slc, Show tr) =&gt;
Int -&gt; DerivationGraph slc tr -&gt; ShowS
forall slc tr.
(Show slc, Show tr) =&gt;
[DerivationGraph slc tr] -&gt; ShowS
forall slc tr.
(Show slc, Show tr) =&gt;
DerivationGraph slc tr -&gt; String
$cshowsPrec :: forall slc tr.
(Show slc, Show tr) =&gt;
Int -&gt; DerivationGraph slc tr -&gt; ShowS
showsPrec :: Int -&gt; DerivationGraph slc tr -&gt; ShowS
$cshow :: forall slc tr.
(Show slc, Show tr) =&gt;
DerivationGraph slc tr -&gt; String
show :: DerivationGraph slc tr -&gt; String
$cshowList :: forall slc tr.
(Show slc, Show tr) =&gt;
[DerivationGraph slc tr] -&gt; ShowS
showList :: [DerivationGraph slc tr] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="annot"><span class="hs-comment">-- | Alias for the type of a monadic action during derivation replay.</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">type</span><span> </span><span id="DerivationOp"><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-var">DerivationOp</span></a></span></span><span> </span><span id="local-6989586621679462786"><span class="annot"><a href="#local-6989586621679462786"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679462787"><span class="annot"><a href="#local-6989586621679462787"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ST.StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462786"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462787"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><span class="hs-comment">-- | Removes and returns an open transition from the current surface.</span></span><span>
</span><span id="line-105"></span><span id="local-6989586621679462281"><span id="local-6989586621679462282"><span class="annot"><a href="Display.html#popOpen"><span class="hs-identifier hs-type">popOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462281"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462282"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462281"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462282"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-106"></span><span id="popOpen"><span class="annot"><span class="annottext">popOpen :: forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var hs-var">popOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>  </span><span id="local-6989586621679462807"><span class="annot"><a href="#local-6989586621679462807"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (DerivationGraph slc tr) (Either String) (DerivationGraph slc tr)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462807"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either String (DerivTrans slc tr)
-&gt; StateT
     (DerivationGraph slc tr) (Either String) (DerivTrans slc tr)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; StateT (DerivationGraph slc tr) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">ST.lift</span></span><span> </span><span class="annot"><span class="annottext">(Either String (DerivTrans slc tr)
 -&gt; StateT
      (DerivationGraph slc tr) (Either String) (DerivTrans slc tr))
-&gt; Either String (DerivTrans slc tr)
-&gt; StateT
     (DerivationGraph slc tr) (Either String) (DerivTrans slc tr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String (DerivTrans slc tr)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;popOpen: no transition to pop&quot;</span></span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679462809"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679462809"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679462810"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679462810"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>      </span><span class="annot"><span class="annottext">DerivationGraph slc tr
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">ST.put</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462807"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462810"><span class="hs-identifier hs-type">ts</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">DerivTrans slc tr
-&gt; StateT
     (DerivationGraph slc tr) (Either String) (DerivTrans slc tr)
forall a. a -&gt; StateT (DerivationGraph slc tr) (Either String) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679462809"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><span class="hs-comment">-- | Adds a list of new open transitions to the current surface and the derivation graph.</span></span><span>
</span><span id="line-115"></span><span id="local-6989586621679462316"><span id="local-6989586621679462317"><span class="annot"><a href="Display.html#pushOpen"><span class="hs-identifier hs-type">pushOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462316"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462317"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462316"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462317"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462316"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462317"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-116"></span><span id="pushOpen"><span class="annot"><span class="annottext">pushOpen :: forall slc tr.
(Ord slc, Ord tr) =&gt;
[DerivTrans slc tr] -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushOpen"><span class="hs-identifier hs-var hs-var">pushOpen</span></a></span></span><span> </span><span id="local-6989586621679462821"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679462821"><span class="hs-identifier hs-var">newts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>  </span><span id="local-6989586621679462822"><span class="annot"><a href="#local-6989586621679462822"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (DerivationGraph slc tr) (Either String) (DerivationGraph slc tr)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679462833"><span class="annot"><a href="#local-6989586621679462833"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr] -&gt; Set (DerivTrans slc tr)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679462821"><span class="hs-identifier hs-var">newts</span></a></span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
-&gt; Set (DerivTrans slc tr) -&gt; Set (DerivTrans slc tr)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462822"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span id="local-6989586621679462837"><span class="annot"><a href="#local-6989586621679462837"><span class="hs-identifier hs-var hs-var">surf'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679462821"><span class="hs-identifier hs-var">newts</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr] -&gt; [DerivTrans slc tr] -&gt; [DerivTrans slc tr]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; [DerivTrans slc tr]
forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462822"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ST.put</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679462822"><span class="hs-identifier hs-type">graph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462833"><span class="hs-identifier hs-type">trans'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462837"><span class="hs-identifier hs-type">surf'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><span class="hs-comment">-- | Adds a frozen transition to the current surface and the derivation graph.</span></span><span>
</span><span id="line-123"></span><span id="local-6989586621679462324"><span id="local-6989586621679462325"><span class="annot"><a href="Display.html#pushClosed"><span class="hs-identifier hs-type">pushClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462324"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462325"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivTrans"><span class="hs-identifier hs-type">DerivTrans</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462324"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462325"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462324"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462325"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-124"></span><span id="pushClosed"><span class="annot"><span class="annottext">pushClosed :: forall slc tr.
(Ord slc, Ord tr) =&gt;
DerivTrans slc tr -&gt; DerivationOp slc tr ()
</span><a href="Display.html#pushClosed"><span class="hs-identifier hs-var hs-var">pushClosed</span></a></span></span><span> </span><span id="local-6989586621679462847"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679462847"><span class="hs-identifier hs-var">newt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>  </span><span id="local-6989586621679462848"><span class="annot"><a href="#local-6989586621679462848"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (DerivationGraph slc tr) (Either String) (DerivationGraph slc tr)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679462856"><span class="annot"><a href="#local-6989586621679462856"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
-&gt; Set (DerivTrans slc tr) -&gt; Set (DerivTrans slc tr)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679462847"><span class="hs-identifier hs-var">newt</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (DerivTrans slc tr) -&gt; Set (DerivTrans slc tr))
-&gt; Set (DerivTrans slc tr) -&gt; Set (DerivTrans slc tr)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
forall slc tr. DerivationGraph slc tr -&gt; Set (DerivTrans slc tr)
</span><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462848"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span id="local-6989586621679462858"><span class="annot"><a href="#local-6989586621679462858"><span class="hs-identifier hs-var hs-var">frozen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679462847"><span class="hs-identifier hs-var">newt</span></a></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr -&gt; [DerivTrans slc tr] -&gt; [DerivTrans slc tr]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; [DerivTrans slc tr]
forall slc tr. DerivationGraph slc tr -&gt; [DerivTrans slc tr]
</span><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var">dgFrozen</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462848"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ST.put</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679462848"><span class="hs-identifier hs-type">graph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Display.html#dgTransitions"><span class="hs-identifier hs-var">dgTransitions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462856"><span class="hs-identifier hs-type">trans'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#dgFrozen"><span class="hs-identifier hs-var">dgFrozen</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462858"><span class="hs-identifier hs-type">frozen'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="annot"><span class="hs-comment">-- | Adds a new slice to the derivation graph.</span></span><span>
</span><span id="line-131"></span><span id="local-6989586621679462329"><span id="local-6989586621679462330"><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462329"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462329"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462329"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462330"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462329"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-132"></span><span id="addSlice"><span class="annot"><span class="annottext">addSlice :: forall slc tr.
Ord slc =&gt;
slc -&gt; Int -&gt; DerivationOp slc tr (DerivSlice slc)
</span><a href="Display.html#addSlice"><span class="hs-identifier hs-var hs-var">addSlice</span></a></span></span><span> </span><span id="local-6989586621679462872"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679462872"><span class="hs-identifier hs-var">sliceContent</span></a></span></span><span> </span><span id="local-6989586621679462873"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679462873"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621679462874"><span class="annot"><a href="#local-6989586621679462874"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (DerivationGraph slc tr) (Either String) (DerivationGraph slc tr)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679462875"><span class="annot"><a href="#local-6989586621679462875"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Int
forall slc tr. DerivationGraph slc tr -&gt; Int
</span><a href="Display.html#dgNextId"><span class="hs-identifier hs-var">dgNextId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462874"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span id="local-6989586621679462876"><span class="annot"><a href="#local-6989586621679462876"><span class="hs-identifier hs-var hs-var">newSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
forall slc. Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
</span><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679462873"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679462875"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc -&gt; StartStop slc
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679462872"><span class="hs-identifier hs-var">sliceContent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span id="local-6989586621679462881"><span class="annot"><a href="#local-6989586621679462881"><span class="hs-identifier hs-var hs-var">slices'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Set (DerivSlice slc) -&gt; Set (DerivSlice slc)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679462876"><span class="hs-identifier hs-var">newSlice</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (DerivSlice slc) -&gt; Set (DerivSlice slc))
-&gt; Set (DerivSlice slc) -&gt; Set (DerivSlice slc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Set (DerivSlice slc)
forall slc tr. DerivationGraph slc tr -&gt; Set (DerivSlice slc)
</span><a href="Display.html#dgSlices"><span class="hs-identifier hs-var">dgSlices</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462874"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ST.put</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679462874"><span class="hs-identifier hs-type">graph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Display.html#dgNextId"><span class="hs-identifier hs-var">dgNextId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462875"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#dgSlices"><span class="hs-identifier hs-var">dgSlices</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462881"><span class="hs-identifier hs-type">slices'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="#local-6989586621679462876"><span class="hs-identifier hs-type">newSlice</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><span class="hs-comment">-- | Adds a new horizontalization edge to the derivation graph.</span></span><span>
</span><span id="line-141"></span><span id="local-6989586621679462335"><span id="local-6989586621679462336"><span class="annot"><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-type">addHoriEdge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462335"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462335"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462335"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462335"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462336"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-142"></span><span id="addHoriEdge"><span class="annot"><span class="annottext">addHoriEdge :: forall slc tr.
Ord slc =&gt;
(DerivSlice slc, DerivSlice slc) -&gt; DerivationOp slc tr ()
</span><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-var hs-var">addHoriEdge</span></a></span></span><span> </span><span id="local-6989586621679462890"><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679462890"><span class="hs-identifier hs-var">edge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>  </span><span id="local-6989586621679462891"><span class="annot"><a href="#local-6989586621679462891"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (DerivationGraph slc tr) (Either String) (DerivationGraph slc tr)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">ST.get</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679462897"><span class="annot"><a href="#local-6989586621679462897"><span class="hs-identifier hs-var hs-var">horis'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc)
-&gt; Set (DerivSlice slc, DerivSlice slc)
-&gt; Set (DerivSlice slc, DerivSlice slc)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">S.insert</span></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679462890"><span class="hs-identifier hs-var">edge</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (DerivSlice slc, DerivSlice slc)
 -&gt; Set (DerivSlice slc, DerivSlice slc))
-&gt; Set (DerivSlice slc, DerivSlice slc)
-&gt; Set (DerivSlice slc, DerivSlice slc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Set (DerivSlice slc, DerivSlice slc)
forall slc tr.
DerivationGraph slc tr -&gt; Set (DerivSlice slc, DerivSlice slc)
</span><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var">dgHoriEdges</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679462891"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ST.put</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679462891"><span class="hs-identifier hs-type">graph</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Display.html#dgHoriEdges"><span class="hs-identifier hs-var">dgHoriEdges</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679462897"><span class="hs-identifier hs-type">horis'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="annot"><span class="hs-comment">{- | A derivation player.
 Contains functions for replaying derivations of a particular grammar,
 i.e. for deriving child elements from parent elements.
-}</span></span><span>
</span><span id="line-151"></span><span class="hs-keyword">data</span><span> </span><span id="DerivationPlayer"><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span></span><span> </span><span id="local-6989586621679462339"><span class="annot"><a href="#local-6989586621679462339"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679462340"><span class="annot"><a href="#local-6989586621679462340"><span class="hs-identifier hs-type">f</span></a></span></span><span> </span><span id="local-6989586621679462341"><span class="annot"><a href="#local-6989586621679462341"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679462342"><span class="annot"><a href="#local-6989586621679462342"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679462343"><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DerivationPlayer"><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span></span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="dpTopTrans"><span class="annot"><span class="annottext">forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var hs-var">dpTopTrans</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the grammars default starting transition for @&#8906;&#8212;&#8212;&#8905;@</span></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpSplit"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; s -&gt; tr -&gt; Either String (tr, slc, tr)
</span><a href="Display.html#dpSplit"><span class="hs-identifier hs-var hs-var">dpSplit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462339"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462342"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ replay a split operation</span></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpFreeze"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr -&gt; f -&gt; tr -&gt; Either String tr
</span><a href="Display.html#dpFreeze"><span class="hs-identifier hs-var hs-var">dpFreeze</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462340"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ replay a freeze operation</span></span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="dpSpread"><span class="annot"><span class="annottext">forall s f h slc tr.
DerivationPlayer s f h slc tr
-&gt; h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr)
</span><a href="Display.html#dpSpread"><span class="hs-identifier hs-var hs-var">dpSpread</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462341"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462342"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462342"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462342"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462343"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ replay a spread operation</span></span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><span class="hs-comment">-- | Replays a single derivation step and applies it to the derivation graph.</span></span><span>
</span><span id="line-163"></span><span id="local-6989586621679462365"><span id="local-6989586621679462366"><span id="local-6989586621679462367"><span id="local-6989586621679462368"><span id="local-6989586621679462369"><span class="annot"><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-type">replayDerivationStep</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462365"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462366"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462367"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462368"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462369"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462365"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462366"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462367"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462368"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462369"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the operation to be applied</span></span><span>
</span><span id="line-169"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationOp"><span class="hs-identifier hs-type">DerivationOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462365"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462366"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-170"></span><span id="replayDerivationStep"><span class="annot"><span class="annottext">replayDerivationStep :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var hs-var">replayDerivationStep</span></a></span></span><span> </span><span id="local-6989586621679462908"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679462908"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span>
</span><span id="line-171"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621679462909"><span class="annot"><span class="annottext">applyRule :: Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679462909"><span class="hs-identifier hs-var hs-var">applyRule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitLeft"><span class="hs-identifier hs-type">LMSplitLeft</span></a></span><span> </span><span id="local-6989586621679462961"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679462961"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462962"><span class="annot"><a href="#local-6989586621679462962"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462963"><span class="annot"><a href="#local-6989586621679462963"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462964"><span class="annot"><a href="#local-6989586621679462964"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivationOp slc tr (DerivSlice slc, tr, DerivSlice slc)
forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462965"><span class="annot"><a href="#local-6989586621679462965"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462966"><span class="annot"><a href="#local-6989586621679462966"><span class="hs-identifier hs-var">cm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462967"><span class="annot"><a href="#local-6989586621679462967"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Display.html#dpSplit"><span class="hs-identifier hs-var">dpSplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462908"><span class="hs-identifier hs-type">player</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462961"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462963"><span class="hs-identifier hs-type">pt</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679462968"><span class="annot"><a href="#local-6989586621679462968"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462966"><span class="hs-identifier hs-type">cm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462962"><span class="hs-identifier hs-type">pl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462964"><span class="hs-identifier hs-type">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="Display.html#pushOpen"><span class="hs-identifier hs-type">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462962"><span class="hs-identifier hs-type">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462965"><span class="hs-identifier hs-type">cl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462968"><span class="hs-identifier hs-type">sm</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462968"><span class="hs-identifier hs-type">sm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462967"><span class="hs-identifier hs-type">cr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462964"><span class="hs-identifier hs-type">pr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitOnly"><span class="hs-identifier hs-type">LMSplitOnly</span></a></span><span> </span><span id="local-6989586621679462971"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679462971"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="annot"><span class="annottext">(Leftmost s f h
 -&gt; StateT (DerivationGraph slc tr) (Either String) ())
-&gt; Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Leftmost s f h
forall s f h. s -&gt; Leftmost s f h
</span><a href="Common.html#LMSplitLeft"><span class="hs-identifier hs-var">LMSplitLeft</span></a></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679462971"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSplitRight"><span class="hs-identifier hs-type">LMSplitRight</span></a></span><span> </span><span id="local-6989586621679462973"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679462973"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679462974"><span class="annot"><a href="#local-6989586621679462974"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivationOp slc tr (DerivSlice slc, tr, DerivSlice slc)
forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462975"><span class="annot"><a href="#local-6989586621679462975"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462976"><span class="annot"><a href="#local-6989586621679462976"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462977"><span class="annot"><a href="#local-6989586621679462977"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#popOpen"><span class="hs-identifier hs-type">popOpen</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462978"><span class="annot"><a href="#local-6989586621679462978"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462979"><span class="annot"><a href="#local-6989586621679462979"><span class="hs-identifier hs-var">cm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462980"><span class="annot"><a href="#local-6989586621679462980"><span class="hs-identifier hs-var">cr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Display.html#dpSplit"><span class="hs-identifier hs-var">dpSplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462908"><span class="hs-identifier hs-type">player</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462973"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462976"><span class="hs-identifier hs-type">pt</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679462981"><span class="annot"><a href="#local-6989586621679462981"><span class="hs-identifier hs-var">sm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462979"><span class="hs-identifier hs-type">cm</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462975"><span class="hs-identifier hs-type">pl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462977"><span class="hs-identifier hs-type">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">+</span></span><span> </span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="Display.html#pushOpen"><span class="hs-identifier hs-type">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679462974"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462975"><span class="hs-identifier hs-type">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462978"><span class="hs-identifier hs-type">cl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462981"><span class="hs-identifier hs-type">sm</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462981"><span class="hs-identifier hs-type">sm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462980"><span class="hs-identifier hs-type">cr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462977"><span class="hs-identifier hs-type">pr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-184"></span><span>  </span><span class="annot"><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMFreezeLeft"><span class="hs-identifier hs-type">LMFreezeLeft</span></a></span><span> </span><span id="local-6989586621679462983"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679462983"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462984"><span class="annot"><a href="#local-6989586621679462984"><span class="hs-identifier hs-var">pl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462985"><span class="annot"><a href="#local-6989586621679462985"><span class="hs-identifier hs-var">pt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462986"><span class="annot"><a href="#local-6989586621679462986"><span class="hs-identifier hs-var">pr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivationOp slc tr (DerivSlice slc, tr, DerivSlice slc)
forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679462987"><span class="annot"><a href="#local-6989586621679462987"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Display.html#dpFreeze"><span class="hs-identifier hs-var">dpFreeze</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462908"><span class="hs-identifier hs-type">player</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462983"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462985"><span class="hs-identifier hs-type">pt</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="annot"><a href="Display.html#pushClosed"><span class="hs-identifier hs-type">pushClosed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462984"><span class="hs-identifier hs-type">pl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462987"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462986"><span class="hs-identifier hs-type">pr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMFreezeOnly"><span class="hs-identifier hs-type">LMFreezeOnly</span></a></span><span> </span><span id="local-6989586621679462989"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679462989"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
</span><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="annot"><span class="annottext">(Leftmost s f h
 -&gt; StateT (DerivationGraph slc tr) (Either String) ())
-&gt; Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">f -&gt; Leftmost s f h
forall f s h. f -&gt; Leftmost s f h
</span><a href="Common.html#LMFreezeLeft"><span class="hs-identifier hs-var">LMFreezeLeft</span></a></span><span> </span><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679462989"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="#local-6989586621679462909"><span class="hs-identifier hs-var">applyRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#LMSpread"><span class="hs-identifier hs-type">LMSpread</span></a></span><span> </span><span id="local-6989586621679462991"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679462991"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679462992"><span class="annot"><a href="#local-6989586621679462992"><span class="hs-identifier hs-var">lpl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462993"><span class="annot"><a href="#local-6989586621679462993"><span class="hs-identifier hs-var">lpt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462994"><span class="annot"><a href="#local-6989586621679462994"><span class="hs-identifier hs-var">pm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivationOp slc tr (DerivSlice slc, tr, DerivSlice slc)
forall slc tr. DerivationOp slc tr (DerivTrans slc tr)
</span><a href="Display.html#popOpen"><span class="hs-identifier hs-var">popOpen</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462995"><span class="annot"><a href="#local-6989586621679462995"><span class="hs-identifier hs-var">rpt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679462996"><span class="annot"><a href="#local-6989586621679462996"><span class="hs-identifier hs-var">rpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#popOpen"><span class="hs-identifier hs-type">popOpen</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679463001"><span class="annot"><a href="#local-6989586621679463001"><span class="hs-identifier hs-var hs-var">depth'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679462992"><span class="hs-identifier hs-var">lpl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679462994"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679462996"><span class="hs-identifier hs-var">rpr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679463002"><span class="annot"><a href="#local-6989586621679463002"><span class="hs-identifier hs-var">pmInner</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Common.html#getInnerE"><span class="hs-identifier hs-type">getInnerE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#dslContent"><span class="hs-identifier hs-var">dslContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462994"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679463004"><span class="annot"><a href="#local-6989586621679463004"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463005"><span class="annot"><a href="#local-6989586621679463005"><span class="hs-identifier hs-var">lc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463006"><span class="annot"><a href="#local-6989586621679463006"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463007"><span class="annot"><a href="#local-6989586621679463007"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463008"><span class="annot"><a href="#local-6989586621679463008"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Display.html#dpSpread"><span class="hs-identifier hs-var">dpSpread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462908"><span class="hs-identifier hs-type">player</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462991"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462993"><span class="hs-identifier hs-type">lpt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463002"><span class="hs-identifier hs-type">pmInner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462995"><span class="hs-identifier hs-type">rpt</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679463009"><span class="annot"><a href="#local-6989586621679463009"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463005"><span class="hs-identifier hs-type">lc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463001"><span class="hs-identifier hs-type">depth'</span></a></span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679463010"><span class="annot"><a href="#local-6989586621679463010"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Display.html#addSlice"><span class="hs-identifier hs-type">addSlice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463007"><span class="hs-identifier hs-type">rc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463001"><span class="hs-identifier hs-type">depth'</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-type">addHoriEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462994"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463009"><span class="hs-identifier hs-type">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="Display.html#addHoriEdge"><span class="hs-identifier hs-type">addHoriEdge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462994"><span class="hs-identifier hs-type">pm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463010"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="Display.html#pushOpen"><span class="hs-identifier hs-type">pushOpen</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462992"><span class="hs-identifier hs-type">lpl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463004"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463009"><span class="hs-identifier hs-type">ls</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679463009"><span class="hs-identifier hs-type">ls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463006"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463010"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679463010"><span class="hs-identifier hs-type">rs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679463008"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679462996"><span class="hs-identifier hs-type">rpr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="annot"><span class="hs-comment">-- | Creates the initial state of the derivation graph.</span></span><span>
</span><span id="line-202"></span><span id="local-6989586621679462383"><span id="local-6989586621679462384"><span class="annot"><a href="Display.html#initialGraph"><span class="hs-identifier hs-type">initialGraph</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462383"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462384"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462384"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462383"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-comment">-- DerivationPlayer s f h slc tr</span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462383"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462384"><span class="hs-identifier hs-type">tr</span></a></span></span></span><span>
</span><span id="line-206"></span><span id="initialGraph"><span class="annot"><span class="annottext">initialGraph :: forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var hs-var">initialGraph</span></a></span></span><span> </span><span id="local-6989586621679463018"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463018"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="annottext">Int
-&gt; Set (DerivSlice slc)
-&gt; Set (DerivTrans slc tr)
-&gt; Set (DerivSlice slc, DerivSlice slc)
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; DerivationGraph slc tr
forall slc tr.
Int
-&gt; Set (DerivSlice slc)
-&gt; Set (DerivTrans slc tr)
-&gt; Set (DerivSlice slc, DerivSlice slc)
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; [DerivTrans slc tr]
-&gt; DerivationGraph slc tr
</span><a href="Display.html#DGraph"><span class="hs-identifier hs-var">DGraph</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path tr slc -&gt; Int
forall a b. Path a b -&gt; Int
</span><a href="Common.html#pathLen"><span class="hs-identifier hs-var">pathLen</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463018"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DerivSlice slc] -&gt; Set (DerivSlice slc)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679463020"><span class="hs-identifier hs-var">topSlices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DerivTrans slc tr] -&gt; Set (DerivTrans slc tr)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463021"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
forall a. Set a
</span><span class="hs-identifier hs-var">S.empty</span></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463021"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463021"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-215"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621679463023"><span class="annot"><span class="annottext">topStart :: DerivSlice slc
</span><a href="#local-6989586621679463023"><span class="hs-identifier hs-var hs-var">topStart</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
forall slc. Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
</span><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-comment">-- collect initial slices (+ Start / Stop)</span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621679463028"><span class="annot"><span class="annottext">topContents :: [StartStop slc]
</span><a href="#local-6989586621679463028"><span class="hs-identifier hs-var hs-var">topContents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc -&gt; StartStop slc
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">(slc -&gt; StartStop slc) -&gt; [slc] -&gt; [StartStop slc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path tr slc -&gt; [slc]
forall a b. Path a b -&gt; [b]
</span><a href="Common.html#pathBetweens"><span class="hs-identifier hs-var">pathBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463018"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[StartStop slc] -&gt; [StartStop slc] -&gt; [StartStop slc]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StartStop slc
forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- assign depth=0 and running IDs to initial slices</span><span>
</span><span id="line-220"></span><span>  </span><span id="local-6989586621679463035"><span class="annot"><span class="annottext">topSlicesTail :: [DerivSlice slc]
</span><a href="#local-6989586621679463035"><span class="hs-identifier hs-var hs-var">topSlicesTail</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; StartStop slc -&gt; DerivSlice slc)
-&gt; [Int] -&gt; [StartStop slc] -&gt; [DerivSlice slc]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
forall slc. Int -&gt; Int -&gt; StartStop slc -&gt; DerivSlice slc
</span><a href="Display.html#DerivSlice"><span class="hs-identifier hs-var">DerivSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[StartStop slc]
</span><a href="#local-6989586621679463028"><span class="hs-identifier hs-var">topContents</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span id="local-6989586621679463020"><span class="annot"><span class="annottext">topSlices :: [DerivSlice slc]
</span><a href="#local-6989586621679463020"><span class="hs-identifier hs-var hs-var">topSlices</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
forall {slc}. DerivSlice slc
</span><a href="#local-6989586621679463023"><span class="hs-identifier hs-var">topStart</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; [DerivSlice slc] -&gt; [DerivSlice slc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679463035"><span class="hs-identifier hs-var">topSlicesTail</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621679463021"><span class="annot"><span class="annottext">top :: [DerivTrans slc tr]
</span><a href="#local-6989586621679463021"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc] -&gt; [tr] -&gt; [DerivSlice slc] -&gt; [DerivTrans slc tr]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><span class="hs-identifier hs-var">zip3</span></span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679463020"><span class="hs-identifier hs-var">topSlices</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path tr slc -&gt; [tr]
forall a b. Path a b -&gt; [a]
</span><a href="Common.html#pathArounds"><span class="hs-identifier hs-var">pathArounds</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463018"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DerivSlice slc]
</span><a href="#local-6989586621679463035"><span class="hs-identifier hs-var">topSlicesTail</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><span class="hs-comment">-- | Replay a derivation from @n@ top-level transitions.</span></span><span>
</span><span id="line-225"></span><span id="local-6989586621679462406"><span id="local-6989586621679462407"><span id="local-6989586621679462408"><span id="local-6989586621679462409"><span id="local-6989586621679462410"><span id="local-6989586621679462411"><span class="annot"><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-type">replayDerivation'</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679462406"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462407"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462408"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462408"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462407"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the starting point of the derivation</span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462409"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462410"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462411"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462407"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462408"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462406"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462409"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462410"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462411"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation</span></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462407"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462408"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-234"></span><span id="replayDerivation%27"><span class="annot"><span class="annottext">replayDerivation' :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h)
-&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-var hs-var">replayDerivation'</span></a></span></span><span> </span><span id="local-6989586621679463049"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463049"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span id="local-6989586621679463050"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463050"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679463051"><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679463051"><span class="hs-identifier hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="annottext">StateT (DerivationGraph slc tr) (Either String) ()
-&gt; DerivationGraph slc tr -&gt; Either String (DerivationGraph slc tr)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">ST.execStateT</span></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Leftmost s f h
 -&gt; StateT (DerivationGraph slc tr) (Either String) ())
-&gt; t (Leftmost s f h)
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
-&gt; Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var">replayDerivationStep</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463050"><span class="hs-identifier hs-var">player</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679463051"><span class="hs-identifier hs-var">deriv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path tr slc -&gt; DerivationGraph slc tr
forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var">initialGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463049"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="annot"><span class="hs-comment">-- | Replay a derivation from @&#8906;&#8212;&#8212;&#8905;@.</span></span><span>
</span><span id="line-240"></span><span id="local-6989586621679462425"><span id="local-6989586621679462426"><span id="local-6989586621679462427"><span id="local-6989586621679462428"><span id="local-6989586621679462429"><span id="local-6989586621679462430"><span class="annot"><a href="Display.html#replayDerivation"><span class="hs-identifier hs-type">replayDerivation</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679462425"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462426"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462427"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462428"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462429"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462430"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462426"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462427"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462425"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462428"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462429"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462430"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation</span></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462426"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462427"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-247"></span><span id="replayDerivation"><span class="annot"><span class="annottext">replayDerivation :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation"><span class="hs-identifier hs-var hs-var">replayDerivation</span></a></span></span><span> </span><span id="local-6989586621679463060"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463060"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h)
-&gt; Either String (DerivationGraph slc tr)
forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h)
-&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation%27"><span class="hs-identifier hs-var">replayDerivation'</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
forall {between}. Path tr between
</span><a href="#local-6989586621679463061"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463060"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-248"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679463061"><span class="annot"><span class="annottext">topPath :: Path tr between
</span><a href="#local-6989586621679463061"><span class="hs-identifier hs-var hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tr -&gt; Path tr between
forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">(tr -&gt; Path tr between) -&gt; tr -&gt; Path tr between
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr -&gt; tr
forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var">dpTopTrans</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463060"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="annot"><span class="hs-comment">{- | Replay a derivation from @&#8906;&#8212;&#8212;&#8905;@
 and ensure that the dervation is complete (freezing all transitions).
 Return an error message if not.
-}</span></span><span>
</span><span id="line-255"></span><span id="local-6989586621679463063"><span id="local-6989586621679463064"><span id="local-6989586621679463065"><span id="local-6989586621679463066"><span id="local-6989586621679463067"><span id="local-6989586621679463068"><span class="annot"><a href="Display.html#replayDerivationFull"><span class="hs-identifier hs-type">replayDerivationFull</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679463063"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679463064"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679463065"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463066"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463067"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463068"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463064"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463065"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679463063"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463066"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463067"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463068"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation</span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463064"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463065"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-262"></span><span id="replayDerivationFull"><span class="annot"><span class="annottext">replayDerivationFull :: forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivationFull"><span class="hs-identifier hs-var hs-var">replayDerivationFull</span></a></span></span><span> </span><span id="local-6989586621679463080"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463080"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span id="local-6989586621679463081"><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679463081"><span class="hs-identifier hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621679463082"><span class="annot"><a href="#local-6989586621679463082"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
forall (t :: * -&gt; *) slc tr s f h.
(Foldable t, Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; t (Leftmost s f h) -&gt; Either String (DerivationGraph slc tr)
</span><a href="Display.html#replayDerivation"><span class="hs-identifier hs-var">replayDerivation</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463080"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">t (Leftmost s f h)
</span><a href="#local-6989586621679463081"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.null</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Display.html#dgOpen"><span class="hs-identifier hs-var">dgOpen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463082"><span class="hs-identifier hs-type">graph</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><a href="#local-6989586621679463082"><span class="hs-identifier hs-type">graph</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Not all open transitions have been frozen!&quot;</span></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">-- TODO: this should work with foldM and a Foldable input:</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">{- | Replays a derivation from @n@ top-level transitions
 and returns every intermediate derivation graph.
-}</span></span><span>
</span><span id="line-273"></span><span id="local-6989586621679462448"><span id="local-6989586621679462449"><span id="local-6989586621679462450"><span id="local-6989586621679462451"><span id="local-6989586621679462452"><span class="annot"><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-type">unfoldDerivation'</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462448"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462449"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462449"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462448"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the starting point of the derivation</span></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462450"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462451"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462452"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462448"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462449"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462450"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462451"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462452"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation</span></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462448"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462449"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-282"></span><span id="unfoldDerivation%27"><span class="annot"><span class="annottext">unfoldDerivation' :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-var hs-var">unfoldDerivation'</span></a></span></span><span> </span><span id="local-6989586621679463090"><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463090"><span class="hs-identifier hs-var">topPath</span></a></span></span><span> </span><span id="local-6989586621679463091"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463091"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463092"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path tr slc -&gt; DerivationGraph slc tr
forall slc tr.
(Ord slc, Ord tr) =&gt;
Path tr slc -&gt; DerivationGraph slc tr
</span><a href="Display.html#initialGraph"><span class="hs-identifier hs-var">initialGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
</span><a href="#local-6989586621679463090"><span class="hs-identifier hs-var">topPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621679463092"><span class="annot"><span class="annottext">go :: DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463092"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679463098"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463098"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679463099"><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463099"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Either String (DerivationGraph slc tr)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463098"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (DerivationGraph slc tr)
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Either String (DerivationGraph slc tr)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463099"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><a href="#local-6989586621679463092"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679463100"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463100"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679463101"><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463101"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463102"><span class="annot"><span class="annottext">Leftmost s f h
</span><a href="#local-6989586621679463102"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679463103"><span class="annot"><span class="annottext">[Leftmost s f h]
</span><a href="#local-6989586621679463103"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StateT (DerivationGraph slc tr) (Either String) ()
-&gt; DerivationGraph slc tr -&gt; Either String (DerivationGraph slc tr)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">ST.execStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
-&gt; Leftmost s f h
-&gt; StateT (DerivationGraph slc tr) (Either String) ()
forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; Leftmost s f h -&gt; DerivationOp slc tr ()
</span><a href="Display.html#replayDerivationStep"><span class="hs-identifier hs-var">replayDerivationStep</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463091"><span class="hs-identifier hs-var">player</span></a></span><span> </span><span class="annot"><span class="annottext">Leftmost s f h
</span><a href="#local-6989586621679463102"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463100"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679463104"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463104"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String (DerivationGraph slc tr)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463104"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (DerivationGraph slc tr)
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Either String (DerivationGraph slc tr)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463101"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679463105"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463105"><span class="hs-identifier hs-var">g'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463092"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463105"><span class="hs-identifier hs-var">g'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivationGraph slc tr -&gt; Either String (DerivationGraph slc tr)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463100"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">Either String (DerivationGraph slc tr)
-&gt; [Either String (DerivationGraph slc tr)]
-&gt; [Either String (DerivationGraph slc tr)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either String (DerivationGraph slc tr)]
</span><a href="#local-6989586621679463101"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Leftmost s f h]
</span><a href="#local-6989586621679463103"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><span class="hs-comment">{- | Replays a derivation from @&#8906;&#8212;&#8212;&#8905;@
 and returns every intermediate derivation graph.
-}</span></span><span>
</span><span id="line-293"></span><span id="local-6989586621679462458"><span id="local-6989586621679462459"><span id="local-6989586621679462460"><span id="local-6989586621679462461"><span id="local-6989586621679462462"><span class="annot"><a href="Display.html#unfoldDerivation"><span class="hs-identifier hs-type">unfoldDerivation</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462458"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679462459"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462461"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462462"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462458"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462459"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation player</span></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Common.html#Leftmost"><span class="hs-identifier hs-type">Leftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462460"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462461"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462462"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation</span></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462458"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462459"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-300"></span><span id="unfoldDerivation"><span class="annot"><span class="annottext">unfoldDerivation :: forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h] -&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation"><span class="hs-identifier hs-var hs-var">unfoldDerivation</span></a></span></span><span> </span><span id="local-6989586621679463110"><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463110"><span class="hs-identifier hs-var">player</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
forall slc tr s f h.
(Ord slc, Ord tr) =&gt;
Path tr slc
-&gt; DerivationPlayer s f h slc tr
-&gt; [Leftmost s f h]
-&gt; [Either String (DerivationGraph slc tr)]
</span><a href="Display.html#unfoldDerivation%27"><span class="hs-identifier hs-var">unfoldDerivation'</span></a></span><span> </span><span class="annot"><span class="annottext">Path tr slc
forall {between}. Path tr between
</span><a href="#local-6989586621679463111"><span class="hs-identifier hs-var">topPath</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463110"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-301"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679463111"><span class="annot"><span class="annottext">topPath :: Path tr between
</span><a href="#local-6989586621679463111"><span class="hs-identifier hs-var hs-var">topPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">tr -&gt; Path tr between
forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">(tr -&gt; Path tr between) -&gt; tr -&gt; Path tr between
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr -&gt; tr
forall s f h slc tr. DerivationPlayer s f h slc tr -&gt; tr
</span><a href="Display.html#dpTopTrans"><span class="hs-identifier hs-var">dpTopTrans</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationPlayer s f h slc tr
</span><a href="#local-6989586621679463110"><span class="hs-identifier hs-var">player</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><span class="hs-comment">{- | A derivation player that uses @()@ for slice and transition contents.
 The actual derivation operations are ignored, so only the outer structure is produced.
-}</span></span><span>
</span><span id="line-307"></span><span id="local-6989586621679462469"><span id="local-6989586621679462470"><span id="local-6989586621679462471"><span class="annot"><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier hs-type">derivationPlayerUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462469"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462470"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462471"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-308"></span><span id="derivationPlayerUnit"><span class="annot"><span class="annottext">derivationPlayerUnit :: forall s f h. DerivationPlayer s f h () ()
</span><a href="Display.html#derivationPlayerUnit"><span class="hs-identifier hs-var hs-var">derivationPlayerUnit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">()
-&gt; (s -&gt; () -&gt; Either String ((), (), ()))
-&gt; (f -&gt; () -&gt; Either String ())
-&gt; (h -&gt; () -&gt; () -&gt; () -&gt; Either String ((), (), (), (), ()))
-&gt; DerivationPlayer s f h () ()
forall s f h slc tr.
tr
-&gt; (s -&gt; tr -&gt; Either String (tr, slc, tr))
-&gt; (f -&gt; tr -&gt; Either String tr)
-&gt; (h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr))
-&gt; DerivationPlayer s f h slc tr
</span><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">s -&gt; () -&gt; Either String ((), (), ())
forall {p} {p} {a}. p -&gt; p -&gt; Either a ((), (), ())
</span><a href="#local-6989586621679463112"><span class="hs-identifier hs-var">usplit</span></a></span><span> </span><span class="annot"><span class="annottext">f -&gt; () -&gt; Either String ()
forall {p} {p} {a}. p -&gt; p -&gt; Either a ()
</span><a href="#local-6989586621679463113"><span class="hs-identifier hs-var">ufreeze</span></a></span><span> </span><span class="annot"><span class="annottext">h -&gt; () -&gt; () -&gt; () -&gt; Either String ((), (), (), (), ())
forall {p} {p} {p} {p} {a}.
p -&gt; p -&gt; p -&gt; p -&gt; Either a ((), (), (), (), ())
</span><a href="#local-6989586621679463114"><span class="hs-identifier hs-var">uspread</span></a></span><span>
</span><span id="line-309"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-310"></span><span>  </span><span id="local-6989586621679463112"><span class="annot"><span class="annottext">usplit :: p -&gt; p -&gt; Either a ((), (), ())
</span><a href="#local-6989586621679463112"><span class="hs-identifier hs-var hs-var">usplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((), (), ()) -&gt; Either a ((), (), ())
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>  </span><span id="local-6989586621679463113"><span class="annot"><span class="annottext">ufreeze :: p -&gt; p -&gt; Either a ()
</span><a href="#local-6989586621679463113"><span class="hs-identifier hs-var hs-var">ufreeze</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either a ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>  </span><span id="local-6989586621679463114"><span class="annot"><span class="annottext">uspread :: p -&gt; p -&gt; p -&gt; p -&gt; Either a ((), (), (), (), ())
</span><a href="#local-6989586621679463114"><span class="hs-identifier hs-var hs-var">uspread</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((), (), (), (), ()) -&gt; Either a ((), (), (), (), ())
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><span class="hs-comment">-- | A helper type that is like @()@ but has a 'Show' instance that returns the empty string.</span></span><span>
</span><span id="line-315"></span><span class="hs-keyword">data</span><span> </span><span id="Empty"><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463117"><span id="local-6989586621679463119"><span class="annot"><span class="annottext">Empty -&gt; Empty -&gt; Bool
(Empty -&gt; Empty -&gt; Bool) -&gt; (Empty -&gt; Empty -&gt; Bool) -&gt; Eq Empty
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Empty -&gt; Empty -&gt; Bool
== :: Empty -&gt; Empty -&gt; Bool
$c/= :: Empty -&gt; Empty -&gt; Bool
/= :: Empty -&gt; Empty -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463125"><span id="local-6989586621679463127"><span id="local-6989586621679463129"><span id="local-6989586621679463133"><span id="local-6989586621679463136"><span id="local-6989586621679463139"><span id="local-6989586621679463142"><span class="annot"><span class="annottext">Eq Empty
Eq Empty =&gt;
(Empty -&gt; Empty -&gt; Ordering)
-&gt; (Empty -&gt; Empty -&gt; Bool)
-&gt; (Empty -&gt; Empty -&gt; Bool)
-&gt; (Empty -&gt; Empty -&gt; Bool)
-&gt; (Empty -&gt; Empty -&gt; Bool)
-&gt; (Empty -&gt; Empty -&gt; Empty)
-&gt; (Empty -&gt; Empty -&gt; Empty)
-&gt; Ord Empty
Empty -&gt; Empty -&gt; Bool
Empty -&gt; Empty -&gt; Ordering
Empty -&gt; Empty -&gt; Empty
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Empty -&gt; Empty -&gt; Ordering
compare :: Empty -&gt; Empty -&gt; Ordering
$c&lt; :: Empty -&gt; Empty -&gt; Bool
&lt; :: Empty -&gt; Empty -&gt; Bool
$c&lt;= :: Empty -&gt; Empty -&gt; Bool
&lt;= :: Empty -&gt; Empty -&gt; Bool
$c&gt; :: Empty -&gt; Empty -&gt; Bool
&gt; :: Empty -&gt; Empty -&gt; Bool
$c&gt;= :: Empty -&gt; Empty -&gt; Bool
&gt;= :: Empty -&gt; Empty -&gt; Bool
$cmax :: Empty -&gt; Empty -&gt; Empty
max :: Empty -&gt; Empty -&gt; Empty
$cmin :: Empty -&gt; Empty -&gt; Empty
min :: Empty -&gt; Empty -&gt; Empty
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679463145"><span id="local-6989586621679463150"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>  </span><span id="local-6989586621679463152"><span class="annot"><span class="annottext">show :: Empty -&gt; String
</span><a href="#local-6989586621679463152"><span class="hs-identifier hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">{- | A derivation player that uses 'Empty' for slice and transition content.
 The actual derivation operations are ignored, so only the outer structure is produced.
-}</span></span><span>
</span><span id="line-324"></span><span id="local-6989586621679462487"><span id="local-6989586621679462488"><span id="local-6989586621679462489"><span class="annot"><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier hs-type">derivationPlayerEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-type">DerivationPlayer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462487"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462488"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462489"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span> </span><span class="annot"><a href="Display.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span></span></span></span><span>
</span><span id="line-325"></span><span id="derivationPlayerEmpty"><span class="annot"><span class="annottext">derivationPlayerEmpty :: forall s f h. DerivationPlayer s f h Empty Empty
</span><a href="Display.html#derivationPlayerEmpty"><span class="hs-identifier hs-var hs-var">derivationPlayerEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Empty
-&gt; (s -&gt; Empty -&gt; Either String (Empty, Empty, Empty))
-&gt; (f -&gt; Empty -&gt; Either String Empty)
-&gt; (h
    -&gt; Empty
    -&gt; Empty
    -&gt; Empty
    -&gt; Either String (Empty, Empty, Empty, Empty, Empty))
-&gt; DerivationPlayer s f h Empty Empty
forall s f h slc tr.
tr
-&gt; (s -&gt; tr -&gt; Either String (tr, slc, tr))
-&gt; (f -&gt; tr -&gt; Either String tr)
-&gt; (h -&gt; tr -&gt; slc -&gt; tr -&gt; Either String (tr, slc, tr, slc, tr))
-&gt; DerivationPlayer s f h slc tr
</span><a href="Display.html#DerivationPlayer"><span class="hs-identifier hs-var">DerivationPlayer</span></a></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span> </span><span class="annot"><span class="annottext">s -&gt; Empty -&gt; Either String (Empty, Empty, Empty)
forall {p} {p} {a}. p -&gt; p -&gt; Either a (Empty, Empty, Empty)
</span><a href="#local-6989586621679463154"><span class="hs-identifier hs-var">nsplit</span></a></span><span> </span><span class="annot"><span class="annottext">f -&gt; Empty -&gt; Either String Empty
forall {p} {p} {a}. p -&gt; p -&gt; Either a Empty
</span><a href="#local-6989586621679463155"><span class="hs-identifier hs-var">nfreeze</span></a></span><span> </span><span class="annot"><span class="annottext">h
-&gt; Empty
-&gt; Empty
-&gt; Empty
-&gt; Either String (Empty, Empty, Empty, Empty, Empty)
forall {p} {p} {p} {p} {a}.
p -&gt; p -&gt; p -&gt; p -&gt; Either a (Empty, Empty, Empty, Empty, Empty)
</span><a href="#local-6989586621679463156"><span class="hs-identifier hs-var">nspread</span></a></span><span>
</span><span id="line-326"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621679463154"><span class="annot"><span class="annottext">nsplit :: p -&gt; p -&gt; Either a (Empty, Empty, Empty)
</span><a href="#local-6989586621679463154"><span class="hs-identifier hs-var hs-var">nsplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Empty, Empty, Empty) -&gt; Either a (Empty, Empty, Empty)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621679463155"><span class="annot"><span class="annottext">nfreeze :: p -&gt; p -&gt; Either a Empty
</span><a href="#local-6989586621679463155"><span class="hs-identifier hs-var hs-var">nfreeze</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Empty -&gt; Either a Empty
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span id="local-6989586621679463156"><span class="annot"><span class="annottext">nspread :: p -&gt; p -&gt; p -&gt; p -&gt; Either a (Empty, Empty, Empty, Empty, Empty)
</span><a href="#local-6989586621679463156"><span class="hs-identifier hs-var hs-var">nspread</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Empty, Empty, Empty, Empty, Empty)
-&gt; Either a (Empty, Empty, Empty, Empty, Empty)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Empty
</span><a href="Display.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- plotting derivation graphs</span><span>
</span><span id="line-332"></span><span class="hs-comment">-- ==========================</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><span class="hs-comment">-- | Convert a derivation graph into a series of TikZ commands.</span></span><span>
</span><span id="line-335"></span><span id="local-6989586621679462504"><span id="local-6989586621679462505"><span class="annot"><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-type">tikzDerivationGraph</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462504"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462505"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462504"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a function for displaying slice contents</span></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679462505"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a function for displaying transitions contents</span></span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462504"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462505"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the derivation graph</span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span></span><span>
</span><span id="line-344"></span><span id="tikzDerivationGraph"><span class="annot"><span class="annottext">tikzDerivationGraph :: forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var hs-var">tikzDerivationGraph</span></a></span></span><span> </span><span id="local-6989586621679463171"><span class="annot"><span class="annottext">slc -&gt; Text
</span><a href="#local-6989586621679463171"><span class="hs-identifier hs-var">showS</span></a></span></span><span> </span><span id="local-6989586621679463172"><span class="annot"><span class="annottext">tr -&gt; Text
</span><a href="#local-6989586621679463172"><span class="hs-identifier hs-var">showT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DGraph"><span class="hs-identifier hs-type">DGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679463173"><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679463173"><span class="hs-identifier hs-var">slices</span></a></span></span><span> </span><span id="local-6989586621679463174"><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679463174"><span class="hs-identifier hs-var">trans</span></a></span></span><span> </span><span id="local-6989586621679463175"><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679463175"><span class="hs-identifier hs-var">horis</span></a></span></span><span> </span><span id="local-6989586621679463176"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463176"><span class="hs-identifier hs-var">openTrans</span></a></span></span><span> </span><span id="local-6989586621679463177"><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463177"><span class="hs-identifier hs-var">frozenTrans</span></a></span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-345"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span>
</span><span id="line-346"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Int, Int, StartStop slc) -&gt; Text
forall {slc} {slc} {slc}.
(Show slc, Show slc, Show slc, Num slc) =&gt;
(slc, slc, slc, StartStop slc) -&gt; Text
</span><a href="#local-6989586621679463179"><span class="hs-identifier hs-var">showNode</span></a></span><span> </span><span class="annot"><span class="annottext">((Double, Int, Int, StartStop slc) -&gt; Text)
-&gt; [(Double, Int, Int, StartStop slc)] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Double, Int, Int, StartStop slc)]
</span><a href="#local-6989586621679463180"><span class="hs-identifier hs-var">tikzNodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>        </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DerivTrans slc tr, Bool) -&gt; Text
forall {slc} {slc}.
((DerivSlice slc, tr, DerivSlice slc), Bool) -&gt; Text
</span><a href="#local-6989586621679463181"><span class="hs-identifier hs-var">showTrans</span></a></span><span> </span><span class="annot"><span class="annottext">((DerivTrans slc tr, Bool) -&gt; Text)
-&gt; [(DerivTrans slc tr, Bool)] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(DerivTrans slc tr, Bool)]
</span><a href="#local-6989586621679463182"><span class="hs-identifier hs-var">trans'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="annottext">[Text] -&gt; [Text] -&gt; [Text]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DerivSlice slc, DerivSlice slc) -&gt; Text
forall {slc} {slc}. (DerivSlice slc, DerivSlice slc) -&gt; Text
</span><a href="#local-6989586621679463183"><span class="hs-identifier hs-var">showHori</span></a></span><span> </span><span class="annot"><span class="annottext">((DerivSlice slc, DerivSlice slc) -&gt; Text)
-&gt; [(DerivSlice slc, DerivSlice slc)] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
-&gt; [(DerivSlice slc, DerivSlice slc)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679463175"><span class="hs-identifier hs-var">horis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621679462517"><span class="annot"><a href="#local-6989586621679463185"><span class="hs-identifier hs-type">showText</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462517"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462517"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span></span><span>
</span><span id="line-353"></span><span>  </span><span id="local-6989586621679463185"><span class="annot"><span class="annottext">showText :: forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var hs-var">showText</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (slc -&gt; String) -&gt; slc -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-comment">-- printing nodes and edges</span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621679463192"><span class="annot"><span class="annottext">showSlice :: StartStop slc -&gt; Text
</span><a href="#local-6989586621679463192"><span class="hs-identifier hs-var hs-var">showSlice</span></a></span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;$\\rtimes$&quot;</span></span><span>
</span><span id="line-356"></span><span>  </span><span class="annot"><a href="#local-6989586621679463192"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;$\\ltimes$&quot;</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="annot"><a href="#local-6989586621679463192"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679463193"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463193"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
</span><a href="#local-6989586621679463171"><span class="hs-identifier hs-var">showS</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463193"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621679463179"><span class="annot"><span class="annottext">showNode :: (slc, slc, slc, StartStop slc) -&gt; Text
</span><a href="#local-6989586621679463179"><span class="hs-identifier hs-var hs-var">showNode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463216"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463216"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463217"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463217"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463218"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463218"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463219"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679463219"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\node[slice] (slice&quot;</span></span><span>
</span><span id="line-360"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463218"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-361"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-362"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463216"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-364"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679463217"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) {&quot;</span></span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Text
</span><a href="#local-6989586621679463192"><span class="hs-identifier hs-var">showSlice</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679463219"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-368"></span><span>  </span><span id="local-6989586621679463181"><span class="annot"><span class="annottext">showTrans :: ((DerivSlice slc, tr, DerivSlice slc), Bool) -&gt; Text
</span><a href="#local-6989586621679463181"><span class="hs-identifier hs-var hs-var">showTrans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679463237"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463237"><span class="hs-identifier hs-var">nl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463238"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679463238"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463239"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463239"><span class="hs-identifier hs-var">nr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463240"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679463240"><span class="hs-identifier hs-var">frozen</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\draw[transition,&quot;</span></span><span>
</span><span id="line-370"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679463240"><span class="hs-identifier hs-var">frozen</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;terminal&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;non-terminal&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;] (slice&quot;</span></span><span>
</span><span id="line-372"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463237"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) -- (slice&quot;</span></span><span>
</span><span id="line-374"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463239"><span class="hs-identifier hs-var">nr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) node[midway,below,sloped] {&quot;</span></span><span>
</span><span id="line-376"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">tr -&gt; Text
</span><a href="#local-6989586621679463172"><span class="hs-identifier hs-var">showT</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679463238"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-377"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621679463183"><span class="annot"><span class="annottext">showHori :: (DerivSlice slc, DerivSlice slc) -&gt; Text
</span><a href="#local-6989586621679463183"><span class="hs-identifier hs-var hs-var">showHori</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463250"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463250"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463251"><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463251"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\\draw[hori] (slice&quot;</span></span><span>
</span><span id="line-380"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463250"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;) -- (slice&quot;</span></span><span>
</span><span id="line-382"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="#local-6989586621679463185"><span class="hs-identifier hs-var">showText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc
</span><a href="#local-6989586621679463251"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;);&quot;</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-comment">-- helpers</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621679463252"><span class="annot"><span class="annottext">leftNode :: (a, b, c) -&gt; a
</span><a href="#local-6989586621679463252"><span class="hs-identifier hs-var hs-var">leftNode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463253"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463253"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463253"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621679463254"><span class="annot"><span class="annottext">rightNode :: (a, b, c) -&gt; c
</span><a href="#local-6989586621679463254"><span class="hs-identifier hs-var hs-var">rightNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463255"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679463255"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679463255"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-comment">-- computing node locations</span><span>
</span><span id="line-388"></span><span>  </span><span id="local-6989586621679463260"><span class="annot"><span class="annottext">nodeChildren :: Map Int [Int]
</span><a href="#local-6989586621679463260"><span class="hs-identifier hs-var hs-var">nodeChildren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-389"></span><span>    </span><span class="annot"><span class="annottext">([Int] -&gt; [Int] -&gt; [Int]) -&gt; [(Int, [Int])] -&gt; Map Int [Int]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="annot"><span class="annottext">([(Int, [Int])] -&gt; Map Int [Int])
-&gt; [(Int, [Int])] -&gt; Map Int [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc -&gt; Int)
-&gt; (DerivSlice slc -&gt; [Int])
-&gt; (DerivSlice slc, DerivSlice slc)
-&gt; (Int, [Int])
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Int] -&gt; [Int]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; [Int])
-&gt; (DerivSlice slc -&gt; Int) -&gt; DerivSlice slc -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((DerivSlice slc, DerivSlice slc) -&gt; (Int, [Int]))
-&gt; [(DerivSlice slc, DerivSlice slc)] -&gt; [(Int, [Int])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
-&gt; [(DerivSlice slc, DerivSlice slc)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc, DerivSlice slc)
</span><a href="#local-6989586621679463175"><span class="hs-identifier hs-var">horis</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span id="local-6989586621679463263"><span class="annot"><span class="annottext">surface :: [DerivTrans slc tr]
</span><a href="#local-6989586621679463263"><span class="hs-identifier hs-var hs-var">surface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr] -&gt; [DerivTrans slc tr]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463177"><span class="hs-identifier hs-var">frozenTrans</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr] -&gt; [DerivTrans slc tr] -&gt; [DerivTrans slc tr]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463176"><span class="hs-identifier hs-var">openTrans</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621679463182"><span class="annot"><span class="annottext">trans' :: [(DerivTrans slc tr, Bool)]
</span><a href="#local-6989586621679463182"><span class="hs-identifier hs-var hs-var">trans'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679463272"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679463272"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679463272"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679463272"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr -&gt; [DerivTrans slc tr] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`L.elem`</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463177"><span class="hs-identifier hs-var">frozenTrans</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DerivTrans slc tr -&gt; (DerivTrans slc tr, Bool))
-&gt; [DerivTrans slc tr] -&gt; [(DerivTrans slc tr, Bool)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr) -&gt; [DerivTrans slc tr]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivTrans slc tr)
</span><a href="#local-6989586621679463174"><span class="hs-identifier hs-var">trans</span></a></span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679463276"><span class="annot"><span class="annottext">surfaceNodes :: [Int]
</span><a href="#local-6989586621679463276"><span class="hs-identifier hs-var hs-var">surfaceNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463263"><span class="hs-identifier hs-var">surface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679463277"><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679463277"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc -&gt; Int) -&gt; [DerivSlice slc] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">([DerivSlice slc] -&gt; [Int]) -&gt; [DerivSlice slc] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr -&gt; DerivSlice slc
forall {a} {b} {c}. (a, b, c) -&gt; a
</span><a href="#local-6989586621679463252"><span class="hs-identifier hs-var">leftNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DerivTrans slc tr
</span><a href="#local-6989586621679463277"><span class="hs-identifier hs-var">t0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; [DerivSlice slc] -&gt; [DerivSlice slc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(DerivTrans slc tr -&gt; DerivSlice slc)
-&gt; [DerivTrans slc tr] -&gt; [DerivSlice slc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">DerivTrans slc tr -&gt; DerivSlice slc
forall {a} {b} {c}. (a, b, c) -&gt; c
</span><a href="#local-6989586621679463254"><span class="hs-identifier hs-var">rightNode</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivTrans slc tr]
</span><a href="#local-6989586621679463263"><span class="hs-identifier hs-var">surface</span></a></span><span>
</span><span id="line-395"></span><span>  </span><span id="local-6989586621679463280"><span class="annot"><span class="annottext">allNodes :: [Int]
</span><a href="#local-6989586621679463280"><span class="hs-identifier hs-var hs-var">allNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslId"><span class="hs-identifier hs-var">dslId</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc -&gt; Int) -&gt; [DerivSlice slc] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc -&gt; Int) -&gt; [DerivSlice slc] -&gt; [DerivSlice slc]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.sortOn</span></span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; Int
forall slc. DerivSlice slc -&gt; Int
</span><a href="Display.html#dslDepth"><span class="hs-identifier hs-var">dslDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (DerivSlice slc) -&gt; [DerivSlice slc]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679463173"><span class="hs-identifier hs-var">slices</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-comment">-- compute x locations</span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621679463285"><span class="annot"><span class="annottext">xloc :: Map Int Double
</span><a href="#local-6989586621679463285"><span class="hs-identifier hs-var hs-var">xloc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Int Double -&gt; Int -&gt; Map Int Double)
-&gt; Map Int Double -&gt; [Int] -&gt; Map Int Double
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Map Int Double -&gt; Int -&gt; Map Int Double
forall {a}. Fractional a =&gt; Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679463286"><span class="hs-identifier hs-var">findX</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Double
</span><a href="#local-6989586621679463287"><span class="hs-identifier hs-var">xlocInit</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679463280"><span class="hs-identifier hs-var">allNodes</span></a></span><span>
</span><span id="line-398"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621679463287"><span class="annot"><span class="annottext">xlocInit :: Map Int Double
</span><a href="#local-6989586621679463287"><span class="hs-identifier hs-var hs-var">xlocInit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Int, Double)] -&gt; Map Int Double
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Int, Double)] -&gt; Map Int Double)
-&gt; [(Int, Double)] -&gt; Map Int Double
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Double] -&gt; [(Int, Double)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679463276"><span class="hs-identifier hs-var">surfaceNodes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621679463304"><span class="annot"><span class="annottext">mean :: t a -&gt; a
</span><a href="#local-6989586621679463304"><span class="hs-identifier hs-var hs-var">mean</span></a></span></span><span> </span><span id="local-6989586621679463305"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679463305"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t a -&gt; a
forall a. Num a =&gt; t a -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679463305"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; Int
forall a. t a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679463305"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-comment">-- findX :: M.Map Int Double -&gt; Int -&gt; M.Map Int Double</span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621679463286"><span class="annot"><span class="annottext">findX :: Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679463286"><span class="hs-identifier hs-var hs-var">findX</span></a></span></span><span> </span><span id="local-6989586621679463313"><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679463313"><span class="hs-identifier hs-var">locs</span></a></span></span><span> </span><span id="local-6989586621679463314"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463314"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Map Int a -&gt; Maybe a
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">M.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463314"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679463313"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-403"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679463313"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-404"></span><span>      </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679463317"><span class="annot"><span class="annottext">children :: [Int]
</span><a href="#local-6989586621679463317"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Int [Int]
</span><a href="#local-6989586621679463260"><span class="hs-identifier hs-var">nodeChildren</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int [Int] -&gt; Int -&gt; [Int]
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463314"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-406"></span><span>            </span><span id="local-6989586621679463321"><span class="annot"><span class="annottext">childxs :: [a]
</span><a href="#local-6989586621679463321"><span class="hs-identifier hs-var hs-var">childxs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679463322"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463322"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map Int a -&gt; Int -&gt; Map Int a
</span><a href="#local-6989586621679463286"><span class="hs-identifier hs-var">findX</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679463313"><span class="hs-identifier hs-var">locs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463322"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a -&gt; Int -&gt; a
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463322"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; a) -&gt; [Int] -&gt; [a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679463317"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-407"></span><span>            </span><span id="local-6989586621679463326"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679463326"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall {a} {t :: * -&gt; *}. (Fractional a, Foldable t) =&gt; t a -&gt; a
</span><a href="#local-6989586621679463304"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679463321"><span class="hs-identifier hs-var">childxs</span></a></span><span>
</span><span id="line-408"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; Map Int a -&gt; Map Int a
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">M.insert</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463314"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463326"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int a
</span><a href="#local-6989586621679463313"><span class="hs-identifier hs-var">locs</span></a></span><span>
</span><span id="line-409"></span><span>  </span><span id="local-6989586621679463180"><span class="annot"><span class="annottext">tikzNodes :: [(Double, Int, Int, StartStop slc)]
</span><a href="#local-6989586621679463180"><span class="hs-identifier hs-var hs-var">tikzNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivSlice slc -&gt; (Double, Int, Int, StartStop slc)
forall {slc}. DerivSlice slc -&gt; (Double, Int, Int, StartStop slc)
</span><a href="#local-6989586621679463329"><span class="hs-identifier hs-var">mkNode</span></a></span><span> </span><span class="annot"><span class="annottext">(DerivSlice slc -&gt; (Double, Int, Int, StartStop slc))
-&gt; [DerivSlice slc] -&gt; [(Double, Int, Int, StartStop slc)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc) -&gt; [DerivSlice slc]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (DerivSlice slc)
</span><a href="#local-6989586621679463173"><span class="hs-identifier hs-var">slices</span></a></span><span>
</span><span id="line-410"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-411"></span><span>    </span><span id="local-6989586621679463329"><span class="annot"><span class="annottext">mkNode :: DerivSlice slc -&gt; (Double, Int, Int, StartStop slc)
</span><a href="#local-6989586621679463329"><span class="hs-identifier hs-var hs-var">mkNode</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Display.html#DerivSlice"><span class="hs-identifier hs-type">DerivSlice</span></a></span><span> </span><span id="local-6989586621679463331"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463331"><span class="hs-identifier hs-var">depth</span></a></span></span><span> </span><span id="local-6989586621679463332"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463332"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679463333"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679463333"><span class="hs-identifier hs-var">content</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int Double
</span><a href="#local-6989586621679463285"><span class="hs-identifier hs-var">xloc</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int Double -&gt; Int -&gt; Double
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">M.!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463332"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463331"><span class="hs-identifier hs-var">depth</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679463332"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679463333"><span class="hs-identifier hs-var">content</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span class="annot"><span class="hs-comment">-- | Wraps TikZ commands in a @tikzpicture@ environment.</span></span><span>
</span><span id="line-414"></span><span id="local-6989586621679462566"><span class="annot"><a href="Display.html#tikzPic"><span class="hs-identifier hs-type">tikzPic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679462566"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621679462566"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462566"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462566"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-415"></span><span id="tikzPic"><span class="annot"><span class="annottext">tikzPic :: forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var hs-var">tikzPic</span></a></span></span><span> </span><span id="local-6989586621679463340"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463340"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>  </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\\begin{tikzpicture}\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463340"><span class="hs-identifier hs-var">content</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\n\\end{tikzpicture}&quot;</span></span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="annot"><span class="hs-comment">{- | Wraps latex code (e.g. a @tikzpicture@) in a complete standalone document.
 This environment includes default styles for slices, transitions, and hori edges.
-}</span></span><span>
</span><span id="line-421"></span><span id="local-6989586621679462568"><span class="annot"><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-type">tikzStandalone</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="#local-6989586621679462568"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IsString</span></span><span> </span><span class="annot"><a href="#local-6989586621679462568"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-424"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a flag for using the the @varwidth@ option of @standalone@ (needed for multiline content)</span></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462568"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the document content</span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679462568"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-428"></span><span id="tikzStandalone"><span class="annot"><span class="annottext">tikzStandalone :: forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var hs-var">tikzStandalone</span></a></span></span><span> </span><span id="local-6989586621679463352"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679463352"><span class="hs-identifier hs-var">varwidth</span></a></span></span><span> </span><span id="local-6989586621679463353"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463353"><span class="hs-identifier hs-var">content</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>  </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\\documentclass&quot;</span></span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679463352"><span class="hs-identifier hs-var">varwidth</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;[varwidth]&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;{standalone}\n\
       \\\usepackage[svgnames]{xcolor}\n\
       \\\usepackage{tikz}\n\
       \\\usepackage{amssymb}\n\
       \\\begin{document}\n\
       \\\tikzstyle{slice} = [rectangle,draw,fill=WhiteSmoke,semithick,minimum size=0.4cm,inner xsep=0,inner ysep=3pt,align=center]\n\
       \\\tikzstyle{transition} = [line width=2pt,draw=lightgray]\n\
       \\\tikzstyle{non-terminal} = []\n\
       \\\tikzstyle{terminal} = [double]\n\
       \\\tikzstyle{hori} = [lightgray,dashed,line width=2pt]\n\n&quot;</span></span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679463353"><span class="hs-identifier hs-var">content</span></a></span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;\n\\end{document}&quot;</span></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="annot"><span class="hs-comment">-- | Write a single derivation graph to a @tex@ file.</span></span><span>
</span><span id="line-445"></span><span id="local-6989586621679462570"><span id="local-6989586621679462571"><span class="annot"><a href="Display.html#writeGraph"><span class="hs-identifier hs-type">writeGraph</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462570"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462570"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462571"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462571"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462570"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462571"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-447"></span><span id="writeGraph"><span class="annot"><span class="annottext">writeGraph :: forall slc tr.
(Show slc, Eq slc, Eq tr, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#writeGraph"><span class="hs-identifier hs-var hs-var">writeGraph</span></a></span></span><span> </span><span id="local-6989586621679463367"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463367"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679463368"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463368"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463367"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var">tikzStandalone</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var">tikzPic</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-451"></span><span>        </span><span class="annot"><span class="annottext">(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var">tikzDerivationGraph</span></a></span><span>
</span><span id="line-452"></span><span>          </span><span class="annot"><span class="annottext">slc -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-453"></span><span>          </span><span class="annot"><span class="annottext">tr -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463368"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="annot"><span class="hs-comment">-- | Write a single derivation graph to a @tex@ file and compile the file using @pdflatex@.</span></span><span>
</span><span id="line-457"></span><span id="local-6989586621679462574"><span id="local-6989586621679462575"><span class="annot"><a href="Display.html#viewGraph"><span class="hs-identifier hs-type">viewGraph</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462574"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462575"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462574"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462575"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462574"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462575"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-459"></span><span id="viewGraph"><span class="annot"><span class="annottext">viewGraph :: forall slc tr.
(Eq slc, Eq tr, Show slc, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#viewGraph"><span class="hs-identifier hs-var hs-var">viewGraph</span></a></span></span><span> </span><span id="local-6989586621679463387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463387"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679463388"><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463388"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; DerivationGraph slc tr -&gt; IO ()
forall slc tr.
(Show slc, Eq slc, Eq tr, Show tr) =&gt;
String -&gt; DerivationGraph slc tr -&gt; IO ()
</span><a href="Display.html#writeGraph"><span class="hs-identifier hs-var">writeGraph</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463387"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">DerivationGraph slc tr
</span><a href="#local-6989586621679463388"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">callCommand</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pdflatex -output-directory=\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FP.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463387"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463387"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><span class="hs-comment">-- | Write a several derivation graphs to a @tex@ file.</span></span><span>
</span><span id="line-464"></span><span id="local-6989586621679462578"><span id="local-6989586621679462579"><span class="annot"><a href="Display.html#writeGraphs"><span class="hs-identifier hs-type">writeGraphs</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462578"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679462579"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462579"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679462578"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462579"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679462578"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-466"></span><span id="writeGraphs"><span class="annot"><span class="annottext">writeGraphs :: forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#writeGraphs"><span class="hs-identifier hs-var hs-var">writeGraphs</span></a></span></span><span> </span><span id="local-6989586621679463404"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463404"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679463405"><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679463405"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Text -&gt; IO ()
</span><span class="hs-identifier hs-var">T.writeFile</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463404"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-468"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Text -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; Bool -&gt; a -&gt; a
</span><a href="Display.html#tikzStandalone"><span class="hs-identifier hs-var">tikzStandalone</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-469"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; [Text] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. (Semigroup a, IsString a) =&gt; a -&gt; a
</span><a href="Display.html#tikzPic"><span class="hs-identifier hs-var">tikzPic</span></a></span><span>
</span><span id="line-471"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; (DerivationGraph slc tr -&gt; Text)
-&gt; DerivationGraph slc tr
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
forall slc tr.
(Eq slc, Eq tr) =&gt;
(slc -&gt; Text) -&gt; (tr -&gt; Text) -&gt; DerivationGraph slc tr -&gt; Text
</span><a href="Display.html#tikzDerivationGraph"><span class="hs-identifier hs-var">tikzDerivationGraph</span></a></span><span> </span><span class="annot"><span class="annottext">slc -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span> </span><span class="annot"><span class="annottext">tr -&gt; Text
forall slc. Show slc =&gt; slc -&gt; Text
</span><a href="Common.html#showTexT"><span class="hs-identifier hs-var">showTexT</span></a></span><span>
</span><span id="line-472"></span><span>          </span><span class="annot"><span class="annottext">(DerivationGraph slc tr -&gt; Text)
-&gt; [DerivationGraph slc tr] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679463405"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-473"></span><span>
</span><span id="line-474"></span><span class="annot"><span class="hs-comment">-- | Write a several derivation graphs to a @tex@ file and compile the file using @pdflatex@.</span></span><span>
</span><span id="line-475"></span><span id="local-6989586621679463406"><span id="local-6989586621679463407"><span class="annot"><a href="Display.html#viewGraphs"><span class="hs-identifier hs-type">viewGraphs</span></a></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679463406"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679463407"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679463407"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679463406"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Display.html#DerivationGraph"><span class="hs-identifier hs-type">DerivationGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463407"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463406"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-477"></span><span id="viewGraphs"><span class="annot"><span class="annottext">viewGraphs :: forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#viewGraphs"><span class="hs-identifier hs-var hs-var">viewGraphs</span></a></span></span><span> </span><span id="local-6989586621679463423"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463423"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span id="local-6989586621679463424"><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679463424"><span class="hs-identifier hs-var">gs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; [DerivationGraph slc tr] -&gt; IO ()
forall tr slc.
(Show tr, Show slc, Eq slc, Eq tr) =&gt;
String -&gt; [DerivationGraph slc tr] -&gt; IO ()
</span><a href="Display.html#writeGraphs"><span class="hs-identifier hs-var">writeGraphs</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463423"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivationGraph slc tr]
</span><a href="#local-6989586621679463424"><span class="hs-identifier hs-var">gs</span></a></span><span>
</span><span id="line-479"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">callCommand</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pdflatex -output-directory=\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShowS
</span><span class="hs-identifier hs-var">FP.takeDirectory</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463423"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679463423"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-480"></span></pre></body></html>