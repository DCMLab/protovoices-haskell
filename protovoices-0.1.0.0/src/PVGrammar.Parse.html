<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{- | This module contains code that is specific to parsing the protovoice grammar.
 It implements a number of evaluators ('Eval') that can be used with the various parsers.
-}</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html"><span class="hs-identifier">PVGrammar.Parse</span></a></span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Generic Parsing</span></span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-comment">-- | Evaluators that directly return protovoice operations.</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-comment">-- They can be embedded into a semiring using 'mapEvalScore'.</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier">IsPitch</span></a></span><span>
</span><span id="line-13"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier">protoVoiceEvaluator</span></a></span><span>
</span><span id="line-14"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#protoVoiceEvaluatorNoRepSplit"><span class="hs-identifier">protoVoiceEvaluatorNoRepSplit</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Parsing Derivations</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvDerivUnrestricted"><span class="hs-identifier">pvDerivUnrestricted</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvDerivRightBranch"><span class="hs-identifier">pvDerivRightBranch</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Counting Parses</span></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvCountUnrestricted"><span class="hs-identifier">pvCountUnrestricted</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplit"><span class="hs-identifier">pvCountNoRepSplit</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranch"><span class="hs-identifier">pvCountNoRepSplitRightBranch</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranchSplitFirst"><span class="hs-identifier">pvCountNoRepSplitRightBranchSplitFirst</span></a></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Useful Helpers</span></span><span>
</span><span id="line-27"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#pvThaw"><span class="hs-identifier">pvThaw</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PVGrammar.html"><span class="hs-identifier">PVGrammar</span></a></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Pitch</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Diatonic</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Notation</span></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SPitch</span></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pc</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pto</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Pitch.Spelled</span></span><span> </span><span class="hs-comment">-- TODO: remove</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">foldl'</span></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Constraint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span>
</span><span id="line-58"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Traversable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">for</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Internal.MultiSet.html"><span class="hs-identifier">Internal.MultiSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MS</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Musicology.Core</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">HasPitch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pitch</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pitched</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isStep</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Debug.Trace</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DT</span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-comment">-- helper type: Either for terminal and non-terminal edges</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- -------------------------------------------------------</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="annot"><span class="hs-comment">{- | A tag that distinguishes between objects related to terminal and non-terminal edges.
 Like 'Either', but with semantic constructor names to avoid confusion.
-}</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">data</span><span> </span><span id="EdgeEither"><span class="annot"><a href="PVGrammar.Parse.html#EdgeEither"><span class="hs-identifier hs-var">EdgeEither</span></a></span></span><span> </span><span id="local-6989586621679471341"><span class="annot"><a href="#local-6989586621679471341"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679471342"><span class="annot"><a href="#local-6989586621679471342"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | marks an terminal edge (or some related object)</span></span><span>
</span><span id="line-80"></span><span>    </span><span id="Reg"><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471341"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | marks a non-terminal edge (or some related object)</span></span><span>
</span><span id="line-82"></span><span>    </span><span id="Pass"><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471342"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471650"><span id="local-6989586621679471657"><span class="annot"><span class="annottext">EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
(EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; Eq (EdgeEither a b)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall a b.
(Eq a, Eq b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$c== :: forall a b.
(Eq a, Eq b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
== :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$c/= :: forall a b.
(Eq a, Eq b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
/= :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471668"><span id="local-6989586621679471672"><span id="local-6989586621679471676"><span id="local-6989586621679471680"><span id="local-6989586621679471683"><span id="local-6989586621679471686"><span id="local-6989586621679471689"><span class="annot"><span class="annottext">Eq (EdgeEither a b)
Eq (EdgeEither a b) =&gt;
(EdgeEither a b -&gt; EdgeEither a b -&gt; Ordering)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; Bool)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b)
-&gt; (EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b)
-&gt; Ord (EdgeEither a b)
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
EdgeEither a b -&gt; EdgeEither a b -&gt; Ordering
EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a b. (Ord a, Ord b) =&gt; Eq (EdgeEither a b)
forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Ordering
forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
$ccompare :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Ordering
compare :: EdgeEither a b -&gt; EdgeEither a b -&gt; Ordering
$c&lt; :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
&lt; :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$c&lt;= :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
&lt;= :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$c&gt; :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
&gt; :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$c&gt;= :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
&gt;= :: EdgeEither a b -&gt; EdgeEither a b -&gt; Bool
$cmax :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
max :: EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
$cmin :: forall a b.
(Ord a, Ord b) =&gt;
EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
min :: EdgeEither a b -&gt; EdgeEither a b -&gt; EdgeEither a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471700"><span id="local-6989586621679471707"><span id="local-6989586621679471711"><span class="annot"><span class="annottext">Int -&gt; EdgeEither a b -&gt; ShowS
[EdgeEither a b] -&gt; ShowS
EdgeEither a b -&gt; String
(Int -&gt; EdgeEither a b -&gt; ShowS)
-&gt; (EdgeEither a b -&gt; String)
-&gt; ([EdgeEither a b] -&gt; ShowS)
-&gt; Show (EdgeEither a b)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a b. (Show a, Show b) =&gt; Int -&gt; EdgeEither a b -&gt; ShowS
forall a b. (Show a, Show b) =&gt; [EdgeEither a b] -&gt; ShowS
forall a b. (Show a, Show b) =&gt; EdgeEither a b -&gt; String
$cshowsPrec :: forall a b. (Show a, Show b) =&gt; Int -&gt; EdgeEither a b -&gt; ShowS
showsPrec :: Int -&gt; EdgeEither a b -&gt; ShowS
$cshow :: forall a b. (Show a, Show b) =&gt; EdgeEither a b -&gt; String
show :: EdgeEither a b -&gt; String
$cshowList :: forall a b. (Show a, Show b) =&gt; [EdgeEither a b] -&gt; ShowS
showList :: [EdgeEither a b] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471716"><span id="local-6989586621679471718"><span class="annot"><span class="annottext">(forall x. EdgeEither a b -&gt; Rep (EdgeEither a b) x)
-&gt; (forall x. Rep (EdgeEither a b) x -&gt; EdgeEither a b)
-&gt; Generic (EdgeEither a b)
forall x. Rep (EdgeEither a b) x -&gt; EdgeEither a b
forall x. EdgeEither a b -&gt; Rep (EdgeEither a b) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a b x. Rep (EdgeEither a b) x -&gt; EdgeEither a b
forall a b x. EdgeEither a b -&gt; Rep (EdgeEither a b) x
$cfrom :: forall a b x. EdgeEither a b -&gt; Rep (EdgeEither a b) x
from :: forall x. EdgeEither a b -&gt; Rep (EdgeEither a b) x
$cto :: forall a b x. Rep (EdgeEither a b) x -&gt; EdgeEither a b
to :: forall x. Rep (EdgeEither a b) x -&gt; EdgeEither a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471730"><span id="local-6989586621679471737"><span class="annot"><span class="annottext">Eq (EdgeEither a b)
Eq (EdgeEither a b) =&gt;
(Int -&gt; EdgeEither a b -&gt; Int)
-&gt; (EdgeEither a b -&gt; Int) -&gt; Hashable (EdgeEither a b)
Int -&gt; EdgeEither a b -&gt; Int
EdgeEither a b -&gt; Int
forall a. Eq a =&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
forall a b. (Hashable a, Hashable b) =&gt; Eq (EdgeEither a b)
forall a b.
(Hashable a, Hashable b) =&gt;
Int -&gt; EdgeEither a b -&gt; Int
forall a b. (Hashable a, Hashable b) =&gt; EdgeEither a b -&gt; Int
$chashWithSalt :: forall a b.
(Hashable a, Hashable b) =&gt;
Int -&gt; EdgeEither a b -&gt; Int
hashWithSalt :: Int -&gt; EdgeEither a b -&gt; Int
$chash :: forall a b. (Hashable a, Hashable b) =&gt; EdgeEither a b -&gt; Int
hash :: EdgeEither a b -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471755"><span class="annot"><span class="annottext">EdgeEither a b -&gt; ()
(EdgeEither a b -&gt; ()) -&gt; NFData (EdgeEither a b)
forall a. (a -&gt; ()) -&gt; NFData a
forall a b. (NFData a, NFData b) =&gt; EdgeEither a b -&gt; ()
$crnf :: forall a b. (NFData a, NFData b) =&gt; EdgeEither a b -&gt; ()
rnf :: EdgeEither a b -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="hs-comment">-- helper type: enum for possible operations</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- -----------------------------------------</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="annot"><span class="hs-comment">{- | A tag that distinguishes four different types of operations:
  regular split, passing split, left ornament, and right ornament
-}</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">data</span><span> </span><span id="Elaboration"><span class="annot"><a href="PVGrammar.Parse.html#Elaboration"><span class="hs-identifier hs-var">Elaboration</span></a></span></span><span> </span><span id="local-6989586621679471513"><span class="annot"><a href="#local-6989586621679471513"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679471514"><span class="annot"><a href="#local-6989586621679471514"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679471515"><span class="annot"><a href="#local-6989586621679471515"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span id="local-6989586621679471516"><span class="annot"><a href="#local-6989586621679471516"><span class="hs-identifier hs-type">d</span></a></span></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | marks a terminal split</span></span><span>
</span><span id="line-93"></span><span>    </span><span id="EReg"><span class="annot"><a href="PVGrammar.Parse.html#EReg"><span class="hs-identifier hs-var">EReg</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471513"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | marks a non-terminal split</span></span><span>
</span><span id="line-95"></span><span>    </span><span id="EPass"><span class="annot"><a href="PVGrammar.Parse.html#EPass"><span class="hs-identifier hs-var">EPass</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471514"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | marks a right ornament</span></span><span>
</span><span id="line-97"></span><span>    </span><span id="ER"><span class="annot"><a href="PVGrammar.Parse.html#ER"><span class="hs-identifier hs-var">ER</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471515"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | marks a left ornament</span></span><span>
</span><span id="line-99"></span><span>    </span><span id="EL"><span class="annot"><a href="PVGrammar.Parse.html#EL"><span class="hs-identifier hs-var">EL</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679471516"><span class="hs-identifier hs-type">d</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471781"><span id="local-6989586621679471789"><span class="annot"><span class="annottext">Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
(Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; (Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; Eq (Elaboration a b c d)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall a b c d.
(Eq a, Eq b, Eq c, Eq d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$c== :: forall a b c d.
(Eq a, Eq b, Eq c, Eq d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
== :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$c/= :: forall a b c d.
(Eq a, Eq b, Eq c, Eq d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
/= :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471803"><span id="local-6989586621679471809"><span id="local-6989586621679471813"><span id="local-6989586621679471816"><span id="local-6989586621679471819"><span id="local-6989586621679471822"><span id="local-6989586621679471825"><span class="annot"><span class="annottext">Eq (Elaboration a b c d)
Eq (Elaboration a b c d) =&gt;
(Elaboration a b c d -&gt; Elaboration a b c d -&gt; Ordering)
-&gt; (Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; (Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; (Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; (Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool)
-&gt; (Elaboration a b c d
    -&gt; Elaboration a b c d -&gt; Elaboration a b c d)
-&gt; (Elaboration a b c d
    -&gt; Elaboration a b c d -&gt; Elaboration a b c d)
-&gt; Ord (Elaboration a b c d)
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Ordering
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Eq (Elaboration a b c d)
forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Ordering
forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
$ccompare :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Ordering
compare :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Ordering
$c&lt; :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
&lt; :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$c&lt;= :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
&lt;= :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$c&gt; :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
&gt; :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$c&gt;= :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
&gt;= :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Bool
$cmax :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
max :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
$cmin :: forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
min :: Elaboration a b c d -&gt; Elaboration a b c d -&gt; Elaboration a b c d
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471832"><span id="local-6989586621679471842"><span id="local-6989586621679471846"><span class="annot"><span class="annottext">Int -&gt; Elaboration a b c d -&gt; ShowS
[Elaboration a b c d] -&gt; ShowS
Elaboration a b c d -&gt; String
(Int -&gt; Elaboration a b c d -&gt; ShowS)
-&gt; (Elaboration a b c d -&gt; String)
-&gt; ([Elaboration a b c d] -&gt; ShowS)
-&gt; Show (Elaboration a b c d)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
Int -&gt; Elaboration a b c d -&gt; ShowS
forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
[Elaboration a b c d] -&gt; ShowS
forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
Elaboration a b c d -&gt; String
$cshowsPrec :: forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
Int -&gt; Elaboration a b c d -&gt; ShowS
showsPrec :: Int -&gt; Elaboration a b c d -&gt; ShowS
$cshow :: forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
Elaboration a b c d -&gt; String
show :: Elaboration a b c d -&gt; String
$cshowList :: forall a b c d.
(Show a, Show b, Show c, Show d) =&gt;
[Elaboration a b c d] -&gt; ShowS
showList :: [Elaboration a b c d] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471849"><span id="local-6989586621679471851"><span class="annot"><span class="annottext">(forall x. Elaboration a b c d -&gt; Rep (Elaboration a b c d) x)
-&gt; (forall x. Rep (Elaboration a b c d) x -&gt; Elaboration a b c d)
-&gt; Generic (Elaboration a b c d)
forall x. Rep (Elaboration a b c d) x -&gt; Elaboration a b c d
forall x. Elaboration a b c d -&gt; Rep (Elaboration a b c d) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a b c d x.
Rep (Elaboration a b c d) x -&gt; Elaboration a b c d
forall a b c d x.
Elaboration a b c d -&gt; Rep (Elaboration a b c d) x
$cfrom :: forall a b c d x.
Elaboration a b c d -&gt; Rep (Elaboration a b c d) x
from :: forall x. Elaboration a b c d -&gt; Rep (Elaboration a b c d) x
$cto :: forall a b c d x.
Rep (Elaboration a b c d) x -&gt; Elaboration a b c d
to :: forall x. Rep (Elaboration a b c d) x -&gt; Elaboration a b c d
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471864"><span id="local-6989586621679471871"><span class="annot"><span class="annottext">Eq (Elaboration a b c d)
Eq (Elaboration a b c d) =&gt;
(Int -&gt; Elaboration a b c d -&gt; Int)
-&gt; (Elaboration a b c d -&gt; Int) -&gt; Hashable (Elaboration a b c d)
Int -&gt; Elaboration a b c d -&gt; Int
Elaboration a b c d -&gt; Int
forall a. Eq a =&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
forall a b c d.
(Hashable a, Hashable b, Hashable c, Hashable d) =&gt;
Eq (Elaboration a b c d)
forall a b c d.
(Hashable a, Hashable b, Hashable c, Hashable d) =&gt;
Int -&gt; Elaboration a b c d -&gt; Int
forall a b c d.
(Hashable a, Hashable b, Hashable c, Hashable d) =&gt;
Elaboration a b c d -&gt; Int
$chashWithSalt :: forall a b c d.
(Hashable a, Hashable b, Hashable c, Hashable d) =&gt;
Int -&gt; Elaboration a b c d -&gt; Int
hashWithSalt :: Int -&gt; Elaboration a b c d -&gt; Int
$chash :: forall a b c d.
(Hashable a, Hashable b, Hashable c, Hashable d) =&gt;
Elaboration a b c d -&gt; Int
hash :: Elaboration a b c d -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471894"><span class="annot"><span class="annottext">Elaboration a b c d -&gt; ()
(Elaboration a b c d -&gt; ()) -&gt; NFData (Elaboration a b c d)
forall a. (a -&gt; ()) -&gt; NFData a
forall a b c d.
(NFData a, NFData b, NFData c, NFData d) =&gt;
Elaboration a b c d -&gt; ()
$crnf :: forall a b c d.
(NFData a, NFData b, NFData c, NFData d) =&gt;
Elaboration a b c d -&gt; ()
rnf :: Elaboration a b c d -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><span class="hs-comment">{- | Takes a collection of 'Elaboration'
 and splits it into lists for each elaboration type.
-}</span></span><span>
</span><span id="line-105"></span><span id="local-6989586621679471289"><span id="local-6989586621679471290"><span id="local-6989586621679471291"><span id="local-6989586621679471292"><span id="local-6989586621679471293"><span class="annot"><a href="PVGrammar.Parse.html#partitionElaborations"><span class="hs-identifier hs-type">partitionElaborations</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471289"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679471289"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Elaboration"><span class="hs-identifier hs-type">Elaboration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471290"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471291"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471292"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471293"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679471290"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679471291"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679471292"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679471293"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-107"></span><span id="partitionElaborations"><span class="annot"><span class="annottext">partitionElaborations :: forall (t :: * -&gt; *) a b c d.
Foldable t =&gt;
t (Elaboration a b c d) -&gt; ([a], [b], [c], [d])
</span><a href="PVGrammar.Parse.html#partitionElaborations"><span class="hs-identifier hs-var hs-var">partitionElaborations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([a], [b], [c], [d])
 -&gt; Elaboration a b c d -&gt; ([a], [b], [c], [d]))
-&gt; ([a], [b], [c], [d])
-&gt; t (Elaboration a b c d)
-&gt; ([a], [b], [c], [d])
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">([a], [b], [c], [d]) -&gt; Elaboration a b c d -&gt; ([a], [b], [c], [d])
forall {a} {a} {a} {a}.
([a], [a], [a], [a]) -&gt; Elaboration a a a a -&gt; ([a], [a], [a], [a])
</span><a href="#local-6989586621679471918"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621679471918"><span class="annot"><span class="annottext">select :: ([a], [a], [a], [a]) -&gt; Elaboration a a a a -&gt; ([a], [a], [a], [a])
</span><a href="#local-6989586621679471918"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471919"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471919"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471920"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471920"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471921"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471921"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471922"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471922"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#EReg"><span class="hs-identifier hs-type">EReg</span></a></span><span> </span><span id="local-6989586621679471923"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471923"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471923"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471919"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471920"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471921"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471922"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="#local-6989586621679471918"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471924"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471924"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471925"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471925"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471926"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471926"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471927"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471927"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#EPass"><span class="hs-identifier hs-type">EPass</span></a></span><span> </span><span id="local-6989586621679471928"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471928"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471924"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471928"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471925"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471926"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471927"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="#local-6989586621679471918"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471929"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471929"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471930"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471930"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471931"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471931"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471932"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471932"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#ER"><span class="hs-identifier hs-type">ER</span></a></span><span> </span><span id="local-6989586621679471933"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471933"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471929"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471930"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471933"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471931"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471932"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="#local-6989586621679471918"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679471934"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471934"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471935"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471935"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471936"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471936"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679471937"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471937"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#EL"><span class="hs-identifier hs-type">EL</span></a></span><span> </span><span id="local-6989586621679471938"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471938"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471934"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471935"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471936"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679471938"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679471937"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- parsing Ornamentations</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- ======================</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><span class="hs-comment">-- | A constraint alias for note types.</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">type</span><span> </span><span id="IsPitch"><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-var">IsPitch</span></a></span></span><span> </span><span id="local-6989586621679471939"><span class="annot"><a href="#local-6989586621679471939"><span class="hs-identifier hs-type">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasPitch</span></span><span> </span><span class="annot"><a href="#local-6989586621679471939"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diatonic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ICOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntervalOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679471939"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ICOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntervalOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679471939"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IntervalOf</span></span><span> </span><span class="annot"><a href="#local-6989586621679471939"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><span class="hs-comment">-- | Checks if the middle pitch is between the left and the right pitch.</span></span><span>
</span><span id="line-123"></span><span id="local-6989586621679471307"><span class="annot"><a href="PVGrammar.Parse.html#between"><span class="hs-identifier hs-type">between</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471307"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Interval</span></span><span> </span><span class="annot"><a href="#local-6989586621679471307"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pitch</span></span><span> </span><span class="annot"><a href="#local-6989586621679471307"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ left pitch</span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pitch</span></span><span> </span><span class="annot"><a href="#local-6989586621679471307"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ middle pitch</span></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pitch</span></span><span> </span><span class="annot"><a href="#local-6989586621679471307"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ right pitch</span></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-132"></span><span id="between"><span class="annot"><span class="annottext">between :: forall i.
(Eq i, Interval i) =&gt;
Pitch i -&gt; Pitch i -&gt; Pitch i -&gt; Bool
</span><a href="PVGrammar.Parse.html#between"><span class="hs-identifier hs-var hs-var">between</span></a></span></span><span> </span><span id="local-6989586621679471960"><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471960"><span class="hs-identifier hs-var">pl</span></a></span></span><span> </span><span id="local-6989586621679471961"><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471961"><span class="hs-identifier hs-var">pm</span></a></span></span><span> </span><span id="local-6989586621679471962"><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471962"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471960"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471961"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471961"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471962"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471960"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471962"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679471965"><span class="hs-identifier hs-var">dir1</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679471966"><span class="hs-identifier hs-var">odir</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679471967"><span class="hs-identifier hs-var">dir2</span></a></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><a href="#local-6989586621679471966"><span class="hs-identifier hs-var">odir</span></a></span><span>
</span><span id="line-134"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-135"></span><span>  </span><span id="local-6989586621679471966"><span class="annot"><span class="annottext">odir :: Ordering
</span><a href="#local-6989586621679471966"><span class="hs-identifier hs-var hs-var">odir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i -&gt; Ordering
forall i. Interval i =&gt; i -&gt; Ordering
</span><span class="hs-identifier hs-var">direction</span></span><span> </span><span class="annot"><span class="annottext">(i -&gt; Ordering) -&gt; i -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471960"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; i
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471962"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679471965"><span class="annot"><span class="annottext">dir1 :: Ordering
</span><a href="#local-6989586621679471965"><span class="hs-identifier hs-var hs-var">dir1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i -&gt; Ordering
forall i. Interval i =&gt; i -&gt; Ordering
</span><span class="hs-identifier hs-var">direction</span></span><span> </span><span class="annot"><span class="annottext">(i -&gt; Ordering) -&gt; i -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471960"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; i
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471961"><span class="hs-identifier hs-var">pm</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679471967"><span class="annot"><span class="annottext">dir2 :: Ordering
</span><a href="#local-6989586621679471967"><span class="hs-identifier hs-var hs-var">dir2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i -&gt; Ordering
forall i. Interval i =&gt; i -&gt; Ordering
</span><span class="hs-identifier hs-var">direction</span></span><span> </span><span class="annot"><span class="annottext">(i -&gt; Ordering) -&gt; i -&gt; Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471961"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch i -&gt; Pitch i -&gt; i
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch i
</span><a href="#local-6989586621679471962"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><span class="hs-comment">{- | Attempts to reduce three nodes using an ornamentation operation.
 If succesfull, returns the ornament type and the parent edge,
 which is either a non-terminal edge for passing notes,
 or a terminal edge for all other operations.
-}</span></span><span>
</span><span id="line-144"></span><span id="local-6989586621679471321"><span class="annot"><a href="PVGrammar.Parse.html#findOrnament"><span class="hs-identifier hs-type">findOrnament</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span>
</span><span id="line-150"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#EdgeEither"><span class="hs-identifier hs-type">EdgeEither</span></a></span><span>
</span><span id="line-151"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#DoubleOrnament"><span class="hs-identifier hs-type">DoubleOrnament</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PassingOrnament"><span class="hs-identifier hs-type">PassingOrnament</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#InnerEdge"><span class="hs-identifier hs-type">InnerEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471321"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-special">)</span></span><span>
</span><span id="line-154"></span><span id="findOrnament"><span class="annot"><span class="annottext">findOrnament :: forall n.
IsPitch n =&gt;
StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
</span><a href="PVGrammar.Parse.html#findOrnament"><span class="hs-identifier hs-var hs-var">findOrnament</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472002"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472003"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472003"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472004"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DoubleOrnament, Edge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. a -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="PVGrammar.html#FullRepeat"><span class="hs-identifier hs-var">FullRepeat</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472009"><span class="hs-identifier hs-var">so</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DoubleOrnament, Edge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. a -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="PVGrammar.html#RightRepeatOfLeft"><span class="hs-identifier hs-var">RightRepeatOfLeft</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472009"><span class="hs-identifier hs-var">so</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DoubleOrnament, Edge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. a -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="PVGrammar.html#LeftRepeatOfRight"><span class="hs-identifier hs-var">LeftRepeatOfRight</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472012"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DoubleOrnament, Edge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. a -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="PVGrammar.html#FullNeighbor"><span class="hs-identifier hs-var">FullNeighbor</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472012"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472014"><span class="hs-identifier hs-var">s2</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Bool
forall i.
(Eq i, Interval i) =&gt;
Pitch i -&gt; Pitch i -&gt; Pitch i -&gt; Bool
</span><a href="PVGrammar.Parse.html#between"><span class="hs-identifier hs-var">between</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PassingOrnament, InnerEdge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. b -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="PVGrammar.html#PassingMid"><span class="hs-identifier hs-var">PassingMid</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621679472005"><span class="annot"><span class="annottext">pl :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472002"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621679472006"><span class="annot"><span class="annottext">pm :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472003"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621679472007"><span class="annot"><span class="annottext">pr :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472004"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621679472012"><span class="annot"><span class="annottext">s1 :: Bool
</span><a href="#local-6989586621679472012"><span class="hs-identifier hs-var hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="annot"><span class="annottext">(ICOf (IntervalOf n) -&gt; Bool) -&gt; ICOf (IntervalOf n) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679472014"><span class="annot"><span class="annottext">s2 :: Bool
</span><a href="#local-6989586621679472014"><span class="hs-identifier hs-var hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="annot"><span class="annottext">(ICOf (IntervalOf n) -&gt; Bool) -&gt; ICOf (IntervalOf n) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472006"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621679472009"><span class="annot"><span class="annottext">so :: Bool
</span><a href="#local-6989586621679472009"><span class="hs-identifier hs-var hs-var">so</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="annot"><span class="annottext">(ICOf (IntervalOf n) -&gt; Bool) -&gt; ICOf (IntervalOf n) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472005"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472007"><span class="hs-identifier hs-var">pr</span></a></span><span>
</span><span id="line-167"></span><span class="annot"><a href="PVGrammar.Parse.html#findOrnament"><span class="hs-identifier hs-var">findOrnament</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(EdgeEither (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
 -&gt; Maybe
      (EdgeEither
         (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)))
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DoubleOrnament, Edge n)
-&gt; EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n)
forall a b. a -&gt; EdgeEither a b
</span><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-var">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="PVGrammar.html#RootNote"><span class="hs-identifier hs-var">RootNote</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop (Note n)
forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="annot"><a href="PVGrammar.Parse.html#findOrnament"><span class="hs-identifier hs-var">findOrnament</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  (EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="annot"><span class="hs-comment">{- | Attempts to reduce three notes as a passing motion
 where one of the child edges is a non-terminal edge.

 Since one of the edges is a terminal edge,
 the corresponding outer note could be start/stop symbol, in which case the reduction fails.
 The side with the terminal edge is thus a @StartStop Pitch i@ within a 'Reg',
 while the non-terminal side is a @Pitch i@ within an 'Pass'.
 Exactly one side must be a 'Reg' and the other an 'Pass', otherwise the reduction fails.
-}</span></span><span>
</span><span id="line-179"></span><span id="local-6989586621679471346"><span class="annot"><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-type">findPassing</span></a></span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#EdgeEither"><span class="hs-identifier hs-type">EdgeEither</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#EdgeEither"><span class="hs-identifier hs-type">EdgeEither</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#InnerEdge"><span class="hs-identifier hs-type">InnerEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471346"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#PassingOrnament"><span class="hs-identifier hs-type">PassingOrnament</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-185"></span><span id="findPassing"><span class="annot"><span class="annottext">findPassing :: forall n.
IsPitch n =&gt;
EdgeEither (StartStop (Note n)) (Note n)
-&gt; Note n
-&gt; EdgeEither (StartStop (Note n)) (Note n)
-&gt; Maybe (InnerEdge n, PassingOrnament)
</span><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-var hs-var">findPassing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472051"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472051"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472052"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472052"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span id="local-6989586621679472053"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472053"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472054"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472055"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Bool
forall i.
(Eq i, Interval i) =&gt;
Pitch i -&gt; Pitch i -&gt; Pitch i -&gt; Bool
</span><a href="PVGrammar.Parse.html#between"><span class="hs-identifier hs-var">between</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472054"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472055"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472056"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-187"></span><span>      </span><span class="annot"><span class="annottext">(InnerEdge n, PassingOrnament)
-&gt; Maybe (InnerEdge n, PassingOrnament)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472051"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472053"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="PVGrammar.html#PassingLeft"><span class="hs-identifier hs-var">PassingLeft</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679472054"><span class="annot"><span class="annottext">pl :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472054"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472051"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621679472055"><span class="annot"><span class="annottext">pm :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472055"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472052"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621679472056"><span class="annot"><span class="annottext">pr :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472056"><span class="hs-identifier hs-var hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472053"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-192"></span><span class="annot"><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-var">findPassing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span id="local-6989586621679472058"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472058"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472059"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472059"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472060"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472060"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472061"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472062"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n))
-&gt; Bool
forall i.
(Eq i, Interval i) =&gt;
Pitch i -&gt; Pitch i -&gt; Pitch i -&gt; Bool
</span><a href="PVGrammar.Parse.html#between"><span class="hs-identifier hs-var">between</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472063"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472061"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472062"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">(InnerEdge n, PassingOrnament)
-&gt; Maybe (InnerEdge n, PassingOrnament)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472058"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472060"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="PVGrammar.html#PassingRight"><span class="hs-identifier hs-var">PassingRight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-196"></span><span>  </span><span id="local-6989586621679472063"><span class="annot"><span class="annottext">pl :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472063"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472058"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621679472061"><span class="annot"><span class="annottext">pm :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472061"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472059"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621679472062"><span class="annot"><span class="annottext">pr :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472062"><span class="hs-identifier hs-var hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472060"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-199"></span><span class="annot"><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-var">findPassing</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeEither (StartStop (Note n)) (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">EdgeEither (StartStop (Note n)) (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (InnerEdge n, PassingOrnament)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="local-6989586621679471348"><span class="annot"><a href="PVGrammar.Parse.html#findRightOrnament"><span class="hs-identifier hs-type">findRightOrnament</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471348"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471348"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471348"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="PVGrammar.html#RightOrnament"><span class="hs-identifier hs-type">RightOrnament</span></a></span></span><span>
</span><span id="line-202"></span><span id="findRightOrnament"><span class="annot"><span class="annottext">findRightOrnament :: forall n. IsPitch n =&gt; Note n -&gt; Note n -&gt; Maybe RightOrnament
</span><a href="PVGrammar.Parse.html#findRightOrnament"><span class="hs-identifier hs-var hs-var">findRightOrnament</span></a></span></span><span> </span><span id="local-6989586621679472082"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472082"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679472083"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472083"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472084"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472085"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RightOrnament -&gt; Maybe RightOrnament
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="PVGrammar.html#RightRepeat"><span class="hs-identifier hs-var">RightRepeat</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472084"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472085"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RightOrnament -&gt; Maybe RightOrnament
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="PVGrammar.html#RightNeighbor"><span class="hs-identifier hs-var">RightNeighbor</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe RightOrnament
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-206"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621679472084"><span class="annot"><span class="annottext">pl :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472084"><span class="hs-identifier hs-var hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472082"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span id="local-6989586621679472085"><span class="annot"><span class="annottext">pm :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472085"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472083"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span id="local-6989586621679471351"><span class="annot"><a href="PVGrammar.Parse.html#findLeftOrnament"><span class="hs-identifier hs-type">findLeftOrnament</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471351"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471351"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471351"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="PVGrammar.html#LeftOrnament"><span class="hs-identifier hs-type">LeftOrnament</span></a></span></span><span>
</span><span id="line-211"></span><span id="findLeftOrnament"><span class="annot"><span class="annottext">findLeftOrnament :: forall n. IsPitch n =&gt; Note n -&gt; Note n -&gt; Maybe LeftOrnament
</span><a href="PVGrammar.Parse.html#findLeftOrnament"><span class="hs-identifier hs-var hs-var">findLeftOrnament</span></a></span></span><span> </span><span id="local-6989586621679472105"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472105"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679472106"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472106"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472107"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n)) -&gt; Pitch (ICOf (IntervalOf n)) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472108"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrnament -&gt; Maybe LeftOrnament
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftRepeat"><span class="hs-identifier hs-var">LeftRepeat</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ICOf (IntervalOf n) -&gt; Bool
forall i. Diatonic i =&gt; i -&gt; Bool
</span><span class="hs-identifier hs-var">isStep</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472107"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
-&gt; Pitch (ICOf (IntervalOf n)) -&gt; ICOf (IntervalOf n)
forall {v}. AdditiveGroup v =&gt; Pitch v -&gt; Pitch v -&gt; v
</span><span class="hs-operator hs-var">`pto`</span></span><span> </span><span class="annot"><span class="annottext">Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472108"><span class="hs-identifier hs-var">pr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LeftOrnament -&gt; Maybe LeftOrnament
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftNeighbor"><span class="hs-identifier hs-var">LeftNeighbor</span></a></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe LeftOrnament
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-215"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621679472107"><span class="annot"><span class="annottext">pm :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472107"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472105"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621679472108"><span class="annot"><span class="annottext">pr :: Pitch (ICOf (IntervalOf n))
</span><a href="#local-6989586621679472108"><span class="hs-identifier hs-var hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n)))
-&gt; Pitch (IntervalOf n) -&gt; Pitch (ICOf (IntervalOf n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; Pitch (IntervalOf n)) -&gt; n -&gt; Pitch (IntervalOf n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472106"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><span class="hs-comment">{- | Checks a transition to see if can can in principle be reduced.
If a note is adjacent to several regular edges, it cannot be reduced by a split or spread.
Consequently, if both sides of the transition contain notes adjacent to several edges,
neither can be reduced and the transition is irreducible
-}</span></span><span>
</span><span id="line-224"></span><span id="local-6989586621679471354"><span class="annot"><a href="PVGrammar.Parse.html#edgesAreReducible"><span class="hs-identifier hs-type">edgesAreReducible</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471354"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471354"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-225"></span><span id="edgesAreReducible"><span class="annot"><span class="annottext">edgesAreReducible :: forall n. Hashable n =&gt; Edges n -&gt; Bool
</span><a href="PVGrammar.Parse.html#edgesAreReducible"><span class="hs-identifier hs-var hs-var">edgesAreReducible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472120"><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472120"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621679472121"><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472121"><span class="hs-identifier hs-var">_pass</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)] -&gt; Bool
forall {a}. Hashable a =&gt; [StartStop a] -&gt; Bool
</span><a href="#local-6989586621679472122"><span class="hs-identifier hs-var">isFree</span></a></span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472123"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)] -&gt; Bool
forall {a}. Hashable a =&gt; [StartStop a] -&gt; Bool
</span><a href="#local-6989586621679472122"><span class="hs-identifier hs-var">isFree</span></a></span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472125"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-226"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621679472123"><span class="annot"><span class="annottext">left :: [StartStop (Note n)]
</span><a href="#local-6989586621679472123"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge n -&gt; StartStop (Note n)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Edge n -&gt; StartStop (Note n)) -&gt; [Edge n] -&gt; [StartStop (Note n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; [Edge n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472120"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621679472125"><span class="annot"><span class="annottext">right :: [StartStop (Note n)]
</span><a href="#local-6989586621679472125"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Edge n -&gt; StartStop (Note n)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Edge n -&gt; StartStop (Note n)) -&gt; [Edge n] -&gt; [StartStop (Note n)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; [Edge n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472120"><span class="hs-identifier hs-var">reg</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621679472122"><span class="annot"><span class="annottext">isFree :: [StartStop a] -&gt; Bool
</span><a href="#local-6989586621679472122"><span class="hs-identifier hs-var hs-var">isFree</span></a></span></span><span> </span><span id="local-6989586621679472140"><span class="annot"><span class="annottext">[StartStop a]
</span><a href="#local-6989586621679472140"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiSet a -&gt; Int
forall a. MultiSet a -&gt; Int
</span><a href="Internal.MultiSet.html#cardinality"><span class="hs-identifier hs-var">MS.cardinality</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiSet a -&gt; Int) -&gt; MultiSet a -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; MultiSet a
forall (t :: * -&gt; *) a.
(Foldable t, Eq a, Hashable a) =&gt;
t a -&gt; MultiSet a
</span><a href="Internal.MultiSet.html#fromList"><span class="hs-identifier hs-var">MS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; MultiSet a) -&gt; [a] -&gt; MultiSet a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(StartStop a -&gt; Maybe a) -&gt; [StartStop a] -&gt; [a]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">StartStop a -&gt; Maybe a
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">[StartStop a]
</span><a href="#local-6989586621679472140"><span class="hs-identifier hs-var">notes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="hs-comment">-- evaluator interface</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- ===================</span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-pragma hs-type">protoVoiceEvaluator</span></a></span><span> </span><span class="hs-pragma">::</span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621679472144"><span id="local-6989586621679472145"><span class="hs-pragma">(</span><span class="annot"><span class="hs-pragma hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679472144"><span class="hs-pragma hs-type">t</span></a></span><span class="hs-pragma">,</span><span> </span><span class="annot"><span class="hs-pragma hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679472145"><span class="hs-pragma hs-type">t2</span></a></span><span class="hs-pragma">)</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-pragma">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-pragma hs-type">Eval</span></a></span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-pragma hs-type">Edges</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span><span>
</span><span id="line-238"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621679472144"><span class="hs-pragma hs-type">t</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-pragma hs-type">Edge</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-pragma hs-type">Notes</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span><span>
</span><span id="line-240"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="#local-6989586621679472145"><span class="hs-pragma hs-type">t2</span></a></span><span> </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-pragma hs-type">Note</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span><span class="hs-pragma">)</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-pragma hs-type">Spread</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-pragma">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-pragma hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><span class="hs-pragma hs-type">SPitch</span></span><span class="hs-pragma">)</span></span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="annot"><span class="hs-comment">{- | The evaluator that represents the proto-voice grammar.
 As scores it returns a representation of each operation.
 These scores do not form a semiring,
 but can be embedded into different semirings using 'mapEvalScore'.
-}</span></span><span>
</span><span id="line-250"></span><span id="local-6989586621679471376"><span id="local-6989586621679471377"><span id="local-6989586621679471378"><span class="annot"><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier hs-type">protoVoiceEvaluator</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471376"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471377"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471376"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471377"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-identifier hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471378"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-253"></span><span id="protoVoiceEvaluator"><span class="annot"><span class="annottext">protoVoiceEvaluator :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier hs-var hs-var">protoVoiceEvaluator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="annottext">UnspreadMiddle (Edges n) (Notes n) (Spread n) (Spread n)
-&gt; UnspreadLeft (Edges n) (Notes n) (Spread n)
-&gt; UnspreadRight (Edges n) (Notes n) (Spread n)
-&gt; (StartStop (Notes n)
    -&gt; Edges n
    -&gt; Notes n
    -&gt; Edges n
    -&gt; StartStop (Notes n)
    -&gt; [(Edges n, Split n)])
-&gt; (StartStop (Notes n)
    -&gt; Maybe (t (Edge n))
    -&gt; StartStop (Notes n)
    -&gt; [(Edges n, Freeze n)])
-&gt; (t2 (Note n) -&gt; Notes n)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (Leftmost (Split n) (Freeze n) (Spread n))
forall tr tr' slc slc' s f h.
UnspreadMiddle tr slc h h
-&gt; UnspreadLeft tr slc h
-&gt; UnspreadRight tr slc h
-&gt; (StartStop slc -&gt; tr -&gt; slc -&gt; tr -&gt; StartStop slc -&gt; [(tr, s)])
-&gt; (StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; [(tr, f)])
-&gt; (slc' -&gt; slc)
-&gt; Eval tr tr' slc slc' h (Leftmost s f h)
</span><a href="Common.html#mkLeftmostEval"><span class="hs-identifier hs-var">mkLeftmostEval</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">UnspreadMiddle (Edges n) (Notes n) (Spread n) (Spread n)
forall n.
(Eq n, Ord n, Hashable n, IsPitch n, Notation n) =&gt;
UnspreadMiddle (Edges n) (Notes n) (Spread n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadMiddle"><span class="hs-identifier hs-var">pvUnspreadMiddle</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">UnspreadLeft (Edges n) (Notes n) (Spread n)
forall n. Hashable n =&gt; UnspreadLeft (Edges n) (Notes n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadLeft"><span class="hs-identifier hs-var">pvUnspreadLeft</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">UnspreadRight (Edges n) (Notes n) (Spread n)
forall n.
Hashable n =&gt;
UnspreadRight (Edges n) (Notes n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadRight"><span class="hs-identifier hs-var">pvUnspreadRight</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">StartStop (Notes n)
-&gt; Edges n
-&gt; Notes n
-&gt; Edges n
-&gt; StartStop (Notes n)
-&gt; [(Edges n, Split n)]
forall n.
(IsPitch n, Notation n, Ord n, Hashable n) =&gt;
StartStop (Notes n)
-&gt; Edges n
-&gt; Notes n
-&gt; Edges n
-&gt; StartStop (Notes n)
-&gt; [(Edges n, Split n)]
</span><a href="PVGrammar.Parse.html#pvUnsplit"><span class="hs-identifier hs-var">pvUnsplit</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679472175"><span class="annot"><span class="annottext">Maybe (t (Edge n))
</span><a href="#local-6989586621679472175"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472176"><span class="annot"><span class="annottext">edges :: Edges n
</span><a href="#local-6989586621679472176"><span class="hs-identifier hs-var hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (t (Edge n)) -&gt; Edges n
forall (t :: * -&gt; *) n.
(Foldable t, Ord n, Hashable n) =&gt;
Maybe (t (Edge n)) -&gt; Edges n
</span><a href="PVGrammar.Parse.html#pvThaw"><span class="hs-identifier hs-var">pvThaw</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (t (Edge n))
</span><a href="#local-6989586621679472175"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472176"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; Freeze n
forall n. HashSet (Edge n) -&gt; Freeze n
</span><a href="PVGrammar.html#FreezeOp"><span class="hs-identifier hs-var">FreezeOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edges n -&gt; HashSet (Edge n)
forall n. Edges n -&gt; HashSet (Edge n)
</span><a href="PVGrammar.html#edgesReg"><span class="hs-identifier hs-var">edgesReg</span></a></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472176"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">t2 (Note n) -&gt; Notes n
forall (t :: * -&gt; *) n.
(Foldable t, Eq n, Hashable n) =&gt;
t (Note n) -&gt; Notes n
</span><a href="PVGrammar.Parse.html#pvSlice"><span class="hs-identifier hs-var">pvSlice</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="annot"><span class="hs-comment">{- | Computes the possible verticalizations (unspread) of a middle transition.
 The verticalization fails if the middle transition contains regular edges
 that are not repetitions.
 Otherwise, unspread matches notes connected by a repetition edge
 and then lists all possible /maximal matchings/
 between the non-paired notes in the left and right slice.
 The remaining unmatched notes are verticalized as &quot;single children&quot;.
-}</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- implementation details: see note [Unspread]</span><span>
</span><span id="line-272"></span><span class="annot"><a href="PVGrammar.Parse.html#pvUnspreadMiddle"><span class="hs-identifier hs-type">pvUnspreadMiddle</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679471400"><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-274"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadMiddle"><span class="hs-identifier hs-type">UnspreadMiddle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span id="pvUnspreadMiddle"><span class="annot"><span class="annottext">pvUnspreadMiddle :: forall n.
(Eq n, Ord n, Hashable n, IsPitch n, Notation n) =&gt;
UnspreadMiddle (Edges n) (Notes n) (Spread n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadMiddle"><span class="hs-identifier hs-var hs-var">pvUnspreadMiddle</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621679472244"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472244"><span class="hs-identifier hs-var">notesl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472245"><span class="annot"><span class="annottext">edges :: Edges n
</span><a href="#local-6989586621679472245"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472246"><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472246"><span class="hs-identifier hs-var">regular</span></a></span></span><span> </span><span id="local-6989586621679472247"><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472247"><span class="hs-identifier hs-var">passing</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621679472248"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472248"><span class="hs-identifier hs-var">notesr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Edge n -&gt; Bool) -&gt; HashSet (Edge n) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Edge n -&gt; Bool) -&gt; Edge n -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Edge n -&gt; Bool
forall {b} {b} {f :: * -&gt; *}.
(ICOf (IntervalOf b) ~ ICOf (IntervalOf b),
 Eq (f (Pitch (ICOf (IntervalOf b)))), Functor f, HasPitch b,
 HasPitch b) =&gt;
(f (Note b), f (Note b)) -&gt; Bool
</span><a href="#local-6989586621679472252"><span class="hs-identifier hs-var">isRepetition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472246"><span class="hs-identifier hs-var">regular</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- can't unspread non-repetition edges</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-comment">-- List monad</span><span>
</span><span id="line-280"></span><span>      </span><span class="hs-comment">-- choose a matching for the unpaired notes</span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621679472253"><span class="annot"><a href="#local-6989586621679472253"><span class="hs-identifier hs-var">matching</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[InnerEdge n]]
</span><a href="#local-6989586621679472254"><span class="hs-identifier hs-var">unpairedMatchings</span></a></span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-comment">-- add to the paired matching</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472255"><span class="annot"><a href="#local-6989586621679472255"><span class="hs-identifier hs-var hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashMap (Note n) (SpreadChildren n)
 -&gt; InnerEdge n -&gt; HashMap (Note n) (SpreadChildren n))
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; [InnerEdge n]
-&gt; HashMap (Note n) (SpreadChildren n)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679472256"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472256"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472257"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472257"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472258"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472258"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Note n
-&gt; Note n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
forall {n}.
Hashable n =&gt;
Note n
-&gt; Note n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472259"><span class="hs-identifier hs-var">insertPair</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472257"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472258"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472256"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472260"><span class="hs-identifier hs-var">repPairs</span></a></span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
</span><a href="#local-6989586621679472253"><span class="hs-identifier hs-var">matching</span></a></span><span>
</span><span id="line-284"></span><span>          </span><span class="hs-comment">-- find pitches that have not been matched</span><span>
</span><span id="line-285"></span><span>          </span><span id="local-6989586621679472261"><span class="annot"><a href="#local-6989586621679472261"><span class="hs-identifier hs-var hs-var">matchedl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Note n] -&gt; HashSet (Note n)) -&gt; [Note n] -&gt; HashSet (Note n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; Note n) -&gt; [InnerEdge n] -&gt; [Note n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">InnerEdge n -&gt; Note n
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
</span><a href="#local-6989586621679472253"><span class="hs-identifier hs-var">matching</span></a></span><span>
</span><span id="line-286"></span><span>          </span><span id="local-6989586621679472263"><span class="annot"><a href="#local-6989586621679472263"><span class="hs-identifier hs-var hs-var">matchedr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Note n] -&gt; HashSet (Note n)) -&gt; [Note n] -&gt; HashSet (Note n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; Note n) -&gt; [InnerEdge n] -&gt; [Note n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">InnerEdge n -&gt; Note n
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
</span><a href="#local-6989586621679472253"><span class="hs-identifier hs-var">matching</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span id="local-6989586621679472264"><span class="annot"><a href="#local-6989586621679472264"><span class="hs-identifier hs-var hs-var">leftoverl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; [Note n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashSet (Note n) -&gt; [Note n]) -&gt; HashSet (Note n) -&gt; [Note n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472265"><span class="hs-identifier hs-var">unpairedl</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; HashSet (Note n) -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472261"><span class="hs-identifier hs-var">matchedl</span></a></span><span>
</span><span id="line-288"></span><span>          </span><span id="local-6989586621679472267"><span class="annot"><a href="#local-6989586621679472267"><span class="hs-identifier hs-var hs-var">leftoverr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; [Note n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashSet (Note n) -&gt; [Note n]) -&gt; HashSet (Note n) -&gt; [Note n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472268"><span class="hs-identifier hs-var">unpairedr</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; HashSet (Note n) -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-operator hs-var">`S.difference`</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472263"><span class="hs-identifier hs-var">matchedr</span></a></span><span>
</span><span id="line-289"></span><span>          </span><span class="hs-comment">-- create single parents for the leftover notes</span><span>
</span><span id="line-290"></span><span>          </span><span id="local-6989586621679472269"><span class="annot"><a href="#local-6989586621679472269"><span class="hs-identifier hs-var hs-var">singlel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; (Note n, SpreadChildren n))
-&gt; [Note n] -&gt; [(Note n, SpreadChildren n)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679472270"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472270"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; Note n
forall {n}. Note n -&gt; Note n
</span><a href="#local-6989586621679472271"><span class="hs-identifier hs-var">mkParent1</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472270"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; SpreadChildren n
forall n. Note n -&gt; SpreadChildren n
</span><a href="PVGrammar.html#SpreadLeftChild"><span class="hs-identifier hs-var">SpreadLeftChild</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472270"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472264"><span class="hs-identifier hs-var">leftoverl</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span id="local-6989586621679472273"><span class="annot"><a href="#local-6989586621679472273"><span class="hs-identifier hs-var hs-var">singler</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; (Note n, SpreadChildren n))
-&gt; [Note n] -&gt; [(Note n, SpreadChildren n)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679472274"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472274"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; Note n
forall {n}. Note n -&gt; Note n
</span><a href="#local-6989586621679472271"><span class="hs-identifier hs-var">mkParent1</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472274"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; SpreadChildren n
forall n. Note n -&gt; SpreadChildren n
</span><a href="PVGrammar.html#SpreadRightChild"><span class="hs-identifier hs-var">SpreadRightChild</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472274"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472267"><span class="hs-identifier hs-var">leftoverr</span></a></span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-comment">-- combine all mappings</span><span>
</span><span id="line-293"></span><span>          </span><span id="local-6989586621679472276"><span class="annot"><a href="#local-6989586621679472276"><span class="hs-identifier hs-var hs-var">mappings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
forall k v. Eq k =&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.union</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472255"><span class="hs-identifier hs-var">pairs</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap (Note n) (SpreadChildren n)
 -&gt; HashMap (Note n) (SpreadChildren n))
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)] -&gt; HashMap (Note n) (SpreadChildren n)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472269"><span class="hs-identifier hs-var">singlel</span></a></span><span> </span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)]
-&gt; [(Note n, SpreadChildren n)] -&gt; [(Note n, SpreadChildren n)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472273"><span class="hs-identifier hs-var">singler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>          </span><span id="local-6989586621679472279"><span class="annot"><a href="#local-6989586621679472279"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; Notes n
forall n. HashSet (Note n) -&gt; Notes n
</span><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet (Note n) -&gt; Notes n) -&gt; HashSet (Note n) -&gt; Notes n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n) -&gt; HashSet (Note n)
forall k a. HashMap k a -&gt; HashSet k
</span><span class="hs-identifier hs-var">HM.keysSet</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472276"><span class="hs-identifier hs-var">mappings</span></a></span><span>
</span><span id="line-295"></span><span>          </span><span id="local-6989586621679472281"><span class="annot"><a href="#local-6989586621679472281"><span class="hs-identifier hs-var hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n) -&gt; Edges n -&gt; Spread n
forall n.
HashMap (Note n) (SpreadChildren n) -&gt; Edges n -&gt; Spread n
</span><a href="PVGrammar.html#SpreadOp"><span class="hs-identifier hs-var">SpreadOp</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472276"><span class="hs-identifier hs-var">mappings</span></a></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472245"><span class="hs-identifier hs-var">edges</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472279"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472281"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472281"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>  </span><span id="local-6989586621679472252"><span class="annot"><span class="annottext">isRepetition :: (f (Note b), f (Note b)) -&gt; Bool
</span><a href="#local-6989586621679472252"><span class="hs-identifier hs-var hs-var">isRepetition</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472324"><span class="annot"><span class="annottext">f (Note b)
</span><a href="#local-6989586621679472324"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472325"><span class="annot"><span class="annottext">f (Note b)
</span><a href="#local-6989586621679472325"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note b -&gt; Pitch (ICOf (IntervalOf b)))
-&gt; f (Note b) -&gt; f (Pitch (ICOf (IntervalOf b)))
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (IntervalOf b) -&gt; Pitch (ICOf (IntervalOf b))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf b) -&gt; Pitch (ICOf (IntervalOf b)))
-&gt; (Note b -&gt; Pitch (IntervalOf b))
-&gt; Note b
-&gt; Pitch (ICOf (IntervalOf b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Pitch (IntervalOf b)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Pitch (IntervalOf b))
-&gt; (Note b -&gt; b) -&gt; Note b -&gt; Pitch (IntervalOf b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note b -&gt; b
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Note b)
</span><a href="#local-6989586621679472324"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="annot"><span class="annottext">f (Pitch (ICOf (IntervalOf b)))
-&gt; f (Pitch (ICOf (IntervalOf b))) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">(Note b -&gt; Pitch (ICOf (IntervalOf b)))
-&gt; f (Note b) -&gt; f (Pitch (ICOf (IntervalOf b)))
forall a b. (a -&gt; b) -&gt; f a -&gt; f b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pitch (IntervalOf b) -&gt; Pitch (ICOf (IntervalOf b))
Pitch (IntervalOf b) -&gt; Pitch (ICOf (IntervalOf b))
forall p. Interval p =&gt; Pitch p -&gt; Pitch (ICOf p)
</span><span class="hs-identifier hs-var">pc</span></span><span> </span><span class="annot"><span class="annottext">(Pitch (IntervalOf b) -&gt; Pitch (ICOf (IntervalOf b)))
-&gt; (Note b -&gt; Pitch (IntervalOf b))
-&gt; Note b
-&gt; Pitch (ICOf (IntervalOf b))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; Pitch (IntervalOf b)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Pitch (IntervalOf b))
-&gt; (Note b -&gt; b) -&gt; Note b -&gt; Pitch (IntervalOf b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note b -&gt; b
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">f (Note b)
</span><a href="#local-6989586621679472325"><span class="hs-identifier hs-var">p2</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span id="local-6989586621679472328"><span class="annot"><span class="annottext">mkParent2 :: Note n -&gt; Note n -&gt; Note n
</span><a href="#local-6989586621679472328"><span class="hs-identifier hs-var hs-var">mkParent2</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span id="local-6989586621679472330"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472330"><span class="hs-identifier hs-var">p1</span></a></span></span><span> </span><span id="local-6989586621679472331"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472331"><span class="hs-identifier hs-var">i1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span id="local-6989586621679472332"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472332"><span class="hs-identifier hs-var">p2</span></a></span></span><span> </span><span id="local-6989586621679472333"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472333"><span class="hs-identifier hs-var">i2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n -&gt; String -&gt; Note n
forall n. n -&gt; String -&gt; Note n
</span><a href="PVGrammar.html#Note"><span class="hs-identifier hs-var">Note</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472330"><span class="hs-identifier hs-var">p1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472331"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472333"><span class="hs-identifier hs-var">i2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>  </span><span id="local-6989586621679472271"><span class="annot"><span class="annottext">mkParent1 :: Note n -&gt; Note n
</span><a href="#local-6989586621679472271"><span class="hs-identifier hs-var hs-var">mkParent1</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span id="local-6989586621679472335"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472335"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679472336"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472336"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n -&gt; String -&gt; Note n
forall n. n -&gt; String -&gt; Note n
</span><a href="PVGrammar.html#Note"><span class="hs-identifier hs-var">Note</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472335"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679472336"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>  </span><span id="local-6989586621679472259"><span class="annot"><span class="annottext">insertPair :: Note n
-&gt; Note n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472259"><span class="hs-identifier hs-var hs-var">insertPair</span></a></span></span><span> </span><span id="local-6989586621679472344"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472344"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679472345"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472345"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679472346"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472346"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Note n
-&gt; SpreadChildren n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Note n
forall {n} {n}. Note n -&gt; Note n -&gt; Note n
</span><a href="#local-6989586621679472328"><span class="hs-identifier hs-var">mkParent2</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472344"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472345"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; SpreadChildren n
forall n. Note n -&gt; Note n -&gt; SpreadChildren n
</span><a href="PVGrammar.html#SpreadBothChildren"><span class="hs-identifier hs-var">SpreadBothChildren</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472344"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472345"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472346"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-comment">-- pairs notes at repetition edges and collects the unpaired notes</span><span>
</span><span id="line-304"></span><span>  </span><span id="local-6989586621679472375"><span class="annot"><span class="annottext">pairRep :: (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
 HashSet (Note n))
-&gt; (StartStop (Note n), StartStop (Note n))
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
</span><a href="#local-6989586621679472375"><span class="hs-identifier hs-var hs-var">pairRep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472376"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472376"><span class="hs-identifier hs-var">paired</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472377"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472377"><span class="hs-identifier hs-var">nl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472378"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472378"><span class="hs-identifier hs-var">nr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472379"><span class="annot"><span class="annottext">edge :: (StartStop (Note n), StartStop (Note n))
</span><a href="#local-6989586621679472379"><span class="hs-identifier hs-var">edge</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679472380"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472380"><span class="hs-identifier hs-var">ssl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472381"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472381"><span class="hs-identifier hs-var">ssr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472382"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472382"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472380"><span class="hs-identifier hs-var">ssl</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472383"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472383"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472381"><span class="hs-identifier hs-var">ssr</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472382"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pitch (IntervalOf n) -&gt; Pitch (IntervalOf n) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; Pitch (IntervalOf n)
forall a. HasPitch a =&gt; a -&gt; Pitch (IntervalOf a)
</span><span class="hs-identifier hs-var">pitch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472383"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Note n
-&gt; Note n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
forall {n}.
Hashable n =&gt;
Note n
-&gt; Note n
-&gt; HashMap (Note n) (SpreadChildren n)
-&gt; HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472259"><span class="hs-identifier hs-var">insertPair</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472382"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472383"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472376"><span class="hs-identifier hs-var">paired</span></a></span><span>
</span><span id="line-309"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; HashSet (Note n) -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.delete</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472382"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472377"><span class="hs-identifier hs-var">nl</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; HashSet (Note n) -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.delete</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472383"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472378"><span class="hs-identifier hs-var">nr</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472376"><span class="hs-identifier hs-var">paired</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472377"><span class="hs-identifier hs-var">nl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472378"><span class="hs-identifier hs-var">nr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679472260"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472260"><span class="hs-identifier hs-var">repPairs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472265"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472265"><span class="hs-identifier hs-var">unpairedl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472268"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472268"><span class="hs-identifier hs-var">unpairedr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((HashMap (Note n) (SpreadChildren n), HashSet (Note n),
  HashSet (Note n))
 -&gt; Edge n
 -&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
     HashSet (Note n)))
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
-&gt; HashSet (Edge n)
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; HashSet a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">(HashMap (Note n) (SpreadChildren n), HashSet (Note n),
 HashSet (Note n))
-&gt; Edge n
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
forall {n}.
(HasPitch n, Hashable n, Eq (IntervalOf n)) =&gt;
(HashMap (Note n) (SpreadChildren n), HashSet (Note n),
 HashSet (Note n))
-&gt; (StartStop (Note n), StartStop (Note n))
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
</span><a href="#local-6989586621679472375"><span class="hs-identifier hs-var">pairRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472244"><span class="hs-identifier hs-var">notesl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472248"><span class="hs-identifier hs-var">notesr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashSet (Edge n)
 -&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
     HashSet (Note n)))
-&gt; HashSet (Edge n)
-&gt; (HashMap (Note n) (SpreadChildren n), HashSet (Note n),
    HashSet (Note n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472246"><span class="hs-identifier hs-var">regular</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- collects the pitches of unpaired notes left and right</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621679472386"><span class="annot"><span class="annottext">unpairedPitches :: [n]
</span><a href="#local-6989586621679472386"><span class="hs-identifier hs-var hs-var">unpairedPitches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet n -&gt; [n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">(HashSet n -&gt; [n]) -&gt; HashSet n -&gt; [n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; n) -&gt; HashSet (Note n) -&gt; HashSet n
forall b a.
(Hashable b, Eq b) =&gt;
(a -&gt; b) -&gt; HashSet a -&gt; HashSet b
</span><span class="hs-identifier hs-var">S.map</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472265"><span class="hs-identifier hs-var">unpairedl</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621679472388"><span class="annot"><span class="annottext">unpairedlList :: [Note n]
</span><a href="#local-6989586621679472388"><span class="hs-identifier hs-var hs-var">unpairedlList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; [Note n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472265"><span class="hs-identifier hs-var">unpairedl</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621679472389"><span class="annot"><span class="annottext">unpairedrList :: [Note n]
</span><a href="#local-6989586621679472389"><span class="hs-identifier hs-var hs-var">unpairedrList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; [Note n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472268"><span class="hs-identifier hs-var">unpairedr</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-comment">-- splits the unpaired notes by pitch,</span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-comment">-- then computes all possible matchings for each group.</span><span>
</span><span id="line-322"></span><span>  </span><span class="hs-comment">-- note that only pitches from one side need to be checked</span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- since pitches on the other side that are not included in a group</span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-comment">-- cannot be matched in the first place</span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><a href="#local-6989586621679472390"><span class="hs-identifier hs-type">pairingGroups</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621679472390"><span class="annot"><span class="annottext">pairingGroups :: [[[InnerEdge n]]]
</span><a href="#local-6989586621679472390"><span class="hs-identifier hs-var hs-var">pairingGroups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((n -&gt; [[InnerEdge n]]) -&gt; [n] -&gt; [[[InnerEdge n]]])
-&gt; [n] -&gt; (n -&gt; [[InnerEdge n]]) -&gt; [[[InnerEdge n]]]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; [[InnerEdge n]]) -&gt; [n] -&gt; [[[InnerEdge n]]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[n]
</span><a href="#local-6989586621679472386"><span class="hs-identifier hs-var">unpairedPitches</span></a></span><span> </span><span class="annot"><span class="annottext">((n -&gt; [[InnerEdge n]]) -&gt; [[[InnerEdge n]]])
-&gt; (n -&gt; [[InnerEdge n]]) -&gt; [[[InnerEdge n]]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679472392"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472392"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472393"><span class="annot"><span class="annottext">ls :: [Note n]
</span><a href="#local-6989586621679472393"><span class="hs-identifier hs-var hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; Bool) -&gt; [Note n] -&gt; [Note n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">n -&gt; n -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472392"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(n -&gt; Bool) -&gt; (Note n -&gt; n) -&gt; Note n -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472388"><span class="hs-identifier hs-var">unpairedlList</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621679472394"><span class="annot"><span class="annottext">rs :: [Note n]
</span><a href="#local-6989586621679472394"><span class="hs-identifier hs-var hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; Bool) -&gt; [Note n] -&gt; [Note n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">n -&gt; n -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679472392"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(n -&gt; Bool) -&gt; (Note n -&gt; n) -&gt; Note n -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; n
forall n. Note n -&gt; n
</span><a href="PVGrammar.html#notePitch"><span class="hs-identifier hs-var">notePitch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472389"><span class="hs-identifier hs-var">unpairedrList</span></a></span><span>
</span><span id="line-329"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; [Note n] -&gt; [[InnerEdge n]]
</span><a href="#local-6989586621679472395"><span class="hs-identifier hs-var">matchGroup</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472393"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472394"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-comment">-- Computes all possible matchings within a pitch group,</span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-comment">-- i.e. between two sets of notes with the same pitch</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="#local-6989586621679472395"><span class="hs-identifier hs-type">matchGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621679472395"><span class="annot"><span class="annottext">matchGroup :: [Note n] -&gt; [Note n] -&gt; [[InnerEdge n]]
</span><a href="#local-6989586621679472395"><span class="hs-identifier hs-var hs-var">matchGroup</span></a></span></span><span> </span><span id="local-6989586621679472396"><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472396"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span id="local-6989586621679472397"><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472397"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472396"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472397"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; [Note n] -&gt; [[InnerEdge n]]
</span><a href="#local-6989586621679472399"><span class="hs-identifier hs-var">allMatches</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472396"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472397"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">([InnerEdge n] -&gt; [InnerEdge n])
-&gt; [[InnerEdge n]] -&gt; [[InnerEdge n]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InnerEdge n -&gt; InnerEdge n) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((InnerEdge n -&gt; InnerEdge n) -&gt; [InnerEdge n] -&gt; [InnerEdge n])
-&gt; (InnerEdge n -&gt; InnerEdge n) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472400"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472400"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472401"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472401"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472401"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472400"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[InnerEdge n]] -&gt; [[InnerEdge n]])
-&gt; [[InnerEdge n]] -&gt; [[InnerEdge n]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; [Note n] -&gt; [[InnerEdge n]]
</span><a href="#local-6989586621679472399"><span class="hs-identifier hs-var">allMatches</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472397"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472396"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-338"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><a href="#local-6989586621679472399"><span class="hs-identifier hs-type">allMatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679472399"><span class="annot"><span class="annottext">allMatches :: [Note n] -&gt; [Note n] -&gt; [[InnerEdge n]]
</span><a href="#local-6989586621679472399"><span class="hs-identifier hs-var hs-var">allMatches</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InnerEdge n] -&gt; [[InnerEdge n]]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="#local-6989586621679472399"><span class="hs-identifier hs-var">allMatches</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472402"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472402"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679472403"><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472403"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472404"><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472404"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-comment">-- List monad</span><span>
</span><span id="line-343"></span><span>      </span><span id="local-6989586621679472405"><span class="annot"><a href="#local-6989586621679472405"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472404"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472406"><span class="annot"><a href="#local-6989586621679472406"><span class="hs-identifier hs-var hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; Bool) -&gt; [Note n] -&gt; [Note n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472405"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Note n]
</span><a href="#local-6989586621679472404"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-345"></span><span>      </span><span id="local-6989586621679472407"><span class="annot"><a href="#local-6989586621679472407"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679472399"><span class="hs-identifier hs-type">allMatches</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472403"><span class="hs-keyword hs-type">as</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472406"><span class="hs-identifier hs-type">bs'</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472402"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472405"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><a href="#local-6989586621679472407"><span class="hs-identifier hs-type">rest</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-comment">-- A list of possible matchings of unpaired notes.</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-comment">-- Takes all combintations of matchings per pitch group</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-comment">-- and then concatenates the groups within each combination.</span><span>
</span><span id="line-351"></span><span>  </span><span class="annot"><a href="#local-6989586621679472254"><span class="hs-identifier hs-type">unpairedMatchings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471400"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-352"></span><span>  </span><span id="local-6989586621679472254"><span class="annot"><span class="annottext">unpairedMatchings :: [[InnerEdge n]]
</span><a href="#local-6989586621679472254"><span class="hs-identifier hs-var hs-var">unpairedMatchings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[InnerEdge n]] -&gt; [InnerEdge n])
-&gt; [[[InnerEdge n]]] -&gt; [[InnerEdge n]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[InnerEdge n]] -&gt; [InnerEdge n]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[[InnerEdge n]]] -&gt; [[InnerEdge n]])
-&gt; [[[InnerEdge n]]] -&gt; [[InnerEdge n]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[[InnerEdge n]]] -&gt; [[[InnerEdge n]]]
forall a. [[a]] -&gt; [[a]]
</span><a href="Common.html#cartProd"><span class="hs-identifier hs-var">cartProd</span></a></span><span> </span><span class="annot"><span class="annottext">[[[InnerEdge n]]]
</span><a href="#local-6989586621679472390"><span class="hs-identifier hs-var">pairingGroups</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">{-
Note [Unspread]
~~~~~~~~~~~~~~~

Unspread performs the following steps
1. Check if the transition contains non-repeating regular edges.
   If so, reject the unspread (return []).
2. Pair all notes that are connected by a repeating edge.
3. Compute all /maximal matchings/ for the remaining notes.
   This can be modelled as a matching problem in a bipartite graph
   where the notes from the left and right child slice are the two groups of vertices
   and pairs of notes with the same pitch are the candidate edges.
   However, because of this construction, we can make additional assumptions:
   - the graph can be decomposed into separated components (one for each pitch)
   - within each component, any note on the left can be matched with any note on the right
   Accordingly, the maximal matchings for the unpaired notes can be computed like this:
   1. Partition the graph into components, one per pitch.
      It is sufficient to do this using the pitches of one side
      since notes on the other side that are not included this way
      don't have a partner that they could be matched to anyways.
   2. Within each group, find the side with fewer pitches
      and compute all possible matchings with notes on the other side.
      This is implemented in the list monad by going through the notes on the smaller side,
      non-deterministically choosing a partner note from the other side,
      and removing that note from the pool.
      For each group, this results in a list of possiblem matchings.
   3. Find all combintations of group-level matchings across groups,
      i.e. the cartesian product of the matching lists for all groups.
      For each combination, combine the group-level matchings to one complete matching.
4. For each matching found in step 3 (together with the edge-paired notes),
   compute the corresponding verticalization.
   non-matched notes on either side are explained as &quot;single children&quot;
   with their own parent in the output slice.
-}</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="annot"><span class="hs-comment">{- | Computes all left parent transitions for a verticalization and a left child transition.
 Here, this operation is always admitted and unique,
 so the edges from the child transition are just passed through.
-}</span></span><span>
</span><span id="line-393"></span><span id="local-6989586621679471401"><span class="annot"><a href="PVGrammar.Parse.html#pvUnspreadLeft"><span class="hs-identifier hs-type">pvUnspreadLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471401"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadLeft"><span class="hs-identifier hs-type">UnspreadLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471401"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471401"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471401"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-394"></span><span id="pvUnspreadLeft"><span class="annot"><span class="annottext">pvUnspreadLeft :: forall n. Hashable n =&gt; UnspreadLeft (Edges n) (Notes n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadLeft"><span class="hs-identifier hs-var hs-var">pvUnspreadLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472444"><span class="annot"><span class="annottext">HashSet (StartStop (Note n), StartStop (Note n))
</span><a href="#local-6989586621679472444"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621679472445"><span class="annot"><span class="annottext">MultiSet (Note n, Note n)
</span><a href="#local-6989586621679472445"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Notes n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Notes n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SpreadOp"><span class="hs-identifier hs-type">SpreadOp</span></a></span><span> </span><span id="local-6989586621679472446"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472446"><span class="hs-identifier hs-var">mapping</span></a></span></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Edges n) -&gt; [Edges n]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Edges n)
</span><a href="#local-6989586621679472447"><span class="hs-identifier hs-var">remapped</span></a></span><span>
</span><span id="line-395"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621679472448"><span class="annot"><span class="annottext">mappingList :: [(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472448"><span class="hs-identifier hs-var hs-var">mappingList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n) -&gt; [(Note n, SpreadChildren n)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472446"><span class="hs-identifier hs-var">mapping</span></a></span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621679472450"><span class="annot"><span class="annottext">inverseByLeft :: [(Note n, Note n)]
</span><a href="#local-6989586621679472450"><span class="hs-identifier hs-var hs-var">inverseByLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (Note n, Note n)] -&gt; [(Note n, Note n)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Note n, Note n)] -&gt; [(Note n, Note n)])
-&gt; [Maybe (Note n, Note n)] -&gt; [(Note n, Note n)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Note n, SpreadChildren n) -&gt; Maybe (Note n, Note n))
-&gt; [(Note n, SpreadChildren n)] -&gt; [Maybe (Note n, Note n)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472451"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472451"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472452"><span class="annot"><span class="annottext">SpreadChildren n
</span><a href="#local-6989586621679472452"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472451"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; (Note n, Note n))
-&gt; Maybe (Note n) -&gt; Maybe (Note n, Note n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SpreadChildren n -&gt; Maybe (Note n)
forall n. SpreadChildren n -&gt; Maybe (Note n)
</span><a href="PVGrammar.html#leftSpreadChild"><span class="hs-identifier hs-var">leftSpreadChild</span></a></span><span> </span><span class="annot"><span class="annottext">SpreadChildren n
</span><a href="#local-6989586621679472452"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472448"><span class="hs-identifier hs-var">mappingList</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621679472454"><span class="annot"><span class="annottext">leftMapping :: HashMap (Note n) (Note n)
</span><a href="#local-6989586621679472454"><span class="hs-identifier hs-var hs-var">leftMapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Note n, Note n)] -&gt; HashMap (Note n) (Note n)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Note n, Note n)]
</span><a href="#local-6989586621679472450"><span class="hs-identifier hs-var">inverseByLeft</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621679472447"><span class="annot"><span class="annottext">remapped :: Maybe (Edges n)
</span><a href="#local-6989586621679472447"><span class="hs-identifier hs-var hs-var">remapped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-comment">-- Maybe</span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621679472455"><span class="annot"><a href="#local-6989586621679472455"><span class="hs-identifier hs-var">reg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((StartStop (Note n), StartStop (Note n))
  -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
 -&gt; HashSet (StartStop (Note n), StartStop (Note n))
 -&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n))))
-&gt; HashSet (StartStop (Note n), StartStop (Note n))
-&gt; ((StartStop (Note n), StartStop (Note n))
    -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((StartStop (Note n), StartStop (Note n))
 -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; HashSet (StartStop (Note n), StartStop (Note n))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall (f :: * -&gt; *) n' n.
(Applicative f, Eq n', Hashable n') =&gt;
(n -&gt; f n') -&gt; HashSet n -&gt; f (HashSet n')
</span><a href="Common.html#traverseSet"><span class="hs-identifier hs-var">traverseSet</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (StartStop (Note n), StartStop (Note n))
</span><a href="#local-6989586621679472444"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">(((StartStop (Note n), StartStop (Note n))
  -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
 -&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n))))
-&gt; ((StartStop (Note n), StartStop (Note n))
    -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472457"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472457"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472458"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472458"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>      </span><span id="local-6989586621679472459"><span class="annot"><a href="#local-6989586621679472459"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n) -&gt; Maybe (Note n)
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472458"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621679472460"><span class="annot"><a href="#local-6989586621679472460"><span class="hs-identifier hs-var">rn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621679472459"><span class="hs-identifier hs-type">rn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472454"><span class="hs-identifier hs-type">leftMapping</span></a></span><span>
</span><span id="line-404"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472457"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472460"><span class="hs-identifier hs-type">rn'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>    </span><span id="local-6989586621679472462"><span class="annot"><a href="#local-6989586621679472462"><span class="hs-identifier hs-var">pass'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Internal.MultiSet.html#traverse"><span class="hs-identifier hs-type">MS.traverse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472445"><span class="hs-identifier hs-type">pass</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472464"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472464"><span class="hs-identifier hs-var">ln</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472465"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472465"><span class="hs-identifier hs-var">rn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>      </span><span id="local-6989586621679472466"><span class="annot"><a href="#local-6989586621679472466"><span class="hs-identifier hs-var">rn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; HashMap (Note n) (Note n) -&gt; Maybe (Note n)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472465"><span class="hs-identifier hs-var">rn</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (Note n)
</span><a href="#local-6989586621679472454"><span class="hs-identifier hs-var">leftMapping</span></a></span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472464"><span class="hs-identifier hs-type">ln</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472466"><span class="hs-identifier hs-type">rn'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472455"><span class="hs-identifier hs-type">reg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472462"><span class="hs-identifier hs-type">pass'</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="annot"><span class="hs-comment">{- | Computes all right parent transition for a verticalization and a right child transition.
 Here, this operation is always admitted and unique,
 so the edges from the child transition are just passed through.
-}</span></span><span>
</span><span id="line-414"></span><span id="local-6989586621679471402"><span class="annot"><a href="PVGrammar.Parse.html#pvUnspreadRight"><span class="hs-identifier hs-type">pvUnspreadRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471402"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadRight"><span class="hs-identifier hs-type">UnspreadRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471402"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471402"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471402"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-415"></span><span id="pvUnspreadRight"><span class="annot"><span class="annottext">pvUnspreadRight :: forall n.
Hashable n =&gt;
UnspreadRight (Edges n) (Notes n) (Spread n)
</span><a href="PVGrammar.Parse.html#pvUnspreadRight"><span class="hs-identifier hs-var hs-var">pvUnspreadRight</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Notes n
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472495"><span class="annot"><span class="annottext">HashSet (StartStop (Note n), StartStop (Note n))
</span><a href="#local-6989586621679472495"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621679472496"><span class="annot"><span class="annottext">MultiSet (Note n, Note n)
</span><a href="#local-6989586621679472496"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Notes n
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SpreadOp"><span class="hs-identifier hs-type">SpreadOp</span></a></span><span> </span><span id="local-6989586621679472497"><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472497"><span class="hs-identifier hs-var">mapping</span></a></span></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Edges n) -&gt; [Edges n]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Edges n)
</span><a href="#local-6989586621679472498"><span class="hs-identifier hs-var">remapped</span></a></span><span>
</span><span id="line-416"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-417"></span><span>  </span><span id="local-6989586621679472499"><span class="annot"><span class="annottext">mappingList :: [(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472499"><span class="hs-identifier hs-var hs-var">mappingList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n) -&gt; [(Note n, SpreadChildren n)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (SpreadChildren n)
</span><a href="#local-6989586621679472497"><span class="hs-identifier hs-var">mapping</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span id="local-6989586621679472500"><span class="annot"><span class="annottext">inverseByRight :: [(Note n, Note n)]
</span><a href="#local-6989586621679472500"><span class="hs-identifier hs-var hs-var">inverseByRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe (Note n, Note n)] -&gt; [(Note n, Note n)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Note n, Note n)] -&gt; [(Note n, Note n)])
-&gt; [Maybe (Note n, Note n)] -&gt; [(Note n, Note n)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Note n, SpreadChildren n) -&gt; Maybe (Note n, Note n))
-&gt; [(Note n, SpreadChildren n)] -&gt; [Maybe (Note n, Note n)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472501"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472501"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472502"><span class="annot"><span class="annottext">SpreadChildren n
</span><a href="#local-6989586621679472502"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472501"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Note n -&gt; (Note n, Note n))
-&gt; Maybe (Note n) -&gt; Maybe (Note n, Note n)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">SpreadChildren n -&gt; Maybe (Note n)
forall n. SpreadChildren n -&gt; Maybe (Note n)
</span><a href="PVGrammar.html#rightSpreadChild"><span class="hs-identifier hs-var">rightSpreadChild</span></a></span><span> </span><span class="annot"><span class="annottext">SpreadChildren n
</span><a href="#local-6989586621679472502"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Note n, SpreadChildren n)]
</span><a href="#local-6989586621679472499"><span class="hs-identifier hs-var">mappingList</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621679472504"><span class="annot"><span class="annottext">rightMapping :: HashMap (Note n) (Note n)
</span><a href="#local-6989586621679472504"><span class="hs-identifier hs-var hs-var">rightMapping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Note n, Note n)] -&gt; HashMap (Note n) (Note n)
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Note n, Note n)]
</span><a href="#local-6989586621679472500"><span class="hs-identifier hs-var">inverseByRight</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621679472498"><span class="annot"><span class="annottext">remapped :: Maybe (Edges n)
</span><a href="#local-6989586621679472498"><span class="hs-identifier hs-var hs-var">remapped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- Maybe</span><span>
</span><span id="line-422"></span><span>    </span><span id="local-6989586621679472505"><span class="annot"><a href="#local-6989586621679472505"><span class="hs-identifier hs-var">reg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(((StartStop (Note n), StartStop (Note n))
  -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
 -&gt; HashSet (StartStop (Note n), StartStop (Note n))
 -&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n))))
-&gt; HashSet (StartStop (Note n), StartStop (Note n))
-&gt; ((StartStop (Note n), StartStop (Note n))
    -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((StartStop (Note n), StartStop (Note n))
 -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; HashSet (StartStop (Note n), StartStop (Note n))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall (f :: * -&gt; *) n' n.
(Applicative f, Eq n', Hashable n') =&gt;
(n -&gt; f n') -&gt; HashSet n -&gt; f (HashSet n')
</span><a href="Common.html#traverseSet"><span class="hs-identifier hs-var">traverseSet</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (StartStop (Note n), StartStop (Note n))
</span><a href="#local-6989586621679472495"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">(((StartStop (Note n), StartStop (Note n))
  -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
 -&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n))))
-&gt; ((StartStop (Note n), StartStop (Note n))
    -&gt; Maybe (StartStop (Note n), StartStop (Note n)))
-&gt; Maybe (HashSet (StartStop (Note n), StartStop (Note n)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472506"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472506"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472507"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472507"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-423"></span><span>      </span><span id="local-6989586621679472508"><span class="annot"><a href="#local-6989586621679472508"><span class="hs-identifier hs-var">ln</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n) -&gt; Maybe (Note n)
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472506"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-424"></span><span>      </span><span id="local-6989586621679472509"><span class="annot"><a href="#local-6989586621679472509"><span class="hs-identifier hs-var">ln'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HM.lookup</span></span><span> </span><span class="annot"><a href="#local-6989586621679472508"><span class="hs-identifier hs-type">ln</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472504"><span class="hs-identifier hs-type">rightMapping</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472509"><span class="hs-identifier hs-type">ln'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472507"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679472510"><span class="annot"><a href="#local-6989586621679472510"><span class="hs-identifier hs-var">pass'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">flip</span></span><span> </span><span class="annot"><a href="Internal.MultiSet.html#traverse"><span class="hs-identifier hs-type">MS.traverse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472496"><span class="hs-identifier hs-type">pass</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472511"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472511"><span class="hs-identifier hs-var">ln</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472512"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472512"><span class="hs-identifier hs-var">rn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>      </span><span id="local-6989586621679472513"><span class="annot"><a href="#local-6989586621679472513"><span class="hs-identifier hs-var">ln'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; HashMap (Note n) (Note n) -&gt; Maybe (Note n)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472511"><span class="hs-identifier hs-var">ln</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Note n) (Note n)
</span><a href="#local-6989586621679472504"><span class="hs-identifier hs-var">rightMapping</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472513"><span class="hs-identifier hs-type">ln'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472512"><span class="hs-identifier hs-type">rn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472505"><span class="hs-identifier hs-type">reg'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472510"><span class="hs-identifier hs-type">pass'</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><span class="hs-comment">{- | Computes all possible unsplits of two child transitions.
 Since transitions here only represent the certain edges,
 'pvUnsplit' must also take into account unelaborated edges,
 which are not present in the child transitions.
-}</span></span><span>
</span><span id="line-436"></span><span class="annot"><a href="PVGrammar.Parse.html#pvUnsplit"><span class="hs-identifier hs-type">pvUnsplit</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679471403"><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span></span><span>
</span><span id="line-438"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-445"></span><span id="pvUnsplit"><span class="annot"><span class="annottext">pvUnsplit :: forall n.
(IsPitch n, Notation n, Ord n, Hashable n) =&gt;
StartStop (Notes n)
-&gt; Edges n
-&gt; Notes n
-&gt; Edges n
-&gt; StartStop (Notes n)
-&gt; [(Edges n, Split n)]
</span><a href="PVGrammar.Parse.html#pvUnsplit"><span class="hs-identifier hs-var hs-var">pvUnsplit</span></a></span></span><span> </span><span id="local-6989586621679472631"><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472631"><span class="hs-identifier hs-var">notesl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472632"><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472632"><span class="hs-identifier hs-var">leftRegs</span></a></span></span><span> </span><span id="local-6989586621679472633"><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472633"><span class="hs-identifier hs-var">leftPass</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span id="local-6989586621679472634"><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472634"><span class="hs-identifier hs-var">notesm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span id="local-6989586621679472635"><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472635"><span class="hs-identifier hs-var">rightRegs</span></a></span></span><span> </span><span id="local-6989586621679472636"><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472636"><span class="hs-identifier hs-var">rightPass</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679472637"><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472637"><span class="hs-identifier hs-var">notesr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-comment">-- List</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-comment">-- pick one combination</span><span>
</span><span id="line-448"></span><span>  </span><span id="local-6989586621679472638"><span class="annot"><a href="#local-6989586621679472638"><span class="hs-identifier hs-var">reduction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Elaboration
    (Edge n, (Note n, DoubleOrnament))
    (InnerEdge n, (Note n, PassingOrnament))
    (Note n, (Note n, RightOrnament))
    (Note n, (Note n, LeftOrnament))]]
-&gt; [[Elaboration
       (Edge n, (Note n, DoubleOrnament))
       (InnerEdge n, (Note n, PassingOrnament))
       (Note n, (Note n, RightOrnament))
       (Note n, (Note n, LeftOrnament))]]
forall a. [[a]] -&gt; [[a]]
</span><a href="Common.html#cartProd"><span class="hs-identifier hs-var">cartProd</span></a></span><span> </span><span class="annot"><span class="annottext">[[Elaboration
    (Edge n, (Note n, DoubleOrnament))
    (InnerEdge n, (Note n, PassingOrnament))
    (Note n, (Note n, RightOrnament))
    (Note n, (Note n, LeftOrnament))]]
</span><a href="#local-6989586621679472639"><span class="hs-identifier hs-var">reductions</span></a></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-comment">-- construct split from reduction</span><span>
</span><span id="line-450"></span><span>  </span><span class="annot"><a href="#local-6989586621679472640"><span class="hs-identifier hs-type">mkTop</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#partitionElaborations"><span class="hs-identifier hs-type">partitionElaborations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472638"><span class="hs-identifier hs-type">reduction</span></a></span><span>
</span><span id="line-451"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679472641"><span class="annot"><span class="annottext">innerL :: [StartStop (Note n)]
</span><a href="#local-6989586621679472641"><span class="hs-identifier hs-var hs-var">innerL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n) -&gt; [StartStop (Note n)]
forall n. StartStop (Notes n) -&gt; [StartStop (Note n)]
</span><a href="PVGrammar.html#innerNotes"><span class="hs-identifier hs-var">innerNotes</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472631"><span class="hs-identifier hs-var">notesl</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679472643"><span class="annot"><span class="annottext">innerR :: [StartStop (Note n)]
</span><a href="#local-6989586621679472643"><span class="hs-identifier hs-var hs-var">innerR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n) -&gt; [StartStop (Note n)]
forall n. StartStop (Notes n) -&gt; [StartStop (Note n)]
</span><a href="PVGrammar.html#innerNotes"><span class="hs-identifier hs-var">innerNotes</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472637"><span class="hs-identifier hs-var">notesr</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>  </span><span class="annot"><a href="#local-6989586621679472639"><span class="hs-identifier hs-type">reductions</span></a></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#Elaboration"><span class="hs-identifier hs-type">Elaboration</span></a></span><span>
</span><span id="line-457"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#DoubleOrnament"><span class="hs-identifier hs-type">DoubleOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-458"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#InnerEdge"><span class="hs-identifier hs-type">InnerEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#PassingOrnament"><span class="hs-identifier hs-type">PassingOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-459"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#RightOrnament"><span class="hs-identifier hs-type">RightOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#LeftOrnament"><span class="hs-identifier hs-type">LeftOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>         </span><span class="hs-special">]</span><span>
</span><span id="line-462"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-463"></span><span>  </span><span id="local-6989586621679472639"><span class="annot"><span class="annottext">reductions :: [[Elaboration
    (Edge n, (Note n, DoubleOrnament))
    (InnerEdge n, (Note n, PassingOrnament))
    (Note n, (Note n, RightOrnament))
    (Note n, (Note n, LeftOrnament))]]
</span><a href="#local-6989586621679472639"><span class="hs-identifier hs-var hs-var">reductions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Note n
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472644"><span class="hs-identifier hs-var">findReductions</span></a></span><span> </span><span class="annot"><span class="annottext">(Note n
 -&gt; [Elaboration
       (Edge n, (Note n, DoubleOrnament))
       (InnerEdge n, (Note n, PassingOrnament))
       (Note n, (Note n, RightOrnament))
       (Note n, (Note n, LeftOrnament))])
-&gt; [Note n]
-&gt; [[Elaboration
       (Edge n, (Note n, DoubleOrnament))
       (InnerEdge n, (Note n, PassingOrnament))
       (Note n, (Note n, RightOrnament))
       (Note n, (Note n, LeftOrnament))]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; [Note n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Note n)
</span><a href="#local-6989586621679472634"><span class="hs-identifier hs-var">notesm</span></a></span><span>
</span><span id="line-464"></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-comment">-- finds all possible reductions for a single middle note</span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><a href="#local-6989586621679472644"><span class="hs-identifier hs-type">findReductions</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#Elaboration"><span class="hs-identifier hs-type">Elaboration</span></a></span><span>
</span><span id="line-469"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#DoubleOrnament"><span class="hs-identifier hs-type">DoubleOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-470"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#InnerEdge"><span class="hs-identifier hs-type">InnerEdge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#PassingOrnament"><span class="hs-identifier hs-type">PassingOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#RightOrnament"><span class="hs-identifier hs-type">RightOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#LeftOrnament"><span class="hs-identifier hs-type">LeftOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-474"></span><span>  </span><span id="local-6989586621679472644"><span class="annot"><span class="annottext">findReductions :: Note n
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472644"><span class="hs-identifier hs-var hs-var">findReductions</span></a></span></span><span> </span><span id="local-6989586621679472645"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-comment">-- more than one mandatory edge left or right -&gt; no reduction possible</span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Edge n] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472646"><span class="hs-identifier hs-var">leftRegParent</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[Edge n] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472647"><span class="hs-identifier hs-var">rightRegParent</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-comment">-- case 1: two mandatory parents: must use both</span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679472648"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472648"><span class="hs-identifier hs-var">lparent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472646"><span class="hs-identifier hs-var">leftRegParent</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472649"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472649"><span class="hs-identifier hs-var">rparent</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472647"><span class="hs-identifier hs-var">rightRegParent</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall {n} {c} {d}.
(HasPitch n, Diatonic (ICOf (IntervalOf n)),
 Eq (ICOf (IntervalOf n)), Eq (IntervalOf n)) =&gt;
StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      c
      d]
</span><a href="#local-6989586621679472650"><span class="hs-identifier hs-var">helperDouble</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472648"><span class="hs-identifier hs-var">lparent</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472649"><span class="hs-identifier hs-var">rparent</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">-- case 2: mandatory parent left: choose right parent or none</span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679472651"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472651"><span class="hs-identifier hs-var">lparent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472646"><span class="hs-identifier hs-var">leftRegParent</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-483"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472652"><span class="annot"><span class="annottext">double :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472652"><span class="hs-identifier hs-var hs-var">double</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>              </span><span id="local-6989586621679472653"><span class="annot"><a href="#local-6989586621679472653"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472643"><span class="hs-identifier hs-var">innerR</span></a></span><span>
</span><span id="line-485"></span><span>              </span><span class="annot"><a href="#local-6989586621679472650"><span class="hs-identifier hs-type">helperDouble</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472651"><span class="hs-identifier hs-type">lparent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472653"><span class="hs-identifier hs-type">rparent</span></a></span><span>
</span><span id="line-486"></span><span>            </span><span id="local-6989586621679472654"><span class="annot"><span class="annottext">passing :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472654"><span class="hs-identifier hs-var hs-var">passing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
-&gt; Note n
-&gt; [InnerEdge n]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall {n} {a} {a} {c} {d}.
(HasPitch n, Diatonic (ICOf (IntervalOf n)),
 Eq (ICOf (IntervalOf n)), Eq (IntervalOf n)) =&gt;
StartStop (Note n)
-&gt; Note n
-&gt; [(a, Note n)]
-&gt; [Elaboration a (InnerEdge n, (Note n, PassingOrnament)) c d]
</span><a href="#local-6989586621679472655"><span class="hs-identifier hs-var">helperPassingRight</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472651"><span class="hs-identifier hs-var">lparent</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
</span><a href="#local-6989586621679472656"><span class="hs-identifier hs-var">rightPassParents</span></a></span><span>
</span><span id="line-487"></span><span>            </span><span id="local-6989586621679472657"><span class="annot"><span class="annottext">single :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472657"><span class="hs-identifier hs-var hs-var">single</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
-&gt; Note n
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall {n} {a} {b} {d}.
(HasPitch n, Diatonic (ICOf (IntervalOf n)),
 Eq (ICOf (IntervalOf n)), Eq (IntervalOf n)) =&gt;
StartStop (Note n)
-&gt; Note n -&gt; [Elaboration a b (Note n, (Note n, RightOrnament)) d]
</span><a href="#local-6989586621679472658"><span class="hs-identifier hs-var">helperSingleLeft</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472651"><span class="hs-identifier hs-var">lparent</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span>
</span><span id="line-488"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472652"><span class="hs-identifier hs-var">double</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472654"><span class="hs-identifier hs-var">passing</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472657"><span class="hs-identifier hs-var">single</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-comment">-- case 3: mandatory parent right</span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472659"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472659"><span class="hs-identifier hs-var">rparent</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Edge n]
</span><a href="#local-6989586621679472647"><span class="hs-identifier hs-var">rightRegParent</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-491"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472660"><span class="annot"><span class="annottext">double :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472660"><span class="hs-identifier hs-var hs-var">double</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-492"></span><span>              </span><span id="local-6989586621679472661"><span class="annot"><a href="#local-6989586621679472661"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472641"><span class="hs-identifier hs-var">innerL</span></a></span><span>
</span><span id="line-493"></span><span>              </span><span class="annot"><a href="#local-6989586621679472650"><span class="hs-identifier hs-type">helperDouble</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472661"><span class="hs-identifier hs-type">lparent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472659"><span class="hs-identifier hs-type">rparent</span></a></span><span>
</span><span id="line-494"></span><span>            </span><span id="local-6989586621679472662"><span class="annot"><span class="annottext">passing :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472662"><span class="hs-identifier hs-var hs-var">passing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall {n} {b} {a} {c} {d}.
(HasPitch n, Diatonic (ICOf (IntervalOf n)),
 Eq (ICOf (IntervalOf n)), Eq (IntervalOf n)) =&gt;
[(Note n, b)]
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration a (InnerEdge n, (Note n, PassingOrnament)) c d]
</span><a href="#local-6989586621679472663"><span class="hs-identifier hs-var">helperPassingLeft</span></a></span><span> </span><span class="annot"><span class="annottext">[InnerEdge n]
</span><a href="#local-6989586621679472664"><span class="hs-identifier hs-var">leftPassParents</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472659"><span class="hs-identifier hs-var">rparent</span></a></span><span>
</span><span id="line-495"></span><span>            </span><span id="local-6989586621679472665"><span class="annot"><span class="annottext">single :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472665"><span class="hs-identifier hs-var hs-var">single</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall {n} {a} {b} {c}.
(HasPitch n, Diatonic (ICOf (IntervalOf n)),
 Eq (ICOf (IntervalOf n)), Eq (IntervalOf n)) =&gt;
Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration a b c (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472666"><span class="hs-identifier hs-var">helperSingleRight</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472659"><span class="hs-identifier hs-var">rparent</span></a></span><span>
</span><span id="line-496"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472660"><span class="hs-identifier hs-var">double</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472662"><span class="hs-identifier hs-var">passing</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472665"><span class="hs-identifier hs-var">single</span></a></span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-comment">-- case 4: no mandatory parents</span><span>
</span><span id="line-498"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679472667"><span class="annot"><span class="annottext">double :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472667"><span class="hs-identifier hs-var hs-var">double</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>              </span><span id="local-6989586621679472668"><span class="annot"><a href="#local-6989586621679472668"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472641"><span class="hs-identifier hs-var">innerL</span></a></span><span>
</span><span id="line-501"></span><span>              </span><span id="local-6989586621679472669"><span class="annot"><a href="#local-6989586621679472669"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679472643"><span class="hs-identifier hs-type">innerR</span></a></span><span>
</span><span id="line-502"></span><span>              </span><span class="annot"><a href="#local-6989586621679472650"><span class="hs-identifier hs-type">helperDouble</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472668"><span class="hs-identifier hs-type">lparent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472669"><span class="hs-identifier hs-type">rparent</span></a></span><span>
</span><span id="line-503"></span><span>            </span><span id="local-6989586621679472670"><span class="annot"><span class="annottext">rightPassing :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472670"><span class="hs-identifier hs-var hs-var">rightPassing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>              </span><span id="local-6989586621679472671"><span class="annot"><a href="#local-6989586621679472671"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472641"><span class="hs-identifier hs-var">innerL</span></a></span><span>
</span><span id="line-505"></span><span>              </span><span class="annot"><a href="#local-6989586621679472655"><span class="hs-identifier hs-type">helperPassingRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472671"><span class="hs-identifier hs-type">lparent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472656"><span class="hs-identifier hs-type">rightPassParents</span></a></span><span>
</span><span id="line-506"></span><span>            </span><span id="local-6989586621679472672"><span class="annot"><span class="annottext">leftPassing :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472672"><span class="hs-identifier hs-var hs-var">leftPassing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-507"></span><span>              </span><span id="local-6989586621679472673"><span class="annot"><a href="#local-6989586621679472673"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472643"><span class="hs-identifier hs-var">innerR</span></a></span><span>
</span><span id="line-508"></span><span>              </span><span class="annot"><a href="#local-6989586621679472663"><span class="hs-identifier hs-type">helperPassingLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472664"><span class="hs-identifier hs-type">leftPassParents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472673"><span class="hs-identifier hs-type">rparent</span></a></span><span>
</span><span id="line-509"></span><span>            </span><span id="local-6989586621679472674"><span class="annot"><span class="annottext">leftSingle :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472674"><span class="hs-identifier hs-var hs-var">leftSingle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>              </span><span id="local-6989586621679472675"><span class="annot"><a href="#local-6989586621679472675"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472641"><span class="hs-identifier hs-var">innerL</span></a></span><span>
</span><span id="line-511"></span><span>              </span><span class="annot"><a href="#local-6989586621679472658"><span class="hs-identifier hs-type">helperSingleLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472675"><span class="hs-identifier hs-type">lparent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span>
</span><span id="line-512"></span><span>            </span><span id="local-6989586621679472676"><span class="annot"><span class="annottext">rightSingle :: [Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472676"><span class="hs-identifier hs-var hs-var">rightSingle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-513"></span><span>              </span><span id="local-6989586621679472677"><span class="annot"><a href="#local-6989586621679472677"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[StartStop (Note n)]
</span><a href="#local-6989586621679472643"><span class="hs-identifier hs-var">innerR</span></a></span><span>
</span><span id="line-514"></span><span>              </span><span class="annot"><a href="#local-6989586621679472666"><span class="hs-identifier hs-type">helperSingleRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472645"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472677"><span class="hs-identifier hs-type">rparent</span></a></span><span>
</span><span id="line-515"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472667"><span class="hs-identifier hs-var">double</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472672"><span class="hs-identifier hs-var">leftPassing</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472670"><span class="hs-identifier hs-var">rightPassing</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472674"><span class="hs-identifier hs-var">leftSingle</span></a></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      (Note n, (Note n, RightOrnament))
      (Note n, (Note n, LeftOrnament))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Elaboration
   (Edge n, (Note n, DoubleOrnament))
   (InnerEdge n, (Note n, PassingOrnament))
   (Note n, (Note n, RightOrnament))
   (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472676"><span class="hs-identifier hs-var">rightSingle</span></a></span><span>
</span><span id="line-516"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-comment">-- mandatory edges left</span><span>
</span><span id="line-518"></span><span>    </span><span id="local-6989586621679472646"><span class="annot"><span class="annottext">leftRegParent :: [Edge n]
</span><a href="#local-6989586621679472646"><span class="hs-identifier hs-var hs-var">leftRegParent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Edge n -&gt; Bool) -&gt; [Edge n] -&gt; [Edge n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472678"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472678"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472678"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n) -&gt; StartStop (Note n) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Edge n] -&gt; [Edge n]) -&gt; [Edge n] -&gt; [Edge n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; [Edge n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472632"><span class="hs-identifier hs-var">leftRegs</span></a></span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-comment">-- mandatory edges right</span><span>
</span><span id="line-520"></span><span>    </span><span id="local-6989586621679472647"><span class="annot"><span class="annottext">rightRegParent :: [Edge n]
</span><a href="#local-6989586621679472647"><span class="hs-identifier hs-var hs-var">rightRegParent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Edge n -&gt; Bool) -&gt; [Edge n] -&gt; [Edge n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472679"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472679"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472679"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n) -&gt; StartStop (Note n) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; StartStop (Note n)
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Edge n] -&gt; [Edge n]) -&gt; [Edge n] -&gt; [Edge n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; [Edge n]
forall a. HashSet a -&gt; [a]
</span><span class="hs-identifier hs-var">S.toList</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472635"><span class="hs-identifier hs-var">rightRegs</span></a></span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-comment">-- passing edges left</span><span>
</span><span id="line-522"></span><span>    </span><span id="local-6989586621679472664"><span class="annot"><span class="annottext">leftPassParents :: [InnerEdge n]
</span><a href="#local-6989586621679472664"><span class="hs-identifier hs-var hs-var">leftPassParents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; Bool) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472680"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472680"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472680"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([InnerEdge n] -&gt; [InnerEdge n]) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n) -&gt; [InnerEdge n]
forall a. MultiSet a -&gt; [a]
</span><a href="Internal.MultiSet.html#toList"><span class="hs-identifier hs-var">MS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472633"><span class="hs-identifier hs-var">leftPass</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-comment">-- passing edges right</span><span>
</span><span id="line-524"></span><span>    </span><span id="local-6989586621679472656"><span class="annot"><span class="annottext">rightPassParents :: [InnerEdge n]
</span><a href="#local-6989586621679472656"><span class="hs-identifier hs-var hs-var">rightPassParents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; Bool) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679472682"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472682"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Note n
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472682"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472645"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([InnerEdge n] -&gt; [InnerEdge n]) -&gt; [InnerEdge n] -&gt; [InnerEdge n]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n) -&gt; [InnerEdge n]
forall a. MultiSet a -&gt; [a]
</span><a href="Internal.MultiSet.html#toList"><span class="hs-identifier hs-var">MS.toList</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472636"><span class="hs-identifier hs-var">rightPass</span></a></span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-comment">-- helper functions: find specific reductions of a note to certain parents</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-comment">-- all of them return a list of reductions of the form (parent, (child, ornamentType))</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-comment">-- wrapped in the appropriate Elaboration constructor</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-comment">-- reduce with two regular parents</span><span>
</span><span id="line-531"></span><span>  </span><span id="local-6989586621679472650"><span class="annot"><span class="annottext">helperDouble :: StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration
      (Edge n, (Note n, DoubleOrnament))
      (InnerEdge n, (Note n, PassingOrnament))
      c
      d]
</span><a href="#local-6989586621679472650"><span class="hs-identifier hs-var hs-var">helperDouble</span></a></span></span><span> </span><span id="local-6989586621679472709"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472709"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span id="local-6989586621679472710"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472710"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span id="local-6989586621679472711"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472711"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
forall n.
IsPitch n =&gt;
StartStop (Note n)
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; Maybe
     (EdgeEither
        (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
</span><a href="PVGrammar.Parse.html#findOrnament"><span class="hs-identifier hs-var">findOrnament</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472709"><span class="hs-identifier hs-var">lparent</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472710"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472711"><span class="hs-identifier hs-var">rparent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-533"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (EdgeEither
     (DoubleOrnament, Edge n) (PassingOrnament, InnerEdge n))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472712"><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="#local-6989586621679472712"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472713"><span class="annot"><span class="annottext">Edge n
</span><a href="#local-6989586621679472713"><span class="hs-identifier hs-var">reg</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Edge n, (Note n, DoubleOrnament))
-&gt; Elaboration
     (Edge n, (Note n, DoubleOrnament))
     (InnerEdge n, (Note n, PassingOrnament))
     c
     d
forall a b c d. a -&gt; Elaboration a b c d
</span><a href="PVGrammar.Parse.html#EReg"><span class="hs-identifier hs-var">EReg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edge n
</span><a href="#local-6989586621679472713"><span class="hs-identifier hs-var">reg</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472710"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DoubleOrnament
</span><a href="#local-6989586621679472712"><span class="hs-identifier hs-var">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472714"><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472714"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472715"><span class="annot"><span class="annottext">InnerEdge n
</span><a href="#local-6989586621679472715"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(InnerEdge n, (Note n, PassingOrnament))
-&gt; Elaboration
     (Edge n, (Note n, DoubleOrnament))
     (InnerEdge n, (Note n, PassingOrnament))
     c
     d
forall a b c d. b -&gt; Elaboration a b c d
</span><a href="PVGrammar.Parse.html#EPass"><span class="hs-identifier hs-var">EPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InnerEdge n
</span><a href="#local-6989586621679472715"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472710"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472714"><span class="hs-identifier hs-var">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>  </span><span class="hs-comment">-- reduce with a passing edge on the right and a regular parent on the left</span><span>
</span><span id="line-538"></span><span>  </span><span id="local-6989586621679472655"><span class="annot"><span class="annottext">helperPassingRight :: StartStop (Note n)
-&gt; Note n
-&gt; [(a, Note n)]
-&gt; [Elaboration a (InnerEdge n, (Note n, PassingOrnament)) c d]
</span><a href="#local-6989586621679472655"><span class="hs-identifier hs-var hs-var">helperPassingRight</span></a></span></span><span> </span><span id="local-6989586621679472745"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472745"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span id="local-6989586621679472746"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472746"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span id="local-6989586621679472747"><span class="annot"><span class="annottext">[(a, Note n)]
</span><a href="#local-6989586621679472747"><span class="hs-identifier hs-var">rpassing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472748"><span class="annot"><a href="#local-6989586621679472748"><span class="hs-identifier hs-var">rparent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Note n)]
</span><a href="#local-6989586621679472747"><span class="hs-identifier hs-var">rpassing</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679472749"><span class="annot"><a href="#local-6989586621679472749"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472750"><span class="annot"><a href="#local-6989586621679472750"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-type">findPassing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472745"><span class="hs-identifier hs-type">lparent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679472746"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472748"><span class="hs-identifier hs-type">rparent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#EPass"><span class="hs-identifier hs-type">EPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472749"><span class="hs-identifier hs-type">pass</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472746"><span class="hs-identifier hs-type">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472750"><span class="hs-identifier hs-type">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span>  </span><span class="hs-comment">-- reduce with a passing edge on the left and a regular parent on the right</span><span>
</span><span id="line-544"></span><span>  </span><span id="local-6989586621679472663"><span class="annot"><span class="annottext">helperPassingLeft :: [(Note n, b)]
-&gt; Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration a (InnerEdge n, (Note n, PassingOrnament)) c d]
</span><a href="#local-6989586621679472663"><span class="hs-identifier hs-var hs-var">helperPassingLeft</span></a></span></span><span> </span><span id="local-6989586621679472780"><span class="annot"><span class="annottext">[(Note n, b)]
</span><a href="#local-6989586621679472780"><span class="hs-identifier hs-var">lpassing</span></a></span></span><span> </span><span id="local-6989586621679472781"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472781"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span id="local-6989586621679472782"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472782"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679472783"><span class="annot"><a href="#local-6989586621679472783"><span class="hs-identifier hs-var">lparent</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Note n, b)]
</span><a href="#local-6989586621679472780"><span class="hs-identifier hs-var">lpassing</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679472784"><span class="annot"><a href="#local-6989586621679472784"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472785"><span class="annot"><a href="#local-6989586621679472785"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#findPassing"><span class="hs-identifier hs-type">findPassing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Pass"><span class="hs-identifier hs-type">Pass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472783"><span class="hs-identifier hs-type">lparent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679472781"><span class="hs-identifier hs-type">note</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.Parse.html#Reg"><span class="hs-identifier hs-type">Reg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472782"><span class="hs-identifier hs-type">rparent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#EPass"><span class="hs-identifier hs-type">EPass</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472784"><span class="hs-identifier hs-type">pass</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472781"><span class="hs-identifier hs-type">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679472785"><span class="hs-identifier hs-type">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-comment">-- reduce with a single parent on the left</span><span>
</span><span id="line-550"></span><span>  </span><span id="local-6989586621679472658"><span class="annot"><span class="annottext">helperSingleLeft :: StartStop (Note n)
-&gt; Note n -&gt; [Elaboration a b (Note n, (Note n, RightOrnament)) d]
</span><a href="#local-6989586621679472658"><span class="hs-identifier hs-var hs-var">helperSingleLeft</span></a></span></span><span> </span><span id="local-6989586621679472812"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472812"><span class="hs-identifier hs-var">lparent</span></a></span></span><span> </span><span id="local-6989586621679472813"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472813"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472812"><span class="hs-identifier hs-var">lparent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>    </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472814"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472814"><span class="hs-identifier hs-var">lp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Maybe RightOrnament
forall n. IsPitch n =&gt; Note n -&gt; Note n -&gt; Maybe RightOrnament
</span><a href="PVGrammar.Parse.html#findRightOrnament"><span class="hs-identifier hs-var">findRightOrnament</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472814"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472813"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-552"></span><span>      </span><span class="annot"><span class="annottext">Maybe RightOrnament
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-553"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679472815"><span class="annot"><span class="annottext">RightOrnament
</span><a href="#local-6989586621679472815"><span class="hs-identifier hs-var">orn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Note n, (Note n, RightOrnament))
-&gt; Elaboration a b (Note n, (Note n, RightOrnament)) d
forall a b c d. c -&gt; Elaboration a b c d
</span><a href="PVGrammar.Parse.html#ER"><span class="hs-identifier hs-var">ER</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472814"><span class="hs-identifier hs-var">lp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472813"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="#local-6989586621679472815"><span class="hs-identifier hs-var">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-554"></span><span>    </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>  </span><span class="hs-comment">-- reduce with a single parent on the right</span><span>
</span><span id="line-557"></span><span>  </span><span id="local-6989586621679472666"><span class="annot"><span class="annottext">helperSingleRight :: Note n
-&gt; StartStop (Note n)
-&gt; [Elaboration a b c (Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472666"><span class="hs-identifier hs-var hs-var">helperSingleRight</span></a></span></span><span> </span><span id="local-6989586621679472842"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472842"><span class="hs-identifier hs-var">note</span></a></span></span><span> </span><span id="local-6989586621679472843"><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472843"><span class="hs-identifier hs-var">rparent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><a href="#local-6989586621679472843"><span class="hs-identifier hs-var">rparent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-558"></span><span>    </span><span class="annot"><a href="Common.html#Inner"><span class="hs-identifier hs-type">Inner</span></a></span><span> </span><span id="local-6989586621679472844"><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472844"><span class="hs-identifier hs-var">rp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Note n -&gt; Note n -&gt; Maybe LeftOrnament
forall n. IsPitch n =&gt; Note n -&gt; Note n -&gt; Maybe LeftOrnament
</span><a href="PVGrammar.Parse.html#findLeftOrnament"><span class="hs-identifier hs-var">findLeftOrnament</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472842"><span class="hs-identifier hs-var">note</span></a></span><span> </span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472844"><span class="hs-identifier hs-var">rp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-559"></span><span>      </span><span class="annot"><span class="annottext">Maybe LeftOrnament
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679472845"><span class="annot"><span class="annottext">LeftOrnament
</span><a href="#local-6989586621679472845"><span class="hs-identifier hs-var">orn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Note n, (Note n, LeftOrnament))
-&gt; Elaboration a b c (Note n, (Note n, LeftOrnament))
forall a b c d. d -&gt; Elaboration a b c d
</span><a href="PVGrammar.Parse.html#EL"><span class="hs-identifier hs-var">EL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472844"><span class="hs-identifier hs-var">rp</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Note n
</span><a href="#local-6989586621679472842"><span class="hs-identifier hs-var">note</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="#local-6989586621679472845"><span class="hs-identifier hs-var">orn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-561"></span><span>    </span><span class="annot"><span class="annottext">StartStop (Note n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-comment">-- convert a combination into a derivation operation:</span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-comment">-- turn the accumulated information into the format expected from the evaluator</span><span>
</span><span id="line-565"></span><span>  </span><span class="annot"><a href="#local-6989586621679472640"><span class="hs-identifier hs-type">mkTop</span></a></span><span>
</span><span id="line-566"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#DoubleOrnament"><span class="hs-identifier hs-type">DoubleOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-567"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#PassingOrnament"><span class="hs-identifier hs-type">PassingOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-568"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#RightOrnament"><span class="hs-identifier hs-type">RightOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-569"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#LeftOrnament"><span class="hs-identifier hs-type">LeftOrnament</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-570"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Split"><span class="hs-identifier hs-type">Split</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471403"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-572"></span><span>  </span><span id="local-6989586621679472640"><span class="annot"><span class="annottext">mkTop :: ([(Edge n, (Note n, DoubleOrnament))],
 [(InnerEdge n, (Note n, PassingOrnament))],
 [(Note n, (Note n, RightOrnament))],
 [(Note n, (Note n, LeftOrnament))])
-&gt; [(Edges n, Split n)]
</span><a href="#local-6989586621679472640"><span class="hs-identifier hs-var hs-var">mkTop</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472846"><span class="annot"><span class="annottext">[(Edge n, (Note n, DoubleOrnament))]
</span><a href="#local-6989586621679472846"><span class="hs-identifier hs-var">regs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472847"><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
</span><a href="#local-6989586621679472847"><span class="hs-identifier hs-var">pass</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472848"><span class="annot"><span class="annottext">[(Note n, (Note n, RightOrnament))]
</span><a href="#local-6989586621679472848"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472849"><span class="annot"><span class="annottext">[(Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472849"><span class="hs-identifier hs-var">ls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Edges n -&gt; Bool
forall n. Hashable n =&gt; Edges n -&gt; Bool
</span><a href="PVGrammar.Parse.html#edgesAreReducible"><span class="hs-identifier hs-var">edgesAreReducible</span></a></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472850"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(Edges n, Split n) -&gt; [(Edges n, Split n)]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472850"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
-&gt; Map (InnerEdge n) [(Note n, PassingOrnament)]
-&gt; Map (Note n) [(Note n, RightOrnament)]
-&gt; Map (Note n) [(Note n, LeftOrnament)]
-&gt; HashSet (Edge n)
-&gt; HashSet (Edge n)
-&gt; MultiSet (InnerEdge n)
-&gt; MultiSet (InnerEdge n)
-&gt; Split n
forall n.
Map (Edge n) [(Note n, DoubleOrnament)]
-&gt; Map (InnerEdge n) [(Note n, PassingOrnament)]
-&gt; Map (Note n) [(Note n, RightOrnament)]
-&gt; Map (Note n) [(Note n, LeftOrnament)]
-&gt; HashSet (Edge n)
-&gt; HashSet (Edge n)
-&gt; MultiSet (InnerEdge n)
-&gt; MultiSet (InnerEdge n)
-&gt; Split n
</span><a href="PVGrammar.html#SplitOp"><span class="hs-identifier hs-var">SplitOp</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
</span><a href="#local-6989586621679472852"><span class="hs-identifier hs-var">regmap</span></a></span><span> </span><span class="annot"><span class="annottext">Map (InnerEdge n) [(Note n, PassingOrnament)]
</span><a href="#local-6989586621679472853"><span class="hs-identifier hs-var">passmap</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Note n) [(Note n, RightOrnament)]
</span><a href="#local-6989586621679472854"><span class="hs-identifier hs-var">rmap</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Note n) [(Note n, LeftOrnament)]
</span><a href="#local-6989586621679472855"><span class="hs-identifier hs-var">lmap</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472632"><span class="hs-identifier hs-var">leftRegs</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><a href="#local-6989586621679472635"><span class="hs-identifier hs-var">rightRegs</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472856"><span class="hs-identifier hs-var">passL</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472857"><span class="hs-identifier hs-var">passR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-576"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-comment">-- collect all operations</span><span>
</span><span id="line-578"></span><span>    </span><span id="local-6989586621679472866"><span class="annot"><span class="annottext">mapify :: [(k, a)] -&gt; Map k [a]
</span><a href="#local-6989586621679472866"><span class="hs-identifier hs-var hs-var">mapify</span></a></span></span><span> </span><span id="local-6989586621679472867"><span class="annot"><span class="annottext">[(k, a)]
</span><a href="#local-6989586621679472867"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([a] -&gt; [a] -&gt; [a]) -&gt; [(k, [a])] -&gt; Map k [a]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">M.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">([(k, [a])] -&gt; Map k [a]) -&gt; [(k, [a])] -&gt; Map k [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; [a]) -&gt; (k, a) -&gt; (k, [a])
forall a b. (a -&gt; b) -&gt; (k, a) -&gt; (k, b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((k, a) -&gt; (k, [a])) -&gt; [(k, a)] -&gt; [(k, [a])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(k, a)]
</span><a href="#local-6989586621679472867"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-579"></span><span>    </span><span id="local-6989586621679472852"><span class="annot"><span class="annottext">regmap :: Map (Edge n) [(Note n, DoubleOrnament)]
</span><a href="#local-6989586621679472852"><span class="hs-identifier hs-var hs-var">regmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Edge n, (Note n, DoubleOrnament))]
-&gt; Map (Edge n) [(Note n, DoubleOrnament)]
forall {k} {a}. Ord k =&gt; [(k, a)] -&gt; Map k [a]
</span><a href="#local-6989586621679472866"><span class="hs-identifier hs-var">mapify</span></a></span><span> </span><span class="annot"><span class="annottext">[(Edge n, (Note n, DoubleOrnament))]
</span><a href="#local-6989586621679472846"><span class="hs-identifier hs-var">regs</span></a></span><span>
</span><span id="line-580"></span><span>    </span><span id="local-6989586621679472853"><span class="annot"><span class="annottext">passmap :: Map (InnerEdge n) [(Note n, PassingOrnament)]
</span><a href="#local-6989586621679472853"><span class="hs-identifier hs-var hs-var">passmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
-&gt; Map (InnerEdge n) [(Note n, PassingOrnament)]
forall {k} {a}. Ord k =&gt; [(k, a)] -&gt; Map k [a]
</span><a href="#local-6989586621679472866"><span class="hs-identifier hs-var">mapify</span></a></span><span> </span><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
</span><a href="#local-6989586621679472847"><span class="hs-identifier hs-var">pass</span></a></span><span>
</span><span id="line-581"></span><span>    </span><span id="local-6989586621679472855"><span class="annot"><span class="annottext">lmap :: Map (Note n) [(Note n, LeftOrnament)]
</span><a href="#local-6989586621679472855"><span class="hs-identifier hs-var hs-var">lmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Note n, (Note n, LeftOrnament))]
-&gt; Map (Note n) [(Note n, LeftOrnament)]
forall {k} {a}. Ord k =&gt; [(k, a)] -&gt; Map k [a]
</span><a href="#local-6989586621679472866"><span class="hs-identifier hs-var">mapify</span></a></span><span> </span><span class="annot"><span class="annottext">[(Note n, (Note n, LeftOrnament))]
</span><a href="#local-6989586621679472849"><span class="hs-identifier hs-var">ls</span></a></span><span>
</span><span id="line-582"></span><span>    </span><span id="local-6989586621679472854"><span class="annot"><span class="annottext">rmap :: Map (Note n) [(Note n, RightOrnament)]
</span><a href="#local-6989586621679472854"><span class="hs-identifier hs-var hs-var">rmap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Note n, (Note n, RightOrnament))]
-&gt; Map (Note n) [(Note n, RightOrnament)]
forall {k} {a}. Ord k =&gt; [(k, a)] -&gt; Map k [a]
</span><a href="#local-6989586621679472866"><span class="hs-identifier hs-var">mapify</span></a></span><span> </span><span class="annot"><span class="annottext">[(Note n, (Note n, RightOrnament))]
</span><a href="#local-6989586621679472848"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-583"></span><span>    </span><span id="local-6989586621679472871"><span class="annot"><span class="annottext">leftPassingChild :: ((a, b), (b, PassingOrnament)) -&gt; Maybe (a, b)
</span><a href="#local-6989586621679472871"><span class="hs-identifier hs-var hs-var">leftPassingChild</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679472872"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679472872"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472873"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679472873"><span class="hs-identifier hs-var">_r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472874"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679472874"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472875"><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472875"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-584"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472875"><span class="hs-identifier hs-var">orn</span></a></span><span> </span><span class="annot"><span class="annottext">PassingOrnament -&gt; PassingOrnament -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="PVGrammar.html#PassingRight"><span class="hs-identifier hs-var">PassingRight</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; Maybe (a, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679472872"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679472874"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (a, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-585"></span><span>    </span><span id="local-6989586621679472877"><span class="annot"><span class="annottext">rightPassingChild :: ((a, b), (a, PassingOrnament)) -&gt; Maybe (a, b)
</span><a href="#local-6989586621679472877"><span class="hs-identifier hs-var hs-var">rightPassingChild</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679472878"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679472878"><span class="hs-identifier hs-var">_l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472879"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679472879"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679472880"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679472880"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472881"><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472881"><span class="hs-identifier hs-var">orn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-586"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="#local-6989586621679472881"><span class="hs-identifier hs-var">orn</span></a></span><span> </span><span class="annot"><span class="annottext">PassingOrnament -&gt; PassingOrnament -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">PassingOrnament
</span><a href="PVGrammar.html#PassingLeft"><span class="hs-identifier hs-var">PassingLeft</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; Maybe (a, b)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679472880"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679472879"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (a, b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-587"></span><span>    </span><span id="local-6989586621679472856"><span class="annot"><span class="annottext">passL :: MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472856"><span class="hs-identifier hs-var hs-var">passL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; MultiSet (InnerEdge n) -&gt; MultiSet (InnerEdge n))
-&gt; MultiSet (InnerEdge n)
-&gt; [InnerEdge n]
-&gt; MultiSet (InnerEdge n)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">InnerEdge n -&gt; MultiSet (InnerEdge n) -&gt; MultiSet (InnerEdge n)
forall a. (Eq a, Hashable a) =&gt; a -&gt; MultiSet a -&gt; MultiSet a
</span><a href="Internal.MultiSet.html#delete"><span class="hs-identifier hs-var">MS.delete</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472633"><span class="hs-identifier hs-var">leftPass</span></a></span><span> </span><span class="annot"><span class="annottext">([InnerEdge n] -&gt; MultiSet (InnerEdge n))
-&gt; [InnerEdge n] -&gt; MultiSet (InnerEdge n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((InnerEdge n, (Note n, PassingOrnament)) -&gt; Maybe (InnerEdge n))
-&gt; [(InnerEdge n, (Note n, PassingOrnament))] -&gt; [InnerEdge n]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(InnerEdge n, (Note n, PassingOrnament)) -&gt; Maybe (InnerEdge n)
forall {a} {b} {b}. ((a, b), (b, PassingOrnament)) -&gt; Maybe (a, b)
</span><a href="#local-6989586621679472871"><span class="hs-identifier hs-var">leftPassingChild</span></a></span><span> </span><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
</span><a href="#local-6989586621679472847"><span class="hs-identifier hs-var">pass</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span id="local-6989586621679472857"><span class="annot"><span class="annottext">passR :: MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472857"><span class="hs-identifier hs-var hs-var">passR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InnerEdge n -&gt; MultiSet (InnerEdge n) -&gt; MultiSet (InnerEdge n))
-&gt; MultiSet (InnerEdge n)
-&gt; [InnerEdge n]
-&gt; MultiSet (InnerEdge n)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">InnerEdge n -&gt; MultiSet (InnerEdge n) -&gt; MultiSet (InnerEdge n)
forall a. (Eq a, Hashable a) =&gt; a -&gt; MultiSet a -&gt; MultiSet a
</span><a href="Internal.MultiSet.html#delete"><span class="hs-identifier hs-var">MS.delete</span></a></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><a href="#local-6989586621679472636"><span class="hs-identifier hs-var">rightPass</span></a></span><span> </span><span class="annot"><span class="annottext">([InnerEdge n] -&gt; MultiSet (InnerEdge n))
-&gt; [InnerEdge n] -&gt; MultiSet (InnerEdge n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((InnerEdge n, (Note n, PassingOrnament)) -&gt; Maybe (InnerEdge n))
-&gt; [(InnerEdge n, (Note n, PassingOrnament))] -&gt; [InnerEdge n]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">(InnerEdge n, (Note n, PassingOrnament)) -&gt; Maybe (InnerEdge n)
forall {a} {b} {a}. ((a, b), (a, PassingOrnament)) -&gt; Maybe (a, b)
</span><a href="#local-6989586621679472877"><span class="hs-identifier hs-var">rightPassingChild</span></a></span><span> </span><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
</span><a href="#local-6989586621679472847"><span class="hs-identifier hs-var">pass</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span id="local-6989586621679472850"><span class="annot"><span class="annottext">top :: Edges n
</span><a href="#local-6989586621679472850"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; MultiSet (InnerEdge n) -&gt; Edges n
forall n. HashSet (Edge n) -&gt; MultiSet (InnerEdge n) -&gt; Edges n
</span><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-var">Edges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Edge n] -&gt; HashSet (Edge n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Edge n, (Note n, DoubleOrnament)) -&gt; Edge n
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Edge n, (Note n, DoubleOrnament)) -&gt; Edge n)
-&gt; [(Edge n, (Note n, DoubleOrnament))] -&gt; [Edge n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Edge n, (Note n, DoubleOrnament))]
</span><a href="#local-6989586621679472846"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InnerEdge n] -&gt; MultiSet (InnerEdge n)
forall (t :: * -&gt; *) a.
(Foldable t, Eq a, Hashable a) =&gt;
t a -&gt; MultiSet a
</span><a href="Internal.MultiSet.html#fromList"><span class="hs-identifier hs-var">MS.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InnerEdge n, (Note n, PassingOrnament)) -&gt; InnerEdge n
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((InnerEdge n, (Note n, PassingOrnament)) -&gt; InnerEdge n)
-&gt; [(InnerEdge n, (Note n, PassingOrnament))] -&gt; [InnerEdge n]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(InnerEdge n, (Note n, PassingOrnament))]
</span><a href="#local-6989586621679472847"><span class="hs-identifier hs-var">pass</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>
</span><span id="line-591"></span><span class="hs-comment">-- old pvUnsplit (no IDs, multisets)</span><span>
</span><span id="line-592"></span><span class="hs-comment">-- pvUnsplit notesl (Edges leftRegs leftPass) (Notes notesm) (Edges rightRegs rightPass) notesr =</span><span>
</span><span id="line-593"></span><span class="hs-comment">--   map mkTop combinations</span><span>
</span><span id="line-594"></span><span class="hs-comment">--  where</span><span>
</span><span id="line-595"></span><span class="hs-comment">--   -- preprocessing of the notes left and right of the unsplit</span><span>
</span><span id="line-596"></span><span class="hs-comment">--   !innerL = Reg &lt;$&gt; innerNotes notesl</span><span>
</span><span id="line-597"></span><span class="hs-comment">--   !innerR = Reg &lt;$&gt; innerNotes notesr</span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="hs-comment">--   -- find all reduction options for every pitch</span><span>
</span><span id="line-600"></span><span class="hs-comment">--   !options = noteOptions &lt;$&gt; MS.toOccurList notesm</span><span>
</span><span id="line-601"></span><span class="hs-comment">--   noteOptions (note, nocc)</span><span>
</span><span id="line-602"></span><span class="hs-comment">--     | nocc &lt; MS.size mandatoryLeft || nocc &lt; MS.size mandatoryRight =</span><span>
</span><span id="line-603"></span><span class="hs-comment">--         []</span><span>
</span><span id="line-604"></span><span class="hs-comment">--     | otherwise =</span><span>
</span><span id="line-605"></span><span class="hs-comment">--         partitionElaborations</span><span>
</span><span id="line-606"></span><span class="hs-comment">--           &lt;$&gt; enumerateOptions mandatoryLeft mandatoryRight nocc</span><span>
</span><span id="line-607"></span><span class="hs-comment">--    where</span><span>
</span><span id="line-608"></span><span class="hs-comment">--     -- compute the mandatory edges for the current pitch:</span><span>
</span><span id="line-609"></span><span class="hs-comment">--     mleftRegs = S.map (Reg . fst) $ S.filter ((== Inner note) . snd) leftRegs</span><span>
</span><span id="line-610"></span><span class="hs-comment">--     mleftPass = MS.map (Pass . fst) $ MS.filter ((== note) . snd) leftPass</span><span>
</span><span id="line-611"></span><span class="hs-comment">--     mrightRegs = S.map (Reg . snd) $ S.filter ((== Inner note) . fst) rightRegs</span><span>
</span><span id="line-612"></span><span class="hs-comment">--     mrightPass = MS.map (Pass . snd) $ MS.filter ((== note) . fst) rightPass</span><span>
</span><span id="line-613"></span><span class="hs-comment">--     mandatoryLeft = MS.fromSet mleftRegs &lt;&gt; mleftPass</span><span>
</span><span id="line-614"></span><span class="hs-comment">--     mandatoryRight = MS.fromSet mrightRegs &lt;&gt; mrightPass</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span class="hs-comment">--     -- the possible reductions of a (multiple) pitch are enumerated in three stages:</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">--     -- stage 1: consume all mandatory edges on the left</span><span>
</span><span id="line-619"></span><span class="hs-comment">--     enumerateOptions ml mr n = do</span><span>
</span><span id="line-620"></span><span class="hs-comment">--       (mr', n', acc) &lt;- MS.foldM goL (mr, n, []) ml</span><span>
</span><span id="line-621"></span><span class="hs-comment">--       (n'', acc') &lt;- MS.foldM goR (n', acc) mr'</span><span>
</span><span id="line-622"></span><span class="hs-comment">--       goFree freeOptions n'' acc'</span><span>
</span><span id="line-623"></span><span class="hs-comment">--     goL (_, 0, _) _ = []</span><span>
</span><span id="line-624"></span><span class="hs-comment">--     goL (mr, n, acc) l = do</span><span>
</span><span id="line-625"></span><span class="hs-comment">--       (new, mr') &lt;- pickLeft n l mr</span><span>
</span><span id="line-626"></span><span class="hs-comment">--       pure (mr', n - 1, new : acc)</span><span>
</span><span id="line-627"></span><span class="hs-comment">--     -- combine a mandatory left with a mandatory right or free right edge</span><span>
</span><span id="line-628"></span><span class="hs-comment">--     pickLeft n l mr</span><span>
</span><span id="line-629"></span><span class="hs-comment">--       | n &gt; MS.size mr = mand &lt;&gt; opt &lt;&gt; single</span><span>
</span><span id="line-630"></span><span class="hs-comment">--       | otherwise = mand</span><span>
</span><span id="line-631"></span><span class="hs-comment">--      where</span><span>
</span><span id="line-632"></span><span class="hs-comment">--       mand = do</span><span>
</span><span id="line-633"></span><span class="hs-comment">--         r &lt;- MS.distinctElems mr</span><span>
</span><span id="line-634"></span><span class="hs-comment">--         red &lt;- maybeToList $ tryReduction True True l note r</span><span>
</span><span id="line-635"></span><span class="hs-comment">--         pure (red, MS.delete r mr)</span><span>
</span><span id="line-636"></span><span class="hs-comment">--       -- TODO: remove mr options here?</span><span>
</span><span id="line-637"></span><span class="hs-comment">--       tryOpt r = tryReduction True (r `S.member` mrightRegs) l note r</span><span>
</span><span id="line-638"></span><span class="hs-comment">--       opt = (,mr) &lt;$&gt; mapMaybe tryOpt innerR</span><span>
</span><span id="line-639"></span><span class="hs-comment">--       single = fmap (,mr) $ maybeToList $ tryLeftReduction note l</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span class="hs-comment">--     -- stage 2: consume all remaining mandatory edges on the right</span><span>
</span><span id="line-642"></span><span class="hs-comment">--     goR (0, _) _ = []</span><span>
</span><span id="line-643"></span><span class="hs-comment">--     goR (n, acc) r = do</span><span>
</span><span id="line-644"></span><span class="hs-comment">--       new &lt;- pickRight r</span><span>
</span><span id="line-645"></span><span class="hs-comment">--       pure (n - 1, new : acc)</span><span>
</span><span id="line-646"></span><span class="hs-comment">--     -- combine mandatory right with free left edge</span><span>
</span><span id="line-647"></span><span class="hs-comment">--     pickRight r = opt &lt;&gt; single</span><span>
</span><span id="line-648"></span><span class="hs-comment">--      where</span><span>
</span><span id="line-649"></span><span class="hs-comment">--       tryOpt l = tryReduction (l `S.member` mleftRegs) True l note r</span><span>
</span><span id="line-650"></span><span class="hs-comment">--       opt = mapMaybe tryOpt innerL</span><span>
</span><span id="line-651"></span><span class="hs-comment">--       single = maybeToList $ tryRightReduction note r</span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">--     -- stage 3: explain all remaining notes through a combination of unknown edges</span><span>
</span><span id="line-654"></span><span class="hs-comment">--     goFree _ 0 acc = pure acc</span><span>
</span><span id="line-655"></span><span class="hs-comment">--     goFree [] _ _ = []</span><span>
</span><span id="line-656"></span><span class="hs-comment">--     goFree [lastOpt] n acc = pure $ L.replicate n lastOpt &lt;&gt; acc</span><span>
</span><span id="line-657"></span><span class="hs-comment">--     goFree (opt : opts) n acc = do</span><span>
</span><span id="line-658"></span><span class="hs-comment">--       nopt &lt;- [0 .. n]</span><span>
</span><span id="line-659"></span><span class="hs-comment">--       goFree opts (n - nopt) (L.replicate nopt opt &lt;&gt; acc)</span><span>
</span><span id="line-660"></span><span class="hs-comment">--     -- list all options for free reduction</span><span>
</span><span id="line-661"></span><span class="hs-comment">--     freeOptions = pickFreeBoth &lt;&gt; pickFreeLeft &lt;&gt; pickFreeRight</span><span>
</span><span id="line-662"></span><span class="hs-comment">--     -- combine two free edges</span><span>
</span><span id="line-663"></span><span class="hs-comment">--     pickFreeBoth = do</span><span>
</span><span id="line-664"></span><span class="hs-comment">--       l &lt;- innerL</span><span>
</span><span id="line-665"></span><span class="hs-comment">--       r &lt;- innerR</span><span>
</span><span id="line-666"></span><span class="hs-comment">--       maybeToList $</span><span>
</span><span id="line-667"></span><span class="hs-comment">--         tryReduction (l `S.member` mleftRegs) (r `S.member` mrightRegs) l note r</span><span>
</span><span id="line-668"></span><span class="hs-comment">--     -- reduce to left using free edge</span><span>
</span><span id="line-669"></span><span class="hs-comment">--     pickFreeLeft = mapMaybe (tryLeftReduction note) innerL</span><span>
</span><span id="line-670"></span><span class="hs-comment">--     -- reduce to right using free edge</span><span>
</span><span id="line-671"></span><span class="hs-comment">--     pickFreeRight = mapMaybe (tryRightReduction note) innerR</span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="hs-comment">--   -- at all stages: try out potential reductions:</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">--   -- two terminal edges: any ornament</span><span>
</span><span id="line-676"></span><span class="hs-comment">--   tryReduction lIsUsed rIsUsed (Reg notel) notem (Reg noter) = do</span><span>
</span><span id="line-677"></span><span class="hs-comment">--     reduction &lt;- findOrnament notel (Inner notem) noter lIsUsed rIsUsed</span><span>
</span><span id="line-678"></span><span class="hs-comment">--     pure $ case reduction of</span><span>
</span><span id="line-679"></span><span class="hs-comment">--       (Reg (orn, parent)) -&gt; EReg (parent, (notem, orn))</span><span>
</span><span id="line-680"></span><span class="hs-comment">--       (Pass (pass, parent)) -&gt; EPass (parent, (notem, pass))</span><span>
</span><span id="line-681"></span><span class="hs-comment">--   -- a non-terminal edge left and a terminal edge right: passing note</span><span>
</span><span id="line-682"></span><span class="hs-comment">--   tryReduction _ _ notel@(Pass _) notem noter@(Reg _) = do</span><span>
</span><span id="line-683"></span><span class="hs-comment">--     (parent, pass) &lt;- findPassing notel notem noter</span><span>
</span><span id="line-684"></span><span class="hs-comment">--     pure $ EPass (parent, (notem, pass))</span><span>
</span><span id="line-685"></span><span class="hs-comment">--   -- a terminal edge left and a non-terminal edge right: passing note</span><span>
</span><span id="line-686"></span><span class="hs-comment">--   tryReduction _ _ notel@(Reg _) notem noter@(Pass _) = do</span><span>
</span><span id="line-687"></span><span class="hs-comment">--     (parent, pass) &lt;- findPassing notel notem noter</span><span>
</span><span id="line-688"></span><span class="hs-comment">--     pure $ EPass (parent, (notem, pass))</span><span>
</span><span id="line-689"></span><span class="hs-comment">--   -- all other combinations are forbidden</span><span>
</span><span id="line-690"></span><span class="hs-comment">--   tryReduction _ _ _ _ _ = Nothing</span><span>
</span><span id="line-691"></span><span>
</span><span id="line-692"></span><span class="hs-comment">--   -- single reduction to a left parent</span><span>
</span><span id="line-693"></span><span class="hs-comment">--   tryLeftReduction notem (Reg (Inner notel)) = do</span><span>
</span><span id="line-694"></span><span class="hs-comment">--     orn &lt;- findRightOrnament notel notem</span><span>
</span><span id="line-695"></span><span class="hs-comment">--     pure $ ER (notel, (notem, orn))</span><span>
</span><span id="line-696"></span><span class="hs-comment">--   tryLeftReduction _ _ = Nothing</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-comment">--   -- single reduction to a right parent</span><span>
</span><span id="line-699"></span><span class="hs-comment">--   tryRightReduction notem (Reg (Inner noter)) = do</span><span>
</span><span id="line-700"></span><span class="hs-comment">--     orn &lt;- findLeftOrnament notem noter</span><span>
</span><span id="line-701"></span><span class="hs-comment">--     pure $ EL (noter, (notem, orn))</span><span>
</span><span id="line-702"></span><span class="hs-comment">--   tryRightReduction _ _ = Nothing</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span class="hs-comment">--   -- compute all possible combinations of reduction options</span><span>
</span><span id="line-705"></span><span class="hs-comment">--   !combinations =</span><span>
</span><span id="line-706"></span><span class="hs-comment">--     if any L.null options -- check if any note has no options</span><span>
</span><span id="line-707"></span><span class="hs-comment">--       then [] -- if yes, then no reduction is possible at all</span><span>
</span><span id="line-708"></span><span class="hs-comment">--       else foldM pickOption ([], [], [], []) options -- otherwise, compute all combinations</span><span>
</span><span id="line-709"></span><span class="hs-comment">--       -- picks all different options for a single note in the list monad</span><span>
</span><span id="line-710"></span><span class="hs-comment">--   pickOption (accReg, accPass, accL, accR) opts = do</span><span>
</span><span id="line-711"></span><span class="hs-comment">--     (regs, pass, ls, rs) &lt;- opts</span><span>
</span><span id="line-712"></span><span class="hs-comment">--     pure (regs &lt;&gt; accReg, pass &lt;&gt; accPass, ls &lt;&gt; accL, rs &lt;&gt; accR)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="hs-comment">--   -- convert a combination into a derivation operation:</span><span>
</span><span id="line-715"></span><span class="hs-comment">--   -- turn the accumulated information into the format expected from the evaluator</span><span>
</span><span id="line-716"></span><span class="hs-comment">--   mkTop (regs, pass, rs, ls) =</span><span>
</span><span id="line-717"></span><span class="hs-comment">--     if True -- validate</span><span>
</span><span id="line-718"></span><span class="hs-comment">--       then (top, SplitOp tmap ntmap rmap lmap leftRegs rightRegs passL passR)</span><span>
</span><span id="line-719"></span><span class="hs-comment">--       else</span><span>
</span><span id="line-720"></span><span class="hs-comment">--         error $</span><span>
</span><span id="line-721"></span><span class="hs-comment">--           &quot;invalid unsplit:\n  notesl=&quot;</span><span>
</span><span id="line-722"></span><span class="hs-comment">--             &lt;&gt; show notesl</span><span>
</span><span id="line-723"></span><span class="hs-comment">--             &lt;&gt; &quot;\n  notesr=&quot;</span><span>
</span><span id="line-724"></span><span class="hs-comment">--             &lt;&gt; show notesr</span><span>
</span><span id="line-725"></span><span class="hs-comment">--             &lt;&gt; &quot;\n  notesm=&quot;</span><span>
</span><span id="line-726"></span><span class="hs-comment">--             &lt;&gt; show (Notes notesm)</span><span>
</span><span id="line-727"></span><span class="hs-comment">--             &lt;&gt; &quot;\n  left=&quot;</span><span>
</span><span id="line-728"></span><span class="hs-comment">--             &lt;&gt; show (Edges leftRegs leftPass)</span><span>
</span><span id="line-729"></span><span class="hs-comment">--             &lt;&gt; &quot;\n  right=&quot;</span><span>
</span><span id="line-730"></span><span class="hs-comment">--             &lt;&gt; show (Edges rightRegs rightPass)</span><span>
</span><span id="line-731"></span><span class="hs-comment">--             &lt;&gt; &quot;\n  top=&quot;</span><span>
</span><span id="line-732"></span><span class="hs-comment">--             &lt;&gt; show top</span><span>
</span><span id="line-733"></span><span class="hs-comment">--    where</span><span>
</span><span id="line-734"></span><span class="hs-comment">--     -- validate =</span><span>
</span><span id="line-735"></span><span class="hs-comment">--     --   all ((`L.elem` innerNotes notesl) . fst . fst) regs</span><span>
</span><span id="line-736"></span><span class="hs-comment">--     --     &amp;&amp; all ((`L.elem` innerNotes notesr) . snd . fst)   regs</span><span>
</span><span id="line-737"></span><span class="hs-comment">--     --     &amp;&amp; all ((`L.elem` innerNotes notesl) . Inner . fst) rs</span><span>
</span><span id="line-738"></span><span class="hs-comment">--     --     &amp;&amp; all ((`L.elem` innerNotes notesr) . Inner . fst) ls</span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span class="hs-comment">--     -- collect all operations</span><span>
</span><span id="line-741"></span><span class="hs-comment">--     mapify xs = M.fromListWith (&lt;&gt;) $ fmap (: []) &lt;$&gt; xs</span><span>
</span><span id="line-742"></span><span class="hs-comment">--     tmap = mapify regs</span><span>
</span><span id="line-743"></span><span class="hs-comment">--     ntmap = mapify pass</span><span>
</span><span id="line-744"></span><span class="hs-comment">--     lmap = mapify ls</span><span>
</span><span id="line-745"></span><span class="hs-comment">--     rmap = mapify rs</span><span>
</span><span id="line-746"></span><span class="hs-comment">--     top = Edges (S.fromList (fst &lt;$&gt; regs)) (MS.fromList (fst &lt;$&gt; pass))</span><span>
</span><span id="line-747"></span><span class="hs-comment">--     passL = foldr MS.delete leftPass $ mapMaybe leftPassingChild pass</span><span>
</span><span id="line-748"></span><span class="hs-comment">--     passR = foldr MS.delete rightPass $ mapMaybe rightPassingChild pass</span><span>
</span><span id="line-749"></span><span class="hs-comment">--     leftPassingChild ((l, _r), (m, orn)) =</span><span>
</span><span id="line-750"></span><span class="hs-comment">--       if orn == PassingRight then Just (l, m) else Nothing</span><span>
</span><span id="line-751"></span><span class="hs-comment">--     rightPassingChild ((_l, r), (m, orn)) =</span><span>
</span><span id="line-752"></span><span class="hs-comment">--       if orn == PassingLeft then Just (m, r) else Nothing</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="annot"><span class="hs-comment">-- | Unfreezes a single transition, which may be 'Nothing'.</span></span><span>
</span><span id="line-755"></span><span id="local-6989586621679471404"><span id="local-6989586621679471405"><span class="annot"><a href="PVGrammar.Parse.html#pvThaw"><span class="hs-identifier hs-type">pvThaw</span></a></span><span>
</span><span id="line-756"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471404"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471405"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471405"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471404"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471405"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471405"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-759"></span><span id="pvThaw"><span class="annot"><span class="annottext">pvThaw :: forall (t :: * -&gt; *) n.
(Foldable t, Ord n, Hashable n) =&gt;
Maybe (t (Edge n)) -&gt; Edges n
</span><a href="PVGrammar.Parse.html#pvThaw"><span class="hs-identifier hs-var hs-var">pvThaw</span></a></span></span><span> </span><span id="local-6989586621679472897"><span class="annot"><span class="annottext">Maybe (t (Edge n))
</span><a href="#local-6989586621679472897"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n) -&gt; MultiSet (InnerEdge n) -&gt; Edges n
forall n. HashSet (Edge n) -&gt; MultiSet (InnerEdge n) -&gt; Edges n
</span><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-var">Edges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Edge n] -&gt; HashSet (Edge n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Edge n] -&gt; HashSet (Edge n)) -&gt; [Edge n] -&gt; HashSet (Edge n)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Edge n]
-&gt; (t (Edge n) -&gt; [Edge n]) -&gt; Maybe (t (Edge n)) -&gt; [Edge n]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">t (Edge n) -&gt; [Edge n]
forall a. t a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Maybe (t (Edge n))
</span><a href="#local-6989586621679472897"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
forall a. MultiSet a
</span><a href="Internal.MultiSet.html#empty"><span class="hs-identifier hs-var">MS.empty</span></a></span><span>
</span><span id="line-760"></span><span>
</span><span id="line-761"></span><span id="local-6989586621679471408"><span id="local-6989586621679471409"><span class="annot"><a href="PVGrammar.Parse.html#pvSlice"><span class="hs-identifier hs-type">pvSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471408"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679471408"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471409"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471409"><span class="hs-identifier hs-type">n</span></a></span></span></span><span>
</span><span id="line-762"></span><span id="pvSlice"><span class="annot"><span class="annottext">pvSlice :: forall (t :: * -&gt; *) n.
(Foldable t, Eq n, Hashable n) =&gt;
t (Note n) -&gt; Notes n
</span><a href="PVGrammar.Parse.html#pvSlice"><span class="hs-identifier hs-var hs-var">pvSlice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet (Note n) -&gt; Notes n
forall n. HashSet (Note n) -&gt; Notes n
</span><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-var">Notes</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet (Note n) -&gt; Notes n)
-&gt; (t (Note n) -&gt; HashSet (Note n)) -&gt; t (Note n) -&gt; Notes n
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Note n] -&gt; HashSet (Note n)
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">S.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Note n] -&gt; HashSet (Note n))
-&gt; (t (Note n) -&gt; [Note n]) -&gt; t (Note n) -&gt; HashSet (Note n)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">t (Note n) -&gt; [Note n]
forall a. t a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- evaluators in specific semirings</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- ================================</span><span>
</span><span id="line-766"></span><span>
</span><span id="line-767"></span><span class="annot"><span class="hs-comment">{- | A restricted version of the PV evaluator
 that prohibits split operations in which one of the parent slices is repeated entirely.
-}</span></span><span>
</span><span id="line-770"></span><span id="local-6989586621679472906"><span id="local-6989586621679472907"><span id="local-6989586621679472908"><span class="annot"><a href="PVGrammar.Parse.html#protoVoiceEvaluatorNoRepSplit"><span class="hs-identifier hs-type">protoVoiceEvaluatorNoRepSplit</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679472906"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679472907"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472906"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679472907"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-identifier hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679472908"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-773"></span><span id="protoVoiceEvaluatorNoRepSplit"><span class="annot"><span class="annottext">protoVoiceEvaluatorNoRepSplit :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluatorNoRepSplit"><span class="hs-identifier hs-var hs-var">protoVoiceEvaluatorNoRepSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle (Edges n) (Notes n) (Spread n) (PVLeftmost n)
-&gt; UnspreadLeft (Edges n) (Notes n) (Spread n)
-&gt; UnspreadRight (Edges n) (Notes n) (Spread n)
-&gt; Unsplit (Edges n) (Notes n) (PVLeftmost n)
-&gt; (StartStop (Notes n)
    -&gt; Maybe (t (Edge n))
    -&gt; StartStop (Notes n)
    -&gt; Bool
    -&gt; [(Edges n, PVLeftmost n)])
-&gt; (t2 (Note n) -&gt; Notes n)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (PVLeftmost n)
forall tr tr' slc slc' h v.
UnspreadMiddle tr slc h v
-&gt; UnspreadLeft tr slc h
-&gt; UnspreadRight tr slc h
-&gt; Unsplit tr slc v
-&gt; (StartStop slc
    -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)])
-&gt; (slc' -&gt; slc)
-&gt; Eval tr tr' slc slc' h v
</span><a href="Common.html#Eval"><span class="hs-identifier hs-var">Eval</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle (Edges n) (Notes n) (Spread n) (PVLeftmost n)
</span><a href="#local-6989586621679472929"><span class="hs-identifier hs-var">vm</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft (Edges n) (Notes n) (Spread n)
</span><a href="#local-6989586621679472930"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight (Edges n) (Notes n) (Spread n)
</span><a href="#local-6989586621679472931"><span class="hs-identifier hs-var">vr</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit (Edges n) (Notes n) (PVLeftmost n)
</span><a href="#local-6989586621679472932"><span class="hs-identifier hs-var">filterSplit</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
-&gt; Maybe (t (Edge n))
-&gt; StartStop (Notes n)
-&gt; Bool
-&gt; [(Edges n, PVLeftmost n)]
</span><a href="#local-6989586621679472933"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">t2 (Note n) -&gt; Notes n
</span><a href="#local-6989586621679472934"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-774"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-775"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621679472929"><span class="annot"><span class="annottext">UnspreadMiddle (Edges n) (Notes n) (Spread n) (PVLeftmost n)
</span><a href="#local-6989586621679472929"><span class="hs-identifier hs-var">vm</span></a></span></span><span> </span><span id="local-6989586621679472930"><span class="annot"><span class="annottext">UnspreadLeft (Edges n) (Notes n) (Spread n)
</span><a href="#local-6989586621679472930"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span id="local-6989586621679472931"><span class="annot"><span class="annottext">UnspreadRight (Edges n) (Notes n) (Spread n)
</span><a href="#local-6989586621679472931"><span class="hs-identifier hs-var">vr</span></a></span></span><span> </span><span id="local-6989586621679472956"><span class="annot"><span class="annottext">Unsplit (Edges n) (Notes n) (PVLeftmost n)
</span><a href="#local-6989586621679472956"><span class="hs-identifier hs-var">mg</span></a></span></span><span> </span><span id="local-6989586621679472933"><span class="annot"><span class="annottext">StartStop (Notes n)
-&gt; Maybe (t (Edge n))
-&gt; StartStop (Notes n)
-&gt; Bool
-&gt; [(Edges n, PVLeftmost n)]
</span><a href="#local-6989586621679472933"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679472934"><span class="annot"><span class="annottext">t2 (Note n) -&gt; Notes n
</span><a href="#local-6989586621679472934"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier hs-var">protoVoiceEvaluator</span></a></span><span>
</span><span id="line-776"></span><span>  </span><span id="local-6989586621679472932"><span class="annot"><span class="annottext">filterSplit :: Unsplit (Edges n) (Notes n) (PVLeftmost n)
</span><a href="#local-6989586621679472932"><span class="hs-identifier hs-var hs-var">filterSplit</span></a></span></span><span> </span><span id="local-6989586621679472957"><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472957"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679472958"><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472958"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679472959"><span class="annot"><span class="annottext">Notes n
</span><a href="#local-6989586621679472959"><span class="hs-identifier hs-var">mid</span></a></span></span><span> </span><span id="local-6989586621679472960"><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472960"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679472961"><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472961"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679472962"><span class="annot"><span class="annottext">SplitType
</span><a href="#local-6989586621679472962"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Edges n, PVLeftmost n) -&gt; Bool)
-&gt; [(Edges n, PVLeftmost n)] -&gt; [(Edges n, PVLeftmost n)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">(Edges n, PVLeftmost n) -&gt; Bool
forall {a} {n} {f} {h}. (a, Leftmost (Split n) f h) -&gt; Bool
</span><a href="#local-6989586621679472963"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">([(Edges n, PVLeftmost n)] -&gt; [(Edges n, PVLeftmost n)])
-&gt; [(Edges n, PVLeftmost n)] -&gt; [(Edges n, PVLeftmost n)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Unsplit (Edges n) (Notes n) (PVLeftmost n)
</span><a href="#local-6989586621679472956"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472957"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472958"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">Notes n
</span><a href="#local-6989586621679472959"><span class="hs-identifier hs-var">mid</span></a></span><span> </span><span class="annot"><span class="annottext">Edges n
</span><a href="#local-6989586621679472960"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop (Notes n)
</span><a href="#local-6989586621679472961"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="#local-6989586621679472962"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span id="local-6989586621679472963"><span class="annot"><span class="annottext">ok :: (a, Leftmost (Split n) f h) -&gt; Bool
</span><a href="#local-6989586621679472963"><span class="hs-identifier hs-var hs-var">ok</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#LMSplitLeft"><span class="hs-identifier hs-type">LMSplitLeft</span></a></span><span> </span><span id="local-6989586621679472965"><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472965"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Split n -&gt; Bool
forall {n}. Split n -&gt; Bool
</span><a href="#local-6989586621679472966"><span class="hs-identifier hs-var">onlyRepeats</span></a></span><span> </span><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472965"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="annot"><a href="#local-6989586621679472963"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#LMSplitOnly"><span class="hs-identifier hs-type">LMSplitOnly</span></a></span><span> </span><span id="local-6989586621679472968"><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472968"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Split n -&gt; Bool
forall {n}. Split n -&gt; Bool
</span><a href="#local-6989586621679472966"><span class="hs-identifier hs-var">onlyRepeats</span></a></span><span> </span><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472968"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><a href="#local-6989586621679472963"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Common.html#LMSplitRight"><span class="hs-identifier hs-type">LMSplitRight</span></a></span><span> </span><span id="local-6989586621679472970"><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472970"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Split n -&gt; Bool
forall {n}. Split n -&gt; Bool
</span><a href="#local-6989586621679472966"><span class="hs-identifier hs-var">onlyRepeats</span></a></span><span> </span><span class="annot"><span class="annottext">Split n
</span><a href="#local-6989586621679472970"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span class="annot"><a href="#local-6989586621679472963"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Leftmost (Split n) f h)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-781"></span><span>  </span><span id="local-6989586621679472966"><span class="annot"><span class="annottext">onlyRepeats :: Split n -&gt; Bool
</span><a href="#local-6989586621679472966"><span class="hs-identifier hs-var hs-var">onlyRepeats</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#SplitOp"><span class="hs-identifier hs-type">SplitOp</span></a></span><span> </span><span id="local-6989586621679472983"><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
</span><a href="#local-6989586621679472983"><span class="hs-identifier hs-var">regs</span></a></span></span><span> </span><span id="local-6989586621679472984"><span class="annot"><span class="annottext">Map (InnerEdge n) [(Note n, PassingOrnament)]
</span><a href="#local-6989586621679472984"><span class="hs-identifier hs-var">pass</span></a></span></span><span> </span><span id="local-6989586621679472985"><span class="annot"><span class="annottext">Map (Note n) [(Note n, RightOrnament)]
</span><a href="#local-6989586621679472985"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621679472986"><span class="annot"><span class="annottext">Map (Note n) [(Note n, LeftOrnament)]
</span><a href="#local-6989586621679472986"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashSet (Edge n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">MultiSet (InnerEdge n)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-782"></span><span>    </span><span class="annot"><span class="annottext">Map (InnerEdge n) [(Note n, PassingOrnament)] -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">M.null</span></span><span> </span><span class="annot"><span class="annottext">Map (InnerEdge n) [(Note n, PassingOrnament)]
</span><a href="#local-6989586621679472984"><span class="hs-identifier hs-var">pass</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472988"><span class="hs-identifier hs-var">allRepetitionsLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472989"><span class="hs-identifier hs-var">allRepetitionsRight</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-784"></span><span>    </span><span id="local-6989586621679472990"><span class="annot"><span class="annottext">allSinglesRepeat :: Bool
</span><a href="#local-6989586621679472990"><span class="hs-identifier hs-var hs-var">allSinglesRepeat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><span class="annottext">((Note n, [(Note n, RightOrnament)]) -&gt; Bool)
-&gt; [(Note n, [(Note n, RightOrnament)])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RightOrnament -&gt; Bool)
-&gt; (Note n, [(Note n, RightOrnament)]) -&gt; Bool
forall {t :: * -&gt; *} {b} {a} {a}.
Foldable t =&gt;
(b -&gt; Bool) -&gt; (a, t (a, b)) -&gt; Bool
</span><a href="#local-6989586621679472992"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RightOrnament -&gt; RightOrnament -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">RightOrnament
</span><a href="PVGrammar.html#RightRepeat"><span class="hs-identifier hs-var">RightRepeat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Note n) [(Note n, RightOrnament)]
-&gt; [(Note n, [(Note n, RightOrnament)])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Note n) [(Note n, RightOrnament)]
</span><a href="#local-6989586621679472985"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Note n, [(Note n, LeftOrnament)]) -&gt; Bool)
-&gt; [(Note n, [(Note n, LeftOrnament)])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LeftOrnament -&gt; Bool)
-&gt; (Note n, [(Note n, LeftOrnament)]) -&gt; Bool
forall {t :: * -&gt; *} {b} {a} {a}.
Foldable t =&gt;
(b -&gt; Bool) -&gt; (a, t (a, b)) -&gt; Bool
</span><a href="#local-6989586621679472992"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LeftOrnament -&gt; LeftOrnament -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">LeftOrnament
</span><a href="PVGrammar.html#LeftRepeat"><span class="hs-identifier hs-var">LeftRepeat</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Note n) [(Note n, LeftOrnament)]
-&gt; [(Note n, [(Note n, LeftOrnament)])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Note n) [(Note n, LeftOrnament)]
</span><a href="#local-6989586621679472986"><span class="hs-identifier hs-var">ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>    </span><span id="local-6989586621679472988"><span class="annot"><span class="annottext">allRepetitionsLeft :: Bool
</span><a href="#local-6989586621679472988"><span class="hs-identifier hs-var hs-var">allRepetitionsLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-788"></span><span>      </span><span class="annot"><span class="annottext">((Edge n, [(Note n, DoubleOrnament)]) -&gt; Bool)
-&gt; [(Edge n, [(Note n, DoubleOrnament)])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DoubleOrnament -&gt; Bool)
-&gt; (Edge n, [(Note n, DoubleOrnament)]) -&gt; Bool
forall {t :: * -&gt; *} {b} {a} {a}.
Foldable t =&gt;
(b -&gt; Bool) -&gt; (a, t (a, b)) -&gt; Bool
</span><a href="#local-6989586621679472992"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">DoubleOrnament -&gt; Bool
</span><a href="PVGrammar.html#isRepetitionOnLeft"><span class="hs-identifier hs-var">isRepetitionOnLeft</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
-&gt; [(Edge n, [(Note n, DoubleOrnament)])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
</span><a href="#local-6989586621679472983"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472990"><span class="hs-identifier hs-var">allSinglesRepeat</span></a></span><span>
</span><span id="line-789"></span><span>    </span><span id="local-6989586621679472989"><span class="annot"><span class="annottext">allRepetitionsRight :: Bool
</span><a href="#local-6989586621679472989"><span class="hs-identifier hs-var hs-var">allRepetitionsRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-790"></span><span>      </span><span class="annot"><span class="annottext">((Edge n, [(Note n, DoubleOrnament)]) -&gt; Bool)
-&gt; [(Edge n, [(Note n, DoubleOrnament)])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DoubleOrnament -&gt; Bool)
-&gt; (Edge n, [(Note n, DoubleOrnament)]) -&gt; Bool
forall {t :: * -&gt; *} {b} {a} {a}.
Foldable t =&gt;
(b -&gt; Bool) -&gt; (a, t (a, b)) -&gt; Bool
</span><a href="#local-6989586621679472992"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">DoubleOrnament -&gt; Bool
</span><a href="PVGrammar.html#isRepetitionOnRight"><span class="hs-identifier hs-var">isRepetitionOnRight</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
-&gt; [(Edge n, [(Note n, DoubleOrnament)])]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span> </span><span class="annot"><span class="annottext">Map (Edge n) [(Note n, DoubleOrnament)]
</span><a href="#local-6989586621679472983"><span class="hs-identifier hs-var">regs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679472990"><span class="hs-identifier hs-var">allSinglesRepeat</span></a></span><span>
</span><span id="line-791"></span><span>  </span><span id="local-6989586621679472992"><span class="annot"><span class="annottext">check :: (b -&gt; Bool) -&gt; (a, t (a, b)) -&gt; Bool
</span><a href="#local-6989586621679472992"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621679472998"><span class="annot"><span class="annottext">b -&gt; Bool
</span><a href="#local-6989586621679472998"><span class="hs-identifier hs-var">fpred</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679472999"><span class="annot"><span class="annottext">t (a, b)
</span><a href="#local-6989586621679472999"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, b) -&gt; Bool) -&gt; t (a, b) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Bool
</span><a href="#local-6989586621679472998"><span class="hs-identifier hs-var">fpred</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Bool) -&gt; ((a, b) -&gt; b) -&gt; (a, b) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; b
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (a, b)
</span><a href="#local-6989586621679472999"><span class="hs-identifier hs-var">os</span></a></span><span>
</span><span id="line-792"></span><span>
</span><span id="line-793"></span><span class="annot"><span class="hs-comment">-- | An evaluator for protovoices that produces values in the 'Derivations' semiring.</span></span><span>
</span><span id="line-794"></span><span id="local-6989586621679471565"><span id="local-6989586621679471566"><span id="local-6989586621679471567"><span class="annot"><a href="PVGrammar.Parse.html#pvDerivUnrestricted"><span class="hs-identifier hs-type">pvDerivUnrestricted</span></a></span><span>
</span><span id="line-795"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471565"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471566"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span>
</span><span id="line-797"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471565"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471566"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Derivations"><span class="hs-identifier hs-type">Derivations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-identifier hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471567"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-803"></span><span id="pvDerivUnrestricted"><span class="annot"><span class="annottext">pvDerivUnrestricted :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (Derivations (PVLeftmost n))
</span><a href="PVGrammar.Parse.html#pvDerivUnrestricted"><span class="hs-identifier hs-var hs-var">pvDerivUnrestricted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PVLeftmost n -&gt; Derivations (PVLeftmost n))
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (PVLeftmost n)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (Derivations (PVLeftmost n))
forall v w tr tr' slc slc' h.
(v -&gt; w) -&gt; Eval tr tr' slc slc' h v -&gt; Eval tr tr' slc slc' h w
</span><a href="Common.html#mapEvalScore"><span class="hs-identifier hs-var">mapEvalScore</span></a></span><span> </span><span class="annot"><span class="annottext">PVLeftmost n -&gt; Derivations (PVLeftmost n)
forall a. a -&gt; Derivations a
</span><a href="Common.html#Do"><span class="hs-identifier hs-var">Do</span></a></span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier hs-var">protoVoiceEvaluator</span></a></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span class="annot"><span class="hs-comment">{- | An evaluator for protovoices that produces values in the 'Derivations' semiring.

 - Enforces right-branching spreads (see 'rightBranchSpread').
-}</span></span><span>
</span><span id="line-809"></span><span id="local-6989586621679471580"><span id="local-6989586621679471581"><span id="local-6989586621679471582"><span class="annot"><a href="PVGrammar.Parse.html#pvDerivRightBranch"><span class="hs-identifier hs-type">pvDerivRightBranch</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471580"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471581"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span>
</span><span id="line-812"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Merged"><span class="hs-identifier hs-type">Merged</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#RightBranchSpread"><span class="hs-identifier hs-type">RightBranchSpread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471580"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471581"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Derivations"><span class="hs-identifier hs-type">Derivations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#PVLeftmost"><span class="hs-identifier hs-type">PVLeftmost</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471582"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-818"></span><span id="pvDerivRightBranch"><span class="annot"><span class="annottext">pvDerivRightBranch :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Merged, (RightBranchSpread, Edges n))
  (t (Edge n))
  ((), ((), Notes n))
  (t2 (Note n))
  ((), ((), Spread n))
  (Derivations (PVLeftmost n))
</span><a href="PVGrammar.Parse.html#pvDerivRightBranch"><span class="hs-identifier hs-var hs-var">pvDerivRightBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-819"></span><span>  </span><span class="annot"><span class="annottext">Eval
  (RightBranchSpread, Edges n)
  (t (Edge n))
  ((), Notes n)
  (t2 (Note n))
  ((), Spread n)
  (Derivations (PVLeftmost n))
-&gt; Eval
     (Merged, (RightBranchSpread, Edges n))
     (t (Edge n))
     ((), ((), Notes n))
     (t2 (Note n))
     ((), ((), Spread n))
     (Derivations (PVLeftmost n))
forall tr tr' slc slc' h w.
Eval tr tr' slc slc' h w
-&gt; Eval (Merged, tr) tr' ((), slc) slc' ((), h) w
</span><a href="Common.html#splitFirst"><span class="hs-identifier hs-var">splitFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Eval
   (RightBranchSpread, Edges n)
   (t (Edge n))
   ((), Notes n)
   (t2 (Note n))
   ((), Spread n)
   (Derivations (PVLeftmost n))
 -&gt; Eval
      (Merged, (RightBranchSpread, Edges n))
      (t (Edge n))
      ((), ((), Notes n))
      (t2 (Note n))
      ((), ((), Spread n))
      (Derivations (PVLeftmost n)))
-&gt; Eval
     (RightBranchSpread, Edges n)
     (t (Edge n))
     ((), Notes n)
     (t2 (Note n))
     ((), Spread n)
     (Derivations (PVLeftmost n))
-&gt; Eval
     (Merged, (RightBranchSpread, Edges n))
     (t (Edge n))
     ((), ((), Notes n))
     (t2 (Note n))
     ((), ((), Spread n))
     (Derivations (PVLeftmost n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (Derivations (PVLeftmost n))
-&gt; Eval
     (RightBranchSpread, Edges n)
     (t (Edge n))
     ((), Notes n)
     (t2 (Note n))
     ((), Spread n)
     (Derivations (PVLeftmost n))
forall tr tr' slc slc' h w.
Eval tr tr' slc slc' h w
-&gt; Eval (RightBranchSpread, tr) tr' ((), slc) slc' ((), h) w
</span><a href="Common.html#rightBranchSpread"><span class="hs-identifier hs-var">rightBranchSpread</span></a></span><span> </span><span class="annot"><span class="annottext">(Eval
   (Edges n)
   (t (Edge n))
   (Notes n)
   (t2 (Note n))
   (Spread n)
   (Derivations (PVLeftmost n))
 -&gt; Eval
      (RightBranchSpread, Edges n)
      (t (Edge n))
      ((), Notes n)
      (t2 (Note n))
      ((), Spread n)
      (Derivations (PVLeftmost n)))
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (Derivations (PVLeftmost n))
-&gt; Eval
     (RightBranchSpread, Edges n)
     (t (Edge n))
     ((), Notes n)
     (t2 (Note n))
     ((), Spread n)
     (Derivations (PVLeftmost n))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PVLeftmost n -&gt; Derivations (PVLeftmost n))
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (PVLeftmost n)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (Derivations (PVLeftmost n))
forall v w tr tr' slc slc' h.
(v -&gt; w) -&gt; Eval tr tr' slc slc' h v -&gt; Eval tr tr' slc slc' h w
</span><a href="Common.html#mapEvalScore"><span class="hs-identifier hs-var">mapEvalScore</span></a></span><span> </span><span class="annot"><span class="annottext">PVLeftmost n -&gt; Derivations (PVLeftmost n)
forall a. a -&gt; Derivations a
</span><a href="Common.html#Do"><span class="hs-identifier hs-var">Do</span></a></span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluatorNoRepSplit"><span class="hs-identifier hs-var">protoVoiceEvaluatorNoRepSplit</span></a></span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="annot"><span class="hs-comment">-- | An evaluator for protovoices that produces values in the counting semiring.</span></span><span>
</span><span id="line-822"></span><span id="local-6989586621679471600"><span id="local-6989586621679471601"><span id="local-6989586621679471602"><span class="annot"><a href="PVGrammar.Parse.html#pvCountUnrestricted"><span class="hs-identifier hs-type">pvCountUnrestricted</span></a></span><span>
</span><span id="line-823"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471600"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471601"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471600"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471601"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471602"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-825"></span><span id="pvCountUnrestricted"><span class="annot"><span class="annottext">pvCountUnrestricted :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
</span><a href="PVGrammar.Parse.html#pvCountUnrestricted"><span class="hs-identifier hs-var hs-var">pvCountUnrestricted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PVLeftmost n -&gt; Int)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (PVLeftmost n)
-&gt; Eval
     (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
forall v w tr tr' slc slc' h.
(v -&gt; w) -&gt; Eval tr tr' slc slc' h v -&gt; Eval tr tr' slc slc' h w
</span><a href="Common.html#mapEvalScore"><span class="hs-identifier hs-var">mapEvalScore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PVLeftmost n -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluator"><span class="hs-identifier hs-var">protoVoiceEvaluator</span></a></span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="annot"><span class="hs-comment">{- | An evaluator for protovoices that produces values in the counting semiring.

 - Prohibits split operations in which one of the parent slices is repeated entirely (see 'protoVoiceEvaluatorNoRepSplit').
-}</span></span><span>
</span><span id="line-831"></span><span id="local-6989586621679473047"><span id="local-6989586621679473048"><span id="local-6989586621679473049"><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplit"><span class="hs-identifier hs-type">pvCountNoRepSplit</span></a></span><span>
</span><span id="line-832"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679473047"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679473048"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679473047"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679473048"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679473049"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-834"></span><span id="pvCountNoRepSplit"><span class="annot"><span class="annottext">pvCountNoRepSplit :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
</span><a href="PVGrammar.Parse.html#pvCountNoRepSplit"><span class="hs-identifier hs-var hs-var">pvCountNoRepSplit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PVLeftmost n -&gt; Int)
-&gt; Eval
     (Edges n)
     (t (Edge n))
     (Notes n)
     (t2 (Note n))
     (Spread n)
     (PVLeftmost n)
-&gt; Eval
     (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
forall v w tr tr' slc slc' h.
(v -&gt; w) -&gt; Eval tr tr' slc slc' h v -&gt; Eval tr tr' slc slc' h w
</span><a href="Common.html#mapEvalScore"><span class="hs-identifier hs-var">mapEvalScore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; PVLeftmost n -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Edges n)
  (t (Edge n))
  (Notes n)
  (t2 (Note n))
  (Spread n)
  (PVLeftmost n)
</span><a href="PVGrammar.Parse.html#protoVoiceEvaluatorNoRepSplit"><span class="hs-identifier hs-var">protoVoiceEvaluatorNoRepSplit</span></a></span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="annot"><span class="hs-comment">{- | An evaluator for protovoices that produces values in the counting semiring.

 - Prohibits split operations in which one of the parent slices is repeated entirely (see 'protoVoiceEvaluatorNoRepSplit').
 - Enforces right-branching spreads (see 'rightBranchSpread').
-}</span></span><span>
</span><span id="line-841"></span><span id="local-6989586621679471611"><span id="local-6989586621679471612"><span id="local-6989586621679471613"><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranch"><span class="hs-identifier hs-type">pvCountNoRepSplitRightBranch</span></a></span><span>
</span><span id="line-842"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471611"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471612"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#RightBranchSpread"><span class="hs-identifier hs-type">RightBranchSpread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471611"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471612"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471613"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-844"></span><span id="pvCountNoRepSplitRightBranch"><span class="annot"><span class="annottext">pvCountNoRepSplitRightBranch :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (RightBranchSpread, Edges n)
  (t (Edge n))
  ((), Notes n)
  (t2 (Note n))
  ((), Spread n)
  Int
</span><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranch"><span class="hs-identifier hs-var hs-var">pvCountNoRepSplitRightBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eval (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
-&gt; Eval
     (RightBranchSpread, Edges n)
     (t (Edge n))
     ((), Notes n)
     (t2 (Note n))
     ((), Spread n)
     Int
forall tr tr' slc slc' h w.
Eval tr tr' slc slc' h w
-&gt; Eval (RightBranchSpread, tr) tr' ((), slc) slc' ((), h) w
</span><a href="Common.html#rightBranchSpread"><span class="hs-identifier hs-var">rightBranchSpread</span></a></span><span> </span><span class="annot"><span class="annottext">Eval (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval (Edges n) (t (Edge n)) (Notes n) (t2 (Note n)) (Spread n) Int
</span><a href="PVGrammar.Parse.html#pvCountNoRepSplit"><span class="hs-identifier hs-var">pvCountNoRepSplit</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span class="annot"><span class="hs-comment">{- | An evaluator for protovoices that produces values in the counting semiring.

 - Prohibits split operations in which one of the parent slices is repeated entirely (see 'protoVoiceEvaluatorNoRepSplit').
 - Enforces right-branching spreads (see 'rightBranchSpread').
 - Normalizes the order of adjacent split and spread operations to split-before-spread (see 'splitFirst').
-}</span></span><span>
</span><span id="line-852"></span><span id="local-6989586621679471617"><span id="local-6989586621679471618"><span id="local-6989586621679471619"><span class="annot"><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranchSplitFirst"><span class="hs-identifier hs-type">pvCountNoRepSplitRightBranchSplitFirst</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471617"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471618"><span class="hs-identifier hs-type">t2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.Parse.html#IsPitch"><span class="hs-identifier hs-type">IsPitch</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Notation</span></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span>
</span><span id="line-855"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Merged"><span class="hs-identifier hs-type">Merged</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#RightBranchSpread"><span class="hs-identifier hs-type">RightBranchSpread</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Edges"><span class="hs-identifier hs-type">Edges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471617"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Edge"><span class="hs-identifier hs-type">Edge</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Notes"><span class="hs-identifier hs-type">Notes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679471618"><span class="hs-identifier hs-type">t2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PVGrammar.html#Note"><span class="hs-identifier hs-type">Note</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PVGrammar.html#Spread"><span class="hs-identifier hs-type">Spread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679471619"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span></span><span>
</span><span id="line-861"></span><span id="pvCountNoRepSplitRightBranchSplitFirst"><span class="annot"><span class="annottext">pvCountNoRepSplitRightBranchSplitFirst :: forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (Merged, (RightBranchSpread, Edges n))
  (t (Edge n))
  ((), ((), Notes n))
  (t2 (Note n))
  ((), ((), Spread n))
  Int
</span><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranchSplitFirst"><span class="hs-identifier hs-var hs-var">pvCountNoRepSplitRightBranchSplitFirst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eval
  (RightBranchSpread, Edges n)
  (t (Edge n))
  ((), Notes n)
  (t2 (Note n))
  ((), Spread n)
  Int
-&gt; Eval
     (Merged, (RightBranchSpread, Edges n))
     (t (Edge n))
     ((), ((), Notes n))
     (t2 (Note n))
     ((), ((), Spread n))
     Int
forall tr tr' slc slc' h w.
Eval tr tr' slc slc' h w
-&gt; Eval (Merged, tr) tr' ((), slc) slc' ((), h) w
</span><a href="Common.html#splitFirst"><span class="hs-identifier hs-var">splitFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Eval
  (RightBranchSpread, Edges n)
  (t (Edge n))
  ((), Notes n)
  (t2 (Note n))
  ((), Spread n)
  Int
forall (t :: * -&gt; *) (t2 :: * -&gt; *) n.
(Foldable t, Foldable t2, Eq n, Ord n, IsPitch n, Notation n,
 Hashable n) =&gt;
Eval
  (RightBranchSpread, Edges n)
  (t (Edge n))
  ((), Notes n)
  (t2 (Note n))
  ((), Spread n)
  Int
</span><a href="PVGrammar.Parse.html#pvCountNoRepSplitRightBranch"><span class="hs-identifier hs-var">pvCountNoRepSplitRightBranch</span></a></span><span>
</span><span id="line-862"></span></pre></body></html>