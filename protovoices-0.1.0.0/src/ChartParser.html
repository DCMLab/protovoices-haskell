<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{- | A chart-based semiring parser for path grammars (e.g. the PV grammar).
Path grammars operate on &quot;paths&quot;
consisting of nodes (slices) and edges (transitions),
both of which can contain arbitrary content.
Paths are elaborated through two operations,
@split@ting transitions and @spread@ing slices
(plus @freeze@, which terminates generation on a transition).

The parser is polymorphic in the grammar
as well as the contents of slices (path nodes) and transitions (path edges).
The grammar to parse is definend in an &quot;evaluator&quot; ('Common.Eval')
which provides completions for parsing the splits, spreads and freezes.
-}</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="ChartParser.html"><span class="hs-identifier">ChartParser</span></a></span><span>
</span><span id="line-18"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Parsing Interface</span></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="ChartParser.html#parse"><span class="hs-identifier">parse</span></a></span><span>
</span><span id="line-20"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#parseSize"><span class="hs-identifier">parseSize</span></a></span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#parseSilent"><span class="hs-identifier">parseSilent</span></a></span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#logSize"><span class="hs-identifier">logSize</span></a></span><span>
</span><span id="line-23"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#logTikz"><span class="hs-identifier">logTikz</span></a></span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Charts</span></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Basic Elements</span></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier">Slice</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier">Transition</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#transLen"><span class="hs-identifier">transLen</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier">Item</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier">TItem</span></a></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Transition Chart</span></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier">TContents</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier">TChart</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier">tcGetByLength</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Verticalization Chart</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier">Vert</span></a></span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier">VChart</span></a></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier">vcGetByLength</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Constraint Aliases</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier">Parsable</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier">Normal</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier">Normal'</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Common.html"><span class="hs-identifier">Common</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Scoring.FunTyped.html"><span class="hs-identifier">Scoring.FunTyped</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HM</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IM</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semiring</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ST</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Parallel.Strategies</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Hashable</span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hash</span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hashWithSalt</span></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Kind</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Constraint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maybeToList</span></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-comment">-- Basic Types</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- ===========</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- | An alias for common constraints on slices and transitions</span></span><span>
</span><span id="line-82"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">type</span><span> </span><span id="Normal"><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span></span><span> </span><span id="local-6989586621679481652"><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481652"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span class="annot"><span class="hs-comment">-- | An alias for common constraints on semiring values</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-type">Normal'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span id="Normal%27"><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-var">Normal'</span></a></span></span><span> </span><span id="local-6989586621679481653"><span class="annot"><a href="#local-6989586621679481653"><span class="hs-identifier hs-type">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679481653"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481653"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481653"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679481653"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="annot"><span class="hs-comment">-- | A summary constraint for transitions, slices, and semiring values</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable%27"><span class="hs-identifier hs-type">Parsable'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">type</span><span> </span><span id="Parsable%27"><span class="annot"><a href="ChartParser.html#Parsable%27"><span class="hs-identifier hs-var">Parsable'</span></a></span></span><span> </span><span id="local-6989586621679481654"><span class="annot"><a href="#local-6989586621679481654"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481655"><span class="annot"><a href="#local-6989586621679481655"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481656"><span class="annot"><a href="#local-6989586621679481656"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481654"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481655"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-type">Normal'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481656"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><span class="hs-comment">-- | A summary constraint for transitions, slices, hori-operations, and semiring values</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">type</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Constraint</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">type</span><span> </span><span id="Parsable"><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-var">Parsable</span></a></span></span><span> </span><span id="local-6989586621679481657"><span class="annot"><a href="#local-6989586621679481657"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481658"><span class="annot"><a href="#local-6989586621679481658"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481659"><span class="annot"><a href="#local-6989586621679481659"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679481660"><span class="annot"><a href="#local-6989586621679481660"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481657"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481658"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal"><span class="hs-identifier hs-type">Normal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481659"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Normal%27"><span class="hs-identifier hs-type">Normal'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481660"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- Slices</span><span>
</span><span id="line-98"></span><span class="hs-comment">---------</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><span class="hs-comment">{- | A slice during chart parsing.
 Besides the slice content (e.g., notes),
 it maintains indices to the first and last surface slice covered,
 as well as an ID that is used for matching compatible parents of a spread.
-}</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">data</span><span> </span><span id="Slice"><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span></span><span> </span><span id="local-6989586621679480886"><span class="annot"><a href="#local-6989586621679480886"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Slice"><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="sFirst"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var hs-var">sFirst</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ index of the first surface slice covered</span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sContent"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var hs-var">sContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Common.html#StartStop"><span class="hs-identifier hs-type">StartStop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480886"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ slice content (or 'Start'/'Stop')</span></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sID"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var hs-var">sID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ unique slice ID</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="sLast"><span class="annot"><span class="annottext">forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var hs-var">sLast</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ index of the last surface slice covered</span></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481670"><span id="local-6989586621679481678"><span class="annot"><span class="annottext">Slice slc -&gt; Slice slc -&gt; Bool
(Slice slc -&gt; Slice slc -&gt; Bool)
-&gt; (Slice slc -&gt; Slice slc -&gt; Bool) -&gt; Eq (Slice slc)
forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
== :: Slice slc -&gt; Slice slc -&gt; Bool
$c/= :: forall slc. Eq slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
/= :: Slice slc -&gt; Slice slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481687"><span id="local-6989586621679481695"><span id="local-6989586621679481701"><span id="local-6989586621679481705"><span id="local-6989586621679481708"><span id="local-6989586621679481711"><span id="local-6989586621679481714"><span class="annot"><span class="annottext">Eq (Slice slc)
Eq (Slice slc) =&gt;
(Slice slc -&gt; Slice slc -&gt; Ordering)
-&gt; (Slice slc -&gt; Slice slc -&gt; Bool)
-&gt; (Slice slc -&gt; Slice slc -&gt; Bool)
-&gt; (Slice slc -&gt; Slice slc -&gt; Bool)
-&gt; (Slice slc -&gt; Slice slc -&gt; Bool)
-&gt; (Slice slc -&gt; Slice slc -&gt; Slice slc)
-&gt; (Slice slc -&gt; Slice slc -&gt; Slice slc)
-&gt; Ord (Slice slc)
Slice slc -&gt; Slice slc -&gt; Bool
Slice slc -&gt; Slice slc -&gt; Ordering
Slice slc -&gt; Slice slc -&gt; Slice slc
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall slc. Ord slc =&gt; Eq (Slice slc)
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Ordering
forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
$ccompare :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Ordering
compare :: Slice slc -&gt; Slice slc -&gt; Ordering
$c&lt; :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&lt; :: Slice slc -&gt; Slice slc -&gt; Bool
$c&lt;= :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&lt;= :: Slice slc -&gt; Slice slc -&gt; Bool
$c&gt; :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&gt; :: Slice slc -&gt; Slice slc -&gt; Bool
$c&gt;= :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Bool
&gt;= :: Slice slc -&gt; Slice slc -&gt; Bool
$cmax :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
max :: Slice slc -&gt; Slice slc -&gt; Slice slc
$cmin :: forall slc. Ord slc =&gt; Slice slc -&gt; Slice slc -&gt; Slice slc
min :: Slice slc -&gt; Slice slc -&gt; Slice slc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481723"><span id="local-6989586621679481725"><span class="annot"><span class="annottext">(forall x. Slice slc -&gt; Rep (Slice slc) x)
-&gt; (forall x. Rep (Slice slc) x -&gt; Slice slc)
-&gt; Generic (Slice slc)
forall x. Rep (Slice slc) x -&gt; Slice slc
forall x. Slice slc -&gt; Rep (Slice slc) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall slc x. Rep (Slice slc) x -&gt; Slice slc
forall slc x. Slice slc -&gt; Rep (Slice slc) x
$cfrom :: forall slc x. Slice slc -&gt; Rep (Slice slc) x
from :: forall x. Slice slc -&gt; Rep (Slice slc) x
$cto :: forall slc x. Rep (Slice slc) x -&gt; Slice slc
to :: forall x. Rep (Slice slc) x -&gt; Slice slc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481732"><span class="annot"><span class="annottext">Slice slc -&gt; ()
(Slice slc -&gt; ()) -&gt; NFData (Slice slc)
forall slc. NFData slc =&gt; Slice slc -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall slc. NFData slc =&gt; Slice slc -&gt; ()
rnf :: Slice slc -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679480927"><span id="local-6989586621679481761"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679480927"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480927"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>  </span><span id="local-6989586621679481767"><span class="annot"><span class="annottext">hashWithSalt :: Int -&gt; Slice slc -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var">hashWithSalt</span></span></span><span> </span><span id="local-6989586621679481768"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481768"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481769"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481769"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hashWithSalt</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481768"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481769"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679480931"><span id="local-6989586621679481772"><span id="local-6989586621679481777"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679480931"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480931"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679481793"><span class="annot"><span class="annottext">show :: Slice slc -&gt; String
</span><a href="#local-6989586621679481793"><span class="hs-identifier hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679481795"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481795"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679481796"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679481796"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679481797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481797"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679481798"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481798"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481795"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679481796"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481797"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679481798"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- Transitions</span><span>
</span><span id="line-125"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="annot"><span class="hs-comment">{- | A transition during chart parsing.
 Has pointers to the two slices it connects,
 a content (e.g., protovoice connections),
 and a flag indicating whether it is the second (right) parent of a spread.
-}</span></span><span>
</span><span id="line-132"></span><span class="hs-keyword">data</span><span> </span><span id="Transition"><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span></span><span> </span><span id="local-6989586621679480935"><span class="annot"><a href="#local-6989586621679480935"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679480936"><span class="annot"><a href="#local-6989586621679480936"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Transition"><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span></span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tLeftSlice"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var hs-var">tLeftSlice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480936"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tContent"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; tr
</span><a href="ChartParser.html#tContent"><span class="hs-identifier hs-var hs-var">tContent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679480935"><span class="hs-identifier hs-type">tr</span></a></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tRightSlice"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var hs-var">tRightSlice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480936"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="t2nd"><span class="annot"><span class="annottext">forall tr slc. Transition tr slc -&gt; Bool
</span><a href="ChartParser.html#t2nd"><span class="hs-identifier hs-var hs-var">t2nd</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481807"><span id="local-6989586621679481814"><span class="annot"><span class="annottext">Transition tr slc -&gt; Transition tr slc -&gt; Bool
(Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; Eq (Transition tr slc)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c== :: forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
== :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c/= :: forall tr slc.
(Eq slc, Eq tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
/= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481824"><span id="local-6989586621679481831"><span id="local-6989586621679481837"><span id="local-6989586621679481841"><span id="local-6989586621679481844"><span id="local-6989586621679481847"><span id="local-6989586621679481850"><span class="annot"><span class="annottext">Eq (Transition tr slc)
Eq (Transition tr slc) =&gt;
(Transition tr slc -&gt; Transition tr slc -&gt; Ordering)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Bool)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc)
-&gt; (Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc)
-&gt; Ord (Transition tr slc)
Transition tr slc -&gt; Transition tr slc -&gt; Bool
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall tr slc. (Ord slc, Ord tr) =&gt; Eq (Transition tr slc)
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
$ccompare :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Ordering
compare :: Transition tr slc -&gt; Transition tr slc -&gt; Ordering
$c&lt; :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&lt; :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&lt;= :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&lt;= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&gt; :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&gt; :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$c&gt;= :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Bool
&gt;= :: Transition tr slc -&gt; Transition tr slc -&gt; Bool
$cmax :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
max :: Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
$cmin :: forall tr slc.
(Ord slc, Ord tr) =&gt;
Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
min :: Transition tr slc -&gt; Transition tr slc -&gt; Transition tr slc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481853"><span id="local-6989586621679481855"><span class="annot"><span class="annottext">(forall x. Transition tr slc -&gt; Rep (Transition tr slc) x)
-&gt; (forall x. Rep (Transition tr slc) x -&gt; Transition tr slc)
-&gt; Generic (Transition tr slc)
forall x. Rep (Transition tr slc) x -&gt; Transition tr slc
forall x. Transition tr slc -&gt; Rep (Transition tr slc) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc x. Rep (Transition tr slc) x -&gt; Transition tr slc
forall tr slc x. Transition tr slc -&gt; Rep (Transition tr slc) x
$cfrom :: forall tr slc x. Transition tr slc -&gt; Rep (Transition tr slc) x
from :: forall x. Transition tr slc -&gt; Rep (Transition tr slc) x
$cto :: forall tr slc x. Rep (Transition tr slc) x -&gt; Transition tr slc
to :: forall x. Rep (Transition tr slc) x -&gt; Transition tr slc
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481860"><span class="annot"><span class="annottext">Transition tr slc -&gt; ()
(Transition tr slc -&gt; ()) -&gt; NFData (Transition tr slc)
forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc. (NFData slc, NFData tr) =&gt; Transition tr slc -&gt; ()
$crnf :: forall tr slc. (NFData slc, NFData tr) =&gt; Transition tr slc -&gt; ()
rnf :: Transition tr slc -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481886"><span id="local-6989586621679481893"><span class="annot"><span class="annottext">Eq (Transition tr slc)
Eq (Transition tr slc) =&gt;
(Int -&gt; Transition tr slc -&gt; Int)
-&gt; (Transition tr slc -&gt; Int) -&gt; Hashable (Transition tr slc)
Int -&gt; Transition tr slc -&gt; Int
Transition tr slc -&gt; Int
forall a. Eq a =&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
forall tr slc. (Eq slc, Hashable tr) =&gt; Eq (Transition tr slc)
forall tr slc.
(Eq slc, Hashable tr) =&gt;
Int -&gt; Transition tr slc -&gt; Int
forall tr slc. (Eq slc, Hashable tr) =&gt; Transition tr slc -&gt; Int
$chashWithSalt :: forall tr slc.
(Eq slc, Hashable tr) =&gt;
Int -&gt; Transition tr slc -&gt; Int
hashWithSalt :: Int -&gt; Transition tr slc -&gt; Int
$chash :: forall tr slc. (Eq slc, Hashable tr) =&gt; Transition tr slc -&gt; Int
hash :: Transition tr slc -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679480980"><span id="local-6989586621679480981"><span id="local-6989586621679481916"><span id="local-6989586621679481921"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679480980"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679480981"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480981"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480980"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>  </span><span id="local-6989586621679481933"><span class="annot"><span class="annottext">show :: Transition e a -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679481934"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481934"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679481935"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679481935"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679481936"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481936"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679481937"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679481937"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481934"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-145"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">e -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621679481935"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481936"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&gt;&quot;</span></span><span>
</span><span id="line-149"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679481937"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;2&quot;</span></span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-comment">-- | Returns the &quot;length&quot; of the transition in terms of surface slices covered.</span></span><span>
</span><span id="line-154"></span><span id="local-6989586621679480982"><span id="local-6989586621679480983"><span class="annot"><a href="ChartParser.html#transLen"><span class="hs-identifier hs-type">transLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480982"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480983"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-155"></span><span id="transLen"><span class="annot"><span class="annottext">transLen :: forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var hs-var">transLen</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679481942"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481942"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">e
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679481943"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481943"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice a -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481943"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Slice a -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679481942"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- Items</span><span>
</span><span id="line-158"></span><span class="hs-comment">--------</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><span class="hs-comment">{- | A parsing item.
 Combines an intermediate value (e.g. a transition) with a semiring score.
-}</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">data</span><span> </span><span id="Item"><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-var">Item</span></a></span></span><span> </span><span id="local-6989586621679480987"><span class="annot"><a href="#local-6989586621679480987"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679480988"><span class="annot"><a href="#local-6989586621679480988"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="%3A%3D"><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">(:=)</span></a></span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="iItem"><span class="annot"><span class="annottext">forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var hs-var">iItem</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679480987"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="iScore"><span class="annot"><span class="annottext">forall i v. Item i v -&gt; Score v Int
</span><a href="ChartParser.html#iScore"><span class="hs-identifier hs-var hs-var">iScore</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#Score"><span class="hs-identifier hs-type">S.Score</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679480988"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481949"><span id="local-6989586621679481951"><span class="annot"><span class="annottext">(forall x. Item i v -&gt; Rep (Item i v) x)
-&gt; (forall x. Rep (Item i v) x -&gt; Item i v) -&gt; Generic (Item i v)
forall x. Rep (Item i v) x -&gt; Item i v
forall x. Item i v -&gt; Rep (Item i v) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall i v x. Rep (Item i v) x -&gt; Item i v
forall i v x. Item i v -&gt; Rep (Item i v) x
$cfrom :: forall i v x. Item i v -&gt; Rep (Item i v) x
from :: forall x. Item i v -&gt; Rep (Item i v) x
$cto :: forall i v x. Rep (Item i v) x -&gt; Item i v
to :: forall x. Rep (Item i v) x -&gt; Item i v
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679481956"><span class="annot"><span class="annottext">Item i v -&gt; ()
(Item i v -&gt; ()) -&gt; NFData (Item i v)
forall a. (a -&gt; ()) -&gt; NFData a
forall i v. (NFData i, NFData v) =&gt; Item i v -&gt; ()
$crnf :: forall i v. (NFData i, NFData v) =&gt; Item i v -&gt; ()
rnf :: Item i v -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481007"><span id="local-6989586621679481008"><span id="local-6989586621679481974"><span id="local-6989586621679481979"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481007"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481008"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481007"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481008"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621679481987"><span class="annot"><span class="annottext">show :: Item i v -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679481988"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679481988"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679481989"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679481989"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679481988"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; := &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Score v Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679481989"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="annot"><span class="hs-comment">-- | A transition item.</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">type</span><span> </span><span id="TItem"><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-var">TItem</span></a></span></span><span> </span><span id="local-6989586621679481990"><span class="annot"><a href="#local-6989586621679481990"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481991"><span class="annot"><a href="#local-6989586621679481991"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481992"><span class="annot"><a href="#local-6989586621679481992"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="ChartParser.html#Item"><span class="hs-identifier hs-type">Item</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481990"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481991"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679481992"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">-- Vert Items</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="annot"><span class="hs-comment">{- | Represents the middle part of an incomplete unspread (&quot;verticalization&quot;).
 Expresses how the middle transition and the two child slices (@vMiddle@)
 are derived from the parent slice (@vTop@) using a spread operation (@vOp@).

 'Vert' objects are stored in the 'VChart'
 to record the intermediate steps of an unspread,
 which is found by first parsing the middle transition into the parent slice
 (generating a 'Vert')
 and then combining the 'Vert' with the left and right child transitions
 to generate the left and right parent transitions, respectively.
-}</span></span><span>
</span><span id="line-188"></span><span class="hs-keyword">data</span><span> </span><span id="Vert"><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span></span><span> </span><span id="local-6989586621679481011"><span class="annot"><a href="#local-6989586621679481011"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481012"><span class="annot"><a href="#local-6989586621679481012"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481013"><span class="annot"><a href="#local-6989586621679481013"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679481014"><span class="annot"><a href="#local-6989586621679481014"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Vert"><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span></span><span>
</span><span id="line-189"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vTop"><span class="annot"><span class="annottext">forall tr slc h v. Vert tr slc h v -&gt; Slice slc
</span><a href="ChartParser.html#vTop"><span class="hs-identifier hs-var hs-var">vTop</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481012"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vOp"><span class="annot"><span class="annottext">forall tr slc h v. Vert tr slc h v -&gt; h
</span><a href="ChartParser.html#vOp"><span class="hs-identifier hs-var hs-var">vOp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679481013"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vVal"><span class="annot"><span class="annottext">forall tr slc h v. Vert tr slc h v -&gt; v
</span><a href="ChartParser.html#vVal"><span class="hs-identifier hs-var hs-var">vVal</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="#local-6989586621679481014"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vMiddle"><span class="annot"><span class="annottext">forall tr slc h v. Vert tr slc h v -&gt; TItem tr slc v
</span><a href="ChartParser.html#vMiddle"><span class="hs-identifier hs-var hs-var">vMiddle</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481011"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481012"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481014"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482000"><span id="local-6989586621679482002"><span class="annot"><span class="annottext">(forall x. Vert tr slc h v -&gt; Rep (Vert tr slc h v) x)
-&gt; (forall x. Rep (Vert tr slc h v) x -&gt; Vert tr slc h v)
-&gt; Generic (Vert tr slc h v)
forall x. Rep (Vert tr slc h v) x -&gt; Vert tr slc h v
forall x. Vert tr slc h v -&gt; Rep (Vert tr slc h v) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc h v x. Rep (Vert tr slc h v) x -&gt; Vert tr slc h v
forall tr slc h v x. Vert tr slc h v -&gt; Rep (Vert tr slc h v) x
$cfrom :: forall tr slc h v x. Vert tr slc h v -&gt; Rep (Vert tr slc h v) x
from :: forall x. Vert tr slc h v -&gt; Rep (Vert tr slc h v) x
$cto :: forall tr slc h v x. Rep (Vert tr slc h v) x -&gt; Vert tr slc h v
to :: forall x. Rep (Vert tr slc h v) x -&gt; Vert tr slc h v
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482009"><span class="annot"><span class="annottext">Vert tr slc h v -&gt; ()
(Vert tr slc h v -&gt; ()) -&gt; NFData (Vert tr slc h v)
forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc h v.
(NFData slc, NFData h, NFData v, NFData tr) =&gt;
Vert tr slc h v -&gt; ()
$crnf :: forall tr slc h v.
(NFData slc, NFData h, NFData v, NFData tr) =&gt;
Vert tr slc h v -&gt; ()
rnf :: Vert tr slc h v -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481053"><span id="local-6989586621679481054"><span id="local-6989586621679481055"><span id="local-6989586621679481056"><span id="local-6989586621679482035"><span id="local-6989586621679482040"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481053"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481054"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481055"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481053"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481054"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481055"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481056"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span id="local-6989586621679482055"><span class="annot"><span class="annottext">show :: Vert e a h v -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679482056"><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679482056"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621679482057"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482057"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679482058"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482058"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621679482059"><span class="annot"><span class="annottext">TItem e a v
</span><a href="#local-6989586621679482059"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Vert&quot;</span></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n top: &quot;</span></span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice a
</span><a href="#local-6989586621679482056"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n op:  &quot;</span></span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">h -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482057"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-203"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n val:  &quot;</span></span><span>
</span><span id="line-204"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482058"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-205"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n m:   &quot;</span></span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TItem e a v -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TItem e a v
</span><a href="#local-6989586621679482059"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- slice and transition charts</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- ===========================</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- vert chart</span><span>
</span><span id="line-212"></span><span class="hs-comment">-------------</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- ops:</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- - get all of len n</span><span>
</span><span id="line-216"></span><span class="hs-comment">-- - get all with left child = x</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- - get all with right child = x</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- - check ID for (top,left,leftid)</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><span class="hs-comment">{- | A verticalization chart.
 Stores 'Vert' objects at certain chart positions.
 To support efficient lookup of 'Vert' objects from different indices,
 each 'Vert' is redundantly stored in several hash maps,
 one for each index:

 - by surface length
 - by surface length (only left border of a 'Vert')
 - by left child slice ID and mid transition length
 - by right child ID

 In addition, the 'VChart' maintains IDs of new slices.
 (Every new slice is the parent of an unspread.)
-}</span></span><span>
</span><span id="line-234"></span><span class="hs-keyword">data</span><span> </span><span id="VChart"><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span></span><span> </span><span id="local-6989586621679481057"><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481058"><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481059"><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679481060"><span class="annot"><a href="#local-6989586621679481060"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VChart"><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="vcNextId"><span class="annot"><span class="annottext">forall tr slc h v. VChart tr slc h v -&gt; Int
</span><a href="ChartParser.html#vcNextId"><span class="hs-identifier hs-var hs-var">vcNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ next free ID</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcIDs"><span class="annot"><span class="annottext">forall tr slc h v. VChart tr slc h v -&gt; HashMap (Int, Int) Int
</span><a href="ChartParser.html#vcIDs"><span class="hs-identifier hs-var hs-var">vcIDs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a mapping from child slice ids to the corresponding parent id</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLength"><span class="annot"><span class="annottext">forall tr slc h v. VChart tr slc h v -&gt; IntMap [Vert tr slc h v]
</span><a href="ChartParser.html#vcByLength"><span class="hs-identifier hs-var hs-var">vcByLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481060"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ maps surface length to the 'Vert' with that length</span></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLengthLeft"><span class="annot"><span class="annottext">forall tr slc h v.
VChart tr slc h v -&gt; IntMap (Set (Slice slc, Slice slc, h))
</span><a href="ChartParser.html#vcByLengthLeft"><span class="hs-identifier hs-var hs-var">vcByLengthLeft</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-comment">-- ^ maps surface length to the &quot;left borders&quot; of 'Vert' objects with that length</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-comment">-- (parent slice, left child slice)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByLeftChild"><span class="annot"><span class="annottext">forall tr slc h v.
VChart tr slc h v -&gt; HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="ChartParser.html#vcByLeftChild"><span class="hs-identifier hs-var hs-var">vcByLeftChild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">-- ^ maps a left child slice ID and the surface length of the middle transition</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-comment">-- to its potential parent slices</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="vcByRightChild"><span class="annot"><span class="annottext">forall tr slc h v.
VChart tr slc h v -&gt; HashMap (Int, Int) [Vert tr slc h v]
</span><a href="ChartParser.html#vcByRightChild"><span class="hs-identifier hs-var hs-var">vcByRightChild</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481057"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481058"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481059"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481060"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-comment">-- ^ maps a right child slice ID and the surface length of the middle transition</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-comment">-- to all 'Vert' objects it is part of.</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482067"><span id="local-6989586621679482069"><span class="annot"><span class="annottext">(forall x. VChart tr slc h v -&gt; Rep (VChart tr slc h v) x)
-&gt; (forall x. Rep (VChart tr slc h v) x -&gt; VChart tr slc h v)
-&gt; Generic (VChart tr slc h v)
forall x. Rep (VChart tr slc h v) x -&gt; VChart tr slc h v
forall x. VChart tr slc h v -&gt; Rep (VChart tr slc h v) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc h v x. Rep (VChart tr slc h v) x -&gt; VChart tr slc h v
forall tr slc h v x. VChart tr slc h v -&gt; Rep (VChart tr slc h v) x
$cfrom :: forall tr slc h v x. VChart tr slc h v -&gt; Rep (VChart tr slc h v) x
from :: forall x. VChart tr slc h v -&gt; Rep (VChart tr slc h v) x
$cto :: forall tr slc h v x. Rep (VChart tr slc h v) x -&gt; VChart tr slc h v
to :: forall x. Rep (VChart tr slc h v) x -&gt; VChart tr slc h v
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482076"><span class="annot"><span class="annottext">VChart tr slc h v -&gt; ()
(VChart tr slc h v -&gt; ()) -&gt; NFData (VChart tr slc h v)
forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc h v.
(NFData slc, NFData h, NFData v, NFData tr) =&gt;
VChart tr slc h v -&gt; ()
$crnf :: forall tr slc h v.
(NFData slc, NFData h, NFData v, NFData tr) =&gt;
VChart tr slc h v -&gt; ()
rnf :: VChart tr slc h v -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679481119"><span id="local-6989586621679481120"><span id="local-6989586621679481121"><span id="local-6989586621679481122"><span id="local-6989586621679482126"><span id="local-6989586621679482131"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481119"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481120"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481121"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481122"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481119"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481120"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481121"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481122"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>  </span><span id="local-6989586621679482137"><span class="annot"><span class="annottext">show :: VChart tr slc h v -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span id="local-6989586621679482138"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482138"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679482139"><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482139"><span class="hs-identifier hs-var">is</span></a></span></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc, h))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc, h))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc h v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VChart (next id: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482138"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679482140"><span class="hs-identifier hs-var">levels</span></a></span><span>
</span><span id="line-255"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679482140"><span class="annot"><span class="annottext">levels :: String
</span><a href="#local-6989586621679482140"><span class="hs-identifier hs-var hs-var">levels</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, [Vert tr slc h v]) -&gt; String)
-&gt; [(Int, [Vert tr slc h v])] -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(Int, [Vert tr slc h v]) -&gt; String
forall {t :: * -&gt; *} {a} {a}.
(Foldable t, Show a, Show a) =&gt;
(a, t a) -&gt; String
</span><a href="#local-6989586621679482151"><span class="hs-identifier hs-var">showLevel</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, [Vert tr slc h v])] -&gt; String)
-&gt; [(Int, [Vert tr slc h v])] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc h v] -&gt; [(Int, [Vert tr slc h v])]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">IM.toAscList</span></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482139"><span class="hs-identifier hs-var">is</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621679482151"><span class="annot"><span class="annottext">showLevel :: (a, t a) -&gt; String
</span><a href="#local-6989586621679482151"><span class="hs-identifier hs-var hs-var">showLevel</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482160"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679482160"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482161"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679482161"><span class="hs-identifier hs-var">items</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nlevel &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679482160"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679482162"><span class="hs-identifier hs-var">sitems</span></a></span><span>
</span><span id="line-258"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>      </span><span id="local-6989586621679482162"><span class="annot"><span class="annottext">sitems :: String
</span><a href="#local-6989586621679482162"><span class="hs-identifier hs-var hs-var">sitems</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; String) -&gt; t a -&gt; String
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShowS -&gt; (a -&gt; String) -&gt; a -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621679482161"><span class="hs-identifier hs-var">items</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="annot"><span class="hs-comment">-- | Returns an empty 'VChart' with the next free ID set to @n + 1@.</span></span><span>
</span><span id="line-262"></span><span id="local-6989586621679481137"><span id="local-6989586621679481138"><span id="local-6989586621679481139"><span id="local-6989586621679481140"><span class="annot"><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-type">vcEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481137"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481138"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481139"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481140"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-263"></span><span id="vcEmpty"><span class="annot"><span class="annottext">vcEmpty :: forall tr slc h v. Int -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-var hs-var">vcEmpty</span></a></span></span><span> </span><span id="local-6989586621679482170"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482170"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc h v]
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; HashMap (Int, Int) [Vert tr slc h v]
-&gt; VChart tr slc h v
forall tr slc h v.
Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc h v]
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; HashMap (Int, Int) [Vert tr slc h v]
-&gt; VChart tr slc h v
</span><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482170"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc, h))
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc, h))
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc h v]
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><span class="hs-comment">-- | Insert a new 'Vert' object into a 'VChart'.</span></span><span>
</span><span id="line-266"></span><span id="local-6989586621679481148"><span id="local-6989586621679481149"><span id="local-6989586621679481150"><span id="local-6989586621679481151"><span class="annot"><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-type">vcInsert</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481149"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481150"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481149"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481151"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the old chart</span></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481149"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481151"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481150"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481151"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the new 'Vert' item's parent slice, operation, value, and middle child transition.</span></span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481150"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481148"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481149"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481151"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the new chart</span></span><span>
</span><span id="line-274"></span><span id="vcInsert"><span class="annot"><span class="annottext">vcInsert :: forall slc h tr v.
(Hashable slc, Ord slc, Ord h) =&gt;
VChart tr slc h v
-&gt; (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-var hs-var">vcInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span id="local-6989586621679482179"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482179"><span class="hs-identifier hs-var">nextid</span></a></span></span><span> </span><span id="local-6989586621679482180"><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482180"><span class="hs-identifier hs-var">ids</span></a></span></span><span> </span><span id="local-6989586621679482181"><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482181"><span class="hs-identifier hs-var">bylen</span></a></span></span><span> </span><span id="local-6989586621679482182"><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc, h))
</span><a href="#local-6989586621679482182"><span class="hs-identifier hs-var">bylenleft</span></a></span></span><span> </span><span id="local-6989586621679482183"><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="#local-6989586621679482183"><span class="hs-identifier hs-var">byleft</span></a></span></span><span> </span><span id="local-6989586621679482184"><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc h v]
</span><a href="#local-6989586621679482184"><span class="hs-identifier hs-var">byright</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482185"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679482185"><span class="hs-identifier hs-var">topContent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482186"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482186"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482187"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482187"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482188"><span class="annot"><span class="annottext">mid :: TItem tr slc v
</span><a href="#local-6989586621679482188"><span class="hs-identifier hs-var">mid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679482189"><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679482190"><span class="annot"><span class="annottext">left :: Slice slc
</span><a href="#local-6989586621679482190"><span class="hs-identifier hs-var hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span>
</span><span id="line-276"></span><span>      </span><span id="local-6989586621679482191"><span class="annot"><span class="annottext">right :: Slice slc
</span><a href="#local-6989586621679482191"><span class="hs-identifier hs-var hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span>
</span><span id="line-277"></span><span>      </span><span id="local-6989586621679482192"><span class="annot"><span class="annottext">idKey :: (Int, Int)
</span><a href="#local-6989586621679482192"><span class="hs-identifier hs-var hs-var">idKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482190"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482191"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679482205"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482205"><span class="hs-identifier hs-var">nextid'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482206"><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482206"><span class="hs-identifier hs-var">ids'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482207"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482207"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; HashMap (Int, Int) Int -&gt; Maybe Int
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679482192"><span class="hs-identifier hs-var">idKey</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482180"><span class="hs-identifier hs-var">ids</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679482209"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482209"><span class="hs-identifier hs-var">i'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482179"><span class="hs-identifier hs-var">nextid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482180"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482209"><span class="hs-identifier hs-var">i'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">Maybe Int
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482179"><span class="hs-identifier hs-var">nextid</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; Int -&gt; HashMap (Int, Int) Int -&gt; HashMap (Int, Int) Int
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insert</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621679482192"><span class="hs-identifier hs-var">idKey</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482179"><span class="hs-identifier hs-var">nextid</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482180"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482179"><span class="hs-identifier hs-var">nextid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>      </span><span id="local-6989586621679482211"><span class="annot"><span class="annottext">top :: Slice slc
</span><a href="#local-6989586621679482211"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
forall slc. Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
</span><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482190"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">slc -&gt; StartStop slc
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679482185"><span class="hs-identifier hs-var">topContent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482207"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482191"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span>      </span><span id="local-6989586621679482213"><span class="annot"><span class="annottext">vert :: [Vert tr slc h v]
</span><a href="#local-6989586621679482213"><span class="hs-identifier hs-var hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Slice slc -&gt; h -&gt; v -&gt; TItem tr slc v -&gt; Vert tr slc h v
forall tr slc h v.
Slice slc -&gt; h -&gt; v -&gt; TItem tr slc v -&gt; Vert tr slc h v
</span><a href="ChartParser.html#Vert"><span class="hs-identifier hs-var">Vert</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482211"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482186"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482187"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482188"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>      </span><span id="local-6989586621679482214"><span class="annot"><span class="annottext">vert' :: Set (Slice slc, Slice slc, h)
</span><a href="#local-6989586621679482214"><span class="hs-identifier hs-var hs-var">vert'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Slice slc, Slice slc, h) -&gt; Set (Slice slc, Slice slc, h)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482211"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482186"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>      </span><span id="local-6989586621679482216"><span class="annot"><span class="annottext">vertl :: Set (Slice slc, h)
</span><a href="#local-6989586621679482216"><span class="hs-identifier hs-var hs-var">vertl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Slice slc, h) -&gt; Set (Slice slc, h)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482211"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482186"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>      </span><span id="local-6989586621679482218"><span class="annot"><span class="annottext">bylen' :: IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482218"><span class="hs-identifier hs-var hs-var">bylen'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Vert tr slc h v] -&gt; [Vert tr slc h v] -&gt; [Vert tr slc h v])
-&gt; Int
-&gt; [Vert tr slc h v]
-&gt; IntMap [Vert tr slc h v]
-&gt; IntMap [Vert tr slc h v]
forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">[Vert tr slc h v] -&gt; [Vert tr slc h v] -&gt; [Vert tr slc h v]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vert tr slc h v]
</span><a href="#local-6989586621679482213"><span class="hs-identifier hs-var">vert</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482181"><span class="hs-identifier hs-var">bylen</span></a></span><span>
</span><span id="line-286"></span><span>      </span><span id="local-6989586621679482230"><span class="annot"><span class="annottext">bylenleft' :: IntMap (Set (Slice slc, Slice slc, h))
</span><a href="#local-6989586621679482230"><span class="hs-identifier hs-var hs-var">bylenleft'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set (Slice slc, Slice slc, h)
 -&gt; Set (Slice slc, Slice slc, h) -&gt; Set (Slice slc, Slice slc, h))
-&gt; Int
-&gt; Set (Slice slc, Slice slc, h)
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; IntMap (Set (Slice slc, Slice slc, h))
forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, Slice slc, h)
-&gt; Set (Slice slc, Slice slc, h) -&gt; Set (Slice slc, Slice slc, h)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, Slice slc, h)
</span><a href="#local-6989586621679482214"><span class="hs-identifier hs-var">vert'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc, h))
</span><a href="#local-6989586621679482182"><span class="hs-identifier hs-var">bylenleft</span></a></span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621679482245"><span class="annot"><span class="annottext">byleft' :: HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="#local-6989586621679482245"><span class="hs-identifier hs-var hs-var">byleft'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set (Slice slc, h) -&gt; Set (Slice slc, h) -&gt; Set (Slice slc, h))
-&gt; (Int, Int)
-&gt; Set (Slice slc, h)
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, h) -&gt; Set (Slice slc, h) -&gt; Set (Slice slc, h)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482190"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, h)
</span><a href="#local-6989586621679482216"><span class="hs-identifier hs-var">vertl</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="#local-6989586621679482183"><span class="hs-identifier hs-var">byleft</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span id="local-6989586621679482254"><span class="annot"><span class="annottext">byright' :: HashMap (Int, Int) [Vert tr slc h v]
</span><a href="#local-6989586621679482254"><span class="hs-identifier hs-var hs-var">byright'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Vert tr slc h v] -&gt; [Vert tr slc h v] -&gt; [Vert tr slc h v])
-&gt; (Int, Int)
-&gt; [Vert tr slc h v]
-&gt; HashMap (Int, Int) [Vert tr slc h v]
-&gt; HashMap (Int, Int) [Vert tr slc h v]
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">[Vert tr slc h v] -&gt; [Vert tr slc h v] -&gt; [Vert tr slc h v]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482191"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482189"><span class="hs-identifier hs-var">tmid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Vert tr slc h v]
</span><a href="#local-6989586621679482213"><span class="hs-identifier hs-var">vert</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc h v]
</span><a href="#local-6989586621679482184"><span class="hs-identifier hs-var">byright</span></a></span><span>
</span><span id="line-289"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc h v]
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; HashMap (Int, Int) [Vert tr slc h v]
-&gt; VChart tr slc h v
forall tr slc h v.
Int
-&gt; HashMap (Int, Int) Int
-&gt; IntMap [Vert tr slc h v]
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; HashMap (Int, Int) [Vert tr slc h v]
-&gt; VChart tr slc h v
</span><a href="ChartParser.html#VChart"><span class="hs-identifier hs-var">VChart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482205"><span class="hs-identifier hs-var">nextid'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) Int
</span><a href="#local-6989586621679482206"><span class="hs-identifier hs-var">ids'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap [Vert tr slc h v]
</span><a href="#local-6989586621679482218"><span class="hs-identifier hs-var">bylen'</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (Set (Slice slc, Slice slc, h))
</span><a href="#local-6989586621679482230"><span class="hs-identifier hs-var">bylenleft'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="#local-6989586621679482245"><span class="hs-identifier hs-var">byleft'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Int, Int) [Vert tr slc h v]
</span><a href="#local-6989586621679482254"><span class="hs-identifier hs-var">byright'</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="annot"><span class="hs-comment">-- | Merge a sequence of new items into a 'VChart'</span></span><span>
</span><span id="line-292"></span><span id="local-6989586621679481175"><span id="local-6989586621679481176"><span id="local-6989586621679481177"><span id="local-6989586621679481178"><span id="local-6989586621679481179"><span class="annot"><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-type">vcMerge</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481175"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481178"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481179"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481175"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481179"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481178"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481179"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481178"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481176"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481177"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481179"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-297"></span><span id="vcMerge"><span class="annot"><span class="annottext">vcMerge :: forall (t :: * -&gt; *) slc h tr v.
(Foldable t, Ord slc, Hashable slc, Ord h) =&gt;
VChart tr slc h v
-&gt; t (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-var hs-var">vcMerge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VChart tr slc h v
 -&gt; (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v)
-&gt; VChart tr slc h v
-&gt; t (slc, h, v, TItem tr slc v)
-&gt; VChart tr slc h v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
-&gt; (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v
forall slc h tr v.
(Hashable slc, Ord slc, Ord h) =&gt;
VChart tr slc h v
-&gt; (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcInsert"><span class="hs-identifier hs-var">vcInsert</span></a></span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><span class="hs-comment">-- | Returns all 'Vert' objects in the 'VChart' with the same length.</span></span><span>
</span><span id="line-300"></span><span id="local-6989586621679481188"><span id="local-6989586621679481189"><span id="local-6989586621679481190"><span id="local-6989586621679481191"><span class="annot"><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-type">vcGetByLength</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481188"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481189"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481191"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the chart</span></span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-304"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ surface length of a middle transition</span></span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481188"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481189"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481190"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481191"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ all corresponding 'Vert' objects</span></span><span>
</span><span id="line-307"></span><span id="vcGetByLength"><span class="annot"><span class="annottext">vcGetByLength :: forall tr slc h v. VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var hs-var">vcGetByLength</span></a></span></span><span> </span><span id="local-6989586621679482264"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482264"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679482265"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482265"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Vert tr slc h v] -&gt; Maybe [Vert tr slc h v] -&gt; [Vert tr slc h v]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(Maybe [Vert tr slc h v] -&gt; [Vert tr slc h v])
-&gt; Maybe [Vert tr slc h v] -&gt; [Vert tr slc h v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IntMap [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v]
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482265"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">(IntMap [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v])
-&gt; IntMap [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; IntMap [Vert tr slc h v]
forall tr slc h v. VChart tr slc h v -&gt; IntMap [Vert tr slc h v]
</span><a href="ChartParser.html#vcByLength"><span class="hs-identifier hs-var">vcByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482264"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><span class="hs-comment">-- | Returns the &quot;left borders&quot; of all 'Vert' objects in the 'VChart' with the same length.</span></span><span>
</span><span id="line-310"></span><span id="local-6989586621679481199"><span id="local-6989586621679481200"><span id="local-6989586621679481201"><span id="local-6989586621679481202"><span class="annot"><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-type">vcGetByLengthLeft</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481199"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481200"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481201"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481202"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-312"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the chart</span></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-314"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the surface length of a middle transition</span></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481200"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481200"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481201"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ (parent slice, left slice, op) of all corresponding 'Vert' objects (without duplicates)</span></span><span>
</span><span id="line-317"></span><span id="vcGetByLengthLeft"><span class="annot"><span class="annottext">vcGetByLengthLeft :: forall tr slc h v.
VChart tr slc h v -&gt; Int -&gt; [(Slice slc, Slice slc, h)]
</span><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-var hs-var">vcGetByLengthLeft</span></a></span></span><span> </span><span id="local-6989586621679482268"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482268"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679482269"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482269"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><span class="annottext">[(Slice slc, Slice slc, h)]
-&gt; (Set (Slice slc, Slice slc, h) -&gt; [(Slice slc, Slice slc, h)])
-&gt; Maybe (Set (Slice slc, Slice slc, h))
-&gt; [(Slice slc, Slice slc, h)]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Set (Slice slc, Slice slc, h) -&gt; [(Slice slc, Slice slc, h)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set (Slice slc, Slice slc, h))
 -&gt; [(Slice slc, Slice slc, h)])
-&gt; Maybe (Set (Slice slc, Slice slc, h))
-&gt; [(Slice slc, Slice slc, h)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; IntMap (Set (Slice slc, Slice slc, h))
-&gt; Maybe (Set (Slice slc, Slice slc, h))
forall a. Int -&gt; IntMap a -&gt; Maybe a
</span><span class="hs-identifier hs-var">IM.lookup</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482269"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; IntMap (Set (Slice slc, Slice slc, h))
forall tr slc h v.
VChart tr slc h v -&gt; IntMap (Set (Slice slc, Slice slc, h))
</span><a href="ChartParser.html#vcByLengthLeft"><span class="hs-identifier hs-var">vcByLengthLeft</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482268"><span class="hs-identifier hs-var">chart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="annot"><span class="hs-comment">{- | Returns the all potential parents of a left child slice
 up to a certain middle transition length.
-}</span></span><span>
</span><span id="line-323"></span><span id="local-6989586621679481210"><span id="local-6989586621679481211"><span id="local-6989586621679481212"><span id="local-6989586621679481213"><span class="annot"><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-type">vcGetByLeftChild</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481210"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481210"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481211"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ maximum middle transition length</span></span><span>
</span><span id="line-327"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481212"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481210"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481211"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481213"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the chart</span></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481210"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-330"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the left child slice</span></span><span>
</span><span id="line-331"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481210"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481211"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ all potential parent slices</span></span><span>
</span><span id="line-333"></span><span id="vcGetByLeftChild"><span class="annot"><span class="annottext">vcGetByLeftChild :: forall slc h tr v.
(Ord slc, Hashable slc, Ord h) =&gt;
Int -&gt; VChart tr slc h v -&gt; Slice slc -&gt; [(Slice slc, h)]
</span><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-var hs-var">vcGetByLeftChild</span></a></span></span><span> </span><span id="local-6989586621679482282"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482282"><span class="hs-identifier hs-var">maxn</span></a></span></span><span> </span><span id="local-6989586621679482283"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482283"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679482284"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482284"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-334"></span><span>  </span><span class="annot"><span class="annottext">Set (Slice slc, h) -&gt; [(Slice slc, h)]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (Slice slc, h) -&gt; [(Slice slc, h)])
-&gt; Set (Slice slc, h) -&gt; [(Slice slc, h)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Set (Slice slc, h)] -&gt; Set (Slice slc, h)
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="annot"><span class="annottext">([Set (Slice slc, h)] -&gt; Set (Slice slc, h))
-&gt; [Set (Slice slc, h)] -&gt; Set (Slice slc, h)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe (Set (Slice slc, h)))
-&gt; [Int] -&gt; [Set (Slice slc, h)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe (Set (Slice slc, h))
</span><a href="#local-6989586621679482286"><span class="hs-identifier hs-var">getN</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482282"><span class="hs-identifier hs-var">maxn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-336"></span><span>  </span><span id="local-6989586621679482286"><span class="annot"><span class="annottext">getN :: Int -&gt; Maybe (Set (Slice slc, h))
</span><a href="#local-6989586621679482286"><span class="hs-identifier hs-var hs-var">getN</span></a></span></span><span> </span><span id="local-6989586621679482293"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482293"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; Maybe (Set (Slice slc, h))
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482284"><span class="hs-identifier hs-var">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482293"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashMap (Int, Int) (Set (Slice slc, h))
 -&gt; Maybe (Set (Slice slc, h)))
-&gt; HashMap (Int, Int) (Set (Slice slc, h))
-&gt; Maybe (Set (Slice slc, h))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; HashMap (Int, Int) (Set (Slice slc, h))
forall tr slc h v.
VChart tr slc h v -&gt; HashMap (Int, Int) (Set (Slice slc, h))
</span><a href="ChartParser.html#vcByLeftChild"><span class="hs-identifier hs-var">vcByLeftChild</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482283"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="annot"><span class="hs-comment">{- | Returns all 'Vert' objects with the same right child
 up to a certain middle transition length.
-}</span></span><span>
</span><span id="line-341"></span><span id="local-6989586621679481223"><span id="local-6989586621679481224"><span id="local-6989586621679481225"><span id="local-6989586621679481226"><span class="annot"><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-type">vcGetByRightChild</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481223"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481223"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-344"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ ID of the right child</span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481224"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481223"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481225"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481226"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481223"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481224"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481223"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481225"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481226"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-348"></span><span id="vcGetByRightChild"><span class="annot"><span class="annottext">vcGetByRightChild :: forall slc tr h v.
(Ord slc, Hashable slc) =&gt;
Int -&gt; VChart tr slc h v -&gt; Slice slc -&gt; [Vert tr slc h v]
</span><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-var hs-var">vcGetByRightChild</span></a></span></span><span> </span><span id="local-6989586621679482300"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482300"><span class="hs-identifier hs-var">maxn</span></a></span></span><span> </span><span id="local-6989586621679482301"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482301"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679482302"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482302"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-349"></span><span>  </span><span class="annot"><span class="annottext">[[Vert tr slc h v]] -&gt; [Vert tr slc h v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[Vert tr slc h v]] -&gt; [Vert tr slc h v])
-&gt; [[Vert tr slc h v]] -&gt; [Vert tr slc h v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Maybe [Vert tr slc h v]) -&gt; [Int] -&gt; [[Vert tr slc h v]]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Maybe [Vert tr slc h v]
</span><a href="#local-6989586621679482304"><span class="hs-identifier hs-var">getN</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482300"><span class="hs-identifier hs-var">maxn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-351"></span><span>  </span><span id="local-6989586621679482304"><span class="annot"><span class="annottext">getN :: Int -&gt; Maybe [Vert tr slc h v]
</span><a href="#local-6989586621679482304"><span class="hs-identifier hs-var hs-var">getN</span></a></span></span><span> </span><span id="local-6989586621679482311"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482311"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Int)
-&gt; HashMap (Int, Int) [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v]
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HM.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482302"><span class="hs-identifier hs-var">right</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482311"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashMap (Int, Int) [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v])
-&gt; HashMap (Int, Int) [Vert tr slc h v] -&gt; Maybe [Vert tr slc h v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; HashMap (Int, Int) [Vert tr slc h v]
forall tr slc h v.
VChart tr slc h v -&gt; HashMap (Int, Int) [Vert tr slc h v]
</span><a href="ChartParser.html#vcByRightChild"><span class="hs-identifier hs-var">vcByRightChild</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482301"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- transition chart</span><span>
</span><span id="line-354"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="hs-comment">-- ops:</span><span>
</span><span id="line-357"></span><span class="hs-comment">-- - get all of length n</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- - get all with left slice l</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- - get all with right slice r</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><span class="hs-comment">{- | The contents of a transition chart (under a particular index).
 A mapping from transitions (with score ID constraints left and right)
 to (partial) semiring scores.
 This mapping usually contains all transition items that satisfy a certain criterion,
 irrespective of their position in the chart (which is encoded in the transitions themselves).

 When new transition items are added, if the transition already exists in the chart
 (as the result of a different partial parse),
 the scores of the new and existing items are &quot;added&quot; (this also requires the score IDs to match).
-}</span></span><span>
</span><span id="line-371"></span><span class="hs-keyword">type</span><span> </span><span id="TContents"><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-var">TContents</span></a></span></span><span> </span><span id="local-6989586621679482312"><span class="annot"><a href="#local-6989586621679482312"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679482313"><span class="annot"><a href="#local-6989586621679482313"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679482314"><span class="annot"><a href="#local-6989586621679482314"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482312"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482313"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#LeftId"><span class="hs-identifier hs-type">S.LeftId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#RightId"><span class="hs-identifier hs-type">S.RightId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Scoring.FunTyped.html#Score"><span class="hs-identifier hs-type">S.Score</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482314"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="annot"><span class="hs-comment">{- | A transition chart.
 Stores intermediate transition items redundantly under several indices:

 - by surface length
 - by left slice
 - by right slice
-}</span></span><span>
</span><span id="line-383"></span><span class="hs-keyword">data</span><span> </span><span id="TChart"><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span></span><span> </span><span id="local-6989586621679481233"><span class="annot"><a href="#local-6989586621679481233"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481234"><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481235"><span class="annot"><a href="#local-6989586621679481235"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TChart"><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="tcByLength"><span class="annot"><span class="annottext">forall tr slc v. TChart tr slc v -&gt; IntMap (TContents tr slc v)
</span><a href="ChartParser.html#tcByLength"><span class="hs-identifier hs-var hs-var">tcByLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">IM.IntMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481233"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481235"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tcByLeft"><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByLeft"><span class="hs-identifier hs-var hs-var">tcByLeft</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481233"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481235"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="tcByRight"><span class="annot"><span class="annottext">forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByRight"><span class="hs-identifier hs-var hs-var">tcByRight</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HM.HashMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481233"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481234"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481235"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482322"><span id="local-6989586621679482332"><span id="local-6989586621679482336"><span class="annot"><span class="annottext">Int -&gt; TChart tr slc v -&gt; ShowS
[TChart tr slc v] -&gt; ShowS
TChart tr slc v -&gt; String
(Int -&gt; TChart tr slc v -&gt; ShowS)
-&gt; (TChart tr slc v -&gt; String)
-&gt; ([TChart tr slc v] -&gt; ShowS)
-&gt; Show (TChart tr slc v)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall tr slc v.
(Show slc, Show tr) =&gt;
Int -&gt; TChart tr slc v -&gt; ShowS
forall tr slc v. (Show slc, Show tr) =&gt; [TChart tr slc v] -&gt; ShowS
forall tr slc v. (Show slc, Show tr) =&gt; TChart tr slc v -&gt; String
$cshowsPrec :: forall tr slc v.
(Show slc, Show tr) =&gt;
Int -&gt; TChart tr slc v -&gt; ShowS
showsPrec :: Int -&gt; TChart tr slc v -&gt; ShowS
$cshow :: forall tr slc v. (Show slc, Show tr) =&gt; TChart tr slc v -&gt; String
show :: TChart tr slc v -&gt; String
$cshowList :: forall tr slc v. (Show slc, Show tr) =&gt; [TChart tr slc v] -&gt; ShowS
showList :: [TChart tr slc v] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482352"><span id="local-6989586621679482354"><span class="annot"><span class="annottext">(forall x. TChart tr slc v -&gt; Rep (TChart tr slc v) x)
-&gt; (forall x. Rep (TChart tr slc v) x -&gt; TChart tr slc v)
-&gt; Generic (TChart tr slc v)
forall x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
forall x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall tr slc v x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
forall tr slc v x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
$cfrom :: forall tr slc v x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
from :: forall x. TChart tr slc v -&gt; Rep (TChart tr slc v) x
$cto :: forall tr slc v x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
to :: forall x. Rep (TChart tr slc v) x -&gt; TChart tr slc v
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482360"><span class="annot"><span class="annottext">TChart tr slc v -&gt; ()
(TChart tr slc v -&gt; ()) -&gt; NFData (TChart tr slc v)
forall a. (a -&gt; ()) -&gt; NFData a
forall tr slc v.
(NFData slc, NFData tr, NFData v) =&gt;
TChart tr slc v -&gt; ()
$crnf :: forall tr slc v.
(NFData slc, NFData tr, NFData v) =&gt;
TChart tr slc v -&gt; ()
rnf :: TChart tr slc v -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="annot"><span class="hs-comment">-- | Returns an empty transition chart.</span></span><span>
</span><span id="line-391"></span><span id="local-6989586621679481279"><span id="local-6989586621679481280"><span id="local-6989586621679481281"><span class="annot"><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-type">tcEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481279"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481280"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481281"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-392"></span><span id="tcEmpty"><span class="annot"><span class="annottext">tcEmpty :: forall tr slc v. TChart tr slc v
</span><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-var hs-var">tcEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
forall tr slc v.
IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
</span><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-comment">-- TODO: there might be room for improvement here</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><span class="hs-comment">{- | Insert a new transition item into the transition chart.
 If the item's transition already exists, the existing and new score are &quot;added&quot;.
-}</span></span><span>
</span><span id="line-399"></span><span id="local-6989586621679481285"><span id="local-6989586621679481286"><span id="local-6989586621679481287"><span class="annot"><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-type">tcInsert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable%27"><span class="hs-identifier hs-type">Parsable'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481285"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481286"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481287"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481285"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481286"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481287"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481285"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481286"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481287"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481285"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481286"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481287"><span class="hs-identifier hs-type">v</span></a></span></span></span></span><span>
</span><span id="line-400"></span><span id="tcInsert"><span class="annot"><span class="annottext">tcInsert :: forall tr slc v.
Parsable' tr slc v =&gt;
TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-var hs-var">tcInsert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span id="local-6989586621679482399"><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679482399"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span id="local-6989586621679482400"><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482400"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span id="local-6989586621679482401"><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482401"><span class="hs-identifier hs-var">right</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482402"><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482402"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482403"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482403"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679482418"><span class="annot"><span class="annottext">new :: TContents tr slc v
</span><a href="#local-6989586621679482418"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int))
-&gt; Score v Int -&gt; TContents tr slc v
forall k v. Hashable k =&gt; k -&gt; v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Score v Int -&gt; Maybe (LeftId Int)
forall s i. Score s i -&gt; Maybe (LeftId i)
</span><a href="Scoring.FunTyped.html#leftSide"><span class="hs-identifier hs-var">S.leftSide</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482403"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Score v Int -&gt; Maybe (RightId Int)
forall s i. Score s i -&gt; Maybe (RightId i)
</span><a href="Scoring.FunTyped.html#rightSide"><span class="hs-identifier hs-var">S.rightSide</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482403"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482403"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-402"></span><span>      </span><span id="local-6989586621679482422"><span class="annot"><span class="annottext">len' :: IntMap (TContents tr slc v)
</span><a href="#local-6989586621679482422"><span class="hs-identifier hs-var hs-var">len'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v)
-&gt; Int
-&gt; TContents tr slc v
-&gt; IntMap (TContents tr slc v)
-&gt; IntMap (TContents tr slc v)
forall a. (a -&gt; a -&gt; a) -&gt; Int -&gt; a -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679482423"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679482418"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679482399"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621679482427"><span class="annot"><span class="annottext">left' :: HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482427"><span class="hs-identifier hs-var hs-var">left'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v)
-&gt; Slice slc
-&gt; TContents tr slc v
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679482423"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679482418"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482400"><span class="hs-identifier hs-var">left</span></a></span><span>
</span><span id="line-404"></span><span>      </span><span id="local-6989586621679482431"><span class="annot"><span class="annottext">right' :: HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482431"><span class="hs-identifier hs-var hs-var">right'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v)
-&gt; Slice slc
-&gt; TContents tr slc v
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v -&gt; v) -&gt; k -&gt; v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.insertWith</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679482423"><span class="hs-identifier hs-var">insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482402"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
</span><a href="#local-6989586621679482418"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482401"><span class="hs-identifier hs-var">right</span></a></span><span>
</span><span id="line-405"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
forall tr slc v.
IntMap (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TChart tr slc v
</span><a href="ChartParser.html#TChart"><span class="hs-identifier hs-var">TChart</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap (TContents tr slc v)
</span><a href="#local-6989586621679482422"><span class="hs-identifier hs-var">len'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482427"><span class="hs-identifier hs-var">left'</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap (Slice slc) (TContents tr slc v)
</span><a href="#local-6989586621679482431"><span class="hs-identifier hs-var">right'</span></a></span><span>
</span><span id="line-406"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-407"></span><span>  </span><span id="local-6989586621679482423"><span class="annot"><span class="annottext">insert :: TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
</span><a href="#local-6989586621679482423"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int))
 -&gt; Score v Int -&gt; Score v Int -&gt; Score v Int)
-&gt; TContents tr slc v -&gt; TContents tr slc v -&gt; TContents tr slc v
forall k v.
Eq k =&gt;
(k -&gt; v -&gt; v -&gt; v) -&gt; HashMap k v -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HM.unionWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">(Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int))
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679482446"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482446"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span id="local-6989586621679482447"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482447"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Score v Int -&gt; Score v Int -&gt; Score v Int
forall s i.
(Semiring s, Eq i) =&gt;
Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#addScores"><span class="hs-identifier hs-var">S.addScores</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482446"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482447"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>
</span><span id="line-409"></span><span class="annot"><span class="hs-comment">-- | Insert several transition items into the transition chart.</span></span><span>
</span><span id="line-410"></span><span id="local-6989586621679481321"><span id="local-6989586621679481322"><span id="local-6989586621679481323"><span id="local-6989586621679481324"><span class="annot"><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-type">tcMerge</span></a></span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481321"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable%27"><span class="hs-identifier hs-type">Parsable'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481322"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481323"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481324"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481322"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481323"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481324"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481321"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481322"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481323"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481324"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481322"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481323"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481324"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span><span>
</span><span id="line-415"></span><span id="tcMerge"><span class="annot"><span class="annottext">tcMerge :: forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var hs-var">tcMerge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v
forall tr slc v.
Parsable' tr slc v =&gt;
TChart tr slc v -&gt; TItem tr slc v -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcInsert"><span class="hs-identifier hs-var">tcInsert</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="annot"><span class="hs-comment">-- | Helper function for getting transition items from the transition chart.</span></span><span>
</span><span id="line-418"></span><span id="local-6989586621679481329"><span id="local-6989586621679481330"><span id="local-6989586621679481331"><span id="local-6989586621679481332"><span id="local-6989586621679481333"><span class="annot"><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-type">tcGetAny</span></a></span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481329"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481330"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481332"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481329"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481330"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481333"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481332"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TContents"><span class="hs-identifier hs-type">TContents</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481329"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481330"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481329"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481330"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481333"><span class="hs-identifier hs-type">k</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481329"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481330"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481331"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span></span><span>
</span><span id="line-424"></span><span id="tcGetAny"><span class="annot"><span class="annottext">tcGetAny :: forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var hs-var">tcGetAny</span></a></span></span><span> </span><span id="local-6989586621679482457"><span class="annot"><span class="annottext">TChart tr slc v -&gt; m
</span><a href="#local-6989586621679482457"><span class="hs-identifier hs-var">field</span></a></span></span><span> </span><span id="local-6989586621679482458"><span class="annot"><span class="annottext">TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v
</span><a href="#local-6989586621679482458"><span class="hs-identifier hs-var">getter</span></a></span></span><span> </span><span id="local-6989586621679482459"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482459"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span id="local-6989586621679482460"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679482460"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>  </span><span class="annot"><span class="annottext">(((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
  Score v Int)
 -&gt; TItem tr slc v)
-&gt; [((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
     Score v Int)]
-&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
 Score v Int)
-&gt; TItem tr slc v
forall {i} {b} {c} {v}. ((i, b, c), Score v Int) -&gt; Item i v
</span><a href="#local-6989586621679482461"><span class="hs-identifier hs-var">mkItem</span></a></span><span> </span><span class="annot"><span class="annottext">([((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
   Score v Int)]
 -&gt; [TItem tr slc v])
-&gt; [((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
     Score v Int)]
-&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
-&gt; [((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
     Score v Int)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HM.toList</span></span><span> </span><span class="annot"><span class="annottext">(TContents tr slc v
 -&gt; [((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
      Score v Int)])
-&gt; TContents tr slc v
-&gt; [((Transition tr slc, Maybe (LeftId Int), Maybe (RightId Int)),
     Score v Int)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v
</span><a href="#local-6989586621679482458"><span class="hs-identifier hs-var">getter</span></a></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HM.empty</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679482460"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">(m -&gt; TContents tr slc v) -&gt; m -&gt; TContents tr slc v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; m
</span><a href="#local-6989586621679482457"><span class="hs-identifier hs-var">field</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482459"><span class="hs-identifier hs-var">chart</span></a></span><span>
</span><span id="line-426"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-427"></span><span>  </span><span id="local-6989586621679482461"><span class="annot"><span class="annottext">mkItem :: ((i, b, c), Score v Int) -&gt; Item i v
</span><a href="#local-6989586621679482461"><span class="hs-identifier hs-var hs-var">mkItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679482463"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679482463"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482464"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482464"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679482463"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">i -&gt; Score v Int -&gt; Item i v
forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482464"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><span class="hs-comment">-- | Returns all transition items with the same length.</span></span><span>
</span><span id="line-430"></span><span id="local-6989586621679481348"><span id="local-6989586621679481349"><span id="local-6989586621679481350"><span class="annot"><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-type">tcGetByLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481348"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481349"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481350"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481348"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481349"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481350"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-431"></span><span id="tcGetByLength"><span class="annot"><span class="annottext">tcGetByLength :: forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var hs-var">tcGetByLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; IntMap (TContents tr slc v))
-&gt; (TContents tr slc v
    -&gt; Int -&gt; IntMap (TContents tr slc v) -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; Int
-&gt; [TItem tr slc v]
forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; IntMap (TContents tr slc v)
forall tr slc v. TChart tr slc v -&gt; IntMap (TContents tr slc v)
</span><a href="ChartParser.html#tcByLength"><span class="hs-identifier hs-var">tcByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
-&gt; Int -&gt; IntMap (TContents tr slc v) -&gt; TContents tr slc v
forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><span class="hs-comment">-- | Returns all transition items with the same left slice.</span></span><span>
</span><span id="line-434"></span><span id="local-6989586621679481355"><span id="local-6989586621679481356"><span id="local-6989586621679481357"><span class="annot"><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-type">tcGetByLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679481355"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679481355"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481356"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481355"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481357"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481355"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481356"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481355"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481357"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-435"></span><span id="tcGetByLeft"><span class="annot"><span class="annottext">tcGetByLeft :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-var hs-var">tcGetByLeft</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v))
-&gt; (TContents tr slc v
    -&gt; Slice slc
    -&gt; HashMap (Slice slc) (TContents tr slc v)
    -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; Slice slc
-&gt; [TItem tr slc v]
forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByLeft"><span class="hs-identifier hs-var">tcByLeft</span></a></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
-&gt; Slice slc
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TContents tr slc v
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.findWithDefault</span></span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="annot"><span class="hs-comment">-- | Returns all transition items with the same right slice.</span></span><span>
</span><span id="line-438"></span><span id="local-6989586621679482473"><span id="local-6989586621679482474"><span id="local-6989586621679482475"><span class="annot"><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-type">tcGetByRight</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679482473"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hashable</span></span><span> </span><span class="annot"><a href="#local-6989586621679482473"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482474"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482475"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482474"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482475"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-439"></span><span id="tcGetByRight"><span class="annot"><span class="annottext">tcGetByRight :: forall slc tr v.
(Ord slc, Hashable slc) =&gt;
TChart tr slc v -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-var hs-var">tcGetByRight</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v))
-&gt; (TContents tr slc v
    -&gt; Slice slc
    -&gt; HashMap (Slice slc) (TContents tr slc v)
    -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; Slice slc
-&gt; [TItem tr slc v]
forall tr slc v m k.
(TChart tr slc v -&gt; m)
-&gt; (TContents tr slc v -&gt; k -&gt; m -&gt; TContents tr slc v)
-&gt; TChart tr slc v
-&gt; k
-&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetAny"><span class="hs-identifier hs-var">tcGetAny</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
forall tr slc v.
TChart tr slc v -&gt; HashMap (Slice slc) (TContents tr slc v)
</span><a href="ChartParser.html#tcByRight"><span class="hs-identifier hs-var">tcByRight</span></a></span><span> </span><span class="annot"><span class="annottext">TContents tr slc v
-&gt; Slice slc
-&gt; HashMap (Slice slc) (TContents tr slc v)
-&gt; TContents tr slc v
forall k v. (Eq k, Hashable k) =&gt; v -&gt; k -&gt; HashMap k v -&gt; v
</span><span class="hs-identifier hs-var">HM.findWithDefault</span></span><span>
</span><span id="line-440"></span><span>
</span><span id="line-441"></span><span class="hs-comment">-- parsing machinery</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- =================</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-comment">-- applying evaluators</span><span>
</span><span id="line-445"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- TODO: add checks that adjacent transitions and slices match?</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><span class="hs-comment">-- | Unspreads the two slices of a (middle) transition, if possible.</span></span><span>
</span><span id="line-449"></span><span id="local-6989586621679481366"><span id="local-6989586621679481367"><span id="local-6989586621679481368"><span id="local-6989586621679481369"><span class="annot"><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-type">unspreadMiddle</span></a></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Common.html#UnspreadMiddle"><span class="hs-identifier hs-type">UnspreadMiddle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481366"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481367"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481368"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481369"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-451"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the UnspreadMiddle evaluator</span></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481366"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481367"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481369"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the middle transition</span></span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679481367"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481368"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679481369"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481366"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481367"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481369"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-comment">-- ^ the top slice, unspread operation,</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-comment">-- and middle transition</span><span>
</span><span id="line-457"></span><span id="unspreadMiddle"><span class="annot"><span class="annottext">unspreadMiddle :: forall tr slc h v.
UnspreadMiddle tr slc h v
-&gt; TItem tr slc v -&gt; [(slc, h, v, TItem tr slc v)]
</span><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-var hs-var">unspreadMiddle</span></a></span></span><span> </span><span id="local-6989586621679482489"><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
</span><a href="#local-6989586621679482489"><span class="hs-identifier hs-var">unspreadm</span></a></span></span><span> </span><span id="local-6989586621679482490"><span class="annot"><span class="annottext">im :: TItem tr slc v
</span><a href="#local-6989586621679482490"><span class="hs-identifier hs-var">im</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679482491"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482491"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679482492"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482492"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679482493"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482493"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-458"></span><span>  </span><span id="local-6989586621679482494"><span class="annot"><a href="#local-6989586621679482494"><span class="hs-identifier hs-var">il</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe slc -&gt; [slc]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe slc -&gt; [slc]) -&gt; Maybe slc -&gt; [slc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe slc
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">(StartStop slc -&gt; Maybe slc) -&gt; StartStop slc -&gt; Maybe slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482491"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621679482496"><span class="annot"><a href="#local-6989586621679482496"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Common.html#getInner"><span class="hs-identifier hs-type">getInner</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482493"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679482497"><span class="annot"><a href="#local-6989586621679482497"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482498"><span class="annot"><a href="#local-6989586621679482498"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482499"><span class="annot"><a href="#local-6989586621679482499"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679482489"><span class="hs-identifier hs-type">unspreadm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482494"><span class="hs-identifier hs-type">il</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482492"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482496"><span class="hs-identifier hs-type">ir</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482497"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482498"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482499"><span class="hs-identifier hs-type">val</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482490"><span class="hs-identifier hs-type">im</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="annot"><span class="hs-comment">-- | Infers the possible left parent transitions of an unspread.</span></span><span>
</span><span id="line-464"></span><span id="local-6989586621679481379"><span id="local-6989586621679481380"><span id="local-6989586621679481381"><span id="local-6989586621679481382"><span class="annot"><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-type">unspreadLeft</span></a></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481379"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481380"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679481381"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481381"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadLeft"><span class="hs-identifier hs-type">UnspreadLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481380"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481379"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481382"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the UnspreadLeft evaluator</span></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481380"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481379"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481381"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-469"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the left child transition</span></span><span>
</span><span id="line-470"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481379"><span class="hs-identifier hs-type">slc</span></a></span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the Vert's top slice and ID</span></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481382"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the Vert's operation</span></span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481380"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481379"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481381"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ all possible left parent transitions</span></span><span>
</span><span id="line-476"></span><span id="unspreadLeft"><span class="annot"><span class="annottext">unspreadLeft :: forall slc tr v h.
(Show slc, Show tr, Semiring v, Show v) =&gt;
UnspreadLeft tr slc h
-&gt; TItem tr slc v -&gt; Slice slc -&gt; h -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-var hs-var">unspreadLeft</span></a></span></span><span> </span><span id="local-6989586621679482511"><span class="annot"><span class="annottext">UnspreadLeft tr slc h
</span><a href="#local-6989586621679482511"><span class="hs-identifier hs-var">unspreadl</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482512"><span class="annot"><span class="annottext">tleft :: Transition tr slc
</span><a href="#local-6989586621679482512"><span class="hs-identifier hs-var">tleft</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679482513"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482513"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621679482514"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482514"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679482515"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482515"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621679482516"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679482516"><span class="hs-identifier hs-var">is2nd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482517"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482517"><span class="hs-identifier hs-var">vleft</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679482518"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482518"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621679482519"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482519"><span class="hs-identifier hs-var">op</span></a></span></span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679482516"><span class="hs-identifier hs-var">is2nd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Item (Transition tr slc) v]
-&gt; Maybe [Item (Transition tr slc) v]
-&gt; [Item (Transition tr slc) v]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[Item (Transition tr slc) v]
forall {a}. a
</span><a href="#local-6989586621679482520"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Item (Transition tr slc) v]
 -&gt; [Item (Transition tr slc) v])
-&gt; Maybe [Item (Transition tr slc) v]
-&gt; [Item (Transition tr slc) v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>      </span><span id="local-6989586621679482521"><span class="annot"><a href="#local-6989586621679482521"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe slc
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">(StartStop slc -&gt; Maybe slc) -&gt; StartStop slc -&gt; Maybe slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482515"><span class="hs-identifier hs-var">lr</span></a></span><span>
</span><span id="line-480"></span><span>      </span><span id="local-6989586621679482522"><span class="annot"><a href="#local-6989586621679482522"><span class="hs-identifier hs-var">itop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Common.html#getInner"><span class="hs-identifier hs-type">getInner</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482518"><span class="hs-identifier hs-type">top</span></a></span><span>
</span><span id="line-481"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679482523"><span class="hs-identifier hs-type">mkParent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482524"><span class="hs-identifier hs-type">v'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679482511"><span class="hs-identifier hs-type">unspreadl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482514"><span class="hs-identifier hs-type">lt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482521"><span class="hs-identifier hs-type">ir</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679482522"><span class="hs-identifier hs-type">itop</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482519"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-482"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-483"></span><span>  </span><span id="local-6989586621679482520"><span class="annot"><span class="annottext">err :: a
</span><a href="#local-6989586621679482520"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-484"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-485"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal left-unspread: left=&quot;</span></span><span>
</span><span id="line-486"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679482512"><span class="hs-identifier hs-var">tleft</span></a></span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, top=&quot;</span></span><span>
</span><span id="line-488"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482518"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-489"></span><span>  </span><span id="local-6989586621679482524"><span class="annot"><span class="annottext">v' :: Score v Int
</span><a href="#local-6989586621679482524"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Score v Int -&gt; Score v Int
forall s i.
(Eq i, Show i, Semiring s, Show s) =&gt;
i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unspreadScoresLeft"><span class="hs-identifier hs-var">S.unspreadScoresLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482518"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482517"><span class="hs-identifier hs-var">vleft</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span id="local-6989586621679482523"><span class="annot"><span class="annottext">mkParent :: Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679482523"><span class="hs-identifier hs-var hs-var">mkParent</span></a></span></span><span> </span><span id="local-6989586621679482541"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482541"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679482542"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482542"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482513"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482542"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482518"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Score v Int -&gt; Item (Transition tr slc) v
forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482541"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span class="annot"><span class="hs-comment">-- | Infers the possible right parent transitions of an unspread.</span></span><span>
</span><span id="line-493"></span><span id="local-6989586621679481399"><span id="local-6989586621679481400"><span id="local-6989586621679481401"><span id="local-6989586621679481402"><span class="annot"><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-type">unspreadRight</span></a></span><span>
</span><span id="line-494"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481402"><span class="hs-identifier hs-type">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadRight"><span class="hs-identifier hs-type">UnspreadRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481402"><span class="hs-identifier hs-type">h</span></a></span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the UnspreadRight evaluator</span></span><span>
</span><span id="line-497"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481402"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the center 'Vert'</span></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the right child transition</span></span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481401"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481400"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481399"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span></span><span>
</span><span id="line-502"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ all possible right parent transitions</span></span><span>
</span><span id="line-503"></span><span id="unspreadRight"><span class="annot"><span class="annottext">unspreadRight :: forall v slc tr h.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v, Show h) =&gt;
UnspreadRight tr slc h
-&gt; Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var hs-var">unspreadRight</span></a></span></span><span> </span><span id="local-6989586621679482558"><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482558"><span class="hs-identifier hs-var">unspreadr</span></a></span></span><span> </span><span id="local-6989586621679482559"><span class="annot"><span class="annottext">vert :: Vert tr slc h v
</span><a href="#local-6989586621679482559"><span class="hs-identifier hs-var">vert</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679482560"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482560"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span id="local-6989586621679482561"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482561"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679482562"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482562"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482563"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482563"><span class="hs-identifier hs-var">vm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679482564"><span class="annot"><span class="annottext">tright :: TItem tr slc v
</span><a href="#local-6989586621679482564"><span class="hs-identifier hs-var">tright</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679482565"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482565"><span class="hs-identifier hs-var">rl</span></a></span></span><span> </span><span id="local-6989586621679482566"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482566"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span id="local-6989586621679482567"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482567"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482568"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482568"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-504"></span><span>  </span><span class="annot"><span class="annottext">[TItem tr slc v] -&gt; Maybe [TItem tr slc v] -&gt; [TItem tr slc v]
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
forall {a}. a
</span><a href="#local-6989586621679482569"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [TItem tr slc v] -&gt; [TItem tr slc v])
-&gt; Maybe [TItem tr slc v] -&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-505"></span><span>    </span><span id="local-6989586621679482570"><span class="annot"><a href="#local-6989586621679482570"><span class="hs-identifier hs-var">ir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe slc
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">(StartStop slc -&gt; Maybe slc) -&gt; StartStop slc -&gt; Maybe slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482565"><span class="hs-identifier hs-var">rl</span></a></span><span>
</span><span id="line-506"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">force</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621679482572"><span class="hs-identifier hs-type">mkParent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482573"><span class="hs-identifier hs-type">v'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679482558"><span class="hs-identifier hs-type">unspreadr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482570"><span class="hs-identifier hs-type">ir</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482566"><span class="hs-identifier hs-type">rt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679482570"><span class="hs-identifier hs-type">ir</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482561"><span class="hs-identifier hs-type">op</span></a></span><span>
</span><span id="line-507"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-508"></span><span>  </span><span id="local-6989586621679482569"><span class="annot"><span class="annottext">err :: a
</span><a href="#local-6989586621679482569"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-510"></span><span>      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal right-unspread: vert=&quot;</span></span><span>
</span><span id="line-511"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Vert tr slc h v -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Vert tr slc h v
</span><a href="#local-6989586621679482559"><span class="hs-identifier hs-var">vert</span></a></span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, right=&quot;</span></span><span>
</span><span id="line-513"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482564"><span class="hs-identifier hs-var">tright</span></a></span><span>
</span><span id="line-514"></span><span>  </span><span id="local-6989586621679482573"><span class="annot"><span class="annottext">v' :: Score v Int
</span><a href="#local-6989586621679482573"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; v -&gt; Score v Int -&gt; Score v Int -&gt; Score v Int
forall i s.
(Eq i, Semiring s, Show i, Show s) =&gt;
i -&gt; s -&gt; Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unspreadScoresRight"><span class="hs-identifier hs-var">S.unspreadScoresRight</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482560"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482562"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482563"><span class="hs-identifier hs-var">vm</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482568"><span class="hs-identifier hs-var">vr</span></a></span><span>
</span><span id="line-515"></span><span>  </span><span id="local-6989586621679482572"><span class="annot"><span class="annottext">mkParent :: Score v Int -&gt; tr -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679482572"><span class="hs-identifier hs-var hs-var">mkParent</span></a></span></span><span> </span><span id="local-6989586621679482591"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482591"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679482592"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482592"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482560"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482592"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482567"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Score v Int -&gt; Item (Transition tr slc) v
forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482591"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span class="annot"><span class="hs-comment">-- | Infers the possible parent transitions of a split.</span></span><span>
</span><span id="line-518"></span><span id="local-6989586621679481414"><span id="local-6989586621679481415"><span id="local-6989586621679481416"><span class="annot"><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-type">unsplit</span></a></span><span>
</span><span id="line-519"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">R.Semiring</span></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481415"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481416"><span class="hs-identifier hs-type">tr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Unsplit"><span class="hs-identifier hs-type">Unsplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481416"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481415"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the Unsplit evaluator</span></span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481416"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481415"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-523"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the left child transition</span></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481416"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481415"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the right child transition</span></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#TItem"><span class="hs-identifier hs-type">TItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481416"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481415"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481414"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-527"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ all possible parent transitions</span></span><span>
</span><span id="line-528"></span><span id="unsplit"><span class="annot"><span class="annottext">unsplit :: forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var hs-var">unsplit</span></a></span></span><span> </span><span id="local-6989586621679482605"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482605"><span class="hs-identifier hs-var">mg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679482606"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482606"><span class="hs-identifier hs-var">ll</span></a></span></span><span> </span><span id="local-6989586621679482607"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482607"><span class="hs-identifier hs-var">lt</span></a></span></span><span> </span><span id="local-6989586621679482608"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482608"><span class="hs-identifier hs-var">lr</span></a></span></span><span> </span><span id="local-6989586621679482609"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679482609"><span class="hs-identifier hs-var">l2nd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482610"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482610"><span class="hs-identifier hs-var">vl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482611"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482611"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482612"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482612"><span class="hs-identifier hs-var">rr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-type">:=</span></a></span><span> </span><span id="local-6989586621679482613"><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482613"><span class="hs-identifier hs-var">vr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe slc
forall a. StartStop a -&gt; Maybe a
</span><a href="Common.html#getInner"><span class="hs-identifier hs-var">getInner</span></a></span><span> </span><span class="annot"><span class="annottext">(StartStop slc -&gt; Maybe slc) -&gt; StartStop slc -&gt; Maybe slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482608"><span class="hs-identifier hs-var">lr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-530"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679482614"><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679482614"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-531"></span><span>      </span><span class="annot"><span class="annottext">[TItem tr slc v] -&gt; [TItem tr slc v]
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">([TItem tr slc v] -&gt; [TItem tr slc v])
-&gt; [TItem tr slc v] -&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(tr, v) -&gt; TItem tr slc v
forall {tr}. (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679482615"><span class="hs-identifier hs-var">mkItem</span></a></span><span> </span><span class="annot"><span class="annottext">((tr, v) -&gt; TItem tr slc v) -&gt; [(tr, v)] -&gt; [TItem tr slc v]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482605"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482606"><span class="hs-identifier hs-var">ll</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482607"><span class="hs-identifier hs-var">lt</span></a></span><span> </span><span class="annot"><span class="annottext">slc
</span><a href="#local-6989586621679482614"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482611"><span class="hs-identifier hs-var">rt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482612"><span class="hs-identifier hs-var">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="#local-6989586621679482616"><span class="hs-identifier hs-var">splitType</span></a></span><span>
</span><span id="line-532"></span><span>    </span><span class="annot"><span class="annottext">Maybe slc
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [TItem tr slc v]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;trying to unsplit at a non-content slice&quot;</span></span><span>
</span><span id="line-533"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-534"></span><span>  </span><span id="local-6989586621679482616"><span class="annot"><span class="annottext">splitType :: SplitType
</span><a href="#local-6989586621679482616"><span class="hs-identifier hs-var hs-var">splitType</span></a></span></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679482609"><span class="hs-identifier hs-var">l2nd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#RightOfTwo"><span class="hs-identifier hs-var">RightOfTwo</span></a></span><span>
</span><span id="line-536"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Bool
forall a. StartStop a -&gt; Bool
</span><a href="Common.html#isStop"><span class="hs-identifier hs-var">isStop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482612"><span class="hs-identifier hs-var">rr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#SingleOfOne"><span class="hs-identifier hs-var">SingleOfOne</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SplitType
</span><a href="Common.html#LeftOfTwo"><span class="hs-identifier hs-var">LeftOfTwo</span></a></span><span>
</span><span id="line-538"></span><span>  </span><span id="local-6989586621679482615"><span class="annot"><span class="annottext">mkItem :: (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679482615"><span class="hs-identifier hs-var hs-var">mkItem</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679482625"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482625"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482626"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482626"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482606"><span class="hs-identifier hs-var">ll</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679482625"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482612"><span class="hs-identifier hs-var">rr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679482609"><span class="hs-identifier hs-var">l2nd</span></a></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Score v Int -&gt; Item (Transition tr slc) v
forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Score v Int -&gt; Score v Int -&gt; Score v Int
forall s i.
(Semiring s, Eq i, Show i, Show s) =&gt;
s -&gt; Score s i -&gt; Score s i -&gt; Score s i
</span><a href="Scoring.FunTyped.html#unsplitScores"><span class="hs-identifier hs-var">S.unsplitScores</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679482626"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482610"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Score v Int
</span><a href="#local-6989586621679482613"><span class="hs-identifier hs-var">vr</span></a></span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span class="hs-comment">-- the parsing main loop</span><span>
</span><span id="line-541"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-542"></span><span>
</span><span id="line-543"></span><span class="annot"><span class="hs-comment">-- | parallelized map</span></span><span>
</span><span id="line-544"></span><span id="local-6989586621679481426"><span id="local-6989586621679481427"><span class="annot"><a href="ChartParser.html#pmap"><span class="hs-identifier hs-type">pmap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="#local-6989586621679481426"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679481427"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481426"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679481427"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679481426"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-545"></span><span id="pmap"><span class="annot"><span class="annottext">pmap :: forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var hs-var">pmap</span></a></span></span><span> </span><span id="local-6989586621679482631"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679482631"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Strategy [b] -&gt; [b] -&gt; [b]
forall a. Strategy a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">P.withStrategy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Strategy b -&gt; Strategy [b]
forall a. Strategy a -&gt; Strategy [a]
</span><span class="hs-identifier hs-var">P.parList</span></span><span> </span><span class="annot"><span class="annottext">Strategy b
forall a. NFData a =&gt; Strategy a
</span><span class="hs-identifier hs-var">P.rdeepseq</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([b] -&gt; [b]) -&gt; ([a] -&gt; [b]) -&gt; [a] -&gt; [b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; [a] -&gt; [b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679482631"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="hs-comment">-- pmap = map</span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span class="annot"><span class="hs-comment">{- | A type alias for  pair of transition chart ('TChart')
 and verticalization chart ('VChart').
-}</span></span><span>
</span><span id="line-552"></span><span class="hs-keyword">type</span><span> </span><span id="ParseState"><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-var">ParseState</span></a></span></span><span> </span><span id="local-6989586621679482635"><span class="annot"><a href="#local-6989586621679482635"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679482636"><span class="annot"><a href="#local-6989586621679482636"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679482637"><span class="annot"><a href="#local-6989586621679482637"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679482638"><span class="annot"><a href="#local-6989586621679482638"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482635"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482636"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482638"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482635"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482636"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482637"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482638"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="annot"><span class="hs-comment">{- | Type alias for a monadic parsing operation.
 A function that takes a level and a 'ParseState'
 and produces a monadic parsing action yielding a new state.

 Used to express the main parsing loop
 as well as all substeps that transform the charts on a specific level.
-}</span></span><span>
</span><span id="line-561"></span><span class="hs-keyword">type</span><span> </span><span id="ParseOp"><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-var">ParseOp</span></a></span></span><span> </span><span id="local-6989586621679482639"><span class="annot"><a href="#local-6989586621679482639"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679482640"><span class="annot"><a href="#local-6989586621679482640"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679482641"><span class="annot"><a href="#local-6989586621679482641"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679482642"><span class="annot"><a href="#local-6989586621679482642"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679482643"><span class="annot"><a href="#local-6989586621679482643"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-type">ParseState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482640"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482641"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482642"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482643"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679482639"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#ParseState"><span class="hs-identifier hs-type">ParseState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482640"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482641"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482642"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482643"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-562"></span><span>
</span><span id="line-563"></span><span class="annot"><span class="hs-comment">-- | A single level iteration of the chart parser.</span></span><span>
</span><span id="line-564"></span><span id="local-6989586621679481434"><span id="local-6989586621679481435"><span id="local-6989586621679481436"><span id="local-6989586621679481437"><span id="local-6989586621679481439"><span id="local-6989586621679481440"><span class="annot"><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-type">parseStep</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481434"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481435"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481437"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481434"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481435"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481437"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481434"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481435"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481437"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ a logging function that takes charts and level number.</span></span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481434"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481439"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481435"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481440"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481437"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the grammar's evaluator</span></span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679481434"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481435"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481436"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481437"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-571"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the parsing operation (from level number and charts to new charts).</span></span><span>
</span><span id="line-572"></span><span id="parseStep"><span class="annot"><span class="annottext">parseStep :: forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
(TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; ParseOp IO tr slc h v
</span><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-var hs-var">parseStep</span></a></span></span><span> </span><span id="local-6989586621679482659"><span class="annot"><span class="annottext">TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679482659"><span class="hs-identifier hs-var">logCharts</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span id="local-6989586621679482660"><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
</span><a href="#local-6989586621679482660"><span class="hs-identifier hs-var">eMid</span></a></span></span><span> </span><span id="local-6989586621679482661"><span class="annot"><span class="annottext">UnspreadLeft tr slc h
</span><a href="#local-6989586621679482661"><span class="hs-identifier hs-var">eLeft</span></a></span></span><span> </span><span id="local-6989586621679482662"><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482662"><span class="hs-identifier hs-var">eRight</span></a></span></span><span> </span><span id="local-6989586621679482663"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482663"><span class="hs-identifier hs-var">eUnsplit</span></a></span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">slc' -&gt; slc
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679482664"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679482665"><span class="annot"><span class="annottext">ParseState tr slc h v
</span><a href="#local-6989586621679482665"><span class="hs-identifier hs-var">charts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ())
-&gt; ParseState tr slc h v -&gt; Int -&gt; IO ()
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679482659"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">ParseState tr slc h v
</span><a href="#local-6989586621679482665"><span class="hs-identifier hs-var">charts</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v -&gt; ParseOp IO tr slc h v
forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadMiddle tr slc h v -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-var">unspreadAllMiddles</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
</span><a href="#local-6989586621679482660"><span class="hs-identifier hs-var">eMid</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ParseState tr slc h v
</span><a href="#local-6989586621679482665"><span class="hs-identifier hs-var">charts</span></a></span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="annottext">IO (ParseState tr slc h v)
-&gt; (ParseState tr slc h v -&gt; IO (ParseState tr slc h v))
-&gt; IO (ParseState tr slc h v)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc h -&gt; ParseOp IO tr slc h v
forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadLeft tr slc h -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-var">unspreadAllLefts</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc h
</span><a href="#local-6989586621679482661"><span class="hs-identifier hs-var">eLeft</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-576"></span><span>    </span><span class="annot"><span class="annottext">IO (ParseState tr slc h v)
-&gt; (ParseState tr slc h v -&gt; IO (ParseState tr slc h v))
-&gt; IO (ParseState tr slc h v)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h -&gt; ParseOp IO tr slc h v
forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadRight tr slc h -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-var">unspreadAllRights</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482662"><span class="hs-identifier hs-var">eRight</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="annot"><span class="annottext">IO (ParseState tr slc h v)
-&gt; (ParseState tr slc h v -&gt; IO (ParseState tr slc h v))
-&gt; IO (ParseState tr slc h v)
forall a b. IO a -&gt; (a -&gt; IO b) -&gt; IO b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v -&gt; ParseOp IO tr slc h v
forall tr slc h v (m :: * -&gt; *).
(Monad m, Parsable tr slc h v) =&gt;
Unsplit tr slc v -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-var">unsplitAll</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482663"><span class="hs-identifier hs-var">eUnsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482664"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span class="annot"><span class="hs-comment">-- | Verticalizes all edges of length @n@.</span></span><span>
</span><span id="line-580"></span><span id="local-6989586621679481453"><span id="local-6989586621679481454"><span id="local-6989586621679481455"><span id="local-6989586621679481456"><span id="local-6989586621679481457"><span class="annot"><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-type">unspreadAllMiddles</span></a></span><span>
</span><span id="line-581"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679481453"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481454"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481455"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481456"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481457"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadMiddle"><span class="hs-identifier hs-type">UnspreadMiddle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481454"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481455"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481456"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481457"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481453"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481454"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481455"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481456"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481457"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-582"></span><span id="unspreadAllMiddles"><span class="annot"><span class="annottext">unspreadAllMiddles :: forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadMiddle tr slc h v -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllMiddles"><span class="hs-identifier hs-var hs-var">unspreadAllMiddles</span></a></span></span><span> </span><span id="local-6989586621679482687"><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
</span><a href="#local-6989586621679482687"><span class="hs-identifier hs-var">evalMid</span></a></span></span><span> </span><span id="local-6989586621679482688"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482688"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679482689"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482689"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482690"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482690"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679482691"><span class="annot"><span class="annottext">ts :: [TItem tr slc v]
</span><a href="#local-6989586621679482691"><span class="hs-identifier hs-var hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482689"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482688"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-584"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679482703"><span class="annot"><span class="annottext">newVerts :: [(slc, h, v, TItem tr slc v)]
</span><a href="#local-6989586621679482703"><span class="hs-identifier hs-var hs-var">newVerts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(slc, h, v, TItem tr slc v)]] -&gt; [(slc, h, v, TItem tr slc v)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[(slc, h, v, TItem tr slc v)]] -&gt; [(slc, h, v, TItem tr slc v)])
-&gt; [[(slc, h, v, TItem tr slc v)]] -&gt; [(slc, h, v, TItem tr slc v)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TItem tr slc v -&gt; [(slc, h, v, TItem tr slc v)])
-&gt; [TItem tr slc v] -&gt; [[(slc, h, v, TItem tr slc v)]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
-&gt; TItem tr slc v -&gt; [(slc, h, v, TItem tr slc v)]
forall tr slc h v.
UnspreadMiddle tr slc h v
-&gt; TItem tr slc v -&gt; [(slc, h, v, TItem tr slc v)]
</span><a href="ChartParser.html#unspreadMiddle"><span class="hs-identifier hs-var">unspreadMiddle</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadMiddle tr slc h v
</span><a href="#local-6989586621679482687"><span class="hs-identifier hs-var">evalMid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TItem tr slc v] -&gt; [[(slc, h, v, TItem tr slc v)]])
-&gt; [TItem tr slc v] -&gt; [[(slc, h, v, TItem tr slc v)]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679482691"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-585"></span><span>      </span><span id="local-6989586621679482712"><span class="annot"><span class="annottext">vchart' :: VChart tr slc h v
</span><a href="#local-6989586621679482712"><span class="hs-identifier hs-var hs-var">vchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
-&gt; [(slc, h, v, TItem tr slc v)] -&gt; VChart tr slc h v
forall (t :: * -&gt; *) slc h tr v.
(Foldable t, Ord slc, Hashable slc, Ord h) =&gt;
VChart tr slc h v
-&gt; t (slc, h, v, TItem tr slc v) -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcMerge"><span class="hs-identifier hs-var">vcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482690"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">[(slc, h, v, TItem tr slc v)]
</span><a href="#local-6989586621679482703"><span class="hs-identifier hs-var">newVerts</span></a></span><span>
</span><span id="line-586"></span><span>  </span><span class="annot"><span class="annottext">(TChart tr slc v, VChart tr slc h v)
-&gt; m (TChart tr slc v, VChart tr slc h v)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482689"><span class="hs-identifier hs-var">tchart</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482712"><span class="hs-identifier hs-var">vchart'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span class="annot"><span class="hs-comment">-- | Perform all left unspreads where either @l@ or @m@ have length @n@.</span></span><span>
</span><span id="line-589"></span><span id="local-6989586621679481461"><span id="local-6989586621679481462"><span id="local-6989586621679481463"><span id="local-6989586621679481464"><span id="local-6989586621679481465"><span class="annot"><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-type">unspreadAllLefts</span></a></span><span>
</span><span id="line-590"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679481461"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481462"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481463"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481464"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481465"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadLeft"><span class="hs-identifier hs-type">UnspreadLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481462"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481463"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481464"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481461"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481462"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481463"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481464"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481465"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-591"></span><span id="unspreadAllLefts"><span class="annot"><span class="annottext">unspreadAllLefts :: forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadLeft tr slc h -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllLefts"><span class="hs-identifier hs-var hs-var">unspreadAllLefts</span></a></span></span><span> </span><span id="local-6989586621679482737"><span class="annot"><span class="annottext">UnspreadLeft tr slc h
</span><a href="#local-6989586621679482737"><span class="hs-identifier hs-var">evalLeft</span></a></span></span><span> </span><span id="local-6989586621679482738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482738"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679482739"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482739"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482740"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482740"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-593"></span><span>    </span><span class="hs-comment">-- left = n (and middle &lt;= n)</span><span>
</span><span id="line-594"></span><span>    </span><span id="local-6989586621679482762"><span class="annot"><span class="annottext">leftn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679482762"><span class="hs-identifier hs-var hs-var">leftn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-595"></span><span>      </span><span class="annot"><span class="annottext">((TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v])
-&gt; [(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="annot"><span class="annottext">(TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v]
forall {v}.
(Semiring v, Show v) =&gt;
(TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679482763"><span class="hs-identifier hs-var">unleft</span></a></span><span> </span><span class="annot"><span class="annottext">([(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]])
-&gt; [(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-597"></span><span>        </span><span id="local-6989586621679482764"><span class="annot"><a href="#local-6989586621679482764"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482739"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482738"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-598"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679482765"><span class="annot"><a href="#local-6989586621679482765"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482766"><span class="annot"><a href="#local-6989586621679482766"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="ChartParser.html#vcGetByLeftChild"><span class="hs-identifier hs-type">vcGetByLeftChild</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482738"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482740"><span class="hs-identifier hs-type">vchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482764"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482764"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482765"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482766"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span>    </span><span class="hs-comment">-- middle = n (and left &lt; n)</span><span>
</span><span id="line-602"></span><span>    </span><span id="local-6989586621679482787"><span class="annot"><span class="annottext">midn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679482787"><span class="hs-identifier hs-var hs-var">midn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-603"></span><span>      </span><span class="annot"><span class="annottext">((TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v])
-&gt; [(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="annot"><span class="annottext">(TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v]
forall {v}.
(Semiring v, Show v) =&gt;
(TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679482763"><span class="hs-identifier hs-var">unleft</span></a></span><span> </span><span class="annot"><span class="annottext">([(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]])
-&gt; [(TItem tr slc v, Slice slc, h)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-604"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-605"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679482788"><span class="annot"><a href="#local-6989586621679482788"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482789"><span class="annot"><a href="#local-6989586621679482789"><span class="hs-identifier hs-var">lslice</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482790"><span class="annot"><a href="#local-6989586621679482790"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; Int -&gt; [(Slice slc, Slice slc, h)]
forall tr slc h v.
VChart tr slc h v -&gt; Int -&gt; [(Slice slc, Slice slc, h)]
</span><a href="ChartParser.html#vcGetByLengthLeft"><span class="hs-identifier hs-var">vcGetByLengthLeft</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482740"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482738"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-606"></span><span>        </span><span id="local-6989586621679482791"><span class="annot"><a href="#local-6989586621679482791"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-607"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679482792"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482792"><span class="hs-identifier hs-var">item</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482792"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482738"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-608"></span><span>            </span><span class="annot"><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-type">tcGetByRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482739"><span class="hs-identifier hs-type">tchart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482789"><span class="hs-identifier hs-type">lslice</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482791"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482788"><span class="hs-identifier hs-type">top</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482790"><span class="hs-identifier hs-type">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>
</span><span id="line-611"></span><span>    </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-612"></span><span>    </span><span id="local-6989586621679482820"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679482820"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482739"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679482762"><span class="hs-identifier hs-var">leftn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679482787"><span class="hs-identifier hs-var">midn</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><span class="annottext">(TChart tr slc v, VChart tr slc h v)
-&gt; m (TChart tr slc v, VChart tr slc h v)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482820"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482740"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-615"></span><span>  </span><span id="local-6989586621679482763"><span class="annot"><span class="annottext">unleft :: (TItem tr slc v, Slice slc, h) -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679482763"><span class="hs-identifier hs-var hs-var">unleft</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679482827"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482827"><span class="hs-identifier hs-var">left</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482828"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482828"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679482829"><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482829"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc h
-&gt; TItem tr slc v -&gt; Slice slc -&gt; h -&gt; [TItem tr slc v]
forall slc tr v h.
(Show slc, Show tr, Semiring v, Show v) =&gt;
UnspreadLeft tr slc h
-&gt; TItem tr slc v -&gt; Slice slc -&gt; h -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadLeft"><span class="hs-identifier hs-var">unspreadLeft</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadLeft tr slc h
</span><a href="#local-6989586621679482737"><span class="hs-identifier hs-var">evalLeft</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482827"><span class="hs-identifier hs-var">left</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679482828"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="annot"><span class="annottext">h
</span><a href="#local-6989586621679482829"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><span class="hs-comment">-- | Perform all right unspreads where either @r@ or @m@ have length @n@</span></span><span>
</span><span id="line-618"></span><span id="local-6989586621679481466"><span id="local-6989586621679481467"><span id="local-6989586621679481468"><span id="local-6989586621679481469"><span id="local-6989586621679481470"><span class="annot"><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-type">unspreadAllRights</span></a></span><span>
</span><span id="line-619"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679481466"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481467"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481468"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481469"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481470"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#UnspreadRight"><span class="hs-identifier hs-type">UnspreadRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481467"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481468"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481469"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481466"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481467"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481468"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481469"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481470"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span><span>
</span><span id="line-620"></span><span id="unspreadAllRights"><span class="annot"><span class="annottext">unspreadAllRights :: forall (m :: * -&gt; *) tr slc h v.
(Monad m, Parsable tr slc h v) =&gt;
UnspreadRight tr slc h -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unspreadAllRights"><span class="hs-identifier hs-var hs-var">unspreadAllRights</span></a></span></span><span> </span><span id="local-6989586621679482853"><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482853"><span class="hs-identifier hs-var">evalRight</span></a></span></span><span> </span><span id="local-6989586621679482854"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482854"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679482855"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482855"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482856"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482856"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-621"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-622"></span><span>    </span><span class="hs-comment">-- right = n (and middle &lt;= n)</span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679482884"><span class="annot"><span class="annottext">rightn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679482884"><span class="hs-identifier hs-var hs-var">rightn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-624"></span><span>      </span><span class="annot"><span class="annottext">[[TItem tr slc v]] -&gt; [[TItem tr slc v]]
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">([[TItem tr slc v]] -&gt; [[TItem tr slc v]])
-&gt; [[TItem tr slc v]] -&gt; [[TItem tr slc v]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; [(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
 -&gt; (Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v, TItem tr slc v)
-&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h
-&gt; Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
forall v slc tr h.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v, Show h) =&gt;
UnspreadRight tr slc h
-&gt; Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var">unspreadRight</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482853"><span class="hs-identifier hs-var">evalRight</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]])
-&gt; [(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-626"></span><span>        </span><span id="local-6989586621679482885"><span class="annot"><a href="#local-6989586621679482885"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482855"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482854"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-627"></span><span>        </span><span id="local-6989586621679482886"><span class="annot"><a href="#local-6989586621679482886"><span class="hs-identifier hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="ChartParser.html#vcGetByRightChild"><span class="hs-identifier hs-type">vcGetByRightChild</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482854"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482856"><span class="hs-identifier hs-type">vchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482885"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482886"><span class="hs-identifier hs-type">vert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482885"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>    </span><span class="hs-comment">-- middle = n (and left &lt; n)</span><span>
</span><span id="line-631"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679482915"><span class="annot"><span class="annottext">midn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679482915"><span class="hs-identifier hs-var hs-var">midn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-632"></span><span>      </span><span class="annot"><span class="annottext">[[TItem tr slc v]] -&gt; [[TItem tr slc v]]
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">([[TItem tr slc v]] -&gt; [[TItem tr slc v]])
-&gt; [[TItem tr slc v]] -&gt; [[TItem tr slc v]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; [(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">((Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
 -&gt; (Vert tr slc h v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (Vert tr slc h v, TItem tr slc v)
-&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h
-&gt; Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
forall v slc tr h.
(Semiring v, NFData slc, NFData tr, NFData v, Show tr, Show slc,
 Show v, Show h) =&gt;
UnspreadRight tr slc h
-&gt; Vert tr slc h v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unspreadRight"><span class="hs-identifier hs-var">unspreadRight</span></a></span><span> </span><span class="annot"><span class="annottext">UnspreadRight tr slc h
</span><a href="#local-6989586621679482853"><span class="hs-identifier hs-var">evalRight</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]])
-&gt; [(Vert tr slc h v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-633"></span><span>        </span><span class="hs-comment">-- in list monad</span><span>
</span><span id="line-634"></span><span>        </span><span id="local-6989586621679482916"><span class="annot"><a href="#local-6989586621679482916"><span class="hs-identifier hs-var">vert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
forall tr slc h v. VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482856"><span class="hs-identifier hs-var">vchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482854"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-635"></span><span>        </span><span id="local-6989586621679482917"><span class="annot"><a href="#local-6989586621679482917"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-636"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679482918"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482918"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679482918"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482854"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-637"></span><span>            </span><span class="annot"><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-type">tcGetByLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482855"><span class="hs-identifier hs-type">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#vMiddle"><span class="hs-identifier hs-var">vMiddle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482916"><span class="hs-identifier hs-type">vert</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679482916"><span class="hs-identifier hs-type">vert</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679482917"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span>    </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-641"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679482946"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679482946"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482855"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679482884"><span class="hs-identifier hs-var">rightn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679482915"><span class="hs-identifier hs-var">midn</span></a></span><span>
</span><span id="line-642"></span><span>  </span><span class="annot"><span class="annottext">(TChart tr slc v, VChart tr slc h v)
-&gt; m (TChart tr slc v, VChart tr slc h v)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482946"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482856"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>
</span><span id="line-644"></span><span class="annot"><span class="hs-comment">-- | perform all unsplits where either @l@ or @r@ have length @n@</span></span><span>
</span><span id="line-645"></span><span class="annot"><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-type">unsplitAll</span></a></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679481472"><span class="annot"><a href="#local-6989586621679481472"><span class="hs-identifier hs-type">tr</span></a></span></span><span> </span><span id="local-6989586621679481473"><span class="annot"><a href="#local-6989586621679481473"><span class="hs-identifier hs-type">slc</span></a></span></span><span> </span><span id="local-6989586621679481474"><span class="annot"><a href="#local-6989586621679481474"><span class="hs-identifier hs-type">h</span></a></span></span><span> </span><span id="local-6989586621679481475"><span class="annot"><a href="#local-6989586621679481475"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span id="local-6989586621679481471"><span class="annot"><a href="#local-6989586621679481471"><span class="hs-identifier hs-type">m</span></a></span></span><span>
</span><span id="line-647"></span><span>   </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679481471"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481472"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481474"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481475"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Unsplit"><span class="hs-identifier hs-type">Unsplit</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481472"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481475"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#ParseOp"><span class="hs-identifier hs-type">ParseOp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481471"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481472"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481473"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481474"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481475"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-650"></span><span id="unsplitAll"><span class="annot"><span class="annottext">unsplitAll :: forall tr slc h v (m :: * -&gt; *).
(Monad m, Parsable tr slc h v) =&gt;
Unsplit tr slc v -&gt; ParseOp m tr slc h v
</span><a href="ChartParser.html#unsplitAll"><span class="hs-identifier hs-var hs-var">unsplitAll</span></a></span></span><span> </span><span id="local-6989586621679482967"><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482967"><span class="hs-identifier hs-var">unsplitter</span></a></span></span><span> </span><span id="local-6989586621679482968"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482968"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679482969"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482969"><span class="hs-identifier hs-var">tchart</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482970"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482970"><span class="hs-identifier hs-var">vchart</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679482977"><span class="annot"><span class="annottext">byLen :: [TItem tr slc v]
</span><a href="#local-6989586621679482977"><span class="hs-identifier hs-var hs-var">byLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v] -&gt; [TItem tr slc v]
forall a. NFData a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">force</span></span><span> </span><span class="annot"><span class="annottext">([TItem tr slc v] -&gt; [TItem tr slc v])
-&gt; [TItem tr slc v] -&gt; [TItem tr slc v]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482969"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482968"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>      </span><span class="hs-comment">-- left = n (and right &lt;= n)</span><span>
</span><span id="line-654"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679483000"><span class="annot"><span class="annottext">leftn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679483000"><span class="hs-identifier hs-var hs-var">leftn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">((TItem tr slc v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; [(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (TItem tr slc v, TItem tr slc v) -&gt; [TItem tr slc v]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var">unsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482967"><span class="hs-identifier hs-var">unsplitter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]])
-&gt; [(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>          </span><span id="local-6989586621679483001"><span class="annot"><a href="#local-6989586621679483001"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679482977"><span class="hs-identifier hs-var">byLen</span></a></span><span>
</span><span id="line-657"></span><span>          </span><span id="local-6989586621679483002"><span class="annot"><a href="#local-6989586621679483002"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-658"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679483003"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483003"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483003"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482968"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-659"></span><span>              </span><span class="annot"><a href="ChartParser.html#tcGetByLeft"><span class="hs-identifier hs-type">tcGetByLeft</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482969"><span class="hs-identifier hs-type">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483001"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-660"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679483001"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679483002"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-comment">-- right = n (and left &lt; n)</span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679483026"><span class="annot"><span class="annottext">rightn :: [[TItem tr slc v]]
</span><a href="#local-6989586621679483026"><span class="hs-identifier hs-var hs-var">rightn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-664"></span><span>        </span><span class="annot"><span class="annottext">((TItem tr slc v, TItem tr slc v) -&gt; [TItem tr slc v])
-&gt; [(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall b a. NFData b =&gt; (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="ChartParser.html#pmap"><span class="hs-identifier hs-var">pmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v])
-&gt; (TItem tr slc v, TItem tr slc v) -&gt; [TItem tr slc v]
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
forall v slc tr.
(Semiring v, NFData slc, NFData tr, NFData v, Show v) =&gt;
Unsplit tr slc v
-&gt; TItem tr slc v -&gt; TItem tr slc v -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#unsplit"><span class="hs-identifier hs-var">unsplit</span></a></span><span> </span><span class="annot"><span class="annottext">Unsplit tr slc v
</span><a href="#local-6989586621679482967"><span class="hs-identifier hs-var">unsplitter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]])
-&gt; [(TItem tr slc v, TItem tr slc v)] -&gt; [[TItem tr slc v]]
forall a b. NFData a =&gt; (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!!</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-665"></span><span>          </span><span id="local-6989586621679483027"><span class="annot"><a href="#local-6989586621679483027"><span class="hs-identifier hs-var">right</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TItem tr slc v]
</span><a href="#local-6989586621679482977"><span class="hs-identifier hs-var">byLen</span></a></span><span>
</span><span id="line-666"></span><span>          </span><span id="local-6989586621679483028"><span class="annot"><a href="#local-6989586621679483028"><span class="hs-identifier hs-var">left</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679483029"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483029"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall e a. Transition e a -&gt; Int
</span><a href="ChartParser.html#transLen"><span class="hs-identifier hs-var">transLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483029"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679482968"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span>
</span><span id="line-668"></span><span>              </span><span class="annot"><a href="ChartParser.html#tcGetByRight"><span class="hs-identifier hs-type">tcGetByRight</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679482969"><span class="hs-identifier hs-type">tchart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483027"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679483028"><span class="hs-identifier hs-type">left</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679483027"><span class="hs-identifier hs-type">right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-670"></span><span>
</span><span id="line-671"></span><span>      </span><span class="hs-comment">-- insert new transitions into chart</span><span>
</span><span id="line-672"></span><span>      </span><span class="hs-glyph">!</span><span id="local-6989586621679483057"><span class="annot"><span class="annottext">tchart' :: TChart tr slc v
</span><a href="#local-6989586621679483057"><span class="hs-identifier hs-var hs-var">tchart'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v)
-&gt; TChart tr slc v -&gt; [[TItem tr slc v]] -&gt; TChart tr slc v
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679482969"><span class="hs-identifier hs-var">tchart</span></a></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679483000"><span class="hs-identifier hs-var">leftn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679483026"><span class="hs-identifier hs-var">rightn</span></a></span><span>
</span><span id="line-673"></span><span>  </span><span class="annot"><span class="annottext">(TChart tr slc v, VChart tr slc h v)
-&gt; m (TChart tr slc v, VChart tr slc h v)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483057"><span class="hs-identifier hs-var">tchart'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679482970"><span class="hs-identifier hs-var">vchart</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">-- parsing entry point</span><span>
</span><span id="line-676"></span><span class="hs-comment">----------------------</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span class="annot"><span class="hs-comment">{- | The main entrypoint to the parser.
 Expects an evaluator for the specific grammar
 and an input path.
 Returns the combined semiring value of all full derivations.
-}</span></span><span>
</span><span id="line-683"></span><span id="local-6989586621679481505"><span id="local-6989586621679481506"><span id="local-6989586621679481507"><span id="local-6989586621679481508"><span id="local-6989586621679481509"><span id="local-6989586621679481510"><span class="annot"><a href="ChartParser.html#parse"><span class="hs-identifier hs-type">parse</span></a></span><span>
</span><span id="line-684"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481505"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481506"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481507"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481508"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481505"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481506"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481508"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481505"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481506"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481507"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481508"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481506"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ logging function</span></span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481505"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481509"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481506"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481510"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481507"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481508"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-688"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the grammar's evaluator</span></span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481510"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481509"><span class="hs-identifier hs-type">tr'</span></a></span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the input path (from first to last slice, excluding 'Start' and 'Stop')</span></span><span>
</span><span id="line-691"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679481508"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ the semiring value at the top</span></span><span>
</span><span id="line-693"></span><span id="parse"><span class="annot"><span class="annottext">parse :: forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var hs-var">parse</span></a></span></span><span> </span><span id="local-6989586621679483090"><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679483090"><span class="hs-identifier hs-var">logCharts</span></a></span></span><span> </span><span id="local-6989586621679483091"><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v
</span><a href="#local-6989586621679483091"><span class="hs-identifier hs-var">eval</span></a></span></span><span> </span><span id="local-6989586621679483092"><span class="annot"><span class="annottext">Path slc' tr'
</span><a href="#local-6989586621679483092"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679483090"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483093"><span class="hs-identifier hs-var">tinit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Slice slc] -&gt; Either (VChart tr slc h v) [Slice slc]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">([Slice slc] -&gt; Either (VChart tr slc h v) [Slice slc])
-&gt; [Slice slc] -&gt; Either (VChart tr slc h v) [Slice slc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path (Slice slc) (Maybe tr') -&gt; [Slice slc]
forall a b. Path a b -&gt; [a]
</span><a href="Common.html#pathArounds"><span class="hs-identifier hs-var">pathArounds</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679483095"><span class="hs-identifier hs-var">slicePath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679483096"><span class="annot"><a href="#local-6989586621679483096"><span class="hs-identifier hs-var">tfinal</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679483097"><span class="annot"><a href="#local-6989586621679483097"><span class="hs-identifier hs-var">vfinal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">((TChart tr slc v, VChart tr slc h v)
 -&gt; Int -&gt; IO (TChart tr slc v, VChart tr slc h v))
-&gt; (TChart tr slc v, VChart tr slc h v)
-&gt; [Int]
-&gt; IO (TChart tr slc v, VChart tr slc h v)
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldM</span></span><span>
</span><span id="line-697"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int
 -&gt; (TChart tr slc v, VChart tr slc h v)
 -&gt; IO (TChart tr slc v, VChart tr slc h v))
-&gt; (TChart tr slc v, VChart tr slc h v)
-&gt; Int
-&gt; IO (TChart tr slc v, VChart tr slc h v)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">((Int
  -&gt; (TChart tr slc v, VChart tr slc h v)
  -&gt; IO (TChart tr slc v, VChart tr slc h v))
 -&gt; (TChart tr slc v, VChart tr slc h v)
 -&gt; Int
 -&gt; IO (TChart tr slc v, VChart tr slc h v))
-&gt; (Int
    -&gt; (TChart tr slc v, VChart tr slc h v)
    -&gt; IO (TChart tr slc v, VChart tr slc h v))
-&gt; (TChart tr slc v, VChart tr slc h v)
-&gt; Int
-&gt; IO (TChart tr slc v, VChart tr slc h v)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v
-&gt; Int
-&gt; (TChart tr slc v, VChart tr slc h v)
-&gt; IO (TChart tr slc v, VChart tr slc h v)
forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
(TChart tr slc v -&gt; VChart tr slc h v -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; ParseOp IO tr slc h v
</span><a href="ChartParser.html#parseStep"><span class="hs-identifier hs-var">parseStep</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679483099"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483099"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679483100"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679483100"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679483101"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483101"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ()
</span><a href="#local-6989586621679483090"><span class="hs-identifier hs-var">logCharts</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483099"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; Either (VChart tr slc h v) [Slice slc]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679483100"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483101"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v
</span><a href="#local-6989586621679483091"><span class="hs-identifier hs-var">eval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483093"><span class="hs-identifier hs-var">tinit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; VChart tr slc h v
forall tr slc h v. Int -&gt; VChart tr slc h v
</span><a href="ChartParser.html#vcEmpty"><span class="hs-identifier hs-var">vcEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483102"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483102"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><a href="#local-6989586621679483090"><span class="hs-identifier hs-type">logCharts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483096"><span class="hs-identifier hs-type">tfinal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><a href="#local-6989586621679483097"><span class="hs-identifier hs-type">vfinal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679483102"><span class="hs-identifier hs-type">len</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679483103"><span class="annot"><a href="#local-6989586621679483103"><span class="hs-identifier hs-var hs-var">goals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483096"><span class="hs-identifier hs-var">tfinal</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483102"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.sum</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Scoring.FunTyped.html#getScoreVal"><span class="hs-identifier hs-type">S.getScoreVal</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="ChartParser.html#iScore"><span class="hs-identifier hs-var">iScore</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679483103"><span class="hs-identifier hs-type">goals</span></a></span><span>
</span><span id="line-703"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-704"></span><span>  </span><span id="local-6989586621679483106"><span class="annot"><span class="annottext">wrapPath :: Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679483106"><span class="hs-identifier hs-var hs-var">wrapPath</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span id="local-6989586621679483108"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483108"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679483109"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483109"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621679483110"><span class="annot"><span class="annottext">Path a a
</span><a href="#local-6989586621679483110"><span class="hs-identifier hs-var">rst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop a
-&gt; Maybe a
-&gt; Path (StartStop a) (Maybe a)
-&gt; Path (StartStop a) (Maybe a)
forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; StartStop a
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483108"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483109"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Path (StartStop a) (Maybe a) -&gt; Path (StartStop a) (Maybe a))
-&gt; Path (StartStop a) (Maybe a) -&gt; Path (StartStop a) (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679483106"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path a a
</span><a href="#local-6989586621679483110"><span class="hs-identifier hs-var">rst</span></a></span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><a href="#local-6989586621679483106"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Common.html#PathEnd"><span class="hs-identifier hs-type">PathEnd</span></a></span><span> </span><span id="local-6989586621679483112"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483112"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop a
-&gt; Maybe a
-&gt; Path (StartStop a) (Maybe a)
-&gt; Path (StartStop a) (Maybe a)
forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; StartStop a
forall a. a -&gt; StartStop a
</span><a href="Common.html#Inner"><span class="hs-identifier hs-var">Inner</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483112"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Path (StartStop a) (Maybe a) -&gt; Path (StartStop a) (Maybe a))
-&gt; Path (StartStop a) (Maybe a) -&gt; Path (StartStop a) (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StartStop a -&gt; Path (StartStop a) (Maybe a)
forall around between. around -&gt; Path around between
</span><a href="Common.html#PathEnd"><span class="hs-identifier hs-var">PathEnd</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop a
forall a. StartStop a
</span><a href="Common.html#Stop"><span class="hs-identifier hs-var">Stop</span></a></span><span>
</span><span id="line-706"></span><span>  </span><span id="local-6989586621679483113"><span class="annot"><span class="annottext">path' :: Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679483113"><span class="hs-identifier hs-var hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StartStop slc'
-&gt; Maybe tr'
-&gt; Path (StartStop slc') (Maybe tr')
-&gt; Path (StartStop slc') (Maybe tr')
forall around between.
around -&gt; between -&gt; Path around between -&gt; Path around between
</span><a href="Common.html#Path"><span class="hs-identifier hs-var">Path</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc'
forall a. StartStop a
</span><a href="Common.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe tr'
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">(Path (StartStop slc') (Maybe tr')
 -&gt; Path (StartStop slc') (Maybe tr'))
-&gt; Path (StartStop slc') (Maybe tr')
-&gt; Path (StartStop slc') (Maybe tr')
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path slc' tr' -&gt; Path (StartStop slc') (Maybe tr')
forall {a} {a}. Path a a -&gt; Path (StartStop a) (Maybe a)
</span><a href="#local-6989586621679483106"><span class="hs-identifier hs-var">wrapPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path slc' tr'
</span><a href="#local-6989586621679483092"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span id="local-6989586621679483102"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679483102"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path (StartStop slc') (Maybe tr') -&gt; Int
forall a b. Path a b -&gt; Int
</span><a href="Common.html#pathLen"><span class="hs-identifier hs-var">pathLen</span></a></span><span> </span><span class="annot"><span class="annottext">Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679483113"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-708"></span><span>  </span><span id="local-6989586621679483095"><span class="annot"><span class="annottext">slicePath :: Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679483095"><span class="hs-identifier hs-var hs-var">slicePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-709"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; (Int -&gt; StartStop slc' -&gt; Slice slc)
-&gt; Path (StartStop slc') (Maybe tr')
-&gt; Path (Slice slc) (Maybe tr')
forall a a' b. Int -&gt; (Int -&gt; a -&gt; a') -&gt; Path a b -&gt; Path a' b
</span><a href="Common.html#mapAroundsWithIndex"><span class="hs-identifier hs-var">mapAroundsWithIndex</span></a></span><span>
</span><span id="line-710"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-711"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679483118"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483118"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679483119"><span class="annot"><span class="annottext">StartStop slc'
</span><a href="#local-6989586621679483119"><span class="hs-identifier hs-var">notes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
forall slc. Int -&gt; StartStop slc -&gt; Int -&gt; Int -&gt; Slice slc
</span><a href="ChartParser.html#Slice"><span class="hs-identifier hs-var">Slice</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483118"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v -&gt; slc' -&gt; slc
forall tr tr' slc slc' h v. Eval tr tr' slc slc' h v -&gt; slc' -&gt; slc
</span><a href="Common.html#evalSlice"><span class="hs-identifier hs-var">evalSlice</span></a></span><span> </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v
</span><a href="#local-6989586621679483091"><span class="hs-identifier hs-var">eval</span></a></span><span> </span><span class="annot"><span class="annottext">(slc' -&gt; slc) -&gt; StartStop slc' -&gt; StartStop slc
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc'
</span><a href="#local-6989586621679483119"><span class="hs-identifier hs-var">notes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483118"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483118"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">Path (StartStop slc') (Maybe tr')
</span><a href="#local-6989586621679483113"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-713"></span><span>  </span><span id="local-6989586621679483122"><span class="annot"><span class="annottext">mkTrans :: Slice slc -&gt; Maybe tr' -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679483122"><span class="hs-identifier hs-var hs-var">mkTrans</span></a></span></span><span> </span><span id="local-6989586621679483123"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483123"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679483124"><span class="annot"><span class="annottext">Maybe tr'
</span><a href="#local-6989586621679483124"><span class="hs-identifier hs-var">esurf</span></a></span></span><span> </span><span id="local-6989586621679483125"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483125"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>    </span><span class="annot"><span class="annottext">(tr, v) -&gt; TItem tr slc v
forall {tr} {v}. (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679483126"><span class="hs-identifier hs-var">mk</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="annot"><span class="annottext">((tr, v) -&gt; TItem tr slc v) -&gt; [(tr, v)] -&gt; [TItem tr slc v]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v
-&gt; StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)]
forall tr tr' slc slc' h v.
Eval tr tr' slc slc' h v
-&gt; StartStop slc -&gt; Maybe tr' -&gt; StartStop slc -&gt; Bool -&gt; [(tr, v)]
</span><a href="Common.html#evalUnfreeze"><span class="hs-identifier hs-var">evalUnfreeze</span></a></span><span>
</span><span id="line-716"></span><span>        </span><span class="annot"><span class="annottext">Eval tr tr' slc slc' h v
</span><a href="#local-6989586621679483091"><span class="hs-identifier hs-var">eval</span></a></span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483123"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>        </span><span class="annot"><span class="annottext">Maybe tr'
</span><a href="#local-6989586621679483124"><span class="hs-identifier hs-var">esurf</span></a></span><span>
</span><span id="line-719"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483125"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StartStop slc -&gt; Bool
forall a. StartStop a -&gt; Bool
</span><a href="Common.html#isStop"><span class="hs-identifier hs-var">isStop</span></a></span><span> </span><span class="annot"><span class="annottext">(StartStop slc -&gt; Bool) -&gt; StartStop slc -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; StartStop slc
forall slc. Slice slc -&gt; StartStop slc
</span><a href="ChartParser.html#sContent"><span class="hs-identifier hs-var">sContent</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483125"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621679483126"><span class="annot"><span class="annottext">mk :: (tr, v) -&gt; Item (Transition tr slc) v
</span><a href="#local-6989586621679483126"><span class="hs-identifier hs-var hs-var">mk</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679483128"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679483128"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679483129"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679483129"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
forall tr slc.
Slice slc -&gt; tr -&gt; Slice slc -&gt; Bool -&gt; Transition tr slc
</span><a href="ChartParser.html#Transition"><span class="hs-identifier hs-var">Transition</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483123"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679483128"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483125"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Score v Int -&gt; Item (Transition tr slc) v
forall i v. i -&gt; Score v Int -&gt; Item i v
</span><a href="ChartParser.html#%3A%3D"><span class="hs-operator hs-var">:=</span></a></span><span> </span><span class="annot"><span class="annottext">v -&gt; Score v Int
forall s i. s -&gt; Score s i
</span><a href="Scoring.FunTyped.html#val"><span class="hs-identifier hs-var">S.val</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679483129"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-723"></span><span>  </span><span id="local-6989586621679483131"><span class="annot"><span class="annottext">trans0 :: [[TItem tr slc v]]
</span><a href="#local-6989586621679483131"><span class="hs-identifier hs-var hs-var">trans0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Slice slc -&gt; Maybe tr' -&gt; Slice slc -&gt; [TItem tr slc v])
-&gt; Path (Slice slc) (Maybe tr') -&gt; [[TItem tr slc v]]
forall a b c. (a -&gt; b -&gt; a -&gt; c) -&gt; Path a b -&gt; [c]
</span><a href="Common.html#mapBetweens"><span class="hs-identifier hs-var">mapBetweens</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; Maybe tr' -&gt; Slice slc -&gt; [TItem tr slc v]
</span><a href="#local-6989586621679483122"><span class="hs-identifier hs-var">mkTrans</span></a></span><span> </span><span class="annot"><span class="annottext">Path (Slice slc) (Maybe tr')
</span><a href="#local-6989586621679483095"><span class="hs-identifier hs-var">slicePath</span></a></span><span>
</span><span id="line-724"></span><span>  </span><span id="local-6989586621679483093"><span class="annot"><span class="annottext">tinit :: TChart tr slc v
</span><a href="#local-6989586621679483093"><span class="hs-identifier hs-var hs-var">tinit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall (t :: * -&gt; *) tr slc v.
(Foldable t, Parsable' tr slc v) =&gt;
TChart tr slc v -&gt; t (TItem tr slc v) -&gt; TChart tr slc v
</span><a href="ChartParser.html#tcMerge"><span class="hs-identifier hs-var">tcMerge</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
forall tr slc v. TChart tr slc v
</span><a href="ChartParser.html#tcEmpty"><span class="hs-identifier hs-var">tcEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">([TItem tr slc v] -&gt; TChart tr slc v)
-&gt; [TItem tr slc v] -&gt; TChart tr slc v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]] -&gt; [TItem tr slc v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[TItem tr slc v]]
</span><a href="#local-6989586621679483131"><span class="hs-identifier hs-var">trans0</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="annot"><span class="hs-comment">-- | A logging function that logs the sice of the charts at each level.</span></span><span>
</span><span id="line-727"></span><span id="local-6989586621679481561"><span id="local-6989586621679481562"><span id="local-6989586621679481563"><span id="local-6989586621679481564"><span id="local-6989586621679481565"><span id="local-6989586621679481566"><span id="local-6989586621679481567"><span class="annot"><a href="ChartParser.html#logSize"><span class="hs-identifier hs-type">logSize</span></a></span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="ChartParser.html#TChart"><span class="hs-identifier hs-type">TChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481561"><span class="hs-identifier hs-type">tr1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481562"><span class="hs-identifier hs-type">slc1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481563"><span class="hs-identifier hs-type">v1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#VChart"><span class="hs-identifier hs-type">VChart</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481564"><span class="hs-identifier hs-type">tr2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481565"><span class="hs-identifier hs-type">slc2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481566"><span class="hs-identifier hs-type">h2</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481567"><span class="hs-identifier hs-type">v2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481565"><span class="hs-identifier hs-type">slc2</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span></span><span>
</span><span id="line-729"></span><span id="logSize"><span class="annot"><span class="annottext">logSize :: forall tr1 slc1 v1 tr2 slc2 h2 v2.
TChart tr1 slc1 v1
-&gt; Either (VChart tr2 slc2 h2 v2) [Slice slc2] -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logSize"><span class="hs-identifier hs-var hs-var">logSize</span></a></span></span><span> </span><span id="local-6989586621679483166"><span class="annot"><span class="annottext">TChart tr1 slc1 v1
</span><a href="#local-6989586621679483166"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679483167"><span class="annot"><span class="annottext">Either (VChart tr2 slc2 h2 v2) [Slice slc2]
</span><a href="#local-6989586621679483167"><span class="hs-identifier hs-var">vc</span></a></span></span><span> </span><span id="local-6989586621679483168"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483168"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-730"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parsing level &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483168"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;transitions: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TItem tr1 slc1 v1] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([TItem tr1 slc1 v1] -&gt; Int) -&gt; [TItem tr1 slc1 v1] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TChart tr1 slc1 v1 -&gt; Int -&gt; [TItem tr1 slc1 v1]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr1 slc1 v1
</span><a href="#local-6989586621679483166"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483168"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679483175"><span class="annot"><span class="annottext">nverts :: Int
</span><a href="#local-6989586621679483175"><span class="hs-identifier hs-var hs-var">nverts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (VChart tr2 slc2 h2 v2) [Slice slc2]
</span><a href="#local-6989586621679483167"><span class="hs-identifier hs-var">vc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-733"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679483176"><span class="annot"><span class="annottext">VChart tr2 slc2 h2 v2
</span><a href="#local-6989586621679483176"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Vert tr2 slc2 h2 v2] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">([Vert tr2 slc2 h2 v2] -&gt; Int) -&gt; [Vert tr2 slc2 h2 v2] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VChart tr2 slc2 h2 v2 -&gt; Int -&gt; [Vert tr2 slc2 h2 v2]
forall tr slc h v. VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr2 slc2 h2 v2
</span><a href="#local-6989586621679483176"><span class="hs-identifier hs-var">chart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483168"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-734"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679483177"><span class="annot"><span class="annottext">[Slice slc2]
</span><a href="#local-6989586621679483177"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Slice slc2] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Slice slc2]
</span><a href="#local-6989586621679483177"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-735"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;verts: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483175"><span class="hs-identifier hs-var">nverts</span></a></span><span>
</span><span id="line-736"></span><span>
</span><span id="line-737"></span><span class="annot"><span class="hs-comment">-- | Parse a piece using the 'logSize' logging function.</span></span><span>
</span><span id="line-738"></span><span id="local-6989586621679481576"><span id="local-6989586621679481577"><span id="local-6989586621679481578"><span id="local-6989586621679481579"><span id="local-6989586621679481580"><span id="local-6989586621679481581"><span class="annot"><a href="ChartParser.html#parseSize"><span class="hs-identifier hs-type">parseSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481576"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481577"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481578"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481579"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481576"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481580"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481577"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481581"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481578"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481579"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481581"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481580"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679481579"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-739"></span><span id="parseSize"><span class="annot"><span class="annottext">parseSize :: forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parseSize"><span class="hs-identifier hs-var hs-var">parseSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v
 -&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ()
forall tr1 slc1 v1 tr2 slc2 h2 v2.
TChart tr1 slc1 v1
-&gt; Either (VChart tr2 slc2 h2 v2) [Slice slc2] -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logSize"><span class="hs-identifier hs-var">logSize</span></a></span><span>
</span><span id="line-740"></span><span>
</span><span id="line-741"></span><span class="annot"><span class="hs-comment">-- | A logging function that does nothing.</span></span><span>
</span><span id="line-742"></span><span id="local-6989586621679481588"><span id="local-6989586621679481589"><span id="local-6989586621679481590"><span id="local-6989586621679481591"><span class="annot"><a href="ChartParser.html#logNone"><span class="hs-identifier hs-type">logNone</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679481588"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481589"><span class="hs-identifier hs-type">p1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481590"><span class="hs-identifier hs-type">p2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481591"><span class="hs-identifier hs-type">p3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679481588"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-743"></span><span id="logNone"><span class="annot"><span class="annottext">logNone :: forall (f :: * -&gt; *) p1 p2 p3.
Applicative f =&gt;
p1 -&gt; p2 -&gt; p3 -&gt; f ()
</span><a href="ChartParser.html#logNone"><span class="hs-identifier hs-var hs-var">logNone</span></a></span></span><span> </span><span class="annot"><span class="annottext">p1
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p2
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">p3
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-744"></span><span>
</span><span id="line-745"></span><span class="annot"><span class="hs-comment">-- | Parse a piece without logging.</span></span><span>
</span><span id="line-746"></span><span id="local-6989586621679483183"><span id="local-6989586621679483184"><span id="local-6989586621679483185"><span id="local-6989586621679483186"><span id="local-6989586621679483187"><span id="local-6989586621679483188"><span class="annot"><a href="ChartParser.html#parseSilent"><span class="hs-identifier hs-type">parseSilent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Parsable"><span class="hs-identifier hs-type">Parsable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483183"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483184"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483185"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483186"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Common.html#Eval"><span class="hs-identifier hs-type">Eval</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483183"><span class="hs-identifier hs-type">tr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483187"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483184"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483188"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483185"><span class="hs-identifier hs-type">h</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483186"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Common.html#Path"><span class="hs-identifier hs-type">Path</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483188"><span class="hs-identifier hs-type">slc'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679483187"><span class="hs-identifier hs-type">tr'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679483186"><span class="hs-identifier hs-type">v</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-747"></span><span id="parseSilent"><span class="annot"><span class="annottext">parseSilent :: forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parseSilent"><span class="hs-identifier hs-var hs-var">parseSilent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TChart tr slc v
 -&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
forall tr slc h v tr' slc'.
Parsable tr slc h v =&gt;
(TChart tr slc v
 -&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ())
-&gt; Eval tr tr' slc slc' h v -&gt; Path slc' tr' -&gt; IO v
</span><a href="ChartParser.html#parse"><span class="hs-identifier hs-var">parse</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
-&gt; Either (VChart tr slc h v) [Slice slc] -&gt; Int -&gt; IO ()
forall (f :: * -&gt; *) p1 p2 p3.
Applicative f =&gt;
p1 -&gt; p2 -&gt; p3 -&gt; f ()
</span><a href="ChartParser.html#logNone"><span class="hs-identifier hs-var">logNone</span></a></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span class="hs-comment">-- fancier logging</span><span>
</span><span id="line-750"></span><span class="hs-comment">-- ---------------</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span class="annot"><span class="hs-comment">-- | Generate TikZ code for a slice.</span></span><span>
</span><span id="line-753"></span><span id="local-6989586621679481602"><span class="annot"><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-type">printTikzSlice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679481602"><span class="hs-identifier hs-type">slc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679481602"><span class="hs-identifier hs-type">slc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-754"></span><span id="printTikzSlice"><span class="annot"><span class="annottext">printTikzSlice :: forall slc. Show slc =&gt; Slice slc -&gt; IO ()
</span><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-var hs-var">printTikzSlice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679483217"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483217"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679483218"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679483218"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621679483219"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483219"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span id="local-6989586621679483220"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483220"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-755"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice,align=center] (slice&quot;</span></span><span>
</span><span id="line-757"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483219"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-758"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-759"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483217"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483220"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span class="hs-special">)</span><span>
</span><span id="line-760"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,0) {&quot;</span></span><span>
</span><span id="line-761"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Common.html#showTex"><span class="hs-identifier hs-var">showTex</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679483218"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-762"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\\\ &quot;</span></span><span>
</span><span id="line-763"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483219"><span class="hs-identifier hs-var">sid</span></a></span><span>
</span><span id="line-764"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span class="annot"><span class="hs-comment">-- | Generate TikZ code for a verticalization.</span></span><span>
</span><span id="line-767"></span><span id="printTikzVert"><span class="annot"><span class="annottext">printTikzVert :: IntMap a -&gt; Vert tr slc h v -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzVert"><span class="hs-identifier hs-var hs-var">printTikzVert</span></a></span></span><span> </span><span id="local-6989586621679483251"><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483251"><span class="hs-identifier hs-var">neighbors</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Vert"><span class="hs-identifier hs-type">Vert</span></a></span><span> </span><span id="local-6989586621679483252"><span class="annot"><span class="annottext">top :: Slice slc
</span><a href="#local-6989586621679483252"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Slice"><span class="hs-identifier hs-type">Slice</span></a></span><span> </span><span id="local-6989586621679483253"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483253"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679483254"><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679483254"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679483255"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483255"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679483256"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483256"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">h
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679483257"><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483257"><span class="hs-identifier hs-var">middle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679483259"><span class="annot"><span class="annottext">index :: Int
</span><a href="#local-6989586621679483259"><span class="hs-identifier hs-var hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483253"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483256"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-769"></span><span>      </span><span id="local-6989586621679483266"><span class="annot"><span class="annottext">xpos :: Double
</span><a href="#local-6989586621679483266"><span class="hs-identifier hs-var hs-var hs-var">xpos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483253"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483256"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span>
</span><span id="line-770"></span><span>      </span><span id="local-6989586621679483268"><span class="annot"><span class="annottext">ypos :: a
</span><a href="#local-6989586621679483268"><span class="hs-identifier hs-var hs-var hs-var">ypos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; IntMap a -&gt; a
forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483259"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483251"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-771"></span><span>      </span><span id="local-6989586621679483272"><span class="annot"><span class="annottext">neighbors' :: IntMap a
</span><a href="#local-6989586621679483272"><span class="hs-identifier hs-var hs-var hs-var">neighbors'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-772"></span><span>        </span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.alter</span></span><span>
</span><span id="line-773"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-774"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679483274"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483274"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483274"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>              </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-776"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483259"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-778"></span><span>          </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483251"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-779"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-780"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice,align=center] (slice&quot;</span></span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483255"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-782"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) at (&quot;</span></span><span>
</span><span id="line-783"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679483266"><span class="hs-identifier hs-var">xpos</span></a></span><span>
</span><span id="line-784"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span>
</span><span id="line-785"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483268"><span class="hs-identifier hs-var">ypos</span></a></span><span>
</span><span id="line-786"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) {&quot;</span></span><span>
</span><span id="line-787"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">StartStop slc -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Common.html#showTex"><span class="hs-identifier hs-var">showTex</span></a></span><span> </span><span class="annot"><span class="annottext">StartStop slc
</span><a href="#local-6989586621679483254"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-788"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\\\ (&quot;</span></span><span>
</span><span id="line-789"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">(Slice slc -&gt; Int) -&gt; Slice slc -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tLeftSlice"><span class="hs-identifier hs-var">tLeftSlice</span></a></span><span> </span><span class="annot"><span class="annottext">(Transition tr slc -&gt; Slice slc) -&gt; Transition tr slc -&gt; Slice slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483257"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) - &quot;</span></span><span>
</span><span id="line-791"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483255"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-792"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; - (&quot;</span></span><span>
</span><span id="line-793"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">(Slice slc -&gt; Int) -&gt; Slice slc -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc -&gt; Slice slc
forall tr slc. Transition tr slc -&gt; Slice slc
</span><a href="ChartParser.html#tRightSlice"><span class="hs-identifier hs-var">tRightSlice</span></a></span><span> </span><span class="annot"><span class="annottext">(Transition tr slc -&gt; Slice slc) -&gt; Transition tr slc -&gt; Slice slc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">TItem tr slc v
</span><a href="#local-6989586621679483257"><span class="hs-identifier hs-var">middle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)};&quot;</span></span><span>
</span><span id="line-795"></span><span>  </span><span class="annot"><span class="annottext">IntMap a -&gt; IO (IntMap a)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483272"><span class="hs-identifier hs-var">neighbors'</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="annot"><span class="hs-comment">-- | Generate TikZ code for a transition.</span></span><span>
</span><span id="line-798"></span><span id="printTikzTrans"><span class="annot"><span class="annottext">printTikzTrans :: IntMap a -&gt; Transition tr slc -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzTrans"><span class="hs-identifier hs-var hs-var">printTikzTrans</span></a></span></span><span> </span><span id="local-6989586621679483307"><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483307"><span class="hs-identifier hs-var">neighbors</span></a></span></span><span> </span><span id="local-6989586621679483308"><span class="annot"><span class="annottext">t :: Transition tr slc
</span><a href="#local-6989586621679483308"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="ChartParser.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span id="local-6989586621679483309"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483309"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span id="local-6989586621679483310"><span class="annot"><span class="annottext">tr
</span><a href="#local-6989586621679483310"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679483311"><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483311"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-799"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679483318"><span class="annot"><span class="annottext">tid :: String
</span><a href="#local-6989586621679483318"><span class="hs-identifier hs-var hs-var hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Transition tr slc -&gt; Int
forall a. Hashable a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">hash</span></span><span> </span><span class="annot"><span class="annottext">Transition tr slc
</span><a href="#local-6989586621679483308"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>      </span><span id="local-6989586621679483320"><span class="annot"><span class="annottext">index :: Int
</span><a href="#local-6989586621679483320"><span class="hs-identifier hs-var hs-var hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sFirst"><span class="hs-identifier hs-var">sFirst</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483309"><span class="hs-identifier hs-var">sl</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sLast"><span class="hs-identifier hs-var">sLast</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483311"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-801"></span><span>      </span><span id="local-6989586621679483326"><span class="annot"><span class="annottext">xpos :: Double
</span><a href="#local-6989586621679483326"><span class="hs-identifier hs-var hs-var hs-var">xpos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483320"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Double
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">2.0</span></span><span>
</span><span id="line-802"></span><span>      </span><span id="local-6989586621679483328"><span class="annot"><span class="annottext">ypos :: a
</span><a href="#local-6989586621679483328"><span class="hs-identifier hs-var hs-var hs-var">ypos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Int -&gt; IntMap a -&gt; a
forall a. a -&gt; Int -&gt; IntMap a -&gt; a
</span><span class="hs-identifier hs-var">IM.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483320"><span class="hs-identifier hs-var">index</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483307"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span id="local-6989586621679483332"><span class="annot"><span class="annottext">neighbors' :: IntMap a
</span><a href="#local-6989586621679483332"><span class="hs-identifier hs-var hs-var hs-var">neighbors'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-804"></span><span>        </span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span><span class="hs-identifier hs-var">IM.alter</span></span><span>
</span><span id="line-805"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-806"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679483333"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483333"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483333"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>              </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-808"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483320"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-810"></span><span>          </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483307"><span class="hs-identifier hs-var">neighbors</span></a></span><span>
</span><span id="line-811"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  \\begin{scope}[xshift=&quot;</span></span><span>
</span><span id="line-813"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679483326"><span class="hs-identifier hs-var">xpos</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cm,yshift=&quot;</span></span><span>
</span><span id="line-815"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679483328"><span class="hs-identifier hs-var">ypos</span></a></span><span>
</span><span id="line-816"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cm]&quot;</span></span><span>
</span><span id="line-817"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-818"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice] (&quot;</span></span><span>
</span><span id="line-819"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679483318"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-820"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;left) at (-0.1,0) {&quot;</span></span><span>
</span><span id="line-821"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483309"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-823"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-824"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\node[slice] (&quot;</span></span><span>
</span><span id="line-825"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679483318"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-826"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;right) at (0.1,0) {&quot;</span></span><span>
</span><span id="line-827"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slice slc -&gt; Int
forall slc. Slice slc -&gt; Int
</span><a href="ChartParser.html#sID"><span class="hs-identifier hs-var">sID</span></a></span><span> </span><span class="annot"><span class="annottext">Slice slc
</span><a href="#local-6989586621679483311"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;};&quot;</span></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-comment">-- printTikzSlice sl (tid &lt;&gt; &quot;left&quot;)  &quot;(-0.2,0)&quot;</span><span>
</span><span id="line-830"></span><span>  </span><span class="hs-comment">-- printTikzSlice sr (tid &lt;&gt; &quot;right&quot;) &quot;(0.2,0)&quot;</span><span>
</span><span id="line-831"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-832"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    \\draw[transition] (&quot;</span></span><span>
</span><span id="line-833"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679483318"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-834"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;left) -- (&quot;</span></span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679483318"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-836"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;right);&quot;</span></span><span>
</span><span id="line-837"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  \\end{scope}&quot;</span></span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><span class="annottext">IntMap a -&gt; IO (IntMap a)
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">IntMap a
</span><a href="#local-6989586621679483332"><span class="hs-identifier hs-var">neighbors'</span></a></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="annot"><span class="hs-comment">-- | A logging function that emits the state of the chart in TikZ code at every level.</span></span><span>
</span><span id="line-841"></span><span id="logTikz"><span class="annot"><span class="annottext">logTikz :: TChart tr slc v
-&gt; Either (VChart tr slc h v) (t (Slice slc)) -&gt; Int -&gt; IO ()
</span><a href="ChartParser.html#logTikz"><span class="hs-identifier hs-var hs-var">logTikz</span></a></span></span><span> </span><span id="local-6989586621679483372"><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483372"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679483373"><span class="annot"><span class="annottext">Either (VChart tr slc h v) (t (Slice slc))
</span><a href="#local-6989586621679483373"><span class="hs-identifier hs-var">vc</span></a></span></span><span> </span><span id="local-6989586621679483374"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-842"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n% level &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679483383"><span class="annot"><span class="annottext">rel :: String
</span><a href="#local-6989586621679483383"><span class="hs-identifier hs-var hs-var hs-var">rel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-844"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-845"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-846"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,shift={($(0,0 |- scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.north)+(0,1cm)$)}&quot;</span></span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\begin{scope}[local bounding box=scope&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679483383"><span class="hs-identifier hs-var">rel</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  % verticalizations:&quot;</span></span><span>
</span><span id="line-849"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (VChart tr slc h v) (t (Slice slc))
</span><a href="#local-6989586621679483373"><span class="hs-identifier hs-var">vc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-850"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679483384"><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679483384"><span class="hs-identifier hs-var">chart</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(IntMap Integer -&gt; Vert tr slc h v -&gt; IO (IntMap Integer))
-&gt; IntMap Integer -&gt; [Vert tr slc h v] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="annot"><span class="annottext">IntMap Integer -&gt; Vert tr slc h v -&gt; IO (IntMap Integer)
forall {a} {slc} {tr} {h} {v}.
(Show a, Show slc, Num a) =&gt;
IntMap a -&gt; Vert tr slc h v -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzVert"><span class="hs-identifier hs-var">printTikzVert</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Integer
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">([Vert tr slc h v] -&gt; IO ()) -&gt; [Vert tr slc h v] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
forall tr slc h v. VChart tr slc h v -&gt; Int -&gt; [Vert tr slc h v]
</span><a href="ChartParser.html#vcGetByLength"><span class="hs-identifier hs-var">vcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">VChart tr slc h v
</span><a href="#local-6989586621679483384"><span class="hs-identifier hs-var">chart</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679483385"><span class="annot"><span class="annottext">t (Slice slc)
</span><a href="#local-6989586621679483385"><span class="hs-identifier hs-var">lst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Slice slc -&gt; IO ()) -&gt; t (Slice slc) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">Slice slc -&gt; IO ()
forall slc. Show slc =&gt; Slice slc -&gt; IO ()
</span><a href="ChartParser.html#printTikzSlice"><span class="hs-identifier hs-var">printTikzSlice</span></a></span><span> </span><span class="annot"><span class="annottext">t (Slice slc)
</span><a href="#local-6989586621679483385"><span class="hs-identifier hs-var">lst</span></a></span><span>
</span><span id="line-852"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n  % transitions:&quot;</span></span><span>
</span><span id="line-853"></span><span>  </span><span class="annot"><span class="annottext">(IntMap Integer -&gt; Transition tr slc -&gt; IO (IntMap Integer))
-&gt; IntMap Integer -&gt; [Transition tr slc] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">foldM_</span></span><span> </span><span class="annot"><span class="annottext">IntMap Integer -&gt; Transition tr slc -&gt; IO (IntMap Integer)
forall {a} {tr} {slc}.
(Show a, Num a, Hashable tr, Eq slc) =&gt;
IntMap a -&gt; Transition tr slc -&gt; IO (IntMap a)
</span><a href="ChartParser.html#printTikzTrans"><span class="hs-identifier hs-var">printTikzTrans</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Integer
forall a. IntMap a
</span><span class="hs-identifier hs-var">IM.empty</span></span><span> </span><span class="annot"><span class="annottext">([Transition tr slc] -&gt; IO ()) -&gt; [Transition tr slc] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Item (Transition tr slc) v -&gt; Transition tr slc
forall i v. Item i v -&gt; i
</span><a href="ChartParser.html#iItem"><span class="hs-identifier hs-var">iItem</span></a></span><span> </span><span class="annot"><span class="annottext">(Item (Transition tr slc) v -&gt; Transition tr slc)
-&gt; [Item (Transition tr slc) v] -&gt; [Transition tr slc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v -&gt; Int -&gt; [Item (Transition tr slc) v]
forall tr slc v. TChart tr slc v -&gt; Int -&gt; [TItem tr slc v]
</span><a href="ChartParser.html#tcGetByLength"><span class="hs-identifier hs-var">tcGetByLength</span></a></span><span> </span><span class="annot"><span class="annottext">TChart tr slc v
</span><a href="#local-6989586621679483372"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679483374"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-854"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\\end{scope}&quot;</span></span><span>
</span><span id="line-855"></span></pre></body></html>