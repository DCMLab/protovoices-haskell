<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">-- | Asynchronous communication between pipes</span></span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP, RankNTypes, Safe #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html"><span class="hs-identifier">Pipes.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Inputs and Outputs</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier">Input</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier">Output</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Pipe utilities</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#fromInput"><span class="hs-identifier">fromInput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#toOutput"><span class="hs-identifier">toOutput</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Mailboxes</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier">Mailbox</span></a></span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#fromMailbox"><span class="hs-identifier">fromMailbox</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#toMailbox"><span class="hs-identifier">toMailbox</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#send%27"><span class="hs-identifier">send'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#recv%27"><span class="hs-identifier">recv'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Actors</span></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#spawn"><span class="hs-identifier">spawn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier">spawn'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#withSpawn"><span class="hs-identifier">withSpawn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#withBuffer"><span class="hs-identifier">withBuffer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier">Buffer</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#unbounded"><span class="hs-identifier">unbounded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#bounded"><span class="hs-identifier">bounded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#latest"><span class="hs-identifier">latest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><a href="Pipes.Concurrent.html#newest"><span class="hs-identifier">newest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- $reexport</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><span class="hs-identifier">System.Mem</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="hs-identifier">Alternative</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Applicative</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pure</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(*&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;*&gt;)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;*)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;$&gt;)</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forkIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">STM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkWeakTVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTVar</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">bracket</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadPlus</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Contravariant</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Contravariant</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">contramap</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Contravariant.Divisible</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="hs-identifier">Divisible</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">divide</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">conquer</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Decidable</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lose</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">choose</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Monoid</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mempty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mappend</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">absurd</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Pipes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">liftIO</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">yield</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">await</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Producer'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Consumer'</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">read</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Mem</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">performGC</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Async</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span>   </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><span class="hs-comment">{-| An exhaustible source of values

    'recv' returns 'Nothing' if the source is exhausted
-}</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">newtype</span><span> </span><span id="Input"><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span> </span><span id="local-6989586621679064229"><span class="annot"><a href="#local-6989586621679064229"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Input"><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-64"></span><span>    </span><span id="recv"><span class="annot"><span class="annottext">forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var hs-var">recv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679064229"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064498"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679064506"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Input a -&gt; Input b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679064507"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679064507"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679064508"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064508"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe b) -&gt; Input b
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe a -&gt; Maybe b) -&gt; STM (Maybe a) -&gt; STM (Maybe b)
forall a b. (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679064507"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064508"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064514"><span id="local-6989586621679064518"><span id="local-6989586621679064521"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-70"></span><span>    </span><span id="local-6989586621679064528"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Input a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621679064529"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064529"><span class="hs-identifier hs-var">r</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; Input a
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; STM (Maybe a)
forall a. a -&gt; STM a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064529"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679064533"><span class="annot"><span class="annottext">Input (a -&gt; b)
</span><a href="#local-6989586621679064533"><span class="hs-identifier hs-var">mf</span></a></span></span><span> </span><span id="local-6989586621679064534"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Input (a -&gt; b) -&gt; Input a -&gt; Input b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span id="local-6989586621679064535"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064535"><span class="hs-identifier hs-var">mx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe b) -&gt; Input b
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall a b. Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">(&lt;*&gt;)</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (a -&gt; b) -&gt; Maybe a -&gt; Maybe b)
-&gt; STM (Maybe (a -&gt; b)) -&gt; STM (Maybe a -&gt; Maybe b)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Input (a -&gt; b) -&gt; STM (Maybe (a -&gt; b))
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input (a -&gt; b)
</span><a href="#local-6989586621679064533"><span class="hs-identifier hs-var">mf</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Maybe a -&gt; Maybe b) -&gt; STM (Maybe a) -&gt; STM (Maybe b)
forall a b. STM (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064535"><span class="hs-identifier hs-var">mx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064540"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679064549"><span class="annot"><span class="annottext">return :: forall a. a -&gt; Input a
</span><span class="hs-identifier hs-var hs-var hs-var">return</span></span></span><span> </span><span id="local-6989586621679064550"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064550"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; Input a
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; STM (Maybe a)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064550"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>    </span><span id="local-6989586621679064553"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064553"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679064554"><span class="annot"><span class="annottext">&gt;&gt;= :: forall a b. Input a -&gt; (a -&gt; Input b) -&gt; Input b
</span><span class="hs-operator hs-var hs-var hs-var">&gt;&gt;=</span></span></span><span> </span><span id="local-6989586621679064555"><span class="annot"><span class="annottext">a -&gt; Input b
</span><a href="#local-6989586621679064555"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe b) -&gt; Input b
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe b) -&gt; Input b) -&gt; STM (Maybe b) -&gt; Input b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>        </span><span id="local-6989586621679064556"><span class="annot"><a href="#local-6989586621679064556"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064553"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679064556"><span class="hs-identifier hs-type">ma</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-78"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe b -&gt; STM (Maybe b)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe b
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-79"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679064557"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064557"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Input b -&gt; STM (Maybe b)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Input b
</span><a href="#local-6989586621679064555"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064557"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064563"><span id="local-6989586621679064567"><span class="annot"><span class="hs-identifier hs-type">Alternative</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679064571"><span class="annot"><span class="annottext">empty :: forall a. Input a
</span><span class="hs-identifier hs-var hs-var hs-var">empty</span></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; Input a
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a -&gt; STM (Maybe a)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span id="local-6989586621679064578"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064578"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679064579"><span class="annot"><span class="annottext">&lt;|&gt; :: forall a. Input a -&gt; Input a -&gt; Input a
</span><span class="hs-operator hs-var hs-var hs-var">&lt;|&gt;</span></span></span><span> </span><span id="local-6989586621679064580"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064580"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; Input a
forall a. STM (Maybe a) -&gt; Input a
</span><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-var">Input</span></a></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe a) -&gt; Input a) -&gt; STM (Maybe a) -&gt; Input a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679064581"><span class="annot"><a href="#local-6989586621679064581"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064582"><span class="annot"><a href="#local-6989586621679064582"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; (Input a, Maybe a))
-&gt; STM (Maybe a) -&gt; STM (Input a, Maybe a)
forall a b. (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064580"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064578"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STM (Input a, Maybe a)
-&gt; STM (Input a, Maybe a) -&gt; STM (Input a, Maybe a)
forall a. STM a -&gt; STM a -&gt; STM a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe a -&gt; (Input a, Maybe a))
-&gt; STM (Maybe a) -&gt; STM (Input a, Maybe a)
forall a b. (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064578"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064580"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679064582"><span class="hs-identifier hs-type">ma</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-86"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064581"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-87"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679064583"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064583"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; STM (Maybe a)
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064583"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadPlus</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-90"></span><span>    </span><span id="local-6989586621679064593"><span class="annot"><span class="annottext">mzero :: forall a. Input a
</span><a href="#local-6989586621679064593"><span class="hs-identifier hs-var hs-var hs-var">mzero</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a
forall a. Input a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679064596"><span class="annot"><span class="annottext">mplus :: forall a. Input a -&gt; Input a -&gt; Input a
</span><a href="#local-6989586621679064596"><span class="hs-identifier hs-var hs-var hs-var">mplus</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; Input a -&gt; Input a
forall a. Input a -&gt; Input a -&gt; Input a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">(&lt;|&gt;)</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064289"><span id="local-6989586621679064600"><span id="local-6989586621679064604"><span class="annot"><span class="hs-identifier hs-type">Data.Semigroup.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>    </span><span id="local-6989586621679064610"><span class="annot"><span class="annottext">&lt;&gt; :: Input a -&gt; Input a -&gt; Input a
</span><span class="hs-operator hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; Input a -&gt; Input a
forall a. Input a -&gt; Input a -&gt; Input a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">(&lt;|&gt;)</span></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064292"><span id="local-6989586621679064615"><span id="local-6989586621679064619"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064292"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679064623"><span class="annot"><span class="annottext">mempty :: Input a
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a
forall a. Input a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a
</span><span class="hs-identifier hs-var">empty</span></span><span class="hs-cpp">

#if !(MIN_VERSION_base(4,11,0))
</span><span>    </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-103"></span><span class="annot"><span class="hs-comment">{-| An exhaustible sink of values

    'send' returns 'False' if the sink is exhausted
-}</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">newtype</span><span> </span><span id="Output"><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span></span><span> </span><span id="local-6989586621679064293"><span class="annot"><a href="#local-6989586621679064293"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Output"><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-108"></span><span>    </span><span id="send"><span class="annot"><span class="annottext">forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var hs-var">send</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679064293"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.STM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064298"><span id="local-6989586621679064628"><span id="local-6989586621679064632"><span class="annot"><span class="hs-identifier hs-type">Data.Semigroup.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064298"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679064638"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064638"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span id="local-6989586621679064639"><span class="annot"><span class="annottext">&lt;&gt; :: Output a -&gt; Output a -&gt; Output a
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621679064640"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064640"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679064641"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064641"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(||)</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; STM Bool -&gt; STM (Bool -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Output a -&gt; a -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064638"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064641"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Bool -&gt; Bool) -&gt; STM Bool -&gt; STM Bool
forall a b. STM (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Output a -&gt; a -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064640"><span class="hs-identifier hs-var">i2</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064641"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064300"><span id="local-6989586621679064647"><span id="local-6989586621679064651"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064300"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-114"></span><span>    </span><span id="local-6989586621679064654"><span class="annot"><span class="annottext">mempty :: Output a
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-cpp">

#if !(MIN_VERSION_base(4,11,0))
</span><span>    </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | This instance is useful for creating new tagged address, similar to elm's</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- Signal.forwardTo. In fact elm's forwardTo is just 'flip contramap'</span><span>
</span><span id="line-122"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679064657"><span class="annot"><span class="hs-identifier hs-type">Contravariant</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679064661"><span class="annot"><span class="annottext">contramap :: forall a' a. (a' -&gt; a) -&gt; Output a -&gt; Output a'
</span><span class="hs-identifier hs-var hs-var hs-var">contramap</span></span></span><span> </span><span id="local-6989586621679064662"><span class="annot"><span class="annottext">a' -&gt; a
</span><a href="#local-6989586621679064662"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span id="local-6989586621679064663"><span class="annot"><span class="annottext">a -&gt; STM Bool
</span><a href="#local-6989586621679064663"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a' -&gt; STM Bool) -&gt; Output a'
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; STM Bool
</span><a href="#local-6989586621679064663"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; (a' -&gt; a) -&gt; a' -&gt; STM Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a' -&gt; a
</span><a href="#local-6989586621679064662"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Divisible</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679064672"><span class="annot"><span class="annottext">conquer :: forall a. Output a
</span><span class="hs-identifier hs-var hs-var hs-var">conquer</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; STM Bool
forall a. a -&gt; STM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621679064675"><span class="annot"><span class="annottext">divide :: forall a b c. (a -&gt; (b, c)) -&gt; Output b -&gt; Output c -&gt; Output a
</span><span class="hs-identifier hs-var hs-var hs-var">divide</span></span></span><span> </span><span id="local-6989586621679064676"><span class="annot"><span class="annottext">a -&gt; (b, c)
</span><a href="#local-6989586621679064676"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679064677"><span class="annot"><span class="annottext">Output b
</span><a href="#local-6989586621679064677"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span id="local-6989586621679064678"><span class="annot"><span class="annottext">Output c
</span><a href="#local-6989586621679064678"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; STM Bool) -&gt; Output a) -&gt; (a -&gt; STM Bool) -&gt; Output a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064679"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064679"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; (b, c)
</span><a href="#local-6989586621679064676"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064679"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679064680"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064680"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064681"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(||)</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; STM Bool -&gt; STM (Bool -&gt; Bool)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Output b -&gt; b -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output b
</span><a href="#local-6989586621679064677"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064680"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Bool -&gt; Bool) -&gt; STM Bool -&gt; STM Bool
forall a b. STM (a -&gt; b) -&gt; STM a -&gt; STM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Output c -&gt; c -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output c
</span><a href="#local-6989586621679064678"><span class="hs-identifier hs-var">i2</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679064681"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Decidable</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679064688"><span class="annot"><span class="annottext">lose :: forall a. (a -&gt; Void) -&gt; Output a
</span><span class="hs-identifier hs-var hs-var hs-var">lose</span></span></span><span> </span><span id="local-6989586621679064689"><span class="annot"><span class="annottext">a -&gt; Void
</span><a href="#local-6989586621679064689"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Void -&gt; STM Bool
forall a. Void -&gt; a
</span><span class="hs-identifier hs-var">absurd</span></span><span> </span><span class="annot"><span class="annottext">(Void -&gt; STM Bool) -&gt; (a -&gt; Void) -&gt; a -&gt; STM Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Void
</span><a href="#local-6989586621679064689"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679064690"><span class="annot"><span class="annottext">choose :: forall a b c. (a -&gt; Either b c) -&gt; Output b -&gt; Output c -&gt; Output a
</span><span class="hs-identifier hs-var hs-var hs-var">choose</span></span></span><span> </span><span id="local-6989586621679064691"><span class="annot"><span class="annottext">a -&gt; Either b c
</span><a href="#local-6989586621679064691"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679064692"><span class="annot"><span class="annottext">Output b
</span><a href="#local-6989586621679064692"><span class="hs-identifier hs-var">i1</span></a></span></span><span> </span><span id="local-6989586621679064693"><span class="annot"><span class="annottext">Output c
</span><a href="#local-6989586621679064693"><span class="hs-identifier hs-var">i2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; STM Bool) -&gt; Output a
forall a. (a -&gt; STM Bool) -&gt; Output a
</span><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-var">Output</span></a></span><span> </span><span class="annot"><span class="annottext">((a -&gt; STM Bool) -&gt; Output a) -&gt; (a -&gt; STM Bool) -&gt; Output a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679064694"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064694"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either b c
</span><a href="#local-6989586621679064691"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064694"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679064695"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064695"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output b -&gt; b -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output b
</span><a href="#local-6989586621679064692"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064695"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679064696"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679064696"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output c -&gt; c -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">Output c
</span><a href="#local-6989586621679064693"><span class="hs-identifier hs-var">i2</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679064696"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="annot"><span class="hs-comment">{-| Combines a source of values and a sink of values

    'fromMailbox' uses 'Mailbox' as 'Pipes.Producer'
    'toMailbox' uses 'Mailbox' as 'Pipes.Consumer'
    'send\'' puts a value in the 'Mailbox'
    'recv\'' obtains a value from the 'Mailbox'
-}</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">type</span><span> </span><span id="Mailbox"><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier hs-var">Mailbox</span></a></span></span><span> </span><span id="local-6989586621679064697"><span class="annot"><a href="#local-6989586621679064697"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064697"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="annot"><span class="hs-comment">{-| Convert a 'Mailbox' to a 'Pipes.Producer'

    'fromMailbox' terminates when the 'Mailbox' source of values is exhausted.
-}</span></span><span>
</span><span id="line-149"></span><span id="local-6989586621679064333"><span id="local-6989586621679064335"><span class="annot"><a href="Pipes.Concurrent.html#fromMailbox"><span class="hs-identifier hs-type">fromMailbox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064333"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier hs-type">Mailbox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064335"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Producer'</span></span><span> </span><span class="annot"><a href="#local-6989586621679064335"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064333"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-150"></span><span id="fromMailbox"><span class="annot"><span class="annottext">fromMailbox :: forall (m :: * -&gt; *) a. MonadIO m =&gt; Mailbox a -&gt; Producer' a m ()
</span><a href="Pipes.Concurrent.html#fromMailbox"><span class="hs-identifier hs-var hs-var">fromMailbox</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064700"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064700"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; Producer' a m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Input a -&gt; Producer' a m ()
</span><a href="Pipes.Concurrent.html#fromInput"><span class="hs-identifier hs-var">fromInput</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064700"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">{-| Convert a 'Mailbox' to a 'Pipes.Consumer'

    'toMailbox' terminates when the 'Mailbox' sink of values is exhausted.
-}</span></span><span>
</span><span id="line-156"></span><span id="local-6989586621679064345"><span id="local-6989586621679064346"><span class="annot"><a href="Pipes.Concurrent.html#toMailbox"><span class="hs-identifier hs-type">toMailbox</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064345"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier hs-type">Mailbox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064346"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Consumer'</span></span><span> </span><span class="annot"><a href="#local-6989586621679064346"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064345"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-157"></span><span id="toMailbox"><span class="annot"><span class="annottext">toMailbox :: forall (m :: * -&gt; *) a. MonadIO m =&gt; Mailbox a -&gt; Consumer' a m ()
</span><a href="Pipes.Concurrent.html#toMailbox"><span class="hs-identifier hs-var hs-var">toMailbox</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679064703"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Output a -&gt; Consumer' a m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; Output a -&gt; Consumer' a m ()
</span><a href="Pipes.Concurrent.html#toOutput"><span class="hs-identifier hs-var">toOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064703"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><span class="hs-comment">{-| Put a value in a 'Mailbox'

    'send' returns 'False' if the 'Mailbox' sink is exhausted
-}</span></span><span>
</span><span id="line-163"></span><span id="local-6989586621679064354"><span class="annot"><a href="Pipes.Concurrent.html#send%27"><span class="hs-identifier hs-type">send'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier hs-type">Mailbox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064354"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679064354"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-164"></span><span id="send%27"><span class="annot"><span class="annottext">send' :: forall a. Mailbox a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send%27"><span class="hs-identifier hs-var hs-var">send'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Output a -&gt; a -&gt; STM Bool
forall a. Output a -&gt; a -&gt; STM Bool
</span><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">(Output a -&gt; a -&gt; STM Bool)
-&gt; (Mailbox a -&gt; Output a) -&gt; Mailbox a -&gt; a -&gt; STM Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Mailbox a -&gt; Output a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="annot"><span class="hs-comment">{-| Obtain a value from a 'Mailbox'

    'recv' returns 'Nothing' if the 'Mailbox' source is exhausted
-}</span></span><span>
</span><span id="line-170"></span><span id="local-6989586621679064358"><span class="annot"><a href="Pipes.Concurrent.html#recv%27"><span class="hs-identifier hs-type">recv'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Mailbox"><span class="hs-identifier hs-type">Mailbox</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064358"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679064358"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-171"></span><span id="recv%27"><span class="annot"><span class="annottext">recv' :: forall a. Mailbox a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv%27"><span class="hs-identifier hs-var hs-var">recv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">(Input a -&gt; STM (Maybe a))
-&gt; (Mailbox a -&gt; Input a) -&gt; Mailbox a -&gt; STM (Maybe a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Mailbox a -&gt; Input a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><span class="hs-comment">{-| Convert an 'Output' to a 'Pipes.Consumer'

    'toOutput' terminates when the 'Output' is exhausted.
-}</span></span><span>
</span><span id="line-177"></span><span id="local-6989586621679064352"><span id="local-6989586621679064353"><span class="annot"><a href="Pipes.Concurrent.html#toOutput"><span class="hs-identifier hs-type">toOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064352"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064353"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Consumer'</span></span><span> </span><span class="annot"><a href="#local-6989586621679064353"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064352"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-178"></span><span id="toOutput"><span class="annot"><span class="annottext">toOutput :: forall (m :: * -&gt; *) a. MonadIO m =&gt; Output a -&gt; Consumer' a m ()
</span><a href="Pipes.Concurrent.html#toOutput"><span class="hs-identifier hs-var hs-var">toOutput</span></a></span></span><span> </span><span id="local-6989586621679064713"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064713"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy () a y' y m ()
forall {y'} {y}. Proxy () a y' y m ()
</span><a href="#local-6989586621679064714"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679064714"><span class="annot"><span class="annottext">loop :: Proxy () a y' y m ()
</span><a href="#local-6989586621679064714"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>        </span><span id="local-6989586621679064728"><span class="annot"><a href="#local-6989586621679064728"><span class="hs-identifier hs-var">a</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Proxy () a y' y m a
Consumer' a m a
forall (m :: * -&gt; *) a. Functor m =&gt; Consumer' a m a
</span><span class="hs-identifier hs-var">await</span></span><span>
</span><span id="line-182"></span><span>        </span><span id="local-6989586621679064729"><span class="annot"><a href="#local-6989586621679064729"><span class="hs-identifier hs-var">alive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">liftIO</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.atomically</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064713"><span class="hs-identifier hs-type">output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064728"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">when</span></span><span> </span><span class="annot"><a href="#local-6989586621679064729"><span class="hs-identifier hs-type">alive</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064714"><span class="hs-identifier hs-type">loop</span></a></span><span>
</span><span id="line-184"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#toOutput"><span class="hs-pragma hs-type">toOutput</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="annot"><span class="hs-comment">{-| Convert an 'Input' to a 'Pipes.Producer'

    'fromInput' terminates when the 'Input' is exhausted.
-}</span></span><span>
</span><span id="line-190"></span><span id="local-6989586621679064343"><span id="local-6989586621679064344"><span class="annot"><a href="Pipes.Concurrent.html#fromInput"><span class="hs-identifier hs-type">fromInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064343"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Producer'</span></span><span> </span><span class="annot"><a href="#local-6989586621679064344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064343"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-191"></span><span id="fromInput"><span class="annot"><span class="annottext">fromInput :: forall (m :: * -&gt; *) a. MonadIO m =&gt; Input a -&gt; Producer' a m ()
</span><a href="Pipes.Concurrent.html#fromInput"><span class="hs-identifier hs-var hs-var">fromInput</span></a></span></span><span> </span><span id="local-6989586621679064734"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064734"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy x' x () a m ()
forall {x'} {x}. Proxy x' x () a m ()
</span><a href="#local-6989586621679064735"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679064735"><span class="annot"><span class="annottext">loop :: Proxy x' x () a m ()
</span><a href="#local-6989586621679064735"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>        </span><span id="local-6989586621679064746"><span class="annot"><a href="#local-6989586621679064746"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe a) -&gt; Proxy x' x () a m (Maybe a)
forall a. IO a -&gt; Proxy x' x () a m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe a) -&gt; Proxy x' x () a m (Maybe a))
-&gt; IO (Maybe a) -&gt; Proxy x' x () a m (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; IO (Maybe a)
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">S.atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM (Maybe a) -&gt; IO (Maybe a)) -&gt; STM (Maybe a) -&gt; IO (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input a -&gt; STM (Maybe a)
forall a. Input a -&gt; STM (Maybe a)
</span><a href="Pipes.Concurrent.html#recv"><span class="hs-identifier hs-var">recv</span></a></span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064734"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679064746"><span class="hs-identifier hs-type">ma</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-196"></span><span>            </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Proxy x' x () a m ()
forall a. a -&gt; Proxy x' x () a m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679064747"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064747"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>                </span><span class="annot"><span class="annottext">a -&gt; Proxy x' x () a m ()
forall (m :: * -&gt; *) a x' x. Functor m =&gt; a -&gt; Proxy x' x () a m ()
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064747"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-199"></span><span>                </span><span class="annot"><span class="annottext">Proxy x' x () a m ()
</span><a href="#local-6989586621679064735"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-200"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#fromInput"><span class="hs-pragma hs-type">fromInput</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span class="annot"><span class="hs-comment">{-| Spawn a mailbox using the specified 'Buffer' to store messages

    Using 'send' on the 'Output'

        * fails and returns 'False' if the mailbox is sealed, otherwise it:

        * retries if the mailbox is full, or:

        * adds a message to the mailbox and returns 'True'.

    Using 'recv' on the 'Input':

        * retrieves a message from the mailbox wrapped in 'Just' if the mailbox
          is not empty, otherwise it:

        * retries if the mailbox is not sealed, or:

        * fails and returns 'Nothing'.

    If either the 'Input' or 'Output' is garbage collected the mailbox will
    become sealed.
-}</span></span><span>
</span><span id="line-224"></span><span id="local-6989586621679064399"><span class="annot"><a href="Pipes.Concurrent.html#spawn"><span class="hs-identifier hs-type">spawn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064399"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064399"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064399"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-225"></span><span id="spawn"><span class="annot"><span class="annottext">spawn :: forall a. Buffer a -&gt; IO (Output a, Input a)
</span><a href="Pipes.Concurrent.html#spawn"><span class="hs-identifier hs-var hs-var">spawn</span></a></span></span><span> </span><span id="local-6989586621679064750"><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064750"><span class="hs-identifier hs-var">buffer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Output a, Input a, STM ()) -&gt; (Output a, Input a))
-&gt; IO (Output a, Input a, STM ()) -&gt; IO (Output a, Input a)
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Output a, Input a, STM ()) -&gt; (Output a, Input a)
forall {a} {b} {c}. (a, b, c) -&gt; (a, b)
</span><a href="#local-6989586621679064751"><span class="hs-identifier hs-var">simplify</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer a -&gt; IO (Output a, Input a, STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064750"><span class="hs-identifier hs-var">buffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>    </span><span id="local-6989586621679064751"><span class="annot"><span class="annottext">simplify :: (a, b, c) -&gt; (a, b)
</span><a href="#local-6989586621679064751"><span class="hs-identifier hs-var hs-var">simplify</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679064752"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064752"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064753"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064753"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064752"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679064753"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#spawn"><span class="hs-pragma hs-type">spawn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><span class="hs-comment">{-| Like 'spawn', but also returns an action to manually @seal@ the mailbox
    early:

&gt; (output, input, seal) &lt;- spawn' buffer
&gt; ...

    Use the @seal@ action to allow early cleanup of readers and writers to the
    mailbox without waiting for the next garbage collection cycle.
-}</span></span><span>
</span><span id="line-239"></span><span id="local-6989586621679064405"><span class="annot"><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier hs-type">spawn'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064405"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064405"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064405"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-240"></span><span id="spawn%27"><span class="annot"><span class="annottext">spawn' :: forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier hs-var hs-var">spawn'</span></a></span></span><span> </span><span id="local-6989586621679064783"><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064783"><span class="hs-identifier hs-var">buffer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679064784"><span class="annot"><a href="#local-6989586621679064784"><span class="hs-identifier hs-var">write</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064785"><span class="annot"><a href="#local-6989586621679064785"><span class="hs-identifier hs-var">read</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064783"><span class="hs-identifier hs-var">buffer</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><a href="Pipes.Concurrent.html#Bounded"><span class="hs-identifier hs-type">Bounded</span></a></span><span> </span><span id="local-6989586621679064787"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064787"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>            </span><span id="local-6989586621679064788"><span class="annot"><a href="#local-6989586621679064788"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; IO (TBQueue a)
forall a. Natural -&gt; IO (TBQueue a)
</span><span class="hs-identifier hs-var">S.newTBQueueIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064787"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.writeTBQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679064788"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.readTBQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679064788"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>        </span><span class="annot"><span class="annottext">Buffer a
</span><a href="Pipes.Concurrent.html#Unbounded"><span class="hs-identifier hs-var">Unbounded</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>            </span><span id="local-6989586621679064793"><span class="annot"><a href="#local-6989586621679064793"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TQueue a)
forall a. IO (TQueue a)
</span><span class="hs-identifier hs-var">S.newTQueueIO</span></span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.writeTQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679064793"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.readTQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679064793"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>        </span><span class="annot"><span class="annottext">Buffer a
</span><a href="Pipes.Concurrent.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>            </span><span id="local-6989586621679064798"><span class="annot"><a href="#local-6989586621679064798"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TMVar a)
forall a. IO (TMVar a)
</span><span class="hs-identifier hs-var">S.newEmptyTMVarIO</span></span><span>
</span><span id="line-250"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.putTMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064798"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.takeTMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064798"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><a href="Pipes.Concurrent.html#Latest"><span class="hs-identifier hs-type">Latest</span></a></span><span> </span><span id="local-6989586621679064803"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064803"><span class="hs-identifier hs-var">a</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>            </span><span id="local-6989586621679064804"><span class="annot"><a href="#local-6989586621679064804"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; IO (TVar a)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">S.newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064803"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.writeTVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064804"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.readTVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064804"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">Buffer a
</span><a href="Pipes.Concurrent.html#New"><span class="hs-identifier hs-var">New</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-255"></span><span>            </span><span id="local-6989586621679064807"><span class="annot"><a href="#local-6989586621679064807"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (TMVar a)
forall a. IO (TMVar a)
</span><span class="hs-identifier hs-var">S.newEmptyTMVarIO</span></span><span>
</span><span id="line-256"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679064808"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064808"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TMVar a -&gt; STM (Maybe a)
forall a. TMVar a -&gt; STM (Maybe a)
</span><span class="hs-identifier hs-var">S.tryTakeTMVar</span></span><span> </span><span class="annot"><span class="annottext">TMVar a
</span><a href="#local-6989586621679064807"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; STM () -&gt; STM ()
forall a b. STM a -&gt; STM b -&gt; STM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">TMVar a -&gt; a -&gt; STM ()
forall a. TMVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">S.putTMVar</span></span><span> </span><span class="annot"><span class="annottext">TMVar a
</span><a href="#local-6989586621679064807"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064808"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.takeTMVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064807"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><a href="Pipes.Concurrent.html#Newest"><span class="hs-identifier hs-type">Newest</span></a></span><span> </span><span id="local-6989586621679064811"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064811"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>            </span><span id="local-6989586621679064812"><span class="annot"><a href="#local-6989586621679064812"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; IO (TBQueue a)
forall a. Natural -&gt; IO (TBQueue a)
</span><span class="hs-identifier hs-var">S.newTBQueueIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064811"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064815"><span class="annot"><a href="#local-6989586621679064815"><span class="hs-identifier hs-var hs-var">write</span></a></span></span><span> </span><span id="local-6989586621679064816"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064816"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TBQueue a -&gt; a -&gt; STM ()
forall a. TBQueue a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">S.writeTBQueue</span></span><span> </span><span class="annot"><span class="annottext">TBQueue a
</span><a href="#local-6989586621679064812"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064816"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; STM () -&gt; STM ()
forall a. STM a -&gt; STM a -&gt; STM a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TBQueue a -&gt; STM (Maybe a)
forall a. TBQueue a -&gt; STM (Maybe a)
</span><span class="hs-identifier hs-var">S.tryReadTBQueue</span></span><span> </span><span class="annot"><span class="annottext">TBQueue a
</span><a href="#local-6989586621679064812"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; STM () -&gt; STM ()
forall a b. STM a -&gt; STM b -&gt; STM b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; STM ()
</span><a href="#local-6989586621679064815"><span class="hs-identifier hs-var">write</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064816"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679064815"><span class="hs-identifier hs-type">write</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.readTBQueue</span></span><span> </span><span class="annot"><a href="#local-6989586621679064812"><span class="hs-identifier hs-type">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679064818"><span class="annot"><a href="#local-6989586621679064818"><span class="hs-identifier hs-var">sealed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">S.newTVarIO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-263"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064819"><span class="annot"><a href="#local-6989586621679064819"><span class="hs-identifier hs-var hs-var">seal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; Bool -&gt; STM ()
forall a. TVar a -&gt; a -&gt; STM ()
</span><span class="hs-identifier hs-var">S.writeTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679064818"><span class="hs-identifier hs-var">sealed</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-comment">{- Use weak TVars to keep track of whether the 'Input' or 'Output' has been
       garbage collected.  Seal the mailbox when either of them becomes garbage
       collected.
    -}</span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679064820"><span class="annot"><a href="#local-6989586621679064820"><span class="hs-identifier hs-var">rSend</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mkWeakTVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064820"><span class="hs-identifier hs-type">rSend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.atomically</span></span><span> </span><span class="annot"><a href="#local-6989586621679064819"><span class="hs-identifier hs-type">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>    </span><span id="local-6989586621679064821"><span class="annot"><a href="#local-6989586621679064821"><span class="hs-identifier hs-var">rRecv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">newTVarIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">void</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mkWeakTVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679064821"><span class="hs-identifier hs-type">rRecv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">S.atomically</span></span><span> </span><span class="annot"><a href="#local-6989586621679064819"><span class="hs-identifier hs-type">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679064826"><span class="annot"><a href="#local-6989586621679064826"><span class="hs-identifier hs-var hs-var">sendOrEnd</span></a></span></span><span> </span><span id="local-6989586621679064827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064827"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-275"></span><span>            </span><span id="local-6989586621679064828"><span class="annot"><a href="#local-6989586621679064828"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; STM Bool
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">S.readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679064818"><span class="hs-identifier hs-var">sealed</span></a></span><span>
</span><span id="line-276"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621679064828"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">False</span></span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>                    </span><span class="annot"><a href="#local-6989586621679064784"><span class="hs-identifier hs-type">write</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064827"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-280"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">True</span></span><span>
</span><span id="line-281"></span><span>        </span><span id="local-6989586621679064834"><span class="annot"><a href="#local-6989586621679064834"><span class="hs-identifier hs-var hs-var">readOrEnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Maybe a) -&gt; STM a -&gt; STM (Maybe a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">STM a
</span><a href="#local-6989586621679064785"><span class="hs-identifier hs-var">read</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; STM (Maybe a) -&gt; STM (Maybe a)
forall a. STM a -&gt; STM a -&gt; STM a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>            </span><span id="local-6989586621679064835"><span class="annot"><a href="#local-6989586621679064835"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Bool -&gt; STM Bool
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">S.readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Bool
</span><a href="#local-6989586621679064818"><span class="hs-identifier hs-var">sealed</span></a></span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">S.check</span></span><span> </span><span class="annot"><a href="#local-6989586621679064835"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621679064838"><span class="annot"><a href="#local-6989586621679064838"><span class="hs-identifier hs-var hs-var">_send</span></a></span></span><span> </span><span id="local-6989586621679064839"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064839"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; STM Bool
</span><a href="#local-6989586621679064826"><span class="hs-identifier hs-var">sendOrEnd</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679064839"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">STM Bool -&gt; STM () -&gt; STM Bool
forall a b. STM a -&gt; STM b -&gt; STM a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">TVar () -&gt; STM ()
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ()
</span><a href="#local-6989586621679064820"><span class="hs-identifier hs-var">rSend</span></a></span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621679064841"><span class="annot"><a href="#local-6989586621679064841"><span class="hs-identifier hs-var hs-var">_recv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">STM (Maybe a)
</span><a href="#local-6989586621679064834"><span class="hs-identifier hs-var">readOrEnd</span></a></span><span>   </span><span class="annot"><span class="annottext">STM (Maybe a) -&gt; STM () -&gt; STM (Maybe a)
forall a b. STM a -&gt; STM b -&gt; STM a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">TVar () -&gt; STM ()
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar ()
</span><a href="#local-6989586621679064821"><span class="hs-identifier hs-var">rRecv</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064838"><span class="hs-identifier hs-type">_send</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064841"><span class="hs-identifier hs-type">_recv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679064819"><span class="hs-identifier hs-type">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-pragma hs-type">spawn'</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><span class="hs-comment">{-| 'withSpawn' passes its enclosed action an 'Output' and 'Input' like you'd get from 'spawn',
    but automatically @seal@s them after the action completes.  This can be used when you need the
    @seal@ing behavior available from 'spawn\'', but want to work at a bit higher level:

&gt; withSpawn buffer $ \(output, input) -&gt; ...

    'withSpawn' is exception-safe, since it uses 'bracket' internally.
-}</span></span><span>
</span><span id="line-298"></span><span id="local-6989586621679064431"><span id="local-6989586621679064432"><span class="annot"><a href="Pipes.Concurrent.html#withSpawn"><span class="hs-identifier hs-type">withSpawn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064431"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064431"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064431"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064432"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064432"><span class="hs-identifier hs-type">r</span></a></span></span></span><span>
</span><span id="line-299"></span><span id="withSpawn"><span class="annot"><span class="annottext">withSpawn :: forall a r. Buffer a -&gt; ((Output a, Input a) -&gt; IO r) -&gt; IO r
</span><a href="Pipes.Concurrent.html#withSpawn"><span class="hs-identifier hs-var hs-var">withSpawn</span></a></span></span><span> </span><span id="local-6989586621679064842"><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064842"><span class="hs-identifier hs-var">buffer</span></a></span></span><span> </span><span id="local-6989586621679064843"><span class="annot"><span class="annottext">(Output a, Input a) -&gt; IO r
</span><a href="#local-6989586621679064843"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Output a, Input a, STM ())
-&gt; ((Output a, Input a, STM ()) -&gt; IO ())
-&gt; ((Output a, Input a, STM ()) -&gt; IO r)
-&gt; IO r
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">bracket</span></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer a -&gt; IO (Output a, Input a, STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064842"><span class="hs-identifier hs-var">buffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064844"><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064844"><span class="hs-identifier hs-var">seal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064844"><span class="hs-identifier hs-var">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679064845"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064845"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064846"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064846"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">STM ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Output a, Input a) -&gt; IO r
</span><a href="#local-6989586621679064843"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064845"><span class="hs-identifier hs-var">output</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064846"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="annot"><span class="hs-comment">-- | A more restrictive alternative to `withSpawn` that prevents deadlocks</span></span><span>
</span><span id="line-305"></span><span id="local-6989586621679064438"><span id="local-6989586621679064439"><span id="local-6989586621679064440"><span class="annot"><a href="Pipes.Concurrent.html#withBuffer"><span class="hs-identifier hs-type">withBuffer</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064439"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Pipes.Concurrent.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621679064438"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679064440"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679064439"><span class="hs-identifier hs-type">l</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679064440"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-310"></span><span id="withBuffer"><span class="annot"><span class="annottext">withBuffer :: forall a l r.
Buffer a -&gt; (Output a -&gt; IO l) -&gt; (Input a -&gt; IO r) -&gt; IO (l, r)
</span><a href="Pipes.Concurrent.html#withBuffer"><span class="hs-identifier hs-var hs-var">withBuffer</span></a></span></span><span> </span><span id="local-6989586621679064847"><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064847"><span class="hs-identifier hs-var">buffer</span></a></span></span><span> </span><span id="local-6989586621679064848"><span class="annot"><span class="annottext">Output a -&gt; IO l
</span><a href="#local-6989586621679064848"><span class="hs-identifier hs-var">fOutput</span></a></span></span><span> </span><span id="local-6989586621679064849"><span class="annot"><span class="annottext">Input a -&gt; IO r
</span><a href="#local-6989586621679064849"><span class="hs-identifier hs-var">fInput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Output a, Input a, STM ())
-&gt; ((Output a, Input a, STM ()) -&gt; IO ())
-&gt; ((Output a, Input a, STM ()) -&gt; IO (l, r))
-&gt; IO (l, r)
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><span class="hs-identifier hs-var">bracket</span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Buffer a -&gt; IO (Output a, Input a, STM ())
forall a. Buffer a -&gt; IO (Output a, Input a, STM ())
</span><a href="Pipes.Concurrent.html#spawn%27"><span class="hs-identifier hs-var">spawn'</span></a></span><span> </span><span class="annot"><span class="annottext">Buffer a
</span><a href="#local-6989586621679064847"><span class="hs-identifier hs-var">buffer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064850"><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064850"><span class="hs-identifier hs-var">seal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064850"><span class="hs-identifier hs-var">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679064851"><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064851"><span class="hs-identifier hs-var">output</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064852"><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064852"><span class="hs-identifier hs-var">input</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679064853"><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064853"><span class="hs-identifier hs-var">seal</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">IO l -&gt; IO r -&gt; IO (l, r)
forall a b. IO a -&gt; IO b -&gt; IO (a, b)
</span><span class="hs-identifier hs-var">Control.Concurrent.Async.concurrently</span></span><span>
</span><span id="line-315"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output a -&gt; IO l
</span><a href="#local-6989586621679064848"><span class="hs-identifier hs-var">fOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Output a
</span><a href="#local-6989586621679064851"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">IO l -&gt; IO () -&gt; IO l
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-operator hs-var">`Control.Exception.finally`</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064853"><span class="hs-identifier hs-var">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input a -&gt; IO r
</span><a href="#local-6989586621679064849"><span class="hs-identifier hs-var">fInput</span></a></span><span>  </span><span class="annot"><span class="annottext">Input a
</span><a href="#local-6989586621679064852"><span class="hs-identifier hs-var">input</span></a></span><span>  </span><span class="annot"><span class="annottext">IO r -&gt; IO () -&gt; IO r
forall a b. IO a -&gt; IO b -&gt; IO a
</span><span class="hs-operator hs-var">`Control.Exception.finally`</span></span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM ()
</span><a href="#local-6989586621679064853"><span class="hs-identifier hs-var">seal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="annot"><span class="hs-comment">-- | 'Buffer' specifies how to buffer messages stored within the mailbox</span></span><span>
</span><span id="line-320"></span><span class="hs-keyword">data</span><span> </span><span id="Buffer"><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-var">Buffer</span></a></span></span><span> </span><span id="local-6989586621679064856"><span class="annot"><a href="#local-6989586621679064856"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Unbounded"><span class="annot"><a href="Pipes.Concurrent.html#Unbounded"><span class="hs-identifier hs-var">Unbounded</span></a></span></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Bounded"><span class="annot"><a href="Pipes.Concurrent.html#Bounded"><span class="hs-identifier hs-var">Bounded</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Single"><span class="annot"><a href="Pipes.Concurrent.html#Single"><span class="hs-identifier hs-var">Single</span></a></span></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Latest"><span class="annot"><a href="Pipes.Concurrent.html#Latest"><span class="hs-identifier hs-var">Latest</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679064856"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Newest"><span class="annot"><a href="Pipes.Concurrent.html#Newest"><span class="hs-identifier hs-var">Newest</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="New"><span class="annot"><a href="Pipes.Concurrent.html#New"><span class="hs-identifier hs-var">New</span></a></span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">Unbounded</span><span> </span><span class="hs-pragma">&quot;Use `unbounded` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-329"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">Bounded</span><span> </span><span class="hs-pragma">&quot;Use `bounded` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-330"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">Single</span><span> </span><span class="hs-pragma">&quot;Use @`bounded` 1@ instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-331"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">Latest</span><span> </span><span class="hs-pragma">&quot;Use `latest` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-332"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">Newest</span><span> </span><span class="hs-pragma">&quot;Use `newest` instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-333"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">New</span><span> </span><span class="hs-pragma">&quot;Use @`newest` 1@ instead&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="annot"><span class="hs-comment">-- | Store an unbounded number of messages in a FIFO queue</span></span><span>
</span><span id="line-336"></span><span id="local-6989586621679064448"><span class="annot"><a href="Pipes.Concurrent.html#unbounded"><span class="hs-identifier hs-type">unbounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064448"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-337"></span><span id="unbounded"><span class="annot"><span class="annottext">unbounded :: forall a. Buffer a
</span><a href="Pipes.Concurrent.html#unbounded"><span class="hs-identifier hs-var hs-var">unbounded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a
forall a. Buffer a
</span><a href="Pipes.Concurrent.html#Unbounded"><span class="hs-identifier hs-var">Unbounded</span></a></span><span>
</span><span id="line-338"></span><span>
</span><span id="line-339"></span><span class="annot"><span class="hs-comment">-- | Store a bounded number of messages, specified by the 'Int' argument</span></span><span>
</span><span id="line-340"></span><span id="local-6989586621679064450"><span class="annot"><a href="Pipes.Concurrent.html#bounded"><span class="hs-identifier hs-type">bounded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064450"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-341"></span><span id="bounded"><span class="annot"><span class="annottext">bounded :: forall a. Int -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#bounded"><span class="hs-identifier hs-var hs-var">bounded</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a
forall a. Buffer a
</span><a href="Pipes.Concurrent.html#Single"><span class="hs-identifier hs-var">Single</span></a></span><span>
</span><span id="line-342"></span><span class="annot"><a href="Pipes.Concurrent.html#bounded"><span class="hs-identifier hs-var">bounded</span></a></span><span> </span><span id="local-6989586621679064861"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064861"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Buffer a
forall a. Int -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#Bounded"><span class="hs-identifier hs-var">Bounded</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064861"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="annot"><span class="hs-comment">{-| Only store the 'Latest' message, beginning with an initial value

    'Latest' is never empty nor full.
-}</span></span><span>
</span><span id="line-348"></span><span id="local-6989586621679064454"><span class="annot"><a href="Pipes.Concurrent.html#latest"><span class="hs-identifier hs-type">latest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679064454"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064454"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-349"></span><span id="latest"><span class="annot"><span class="annottext">latest :: forall a. a -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#latest"><span class="hs-identifier hs-var hs-var">latest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Buffer a
forall a. a -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#Latest"><span class="hs-identifier hs-var">Latest</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><span class="hs-comment">{-| Like @Bounded@, but 'send' never fails (the buffer is never full).
    Instead, old elements are discarded to make room for new elements
-}</span></span><span>
</span><span id="line-354"></span><span id="local-6989586621679064862"><span class="annot"><a href="Pipes.Concurrent.html#newest"><span class="hs-identifier hs-type">newest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Pipes.Concurrent.html#Buffer"><span class="hs-identifier hs-type">Buffer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679064862"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-355"></span><span id="newest"><span class="annot"><span class="annottext">newest :: forall a. Int -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#newest"><span class="hs-identifier hs-var hs-var">newest</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Buffer a
forall a. Buffer a
</span><a href="Pipes.Concurrent.html#New"><span class="hs-identifier hs-var">New</span></a></span><span>
</span><span id="line-356"></span><span class="annot"><a href="Pipes.Concurrent.html#newest"><span class="hs-identifier hs-var">newest</span></a></span><span> </span><span id="local-6989586621679064865"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064865"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Buffer a
forall a. Int -&gt; Buffer a
</span><a href="Pipes.Concurrent.html#Newest"><span class="hs-identifier hs-var">Newest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679064865"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><span class="hs-comment">{- $reexport
    @Control.Concurrent@ re-exports 'forkIO', although I recommend using the
    @async@ library instead.

    @Control.Concurrent.STM@ re-exports 'atomically' and 'STM'.

    @System.Mem@ re-exports 'performGC'.
-}</span></span><span>
</span><span id="line-366"></span></pre></body></html>