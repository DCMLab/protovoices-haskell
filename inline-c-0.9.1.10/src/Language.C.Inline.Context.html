<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span class="hs-comment">-- | A 'Context' is used to define the capabilities of the Template Haskell code</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- that handles the inline C code. See the documentation of the data type for</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- more details.</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- In practice, a 'Context' will have to be defined for each library that</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- defines new C types, to allow the TemplateHaskell code to interpret said</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- types correctly.</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html"><span class="hs-identifier">Language.C.Inline.Context</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * 'TypesTable'</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier">TypesTable</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Purity"><span class="hs-identifier">Purity</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#convertType"><span class="hs-identifier">convertType</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#CArray"><span class="hs-identifier">CArray</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#typeNamesFromTypesTable"><span class="hs-identifier">typeNamesFromTypesTable</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- * 'AntiQuoter'</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier">AntiQuoter</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoterId"><span class="hs-identifier">AntiQuoterId</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier">SomeAntiQuoter</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoters"><span class="hs-identifier">AntiQuoters</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * 'Context'</span></span><span>
</span><span id="line-42"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier">Context</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#baseCtx"><span class="hs-identifier">baseCtx</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#fptrCtx"><span class="hs-identifier">fptrCtx</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#funCtx"><span class="hs-identifier">funCtx</span></a></span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#vecCtx"><span class="hs-identifier">vecCtx</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#VecCtx"><span class="hs-identifier">VecCtx</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#bsCtx"><span class="hs-identifier">bsCtx</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;|&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mzero</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MaybeT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runMaybeT</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Unsafe</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Int16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Int32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector.Storable.Mutable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VM</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word8</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.C.Types</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.ForeignPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withForeignPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ptr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FunPtr</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">freeHaskellFunPtr</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Foreign.Storable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Storable</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Text.Parser.Token</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashSet</span></span><span class="hs-cpp">


#if MIN_VERSION_base(4,9,0)
</span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;&gt;)</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator">&lt;&gt;</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 710
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Monoid</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Traversable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">traverse</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Language.C.Inline.FunPtr.html"><span class="hs-identifier">Language.C.Inline.FunPtr</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Language.C.Types.html"><span class="hs-identifier">Language.C.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html"><span class="hs-identifier">Language.C.Inline.HaskellIdentifier</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- | A mapping from 'C.TypeSpecifier's to Haskell types.  Needed both to</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- parse C types, and to convert them to Haskell types.</span><span>
</span><span id="line-91"></span><span class="hs-keyword">type</span><span> </span><span id="TypesTable"><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-var">TypesTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.TypeQ</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | A data type to indicate whether the user requested pure or IO</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- function from Haskell</span><span>
</span><span id="line-95"></span><span class="hs-keyword">data</span><span> </span><span id="Purity"><span class="annot"><a href="Language.C.Inline.Context.html#Purity"><span class="hs-identifier hs-var">Purity</span></a></span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Pure"><span class="annot"><a href="Language.C.Inline.Context.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="IO"><span class="annot"><a href="Language.C.Inline.Context.html#IO"><span class="hs-identifier hs-var">IO</span></a></span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297907"><span id="local-6989586621679297912"><span class="annot"><span class="annottext">Purity -&gt; Purity -&gt; Bool
(Purity -&gt; Purity -&gt; Bool)
-&gt; (Purity -&gt; Purity -&gt; Bool) -&gt; Eq Purity
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Purity -&gt; Purity -&gt; Bool
== :: Purity -&gt; Purity -&gt; Bool
$c/= :: Purity -&gt; Purity -&gt; Bool
/= :: Purity -&gt; Purity -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297917"><span id="local-6989586621679297919"><span id="local-6989586621679297923"><span class="annot"><span class="annottext">Int -&gt; Purity -&gt; ShowS
[Purity] -&gt; ShowS
Purity -&gt; [Char]
(Int -&gt; Purity -&gt; ShowS)
-&gt; (Purity -&gt; [Char]) -&gt; ([Purity] -&gt; ShowS) -&gt; Show Purity
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Purity -&gt; ShowS
showsPrec :: Int -&gt; Purity -&gt; ShowS
$cshow :: Purity -&gt; [Char]
show :: Purity -&gt; [Char]
$cshowList :: [Purity] -&gt; ShowS
showList :: [Purity] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Specifies how to parse and process an antiquotation in the C code.</span><span>
</span><span id="line-101"></span><span class="hs-comment">--</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- All antiquotations (apart from plain variable capture) have syntax</span><span>
</span><span id="line-103"></span><span class="hs-comment">--</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- $XXX:YYY</span><span>
</span><span id="line-106"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-107"></span><span class="hs-comment">--</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- Where @XXX@ is the name of the antiquoter and @YYY@ is something</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- parseable by the respective 'aqParser'.</span><span>
</span><span id="line-110"></span><span class="hs-keyword">data</span><span> </span><span id="AntiQuoter"><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-var">AntiQuoter</span></a></span></span><span> </span><span id="local-6989586621679297481"><span class="annot"><a href="#local-6989586621679297481"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AntiQuoter"><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-var">AntiQuoter</span></a></span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="aqParser"><span class="annot"><span class="annottext">forall a.
AntiQuoter a
-&gt; forall (m :: * -&gt; *).
   CParser HaskellIdentifier m =&gt;
   m (CIdentifier, Type CIdentifier, a)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var hs-var">aqParser</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679297483"><span class="annot"><a href="#local-6989586621679297483"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CParser"><span class="hs-identifier hs-type">C.CParser</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297483"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297481"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- ^ Parses the body of the antiquotation, returning a hint for the name to</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- assign to the variable that will replace the anti-quotation, the type of</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- said variable, and some arbitrary data which will then be fed to</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- 'aqMarshaller'.</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-comment">-- The 'C.Type' has 'Void' as an identifier type to make sure that</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- no names appear in it.</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="aqMarshaller"><span class="annot"><span class="annottext">forall a.
AntiQuoter a
-&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; a -&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var hs-var">aqMarshaller</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Purity"><span class="hs-identifier hs-type">Purity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-type">TypesTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297481"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Exp</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-comment">-- ^ Takes the requested purity, the current 'TypesTable', and the</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-comment">-- type and the body returned by 'aqParser'.</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-comment">-- Returns the Haskell type for the parameter, and the Haskell expression</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-comment">-- that will be passed in as the parameter.</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- If the the type returned is @ty@, the 'TH.Exp' __must__ have type @forall</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-comment">-- a. (ty -&gt; IO a) -&gt; IO a@. This allows to do resource handling when</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-comment">-- preparing C values.</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-comment">-- Care must be taken regarding 'Purity'. Specifically, the generated IO</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-comment">-- computation must be idempotent to guarantee its safety when used in pure</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-comment">-- code. We cannot prevent the IO computation from being inlined, hence</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-comment">-- potentially duplicated. If non-idempotent marshallers are required (e.g.</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-comment">-- if an update to some global state is needed), it is best to throw an</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-comment">-- error when 'Purity' is 'Pure' (for example &quot;you cannot use context X with</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- @pure@&quot;), which will show up at compile time.</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><span class="hs-comment">-- | An identifier for a 'AntiQuoter'.</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">type</span><span> </span><span id="AntiQuoterId"><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoterId"><span class="hs-identifier hs-var">AntiQuoterId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-comment">-- | Existential wrapper around 'AntiQuoter'.</span></span><span>
</span><span id="line-143"></span><span class="hs-keyword">data</span><span> </span><span id="SomeAntiQuoter"><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-var">SomeAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679297931"><span class="annot"><a href="#local-6989586621679297931"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679297931"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="annot"><a href="#local-6989586621679297931"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="SomeAntiQuoter"><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-var">SomeAntiQuoter</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297931"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-keyword">type</span><span> </span><span id="AntiQuoters"><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoters"><span class="hs-identifier hs-var">AntiQuoters</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoterId"><span class="hs-identifier hs-type">AntiQuoterId</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">-- | A 'Context' stores various information needed to produce the files with</span><span>
</span><span id="line-148"></span><span class="hs-comment">-- the C code derived from the inline C snippets.</span><span>
</span><span id="line-149"></span><span class="hs-comment">--</span><span>
</span><span id="line-150"></span><span class="hs-comment">-- 'Context's can be composed with their 'Monoid' instance, where 'mappend' is</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- right-biased -- in @'mappend' x y@ @y@ will take precedence over @x@.</span><span>
</span><span id="line-152"></span><span class="hs-keyword">data</span><span> </span><span id="Context"><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-var">Context</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Context"><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-var">Context</span></a></span></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ctxTypesTable"><span class="annot"><span class="annottext">Context -&gt; TypesTable
</span><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var hs-var">ctxTypesTable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-type">TypesTable</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Needed to convert C types to Haskell types.</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ctxAntiQuoters"><span class="annot"><span class="annottext">Context -&gt; AntiQuoters
</span><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var hs-var">ctxAntiQuoters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoters"><span class="hs-identifier hs-type">AntiQuoters</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Needed to parse and process antiquotations.</span></span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ctxOutput"><span class="annot"><span class="annottext">Context -&gt; Maybe ShowS
</span><a href="Language.C.Inline.Context.html#ctxOutput"><span class="hs-identifier hs-var hs-var">ctxOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-comment">-- ^ This function is used to post-process the functions generated</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-comment">-- from the C snippets.  Currently just used to specify C linkage</span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-comment">-- when generating C++ code.</span><span>
</span><span id="line-161"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ctxForeignSrcLang"><span class="annot"><span class="annottext">Context -&gt; Maybe ForeignSrcLang
</span><a href="Language.C.Inline.Context.html#ctxForeignSrcLang"><span class="hs-identifier hs-var hs-var">ctxForeignSrcLang</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.ForeignSrcLang</span></span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ TH.LangC by default</span></span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ctxEnableCpp"><span class="annot"><span class="annottext">Context -&gt; Bool
</span><a href="Language.C.Inline.Context.html#ctxEnableCpp"><span class="hs-identifier hs-var hs-var">ctxEnableCpp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="hs-comment">-- ^ Compile source code to raw object.</span></span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ctxRawObjectCompile"><span class="annot"><span class="annottext">Context -&gt; Maybe ([Char] -&gt; Q [Char])
</span><a href="Language.C.Inline.Context.html#ctxRawObjectCompile"><span class="hs-identifier hs-var hs-var">ctxRawObjectCompile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>  </span><span class="hs-special">}</span><span class="hs-cpp">


#if MIN_VERSION_base(4,9,0)
</span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679297942"><span id="local-6989586621679297946"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621679297958"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span></span><span> </span><span id="local-6989586621679297959"><span class="annot"><span class="annottext">&lt;&gt; :: Context -&gt; Context -&gt; Context
</span><span class="hs-operator hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span id="local-6989586621679297960"><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctxTypesTable :: TypesTable
</span><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var">ctxTypesTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; TypesTable
</span><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var">ctxTypesTable</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable -&gt; TypesTable -&gt; TypesTable
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; TypesTable
</span><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var">ctxTypesTable</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxAntiQuoters :: AntiQuoters
</span><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; AntiQuoters
</span><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">AntiQuoters -&gt; AntiQuoters -&gt; AntiQuoters
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; AntiQuoters
</span><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxOutput :: Maybe ShowS
</span><a href="Language.C.Inline.Context.html#ctxOutput"><span class="hs-identifier hs-var">ctxOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ShowS
</span><a href="Language.C.Inline.Context.html#ctxOutput"><span class="hs-identifier hs-var">ctxOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ShowS -&gt; Maybe ShowS -&gt; Maybe ShowS
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ShowS
</span><a href="Language.C.Inline.Context.html#ctxOutput"><span class="hs-identifier hs-var">ctxOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxForeignSrcLang :: Maybe ForeignSrcLang
</span><a href="Language.C.Inline.Context.html#ctxForeignSrcLang"><span class="hs-identifier hs-var">ctxForeignSrcLang</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ForeignSrcLang
</span><a href="Language.C.Inline.Context.html#ctxForeignSrcLang"><span class="hs-identifier hs-var">ctxForeignSrcLang</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang
-&gt; Maybe ForeignSrcLang -&gt; Maybe ForeignSrcLang
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ForeignSrcLang
</span><a href="Language.C.Inline.Context.html#ctxForeignSrcLang"><span class="hs-identifier hs-var">ctxForeignSrcLang</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxEnableCpp :: Bool
</span><a href="Language.C.Inline.Context.html#ctxEnableCpp"><span class="hs-identifier hs-var">ctxEnableCpp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Bool
</span><a href="Language.C.Inline.Context.html#ctxEnableCpp"><span class="hs-identifier hs-var">ctxEnableCpp</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Bool
</span><a href="Language.C.Inline.Context.html#ctxEnableCpp"><span class="hs-identifier hs-var">ctxEnableCpp</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxRawObjectCompile :: Maybe ([Char] -&gt; Q [Char])
</span><a href="Language.C.Inline.Context.html#ctxRawObjectCompile"><span class="hs-identifier hs-var">ctxRawObjectCompile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ([Char] -&gt; Q [Char])
</span><a href="Language.C.Inline.Context.html#ctxRawObjectCompile"><span class="hs-identifier hs-var">ctxRawObjectCompile</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297960"><span class="hs-identifier hs-var">ctx1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([Char] -&gt; Q [Char])
-&gt; Maybe ([Char] -&gt; Q [Char]) -&gt; Maybe ([Char] -&gt; Q [Char])
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; Maybe ([Char] -&gt; Q [Char])
</span><a href="Language.C.Inline.Context.html#ctxRawObjectCompile"><span class="hs-identifier hs-var">ctxRawObjectCompile</span></a></span><span> </span><span class="annot"><span class="annottext">Context
</span><a href="#local-6989586621679297958"><span class="hs-identifier hs-var">ctx2</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-special">}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-181"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679297966"><span id="local-6989586621679297969"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679297975"><span class="annot"><span class="annottext">mempty :: Context
</span><span class="hs-identifier hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctxTypesTable :: TypesTable
</span><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var">ctxTypesTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypesTable
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxAntiQuoters :: AntiQuoters
</span><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AntiQuoters
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxOutput :: Maybe ShowS
</span><a href="Language.C.Inline.Context.html#ctxOutput"><span class="hs-identifier hs-var">ctxOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ShowS
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxForeignSrcLang :: Maybe ForeignSrcLang
</span><a href="Language.C.Inline.Context.html#ctxForeignSrcLang"><span class="hs-identifier hs-var">ctxForeignSrcLang</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxEnableCpp :: Bool
</span><a href="Language.C.Inline.Context.html#ctxEnableCpp"><span class="hs-identifier hs-var">ctxEnableCpp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctxRawObjectCompile :: Maybe ([Char] -&gt; Q [Char])
</span><a href="Language.C.Inline.Context.html#ctxRawObjectCompile"><span class="hs-identifier hs-var">ctxRawObjectCompile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Char] -&gt; Q [Char])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">}</span><span class="hs-cpp">

#if !MIN_VERSION_base(4,11,0)
</span><span>  </span><span class="hs-identifier">mappend</span><span> </span><span class="hs-identifier">ctx2</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Context</span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctxTypesTable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxTypesTable</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">ctxTypesTable</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctxAntiQuoters</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxAntiQuoters</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">&lt;&gt;</span><span> </span><span class="hs-identifier">ctxAntiQuoters</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctxOutput</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxOutput</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">&lt;|&gt;</span><span> </span><span class="hs-identifier">ctxOutput</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctxForeignSrcLang</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxForeignSrcLang</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">&lt;|&gt;</span><span> </span><span class="hs-identifier">ctxForeignSrcLang</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctxEnableCpp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxEnableCpp</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">ctxEnableCpp</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctxRawObjectCompile</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctxRawObjectCompile</span><span> </span><span class="hs-identifier">ctx1</span><span> </span><span class="hs-operator">&lt;|&gt;</span><span> </span><span class="hs-identifier">ctxRawObjectCompile</span><span> </span><span class="hs-identifier">ctx2</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">}</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- | Context useful to work with vanilla C. Used by default.</span><span>
</span><span id="line-203"></span><span class="hs-comment">--</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- 'ctxTypesTable': converts C basic types to their counterparts in</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- &quot;Foreign.C.Types&quot;.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- No 'ctxAntiQuoters'.</span><span>
</span><span id="line-208"></span><span class="annot"><a href="Language.C.Inline.Context.html#baseCtx"><span class="hs-identifier hs-type">baseCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-209"></span><span id="baseCtx"><span class="annot"><span class="annottext">baseCtx :: Context
</span><a href="Language.C.Inline.Context.html#baseCtx"><span class="hs-identifier hs-var hs-var">baseCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#ctxTypesTable"><span class="hs-identifier hs-var">ctxTypesTable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#baseTypesTable"><span class="hs-identifier hs-type">baseTypesTable</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="Language.C.Inline.Context.html#baseTypesTable"><span class="hs-identifier hs-type">baseTypesTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.TypeQ</span></span><span>
</span><span id="line-214"></span><span id="baseTypesTable"><span class="annot"><span class="annottext">baseTypesTable :: TypesTable
</span><a href="Language.C.Inline.Context.html#baseTypesTable"><span class="hs-identifier hs-var hs-var">baseTypesTable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TypeSpecifier, TypeQ)] -&gt; TypesTable
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="Language.C.Types.html#Void"><span class="hs-identifier hs-var">C.Void</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>  </span><span class="hs-comment">-- Types from Foreign.C.Types in the order in which they are presented there,</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-comment">-- along with its documentation's section headers.</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">-- Integral types</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="Language.C.Types.html#Bool"><span class="hs-identifier hs-var">C.Bool</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CBool</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-var">C.Char</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Sign
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CChar</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-var">C.Char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; Maybe Sign
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CSChar</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-var">C.Char</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; Maybe Sign
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Unsigned"><span class="hs-identifier hs-var">C.Unsigned</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUChar</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Short"><span class="hs-identifier hs-var">C.Short</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CShort</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Short"><span class="hs-identifier hs-var">C.Short</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Unsigned"><span class="hs-identifier hs-var">C.Unsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUShort</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Int"><span class="hs-identifier hs-var">C.Int</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Int"><span class="hs-identifier hs-var">C.Int</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Unsigned"><span class="hs-identifier hs-var">C.Unsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUInt</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-var">C.Long</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-var">C.Long</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Unsigned"><span class="hs-identifier hs-var">C.Unsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CULong</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;ptrdiff_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CPtrdiff</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;size_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CSize</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;wchar_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CWchar</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;sig_atomic_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CSigAtomic</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#LLong"><span class="hs-identifier hs-var">C.LLong</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLLong</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sign -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#LLong"><span class="hs-identifier hs-var">C.LLong</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Unsigned"><span class="hs-identifier hs-var">C.Unsigned</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CULLong</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;intptr_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CIntPtr</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uintptr_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUIntPtr</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;intmax_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CIntMax</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uintmax_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUIntMax</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-comment">-- Numeric types</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;clock_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CClock</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;time_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CTime</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;useconds_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CUSeconds</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;suseconds_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CSUSeconds</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-comment">-- Floating types</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="Language.C.Types.html#Float"><span class="hs-identifier hs-var">C.Float</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CFloat</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="Language.C.Types.html#Double"><span class="hs-identifier hs-var">C.Double</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CDouble</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-comment">-- Other types</span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;FILE&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CFile</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;fpos_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CFpos</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;jmp_buf&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CJmpBuf</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-comment">-- Types from stdint.h that can be statically mapped to their Haskell</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-comment">-- equivalents. Excludes int_fast*_t and int_least*_t and the corresponding</span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-comment">-- unsigned types, since their sizes are platform-specific.</span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;int8_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int8</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;int16_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int16</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;int32_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int32</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;int64_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uint8_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uint16_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uint32_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><span class="hs-string">&quot;uint64_t&quot;</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span> </span><span class="hs-special">|]</span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="annot"><span class="hs-comment">-- | An alias for 'Ptr'.</span></span><span>
</span><span id="line-266"></span><span class="hs-keyword">type</span><span> </span><span id="CArray"><span class="annot"><a href="Language.C.Inline.Context.html#CArray"><span class="hs-identifier hs-var">CArray</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- Type conversion</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- | Given a 'Context', it uses its 'ctxTypesTable' to convert</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- arbitrary C types.</span><span>
</span><span id="line-273"></span><span class="annot"><a href="Language.C.Inline.Context.html#convertType"><span class="hs-identifier hs-type">convertType</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Purity"><span class="hs-identifier hs-type">Purity</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-type">TypesTable</span></a></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span id="convertType"><span class="annot"><span class="annottext">convertType :: Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; Q (Maybe Type)
</span><a href="Language.C.Inline.Context.html#convertType"><span class="hs-identifier hs-var hs-var">convertType</span></a></span></span><span> </span><span id="local-6989586621679298019"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298019"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298020"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298020"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaybeT Q Type -&gt; Q (Maybe Type)
forall (m :: * -&gt; *) a. MaybeT m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">runMaybeT</span></span><span> </span><span class="annot"><span class="annottext">(MaybeT Q Type -&gt; Q (Maybe Type))
-&gt; (Type CIdentifier -&gt; MaybeT Q Type)
-&gt; Type CIdentifier
-&gt; Q (Maybe Type)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679298023"><span class="annot"><span class="annottext">goDecl :: ParameterDeclaration CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298023"><span class="hs-identifier hs-var hs-var">goDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Type CIdentifier -&gt; MaybeT Q Type)
-&gt; (ParameterDeclaration CIdentifier -&gt; Type CIdentifier)
-&gt; ParameterDeclaration CIdentifier
-&gt; MaybeT Q Type
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ParameterDeclaration CIdentifier -&gt; Type CIdentifier
forall i. ParameterDeclaration i -&gt; Type i
</span><a href="Language.C.Types.html#parameterDeclarationType"><span class="hs-identifier hs-var">C.parameterDeclarationType</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="#local-6989586621679298022"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Type</span></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679298022"><span class="annot"><span class="annottext">go :: Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679298025"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298025"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298025"><span class="hs-identifier hs-var">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span id="local-6989586621679298026"><span class="annot"><span class="annottext">Specifiers
</span><a href="#local-6989586621679298026"><span class="hs-identifier hs-var">_specs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Template"><span class="hs-identifier hs-type">C.Template</span></a></span><span> </span><span id="local-6989586621679298028"><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298028"><span class="hs-identifier hs-var">ident'</span></a></span></span><span> </span><span id="local-6989586621679298029"><span class="annot"><span class="annottext">[TypeSpecifier]
</span><a href="#local-6989586621679298029"><span class="hs-identifier hs-var">cTys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span class="hs-comment">--        let symbol = TH.LitT (TH.StrTyLit (C.unCIdentifier ident'))</span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621679298030"><span class="annot"><a href="#local-6989586621679298030"><span class="hs-identifier hs-var">symbol</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeSpecifier -&gt; TypesTable -&gt; Maybe TypeQ
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CIdentifier -&gt; TypeSpecifier
</span><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-var">C.TypeName</span></a></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298028"><span class="hs-identifier hs-var">ident'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298020"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>          </span><span class="annot"><span class="annottext">Maybe TypeQ
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT Q TypeQ
forall a. MaybeT Q a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-289"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298032"><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298032"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q TypeQ
forall a. a -&gt; MaybeT Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298032"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span id="local-6989586621679298033"><span class="annot"><a href="#local-6989586621679298033"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">forM</span></span><span> </span><span class="annot"><a href="#local-6989586621679298029"><span class="hs-identifier hs-type">cTys</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298034"><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298034"><span class="hs-identifier hs-var">cTys'</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Specifiers -&gt; TypeSpecifier -&gt; Type CIdentifier
forall i. Specifiers -&gt; TypeSpecifier -&gt; Type i
</span><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-var">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">Specifiers
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298034"><span class="hs-identifier hs-var">cTys'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679298033"><span class="hs-identifier hs-type">hsTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; MaybeT Q Type
forall a. [Char] -&gt; MaybeT Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; MaybeT Q Type) -&gt; [Char] -&gt; MaybeT Q Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Can not find template parameters.&quot;</span></span><span>
</span><span id="line-293"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679298036"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298036"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>            </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TypeQ -&gt; MaybeT Q Type) -&gt; TypeQ -&gt; MaybeT Q Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">TH.AppT</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; TypeQ -&gt; Q (Type -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298030"><span class="hs-identifier hs-var">symbol</span></a></span><span> </span><span class="annot"><span class="annottext">Q (Type -&gt; Type) -&gt; TypeQ -&gt; TypeQ
forall a b. Q (a -&gt; b) -&gt; Q a -&gt; Q b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298036"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-295"></span><span>          </span><span id="local-6989586621679298039"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679298039"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-296"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298040"><span class="annot"><span class="annottext">tuple :: Type
</span><a href="#local-6989586621679298040"><span class="hs-identifier hs-var hs-var">tuple</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; [Type] -&gt; Type
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679298042"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298042"><span class="hs-identifier hs-var">tuple</span></a></span></span><span> </span><span id="local-6989586621679298043"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298043"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">TH.AppT</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298042"><span class="hs-identifier hs-var">tuple</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298043"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Type
</span><span class="hs-identifier hs-var">TH.PromotedTupleT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679298039"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679298039"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-297"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(TypeQ -&gt; MaybeT Q Type) -&gt; TypeQ -&gt; MaybeT Q Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><span class="hs-identifier hs-var">TH.AppT</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; TypeQ -&gt; Q (Type -&gt; Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298030"><span class="hs-identifier hs-var">symbol</span></a></span><span> </span><span class="annot"><span class="annottext">Q (Type -&gt; Type) -&gt; TypeQ -&gt; TypeQ
forall a b. Q (a -&gt; b) -&gt; Q a -&gt; Q b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298040"><span class="hs-identifier hs-var">tuple</span></a></span><span>
</span><span id="line-298"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span id="local-6989586621679298046"><span class="annot"><span class="annottext">Specifiers
</span><a href="#local-6989586621679298046"><span class="hs-identifier hs-var">_specs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TemplateConst"><span class="hs-identifier hs-type">C.TemplateConst</span></a></span><span> </span><span id="local-6989586621679298048"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298048"><span class="hs-identifier hs-var">num</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-299"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298049"><span class="annot"><span class="annottext">n :: Type
</span><a href="#local-6989586621679298049"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyLit -&gt; Type
</span><span class="hs-identifier hs-var">TH.LitT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; TyLit
</span><span class="hs-identifier hs-var">TH.NumTyLit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Integer
forall a. Read a =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298048"><span class="hs-identifier hs-var">num</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>        </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298049"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span id="local-6989586621679298053"><span class="annot"><span class="annottext">Specifiers
</span><a href="#local-6989586621679298053"><span class="hs-identifier hs-var">_specs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TemplatePointer"><span class="hs-identifier hs-type">C.TemplatePointer</span></a></span><span> </span><span id="local-6989586621679298055"><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298055"><span class="hs-identifier hs-var">cSpec</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeSpecifier -&gt; TypesTable -&gt; Maybe TypeQ
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298055"><span class="hs-identifier hs-var">cSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298020"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-303"></span><span>          </span><span class="annot"><span class="annottext">Maybe TypeQ
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT Q Type
forall a. MaybeT Q a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298056"><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298056"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298056"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span id="local-6989586621679298057"><span class="annot"><span class="annottext">Specifiers
</span><a href="#local-6989586621679298057"><span class="hs-identifier hs-var">_specs</span></a></span></span><span> </span><span id="local-6989586621679298058"><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298058"><span class="hs-identifier hs-var">cSpec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-306"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TypeSpecifier -&gt; TypesTable -&gt; Maybe TypeQ
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TypeSpecifier
</span><a href="#local-6989586621679298058"><span class="hs-identifier hs-var">cSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298020"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><span class="annottext">Maybe TypeQ
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaybeT Q Type
forall a. MaybeT Q a
forall (m :: * -&gt; *) a. MonadPlus m =&gt; m a
</span><span class="hs-identifier hs-var">mzero</span></span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298059"><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298059"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeQ -&gt; MaybeT Q Type
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; MaybeT m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">TypeQ
</span><a href="#local-6989586621679298059"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-309"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span id="local-6989586621679298061"><span class="annot"><span class="annottext">[TypeQualifier]
</span><a href="#local-6989586621679298061"><span class="hs-identifier hs-var">_quals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Proto"><span class="hs-identifier hs-type">C.Proto</span></a></span><span> </span><span id="local-6989586621679298063"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298063"><span class="hs-identifier hs-var">retType</span></a></span></span><span> </span><span id="local-6989586621679298064"><span class="annot"><span class="annottext">[ParameterDeclaration CIdentifier]
</span><a href="#local-6989586621679298064"><span class="hs-identifier hs-var">pars</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-310"></span><span>        </span><span id="local-6989586621679298065"><span class="annot"><a href="#local-6989586621679298065"><span class="hs-identifier hs-var">hsRetType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298063"><span class="hs-identifier hs-var">retType</span></a></span><span>
</span><span id="line-311"></span><span>        </span><span id="local-6989586621679298066"><span class="annot"><a href="#local-6989586621679298066"><span class="hs-identifier hs-var">hsPars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM</span></span><span> </span><span class="annot"><a href="#local-6989586621679298023"><span class="hs-identifier hs-type">goDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298064"><span class="hs-identifier hs-type">pars</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FunPtr</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298068"><span class="hs-identifier hs-type">buildArr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298066"><span class="hs-identifier hs-type">hsPars</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298065"><span class="hs-identifier hs-type">hsRetType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-313"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span id="local-6989586621679298069"><span class="annot"><span class="annottext">[TypeQualifier]
</span><a href="#local-6989586621679298069"><span class="hs-identifier hs-var">_quals</span></a></span></span><span> </span><span id="local-6989586621679298070"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298070"><span class="hs-identifier hs-var">cTy'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>        </span><span id="local-6989586621679298071"><span class="annot"><a href="#local-6989586621679298071"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298070"><span class="hs-identifier hs-var">cTy'</span></a></span><span>
</span><span id="line-315"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298071"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-316"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#Array"><span class="hs-identifier hs-type">C.Array</span></a></span><span> </span><span id="local-6989586621679298073"><span class="annot"><span class="annottext">ArrayType CIdentifier
</span><a href="#local-6989586621679298073"><span class="hs-identifier hs-var">_mbSize</span></a></span></span><span> </span><span id="local-6989586621679298074"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298074"><span class="hs-identifier hs-var">cTy'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>        </span><span id="local-6989586621679298075"><span class="annot"><a href="#local-6989586621679298075"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier -&gt; MaybeT Q Type
</span><a href="#local-6989586621679298022"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298074"><span class="hs-identifier hs-var">cTy'</span></a></span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">lift</span></span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#CArray"><span class="hs-identifier hs-type">CArray</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298075"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><a href="Language.C.Types.html#Proto"><span class="hs-identifier hs-type">C.Proto</span></a></span><span> </span><span id="local-6989586621679298076"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298076"><span class="hs-identifier hs-var">_retType</span></a></span></span><span> </span><span id="local-6989586621679298077"><span class="annot"><span class="annottext">[ParameterDeclaration CIdentifier]
</span><a href="#local-6989586621679298077"><span class="hs-identifier hs-var">_pars</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-comment">-- We cannot convert standalone prototypes</span><span>
</span><span id="line-321"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">mzero</span></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679298068"><span class="annot"><span class="annottext">buildArr :: [Type] -&gt; Type -&gt; TypeQ
</span><a href="#local-6989586621679298068"><span class="hs-identifier hs-var hs-var">buildArr</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621679298078"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298078"><span class="hs-identifier hs-var">hsRetType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298019"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-325"></span><span>        </span><span class="annot"><span class="annottext">Purity
</span><a href="Language.C.Inline.Context.html#Pure"><span class="hs-identifier hs-var">Pure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298078"><span class="hs-identifier hs-var">hsRetType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-326"></span><span>        </span><span class="annot"><span class="annottext">Purity
</span><a href="Language.C.Inline.Context.html#IO"><span class="hs-identifier hs-var">IO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298078"><span class="hs-identifier hs-var">hsRetType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><a href="#local-6989586621679298068"><span class="hs-identifier hs-var">buildArr</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679298079"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298079"><span class="hs-identifier hs-var">hsPar</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679298080"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679298080"><span class="hs-identifier hs-var">hsPars</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679298081"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298081"><span class="hs-identifier hs-var">hsRetType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-328"></span><span>      </span><span class="hs-special">[t|</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298079"><span class="hs-identifier hs-var">hsPar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; TypeQ
</span><a href="#local-6989586621679298068"><span class="hs-identifier hs-var">buildArr</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621679298080"><span class="hs-identifier hs-var">hsPars</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298081"><span class="hs-identifier hs-var">hsRetType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="annot"><a href="Language.C.Inline.Context.html#typeNamesFromTypesTable"><span class="hs-identifier hs-type">typeNamesFromTypesTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-type">TypesTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#TypeNames"><span class="hs-identifier hs-type">C.TypeNames</span></a></span><span>
</span><span id="line-331"></span><span id="typeNamesFromTypesTable"><span class="annot"><span class="annottext">typeNamesFromTypesTable :: TypesTable -&gt; TypeNames
</span><a href="Language.C.Inline.Context.html#typeNamesFromTypesTable"><span class="hs-identifier hs-var hs-var">typeNamesFromTypesTable</span></a></span></span><span> </span><span id="local-6989586621679298082"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298082"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CIdentifier] -&gt; TypeNames
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.fromList</span></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298084"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Language.C.Types.html#TypeName"><span class="hs-identifier hs-type">C.TypeName</span></a></span><span> </span><span id="local-6989586621679298084"><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298084"><span class="hs-identifier hs-var">id'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypesTable -&gt; [TypeSpecifier]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298082"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- Useful contexts</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.ExpQ</span></span><span>
</span><span id="line-338"></span><span id="getHsVariable"><span class="annot"><span class="annottext">getHsVariable :: [Char] -&gt; HaskellIdentifier -&gt; ExpQ
</span><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-var hs-var">getHsVariable</span></a></span></span><span> </span><span id="local-6989586621679298087"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298087"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679298088"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298088"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679298089"><span class="annot"><a href="#local-6989586621679298089"><span class="hs-identifier hs-var">mbHsName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Maybe Name)
</span><span class="hs-identifier hs-var">TH.lookupValueName</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Q (Maybe Name)) -&gt; [Char] -&gt; Q (Maybe Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier -&gt; [Char]
</span><a href="Language.C.Inline.HaskellIdentifier.html#unHaskellIdentifier"><span class="hs-identifier hs-var">unHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298088"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679298089"><span class="hs-identifier hs-type">mbHsName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><span class="annottext">Maybe Name
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ExpQ
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ExpQ) -&gt; [Char] -&gt; ExpQ
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot capture Haskell variable &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier -&gt; [Char]
</span><a href="Language.C.Inline.HaskellIdentifier.html#unHaskellIdentifier"><span class="hs-identifier hs-var">unHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298088"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-342"></span><span>                      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;, because it's not in scope. (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298087"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298092"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298092"><span class="hs-identifier hs-var">hsName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpQ
forall (m :: * -&gt; *). Quote m =&gt; Name -&gt; m Exp
</span><span class="hs-identifier hs-var">TH.varE</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298092"><span class="hs-identifier hs-var">hsName</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-type">convertType_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Purity"><span class="hs-identifier hs-type">Purity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#TypesTable"><span class="hs-identifier hs-type">TypesTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Q</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TH.Type</span></span><span>
</span><span id="line-346"></span><span id="convertType_"><span class="annot"><span class="annottext">convertType_ :: [Char] -&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; TypeQ
</span><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-var hs-var">convertType_</span></a></span></span><span> </span><span id="local-6989586621679298094"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298094"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span id="local-6989586621679298095"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298095"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298096"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298096"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span id="local-6989586621679298097"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298097"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>  </span><span id="local-6989586621679298098"><span class="annot"><a href="#local-6989586621679298098"><span class="hs-identifier hs-var">mbHsType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; Q (Maybe Type)
</span><a href="Language.C.Inline.Context.html#convertType"><span class="hs-identifier hs-var">convertType</span></a></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298095"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298096"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298097"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679298098"><span class="hs-identifier hs-type">mbHsType</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><span class="annottext">Maybe Type
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TypeQ
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TypeQ) -&gt; [Char] -&gt; TypeQ
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Cannot convert C type (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298094"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298099"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298099"><span class="hs-identifier hs-var">hsType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298099"><span class="hs-identifier hs-var">hsType</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-comment">-- | This 'Context' adds support for 'ForeignPtr' arguments. It adds a unique</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- marshaller called @fptr-ptr@. For example, @$fptr-ptr:(int *x)@ extracts the</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- bare C pointer out of foreign pointer @x@.</span><span>
</span><span id="line-355"></span><span class="annot"><a href="Language.C.Inline.Context.html#fptrCtx"><span class="hs-identifier hs-type">fptrCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-356"></span><span id="fptrCtx"><span class="annot"><span class="annottext">fptrCtx :: Context
</span><a href="Language.C.Inline.Context.html#fptrCtx"><span class="hs-identifier hs-var hs-var">fptrCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;fptr-ptr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#fptrAntiQuoter"><span class="hs-identifier hs-type">fptrAntiQuoter</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="annot"><a href="Language.C.Inline.Context.html#fptrAntiQuoter"><span class="hs-identifier hs-type">fptrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-361"></span><span id="fptrAntiQuoter"><span class="annot"><span class="annottext">fptrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#fptrAntiQuoter"><span class="hs-identifier hs-var hs-var">fptrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (CIdentifier, Type CIdentifier, HaskellIdentifier)
forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-var">cDeclAqParser</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298104"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298104"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298105"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298105"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span id="local-6989586621679298106"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298106"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298107"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298107"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>      </span><span id="local-6989586621679298108"><span class="annot"><a href="#local-6989586621679298108"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; TypeQ
</span><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-var">convertType_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fptrCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298104"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298105"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298106"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-365"></span><span>      </span><span id="local-6989586621679298109"><span class="annot"><a href="#local-6989586621679298109"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fptrCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298107"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span id="local-6989586621679298110"><span class="annot"><a href="#local-6989586621679298110"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">withForeignPtr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">coerce</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298109"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-367"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298108"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298110"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-comment">-- | This 'Context' includes a 'AntiQuoter' that removes the need for</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- explicitely creating 'FunPtr's, named @&quot;fun&quot;@ along with one which</span><span>
</span><span id="line-372"></span><span class="hs-comment">-- allocates new memory which must be manually freed named @&quot;fun-alloc&quot;@.</span><span>
</span><span id="line-373"></span><span class="hs-comment">--</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- For example, we can capture function @f@ of type @CInt -&gt; CInt -&gt; IO</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- CInt@ in C code using @$fun:(int (*f)(int, int))@.</span><span>
</span><span id="line-376"></span><span class="hs-comment">--</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- When used in a @pure@ embedding, the Haskell function will have to be</span><span>
</span><span id="line-378"></span><span class="hs-comment">-- pure too.  Continuing the example above we'll have @CInt -&gt; CInt -&gt;</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- IO CInt@.</span><span>
</span><span id="line-380"></span><span class="hs-comment">--</span><span>
</span><span id="line-381"></span><span class="hs-comment">-- Does not include the 'baseCtx', since most of the time it's going to</span><span>
</span><span id="line-382"></span><span class="hs-comment">-- be included as part of larger contexts.</span><span>
</span><span id="line-383"></span><span class="hs-comment">--</span><span>
</span><span id="line-384"></span><span class="hs-comment">-- IMPORTANT: When using the @fun@ anti quoter, one must be aware that</span><span>
</span><span id="line-385"></span><span class="hs-comment">-- the function pointer which is automatically generated is freed when</span><span>
</span><span id="line-386"></span><span class="hs-comment">-- the code contained in the block containing the anti quoter exits.</span><span>
</span><span id="line-387"></span><span class="hs-comment">-- Thus, if you need the function pointer to be longer-lived, you must</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- allocate it and free it manually using 'freeHaskellFunPtr'.</span><span>
</span><span id="line-389"></span><span class="hs-comment">-- We provide utilities to easily</span><span>
</span><span id="line-390"></span><span class="hs-comment">-- allocate them (see 'Language.C.Inline.mkFunPtr').</span><span>
</span><span id="line-391"></span><span class="hs-comment">--</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- IMPORTANT: When using the @fun-alloc@ anti quoter, one must free the allocated</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- function pointer. The GHC runtime provides a function to do this,</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- 'hs_free_fun_ptr' available in the 'HsFFI.h' header.</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="annot"><a href="Language.C.Inline.Context.html#funCtx"><span class="hs-identifier hs-type">funCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-397"></span><span id="funCtx"><span class="annot"><span class="annottext">funCtx :: Context
</span><a href="Language.C.Inline.Context.html#funCtx"><span class="hs-identifier hs-var hs-var">funCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;fun&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#funPtrAntiQuoter"><span class="hs-identifier hs-type">funPtrAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                                  </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;fun-alloc&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#funAllocPtrAntiQuoter"><span class="hs-identifier hs-type">funAllocPtrAntiQuoter</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="annot"><a href="Language.C.Inline.Context.html#funPtrAntiQuoter"><span class="hs-identifier hs-type">funPtrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-403"></span><span id="funPtrAntiQuoter"><span class="annot"><span class="annottext">funPtrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#funPtrAntiQuoter"><span class="hs-identifier hs-var hs-var">funPtrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-404"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (CIdentifier, Type CIdentifier, HaskellIdentifier)
forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-var">cDeclAqParser</span></a></span><span>
</span><span id="line-405"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298115"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298115"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298116"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298116"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span id="local-6989586621679298117"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298117"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298118"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298118"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-406"></span><span>      </span><span id="local-6989586621679298119"><span class="annot"><a href="#local-6989586621679298119"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; TypeQ
</span><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-var">convertType_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;funCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298115"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298116"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298117"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-407"></span><span>      </span><span id="local-6989586621679298120"><span class="annot"><a href="#local-6989586621679298120"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;funCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298118"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679298119"><span class="hs-identifier hs-type">hsTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">TH.AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.ConT</span></span><span> </span><span id="local-6989586621679298122"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298122"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679298123"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298123"><span class="hs-identifier hs-var">hsTy'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298122"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-410"></span><span>          </span><span id="local-6989586621679298124"><span class="annot"><a href="#local-6989586621679298124"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298125"><span class="annot"><a href="#local-6989586621679298125"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-411"></span><span>              </span><span id="local-6989586621679298126"><span class="annot"><a href="#local-6989586621679298126"><span class="hs-identifier hs-var">funPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeQ -&gt; ExpQ
</span><a href="Language.C.Inline.FunPtr.html#mkFunPtr"><span class="hs-identifier hs-var">mkFunPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298123"><span class="hs-identifier hs-var">hsTy'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; ExpQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679298120"><span class="hs-identifier hs-var">hsExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>              </span><span id="local-6989586621679298128"><span class="annot"><a href="#local-6989586621679298128"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621679298125"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298126"><span class="hs-identifier hs-type">funPtr</span></a></span><span>
</span><span id="line-413"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">freeHaskellFunPtr</span></span><span> </span><span class="annot"><a href="#local-6989586621679298126"><span class="hs-identifier hs-type">funPtr</span></a></span><span>
</span><span id="line-414"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298128"><span class="hs-identifier hs-type">x</span></a></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-special">|]</span><span>
</span><span id="line-416"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298119"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298124"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>        </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The `fun' marshaller captures function pointers only&quot;</span></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-419"></span><span>
</span><span id="line-420"></span><span class="annot"><a href="Language.C.Inline.Context.html#funAllocPtrAntiQuoter"><span class="hs-identifier hs-type">funAllocPtrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-421"></span><span id="funAllocPtrAntiQuoter"><span class="annot"><span class="annottext">funAllocPtrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#funAllocPtrAntiQuoter"><span class="hs-identifier hs-var hs-var">funAllocPtrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (CIdentifier, Type CIdentifier, HaskellIdentifier)
forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-var">cDeclAqParser</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298131"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298131"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298132"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298132"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span id="local-6989586621679298133"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298133"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298134"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298134"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-424"></span><span>      </span><span id="local-6989586621679298135"><span class="annot"><a href="#local-6989586621679298135"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; TypeQ
</span><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-var">convertType_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;funCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298131"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298132"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298133"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-425"></span><span>      </span><span id="local-6989586621679298136"><span class="annot"><a href="#local-6989586621679298136"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;funCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298134"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-426"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621679298135"><span class="hs-identifier hs-type">hsTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-427"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">TH.AppT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TH.ConT</span></span><span> </span><span id="local-6989586621679298137"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298137"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679298138"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298138"><span class="hs-identifier hs-var">hsTy'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679298137"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-428"></span><span>          </span><span id="local-6989586621679298139"><span class="annot"><a href="#local-6989586621679298139"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298140"><span class="annot"><a href="#local-6989586621679298140"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-429"></span><span>              </span><span id="local-6989586621679298141"><span class="annot"><a href="#local-6989586621679298141"><span class="hs-identifier hs-var">funPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeQ -&gt; ExpQ
</span><a href="Language.C.Inline.FunPtr.html#mkFunPtr"><span class="hs-identifier hs-var">mkFunPtr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TypeQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621679298138"><span class="hs-identifier hs-var">hsTy'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Exp -&gt; ExpQ
forall a. a -&gt; Q a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Exp
</span><a href="#local-6989586621679298136"><span class="hs-identifier hs-var">hsExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>              </span><span class="annot"><a href="#local-6989586621679298140"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298141"><span class="hs-identifier hs-type">funPtr</span></a></span><span>
</span><span id="line-431"></span><span>            </span><span class="hs-special">|]</span><span>
</span><span id="line-432"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298135"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298139"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>        </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The `fun-alloc' marshaller captures function pointers only&quot;</span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="hs-comment">-- | This 'Context' includes two 'AntiQuoter's that allow to easily use</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- Haskell vectors in C.</span><span>
</span><span id="line-438"></span><span class="hs-comment">--</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- Specifically, the @vec-len@ and @vec-ptr@ will get the length and the</span><span>
</span><span id="line-440"></span><span class="hs-comment">-- pointer underlying mutable ('V.IOVector') and immutable ('V.Vector')</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- storable vectors.</span><span>
</span><span id="line-442"></span><span class="hs-comment">--</span><span>
</span><span id="line-443"></span><span class="hs-comment">-- Note that if you use 'vecCtx' to manipulate immutable vectors you</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- must make sure that the vector is not modified in the C code.</span><span>
</span><span id="line-445"></span><span class="hs-comment">--</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- To use @vec-len@, simply write @$vec-len:x@, where @x@ is something</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- of type @'V.IOVector' a@ or @'V.Vector' a@, for some @a@.  To use</span><span>
</span><span id="line-448"></span><span class="hs-comment">-- @vec-ptr@ you need to specify the type of the pointer,</span><span>
</span><span id="line-449"></span><span class="hs-comment">-- e.g. @$vec-len:(int *x)@ will work if @x@ has type @'V.IOVector'</span><span>
</span><span id="line-450"></span><span class="hs-comment">-- 'CInt'@.</span><span>
</span><span id="line-451"></span><span class="annot"><a href="Language.C.Inline.Context.html#vecCtx"><span class="hs-identifier hs-type">vecCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-452"></span><span id="vecCtx"><span class="annot"><span class="annottext">vecCtx :: Context
</span><a href="Language.C.Inline.Context.html#vecCtx"><span class="hs-identifier hs-var hs-var">vecCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span>
</span><span id="line-454"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;vec-ptr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#vecPtrAntiQuoter"><span class="hs-identifier hs-type">vecPtrAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;vec-len&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#vecLenAntiQuoter"><span class="hs-identifier hs-type">vecLenAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span class="annot"><span class="hs-comment">-- | Type class used to implement the anti-quoters in 'vecCtx'.</span></span><span>
</span><span id="line-460"></span><span class="hs-keyword">class</span><span> </span><span id="VecCtx"><span class="annot"><a href="Language.C.Inline.Context.html#VecCtx"><span class="hs-identifier hs-var">VecCtx</span></a></span></span><span> </span><span id="local-6989586621679297574"><span class="annot"><a href="#local-6989586621679297574"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="VecCtxScalar"><span class="annot"><a href="Language.C.Inline.Context.html#VecCtxScalar"><span class="hs-identifier hs-var">VecCtxScalar</span></a></span></span><span> </span><span id="local-6989586621679297574"><span class="annot"><a href="#local-6989586621679297574"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-operator">*</span></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span>  </span><span id="vecCtxLength"><span class="annot"><a href="Language.C.Inline.Context.html#vecCtxLength"><span class="hs-identifier hs-type">vecCtxLength</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-464"></span><span>  </span><span id="vecCtxUnsafeWith"><span class="annot"><a href="Language.C.Inline.Context.html#vecCtxUnsafeWith"><span class="hs-identifier hs-type">vecCtxUnsafeWith</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span id="local-6989586621679297571"><span class="annot"><a href="#local-6989586621679297574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Context.html#VecCtxScalar"><span class="hs-identifier hs-type">VecCtxScalar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297574"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679297571"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679297571"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679297575"><span class="annot"><span class="hs-identifier hs-type">Storable</span></span><span> </span><span class="annot"><a href="#local-6989586621679297575"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#VecCtx"><span class="hs-identifier hs-type">VecCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679297575"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="VecCtxScalar"><span class="annot"><a href="Language.C.Inline.Context.html#VecCtxScalar"><span class="hs-identifier hs-var">VecCtxScalar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679297575"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679297575"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span>  </span><span id="local-6989586621679298153"><span class="annot"><span class="annottext">vecCtxLength :: Vector a -&gt; Int
</span><a href="Language.C.Inline.Context.html#vecCtxLength"><span class="hs-identifier hs-var hs-var hs-var">vecCtxLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; Int
forall a. Storable a =&gt; Vector a -&gt; Int
</span><span class="hs-identifier hs-var">V.length</span></span><span>
</span><span id="line-470"></span><span>  </span><span id="local-6989586621679298156"><span class="annot"><span class="annottext">vecCtxUnsafeWith :: forall b.
Vector a -&gt; (Ptr (VecCtxScalar (Vector a)) -&gt; IO b) -&gt; IO b
</span><a href="Language.C.Inline.Context.html#vecCtxUnsafeWith"><span class="hs-identifier hs-var hs-var hs-var">vecCtxUnsafeWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Vector a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
Vector a -&gt; (Ptr (VecCtxScalar (Vector a)) -&gt; IO b) -&gt; IO b
forall a b. Storable a =&gt; Vector a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">V.unsafeWith</span></span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679297581"><span class="annot"><span class="hs-identifier hs-type">Storable</span></span><span> </span><span class="annot"><a href="#local-6989586621679297581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#VecCtx"><span class="hs-identifier hs-type">VecCtx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VM.IOVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679297581"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="VecCtxScalar"><span class="annot"><a href="Language.C.Inline.Context.html#VecCtxScalar"><span class="hs-identifier hs-var">VecCtxScalar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">VM.IOVector</span></span><span> </span><span class="annot"><a href="#local-6989586621679297581"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679297581"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span>  </span><span id="local-6989586621679298163"><span class="annot"><span class="annottext">vecCtxLength :: IOVector a -&gt; Int
</span><a href="Language.C.Inline.Context.html#vecCtxLength"><span class="hs-identifier hs-var hs-var hs-var">vecCtxLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOVector a -&gt; Int
forall a s. Storable a =&gt; MVector s a -&gt; Int
</span><span class="hs-identifier hs-var">VM.length</span></span><span>
</span><span id="line-476"></span><span>  </span><span id="local-6989586621679298166"><span class="annot"><span class="annottext">vecCtxUnsafeWith :: forall b.
IOVector a -&gt; (Ptr (VecCtxScalar (IOVector a)) -&gt; IO b) -&gt; IO b
</span><a href="Language.C.Inline.Context.html#vecCtxUnsafeWith"><span class="hs-identifier hs-var hs-var hs-var">vecCtxUnsafeWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOVector a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
IOVector a -&gt; (Ptr (VecCtxScalar (IOVector a)) -&gt; IO b) -&gt; IO b
forall a b. Storable a =&gt; IOVector a -&gt; (Ptr a -&gt; IO b) -&gt; IO b
</span><span class="hs-identifier hs-var">VM.unsafeWith</span></span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="annot"><a href="Language.C.Inline.Context.html#vecPtrAntiQuoter"><span class="hs-identifier hs-type">vecPtrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-479"></span><span id="vecPtrAntiQuoter"><span class="annot"><span class="annottext">vecPtrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#vecPtrAntiQuoter"><span class="hs-identifier hs-var hs-var">vecPtrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (CIdentifier, Type CIdentifier, HaskellIdentifier)
forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-var">cDeclAqParser</span></a></span><span>
</span><span id="line-481"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298170"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298170"><span class="hs-identifier hs-var">purity</span></a></span></span><span> </span><span id="local-6989586621679298171"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298171"><span class="hs-identifier hs-var">cTypes</span></a></span></span><span> </span><span id="local-6989586621679298172"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298172"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298173"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298173"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-482"></span><span>      </span><span id="local-6989586621679298174"><span class="annot"><a href="#local-6989586621679298174"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Purity -&gt; TypesTable -&gt; Type CIdentifier -&gt; TypeQ
</span><a href="Language.C.Inline.Context.html#convertType_"><span class="hs-identifier hs-var">convertType_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;vecCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298170"><span class="hs-identifier hs-var">purity</span></a></span><span> </span><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298171"><span class="hs-identifier hs-var">cTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298172"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-483"></span><span>      </span><span id="local-6989586621679298175"><span class="annot"><a href="#local-6989586621679298175"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;vecCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298173"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-484"></span><span>      </span><span id="local-6989586621679298176"><span class="annot"><a href="#local-6989586621679298176"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#vecCtxUnsafeWith"><span class="hs-identifier hs-type">vecCtxUnsafeWith</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298175"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-485"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298174"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298176"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span class="annot"><a href="Language.C.Inline.Context.html#vecLenAntiQuoter"><span class="hs-identifier hs-type">vecLenAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-489"></span><span id="vecLenAntiQuoter"><span class="annot"><span class="annottext">vecLenAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#vecLenAntiQuoter"><span class="hs-identifier hs-var hs-var">vecLenAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-490"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-491"></span><span>      </span><span id="local-6989586621679298198"><span class="annot"><a href="#local-6989586621679298198"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HaskellIdentifier
forall i (m :: * -&gt; *). CParser i m =&gt; m i
</span><a href="Language.C.Types.html#parseIdentifier"><span class="hs-identifier hs-var">C.parseIdentifier</span></a></span><span>
</span><span id="line-492"></span><span>      </span><span id="local-6989586621679298200"><span class="annot"><a href="#local-6989586621679298200"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-type">C.parseEnableCpp</span></a></span><span>
</span><span id="line-493"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298202"><span class="annot"><a href="#local-6989586621679298202"><span class="hs-identifier hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HaskellIdentifier -&gt; CIdentifier
</span><a href="Language.C.Inline.HaskellIdentifier.html#mangleHaskellIdentifier"><span class="hs-identifier hs-var">mangleHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679298200"><span class="hs-identifier hs-var">useCpp</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298198"><span class="hs-identifier hs-var">hId</span></a></span><span>
</span><span id="line-494"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298202"><span class="hs-identifier hs-type">cId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-type">C.Long</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-type">C.Signed</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298198"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298204"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298204"><span class="hs-identifier hs-var">_purity</span></a></span></span><span> </span><span id="local-6989586621679298205"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298205"><span class="hs-identifier hs-var">_cTypes</span></a></span></span><span> </span><span id="local-6989586621679298206"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298206"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298207"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298207"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298206"><span class="hs-identifier hs-var">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-497"></span><span>        </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">Specifiers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-type">C.Long</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-498"></span><span>          </span><span id="local-6989586621679298208"><span class="annot"><a href="#local-6989586621679298208"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; HaskellIdentifier -&gt; ExpQ
</span><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-var">getHsVariable</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;vecCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298207"><span class="hs-identifier hs-var">cId</span></a></span><span>
</span><span id="line-499"></span><span>          </span><span id="local-6989586621679298209"><span class="annot"><a href="#local-6989586621679298209"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.Context.html#vecCtxLength"><span class="hs-identifier hs-type">vecCtxLength</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298208"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-500"></span><span>          </span><span id="local-6989586621679298210"><span class="annot"><a href="#local-6989586621679298210"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-501"></span><span>          </span><span id="local-6989586621679298211"><span class="annot"><a href="#local-6989586621679298211"><span class="hs-identifier hs-var">hsExp''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298212"><span class="annot"><a href="#local-6989586621679298212"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679298212"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298209"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-502"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298210"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298211"><span class="hs-identifier hs-type">hsExp''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>        </span><span class="annot"><span class="annottext">Type CIdentifier
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible: got type different from `long' (vecCtx)&quot;</span></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>
</span><span id="line-508"></span><span class="hs-comment">-- | 'bsCtx' serves exactly the same purpose as 'vecCtx', but only for</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- 'BS.ByteString'.  @vec-ptr@ becomes @bs-ptr@, and @vec-len@ becomes</span><span>
</span><span id="line-510"></span><span class="hs-comment">-- @bs-len@.  You don't need to specify the type of the pointer in</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- @bs-ptr@, it will always be @char*@.</span><span>
</span><span id="line-512"></span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- Moreover, @bs-cstr@ works as @bs-ptr@ but it provides a null-terminated</span><span>
</span><span id="line-514"></span><span class="hs-comment">-- copy of the given 'BS.ByteString'.</span><span>
</span><span id="line-515"></span><span class="annot"><a href="Language.C.Inline.Context.html#bsCtx"><span class="hs-identifier hs-type">bsCtx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#Context"><span class="hs-identifier hs-type">Context</span></a></span><span>
</span><span id="line-516"></span><span id="bsCtx"><span class="annot"><span class="annottext">bsCtx :: Context
</span><a href="Language.C.Inline.Context.html#bsCtx"><span class="hs-identifier hs-var hs-var">bsCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Context
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-517"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#ctxAntiQuoters"><span class="hs-identifier hs-var">ctxAntiQuoters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.fromList</span></span><span>
</span><span id="line-518"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;bs-ptr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#bsPtrAntiQuoter"><span class="hs-identifier hs-type">bsPtrAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;bs-len&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#bsLenAntiQuoter"><span class="hs-identifier hs-type">bsLenAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;bs-cstr&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#SomeAntiQuoter"><span class="hs-identifier hs-type">SomeAntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#bsCStrAntiQuoter"><span class="hs-identifier hs-type">bsCStrAntiQuoter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-522"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-523"></span><span>
</span><span id="line-524"></span><span class="annot"><a href="Language.C.Inline.Context.html#bsPtrAntiQuoter"><span class="hs-identifier hs-type">bsPtrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-525"></span><span id="bsPtrAntiQuoter"><span class="annot"><span class="annottext">bsPtrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#bsPtrAntiQuoter"><span class="hs-identifier hs-var hs-var">bsPtrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-527"></span><span>      </span><span id="local-6989586621679298237"><span class="annot"><a href="#local-6989586621679298237"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HaskellIdentifier
forall i (m :: * -&gt; *). CParser i m =&gt; m i
</span><a href="Language.C.Types.html#parseIdentifier"><span class="hs-identifier hs-var">C.parseIdentifier</span></a></span><span>
</span><span id="line-528"></span><span>      </span><span id="local-6989586621679298238"><span class="annot"><a href="#local-6989586621679298238"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-type">C.parseEnableCpp</span></a></span><span>
</span><span id="line-529"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298239"><span class="annot"><a href="#local-6989586621679298239"><span class="hs-identifier hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HaskellIdentifier -&gt; CIdentifier
</span><a href="Language.C.Inline.HaskellIdentifier.html#mangleHaskellIdentifier"><span class="hs-identifier hs-var">mangleHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679298238"><span class="hs-identifier hs-var">useCpp</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298237"><span class="hs-identifier hs-var">hId</span></a></span><span>
</span><span id="line-530"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298239"><span class="hs-identifier hs-type">cId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-type">C.Char</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298237"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298240"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298240"><span class="hs-identifier hs-var">_purity</span></a></span></span><span> </span><span id="local-6989586621679298241"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298241"><span class="hs-identifier hs-var">_cTypes</span></a></span></span><span> </span><span id="local-6989586621679298242"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298242"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298243"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298243"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298242"><span class="hs-identifier hs-var">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-533"></span><span>        </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeQualifier]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">Specifiers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-type">C.Char</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Sign
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-534"></span><span>          </span><span id="local-6989586621679298244"><span class="annot"><a href="#local-6989586621679298244"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CChar</span></span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-535"></span><span>          </span><span id="local-6989586621679298245"><span class="annot"><a href="#local-6989586621679298245"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bsCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298243"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-536"></span><span>          </span><span id="local-6989586621679298246"><span class="annot"><a href="#local-6989586621679298246"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298247"><span class="annot"><a href="#local-6989586621679298247"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.unsafeUseAsCString</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298245"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298249"><span class="annot"><a href="#local-6989586621679298249"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679298247"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298249"><span class="hs-identifier hs-type">ptr</span></a></span><span>  </span><span class="hs-special">|]</span><span>
</span><span id="line-537"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298244"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298246"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>        </span><span class="annot"><span class="annottext">Type CIdentifier
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible: got type different from `char *' (bsCtx)&quot;</span></span><span>
</span><span id="line-540"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="annot"><a href="Language.C.Inline.Context.html#bsLenAntiQuoter"><span class="hs-identifier hs-type">bsLenAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-543"></span><span id="bsLenAntiQuoter"><span class="annot"><span class="annottext">bsLenAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#bsLenAntiQuoter"><span class="hs-identifier hs-var hs-var">bsLenAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-544"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-545"></span><span>      </span><span id="local-6989586621679298270"><span class="annot"><a href="#local-6989586621679298270"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HaskellIdentifier
forall i (m :: * -&gt; *). CParser i m =&gt; m i
</span><a href="Language.C.Types.html#parseIdentifier"><span class="hs-identifier hs-var">C.parseIdentifier</span></a></span><span>
</span><span id="line-546"></span><span>      </span><span id="local-6989586621679298271"><span class="annot"><a href="#local-6989586621679298271"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-type">C.parseEnableCpp</span></a></span><span>
</span><span id="line-547"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298272"><span class="annot"><a href="#local-6989586621679298272"><span class="hs-identifier hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HaskellIdentifier -&gt; CIdentifier
</span><a href="Language.C.Inline.HaskellIdentifier.html#mangleHaskellIdentifier"><span class="hs-identifier hs-var">mangleHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679298271"><span class="hs-identifier hs-var">useCpp</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298270"><span class="hs-identifier hs-var">hId</span></a></span><span>
</span><span id="line-548"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298272"><span class="hs-identifier hs-type">cId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-type">C.Long</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-type">C.Signed</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298270"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298273"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298273"><span class="hs-identifier hs-var">_purity</span></a></span></span><span> </span><span id="local-6989586621679298274"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298274"><span class="hs-identifier hs-var">_cTypes</span></a></span></span><span> </span><span id="local-6989586621679298275"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298275"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298276"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298276"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298275"><span class="hs-identifier hs-var">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>        </span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">Specifiers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Long"><span class="hs-identifier hs-type">C.Long</span></a></span><span> </span><span class="annot"><span class="annottext">Sign
</span><a href="Language.C.Types.html#Signed"><span class="hs-identifier hs-var">C.Signed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>          </span><span id="local-6989586621679298277"><span class="annot"><a href="#local-6989586621679298277"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; HaskellIdentifier -&gt; ExpQ
</span><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-var">getHsVariable</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;bsCtx&quot;</span></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298276"><span class="hs-identifier hs-var">cId</span></a></span><span>
</span><span id="line-553"></span><span>          </span><span id="local-6989586621679298278"><span class="annot"><a href="#local-6989586621679298278"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BS.length</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298277"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-554"></span><span>          </span><span id="local-6989586621679298280"><span class="annot"><a href="#local-6989586621679298280"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CLong</span></span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-555"></span><span>          </span><span id="local-6989586621679298281"><span class="annot"><a href="#local-6989586621679298281"><span class="hs-identifier hs-var">hsExp''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298282"><span class="annot"><a href="#local-6989586621679298282"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679298282"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298278"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-556"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298280"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298281"><span class="hs-identifier hs-type">hsExp''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>        </span><span class="annot"><span class="annottext">Type CIdentifier
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible: got type different from `long' (bsCtx)&quot;</span></span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span class="annot"><a href="Language.C.Inline.Context.html#bsCStrAntiQuoter"><span class="hs-identifier hs-type">bsCStrAntiQuoter</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span>
</span><span id="line-562"></span><span id="bsCStrAntiQuoter"><span class="annot"><span class="annottext">bsCStrAntiQuoter :: AntiQuoter HaskellIdentifier
</span><a href="Language.C.Inline.Context.html#bsCStrAntiQuoter"><span class="hs-identifier hs-var hs-var">bsCStrAntiQuoter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#AntiQuoter"><span class="hs-identifier hs-type">AntiQuoter</span></a></span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">aqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#aqParser"><span class="hs-identifier hs-var">aqParser</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-564"></span><span>      </span><span id="local-6989586621679298303"><span class="annot"><a href="#local-6989586621679298303"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HaskellIdentifier
forall i (m :: * -&gt; *). CParser i m =&gt; m i
</span><a href="Language.C.Types.html#parseIdentifier"><span class="hs-identifier hs-var">C.parseIdentifier</span></a></span><span>
</span><span id="line-565"></span><span>      </span><span id="local-6989586621679298304"><span class="annot"><a href="#local-6989586621679298304"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-type">C.parseEnableCpp</span></a></span><span>
</span><span id="line-566"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298305"><span class="annot"><a href="#local-6989586621679298305"><span class="hs-identifier hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HaskellIdentifier -&gt; CIdentifier
</span><a href="Language.C.Inline.HaskellIdentifier.html#mangleHaskellIdentifier"><span class="hs-identifier hs-var">mangleHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679298304"><span class="hs-identifier hs-var">useCpp</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298303"><span class="hs-identifier hs-var">hId</span></a></span><span>
</span><span id="line-567"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298305"><span class="hs-identifier hs-type">cId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-type">C.Char</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298303"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">aqMarshaller :: Purity
-&gt; TypesTable
-&gt; Type CIdentifier
-&gt; HaskellIdentifier
-&gt; Q (Type, Exp)
</span><a href="Language.C.Inline.Context.html#aqMarshaller"><span class="hs-identifier hs-var">aqMarshaller</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298306"><span class="annot"><span class="annottext">Purity
</span><a href="#local-6989586621679298306"><span class="hs-identifier hs-var">_purity</span></a></span></span><span> </span><span id="local-6989586621679298307"><span class="annot"><span class="annottext">TypesTable
</span><a href="#local-6989586621679298307"><span class="hs-identifier hs-var">_cTypes</span></a></span></span><span> </span><span id="local-6989586621679298308"><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298308"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span id="local-6989586621679298309"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298309"><span class="hs-identifier hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-569"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type CIdentifier
</span><a href="#local-6989586621679298308"><span class="hs-identifier hs-var">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-570"></span><span>        </span><span class="annot"><a href="Language.C.Types.html#Ptr"><span class="hs-identifier hs-type">C.Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">[TypeQualifier]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#TypeSpecifier"><span class="hs-identifier hs-type">C.TypeSpecifier</span></a></span><span> </span><span class="annot"><span class="annottext">Specifiers
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Char"><span class="hs-identifier hs-type">C.Char</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Sign
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>          </span><span id="local-6989586621679298310"><span class="annot"><a href="#local-6989586621679298310"><span class="hs-identifier hs-var">hsTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[t|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ptr</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CChar</span></span><span> </span><span class="hs-special">|]</span><span>
</span><span id="line-572"></span><span>          </span><span id="local-6989586621679298311"><span class="annot"><a href="#local-6989586621679298311"><span class="hs-identifier hs-var">hsExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Inline.Context.html#getHsVariable"><span class="hs-identifier hs-type">getHsVariable</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;bsCtx&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679298309"><span class="hs-identifier hs-type">cId</span></a></span><span>
</span><span id="line-573"></span><span>          </span><span id="local-6989586621679298312"><span class="annot"><a href="#local-6989586621679298312"><span class="hs-identifier hs-var">hsExp'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[|</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298313"><span class="annot"><a href="#local-6989586621679298313"><span class="hs-identifier hs-var">cont</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.useAsCString</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="#local-6989586621679298311"><span class="hs-identifier hs-type">hsExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298315"><span class="annot"><a href="#local-6989586621679298315"><span class="hs-identifier hs-var">ptr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679298313"><span class="hs-identifier hs-type">cont</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298315"><span class="hs-identifier hs-type">ptr</span></a></span><span>  </span><span class="hs-special">|]</span><span>
</span><span id="line-574"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298310"><span class="hs-identifier hs-type">hsTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298312"><span class="hs-identifier hs-type">hsExp'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><span class="annottext">Type CIdentifier
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-576"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; Q (Type, Exp)
forall a. [Char] -&gt; Q a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible: got type different from `char *' (bsCtx)&quot;</span></span><span>
</span><span id="line-577"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-578"></span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-comment">-- Utils</span><span>
</span><span id="line-581"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span id="local-6989586621679298316"><span class="annot"><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-type">cDeclAqParser</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CParser"><span class="hs-identifier hs-type">C.CParser</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298316"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679298316"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-586"></span><span id="cDeclAqParser"><span class="annot"><span class="annottext">cDeclAqParser :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
m (CIdentifier, Type CIdentifier, HaskellIdentifier)
</span><a href="Language.C.Inline.Context.html#cDeclAqParser"><span class="hs-identifier hs-var hs-var">cDeclAqParser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-587"></span><span>  </span><span id="local-6989586621679298342"><span class="annot"><a href="#local-6989586621679298342"><span class="hs-identifier hs-var">cTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ParameterDeclaration HaskellIdentifier)
-&gt; m (ParameterDeclaration HaskellIdentifier)
forall (m :: * -&gt; *) a. TokenParsing m =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">Parser.parens</span></span><span> </span><span class="annot"><span class="annottext">m (ParameterDeclaration HaskellIdentifier)
forall i (m :: * -&gt; *).
(CParser i m, Pretty i) =&gt;
m (ParameterDeclaration i)
</span><a href="Language.C.Types.html#parseParameterDeclaration"><span class="hs-identifier hs-var">C.parseParameterDeclaration</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span id="local-6989586621679298345"><span class="annot"><a href="#local-6989586621679298345"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-type">C.parseEnableCpp</span></a></span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Language.C.Types.html#parameterDeclarationId"><span class="hs-identifier hs-var">C.parameterDeclarationId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298342"><span class="hs-identifier hs-type">cTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-590"></span><span>    </span><span class="annot"><span class="annottext">Maybe HaskellIdentifier
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m (CIdentifier, Type CIdentifier, HaskellIdentifier)
forall a. [Char] -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Every captured function must be named (funCtx)&quot;</span></span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679298347"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298347"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679298348"><span class="annot"><span class="annottext">cId :: CIdentifier
</span><a href="#local-6989586621679298348"><span class="hs-identifier hs-var hs-var hs-var">cId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; HaskellIdentifier -&gt; CIdentifier
</span><a href="Language.C.Inline.HaskellIdentifier.html#mangleHaskellIdentifier"><span class="hs-identifier hs-var">mangleHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679298345"><span class="hs-identifier hs-var">useCpp</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298347"><span class="hs-identifier hs-var">hId</span></a></span><span>
</span><span id="line-593"></span><span>     </span><span id="local-6989586621679298349"><span class="annot"><a href="#local-6989586621679298349"><span class="hs-identifier hs-var">cTy'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type HaskellIdentifier -&gt; m (Type CIdentifier)
forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
Type HaskellIdentifier -&gt; m (Type CIdentifier)
</span><a href="Language.C.Inline.Context.html#deHaskellifyCType"><span class="hs-identifier hs-var">deHaskellifyCType</span></a></span><span> </span><span class="annot"><span class="annottext">(Type HaskellIdentifier -&gt; m (Type CIdentifier))
-&gt; Type HaskellIdentifier -&gt; m (Type CIdentifier)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ParameterDeclaration HaskellIdentifier -&gt; Type HaskellIdentifier
forall i. ParameterDeclaration i -&gt; Type i
</span><a href="Language.C.Types.html#parameterDeclarationType"><span class="hs-identifier hs-var">C.parameterDeclarationType</span></a></span><span> </span><span class="annot"><span class="annottext">ParameterDeclaration HaskellIdentifier
</span><a href="#local-6989586621679298342"><span class="hs-identifier hs-var">cTy</span></a></span><span>
</span><span id="line-594"></span><span>     </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679298348"><span class="hs-identifier hs-type">cId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298349"><span class="hs-identifier hs-type">cTy'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679298347"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span id="local-6989586621679297619"><span class="annot"><a href="Language.C.Inline.Context.html#deHaskellifyCType"><span class="hs-identifier hs-type">deHaskellifyCType</span></a></span><span>
</span><span id="line-597"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CParser"><span class="hs-identifier hs-type">C.CParser</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297619"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-598"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#HaskellIdentifier"><span class="hs-identifier hs-type">HaskellIdentifier</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297619"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Types.html#Type"><span class="hs-identifier hs-type">C.Type</span></a></span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#CIdentifier"><span class="hs-identifier hs-type">C.CIdentifier</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-599"></span><span id="deHaskellifyCType"><span class="annot"><span class="annottext">deHaskellifyCType :: forall (m :: * -&gt; *).
CParser HaskellIdentifier m =&gt;
Type HaskellIdentifier -&gt; m (Type CIdentifier)
</span><a href="Language.C.Inline.Context.html#deHaskellifyCType"><span class="hs-identifier hs-var hs-var">deHaskellifyCType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HaskellIdentifier -&gt; m CIdentifier)
-&gt; Type HaskellIdentifier -&gt; m (Type CIdentifier)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Type a -&gt; f (Type b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">((HaskellIdentifier -&gt; m CIdentifier)
 -&gt; Type HaskellIdentifier -&gt; m (Type CIdentifier))
-&gt; (HaskellIdentifier -&gt; m CIdentifier)
-&gt; Type HaskellIdentifier
-&gt; m (Type CIdentifier)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679298375"><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298375"><span class="hs-identifier hs-var">hId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-600"></span><span>  </span><span id="local-6989586621679298376"><span class="annot"><a href="#local-6989586621679298376"><span class="hs-identifier hs-var">useCpp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool
forall i (m :: * -&gt; *). CParser i m =&gt; m Bool
</span><a href="Language.C.Types.html#parseEnableCpp"><span class="hs-identifier hs-var">C.parseEnableCpp</span></a></span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Language.C.Types.Parse.html#cIdentifierFromString"><span class="hs-identifier hs-type">C.cIdentifierFromString</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298376"><span class="hs-identifier hs-type">useCpp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.C.Inline.HaskellIdentifier.html#unHaskellIdentifier"><span class="hs-identifier hs-var">unHaskellIdentifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679298375"><span class="hs-identifier hs-type">hId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-602"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679298378"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298378"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m CIdentifier
forall a. [Char] -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m CIdentifier) -&gt; [Char] -&gt; m CIdentifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Illegal Haskell identifier &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier -&gt; [Char]
</span><a href="Language.C.Inline.HaskellIdentifier.html#unHaskellIdentifier"><span class="hs-identifier hs-var">unHaskellIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">HaskellIdentifier
</span><a href="#local-6989586621679298375"><span class="hs-identifier hs-var">hId</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-603"></span><span>                       </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; in C type:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679298378"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679298379"><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298379"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CIdentifier -&gt; m CIdentifier
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">CIdentifier
</span><a href="#local-6989586621679298379"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-605"></span></pre></body></html>